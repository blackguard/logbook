/*! For license information please see main.js.LICENSE.txt */
(()=>{var e,t,n,s,i={256:e=>{function t(e){return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=()=>[],t.resolve=t,t.id=256,e.exports=t},129:e=>{function t(e){return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=()=>[],t.resolve=t,t.id=129,e.exports=t},907:e=>{function t(e){return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=()=>[],t.resolve=t,t.id=907,e.exports=t},886:(e,t,n)=>{"use strict";n.d(t,{w:()=>s});class s{constructor(){this.#e=[]}#e;empty(){return this.#e.length<=0}add(e,t,n,s){const i={target:e,type:t,listener:n,options:s};if(this.constructor.#t(i),-1!==this.#n(i))throw new Error("equivalent event handler already added");e.addEventListener(t,n,s),this.#e.push(i)}remove(e,t,n,s){const i={target:e,type:t,listener:n,options:s};this.constructor.#t(i);const r=this.#n(i);if(-1===r)throw new Error("specified event handler not found");this.#e.splice(r,1),e.removeEventListener(e,t,s)}remove_all(){for(const e of this.#e){const{target:t,type:n,listener:s,options:i}=e;t.removeEventListener(n,s,i)}this.#e.splice(0)}reattach(){for(const e of this.#e){const{target:t,type:n,listener:s,options:i}=e;t.removeEventListener(n,s,i),t.addEventListener(n,s,i)}}#n(e){for(let t=0;t<this.#e.length;t++)if(this.constructor.#s(e,this.#e[t]))return t;return-1}static#t(e){if("object"!=typeof e)throw new Error("spec must be an object");let t=!1;const{target:n,type:s,listener:i,options:r}=e;if(!(n instanceof EventTarget))throw new Error("target must be an instance of EventTarget");if("string"!=typeof s)throw new Error("type in spec must be a string");if("function"!=typeof i)throw new Error("listener in spec must be a function");if("boolean"==typeof r)t=r;else if("object"==typeof r)t=!!r.capture;else if(void 0!==r)throw new Error("options in spec must be a undefined, boolean, or an object");return t}static#s(e,t){return this.#t(e)===this.#t(t)&&e.target===t.target&&e.type===t.type&&e.listener===t.listener}}},345:(e,t,n)=>{"use strict";n.d(t,{H:()=>r});var s=n(889);class i{static fsaapi_available=globalThis.FileSystemHandle&&globalThis.FileSystemFileHandle&&globalThis.FileSystemDirectoryHandle&&"function"==typeof globalThis.showOpenFilePicker&&"function"==typeof globalThis.showSaveFilePicker&&"function"==typeof globalThis.showDirectoryPicker;static ensure_fsaapi_available(){if(!this.fsaapi_available)throw new Error("unexpected: File System API is not available")}get fsaapi_available(){return this.constructor.fsaapi_available}async verify_permission(e,t=!1){this.constructor.ensure_fsaapi_available();const n={};return t&&(n.writable=!0,n.mode="readwrite"),"granted"===await e.queryPermission(n)||"granted"===await e.requestPermission(n)}async save(e,t){if(!this.fsaapi_available)return this.legacy_save(e,t);let n=(t=t??{}).file_handle;if(!n){const e=await this.prompt_for_save(t.prompt_options);if(e.canceled)return{canceled:!0};n=e.file_handle}await this.verify_permission(n,!0);const s=e(),i=await n.createWritable();return await i.write(s),await i.close(),{file_handle:n,stats:await this.get_fs_stats_for_file_handle(n)}}async open(e){if(!this.fsaapi_available)return this.legacy_open(e);let t=(e=e??{}).file_handle;if(!t){const n=await this.prompt_for_open(e.prompt_options);if(n.canceled)return{canceled:!0};t=n.file_handle}await this.verify_permission(t,!1);const n=await t.getFile();return{file_handle:t,text:await n.text(),stats:this.get_fs_stats_for_file(n)}}async get_fs_stats_for_file_handle(e){this.constructor.ensure_fsaapi_available(),await this.verify_permission(e);const t=await e.getFile();return this.get_fs_stats_for_file(t)}get_fs_stats_for_file(e){const{lastModified:t,lastModified:n,name:s,size:i,type:r}=e;return{lastModified:t,last_modified:n,name:s,size:i,type:r}}async prompt_for_save(e=void 0){this.constructor.ensure_fsaapi_available();const t=await this._prompt(globalThis.showSaveFilePicker,e);return t?{file_handle:t}:{canceled:!0}}async prompt_for_open(e=void 0){this.constructor.ensure_fsaapi_available(),e=e??{};const t=await this._prompt(globalThis.showOpenFilePicker,{...e,multiple:!1});return t?{file_handle:t[0]}:{canceled:!0}}async _prompt(e,t){t=t??{};try{return await e(t)}catch(e){return}}async legacy_save(e,t){return new Promise(((n,s)=>{const i=e(),r=document.createElement("a");r.download=t?.name??"Untitled.logbook",r.href=URL.createObjectURL(new Blob([i],{type:"text/plain"})),document.body.onfocus=e=>{document.body.onfocus=null,URL.revokeObjectURL(r.href),r.href=null,n({})},r.click()}))}async legacy_open(e){const t=this._convert_options_for_legacy(e);let n=document.getElementById(this.constructor.legacy_file_input_element_id);n||(n=document.createElement("input"),n.id=this.constructor.legacy_file_input_element_id,n.classList.add("hidden-fs-interface-element"),n.type="file",t&&(n.accept=t),document.body.insertBefore(n,document.body.firstChild));const i=new s.i;return n.onchange=async e=>{if(n.files.length<=0)i.resolve({canceled:!0});else{const e=n.files[0],t=await e.text(),s=this.get_fs_stats_for_file(e);i.resolve({text:t,stats:s})}},n.click(),i.promise}static legacy_file_input_element_id="legacy_file_input_element_id";_convert_options_for_legacy(e){e=e??{};const t=e?.prompt_options?.types?.[0]?.accept;return t?Object.keys(t):void 0}}const r=new i},7:(e,t,n)=>{"use strict";function s(e,t){for(const n of t)e=(e??{})[n];return e}function i(e,t,n){if(t.length<1)throw new Error("path must contain at least one segment");for(const n of t.slice(0,-1))void 0===e[n]&&(e[n]={}),e=e[n];e[t.slice(-1)[0]]=n}n.d(t,{$:()=>i,Z:()=>s})},889:(e,t,n)=>{"use strict";n.d(t,{i:()=>s});class s{constructor(){let e,t;const n=new Promise(((n,s)=>{e=n,t=s}));Object.defineProperties(this,{promise:{value:n},resolve:{value:e},reject:{value:t},then:{value:n.then.bind(n)},catch:{value:n.catch.bind(n)},finally:{value:n.finally.bind(n)}})}async await(){return await this.promise}}},660:(e,t,n)=>{"use strict";n.a(e,(async(e,s)=>{try{n.d(t,{Z:()=>r});var i=n(984);const e=new URL("../../node_modules/rxjs/dist/bundles/rxjs.umd.min.js","file:///home/ed/code/logbook/lib/sys/rxjs.js");await(0,i.h0)(document.head,e);const r={...globalThis.rxjs};globalThis.rxjs=void 0,s()}catch(e){s(e)}}),1)},429:(e,t,n)=>{"use strict";n.d(t,{T:()=>i,X:()=>s});class s{constructor(e,t=null,n=!1){if(null==e)throw new Error("target must not be null or undefined");if(t??=e=>e.stop(),"function"!=typeof t)throw new Error("stopper must be a function taking target as a parameter");Object.defineProperties(this,{target:{value:e,enumerable:!0},stopper:{value:t,enumerable:!0},multiple_stops:{value:n,enumerable:!0}}),this.#i=0}#i;get stop_count(){return this.#i}get stopped(){return this.#i>0}stop(){return!(!this.multiple_stops&&this.stopped||(this.stopper(this.target),this.#i++,0))}}class i{constructor(){this.#r=[],this.#o=!1}#r;#o;get stopped(){return this.#o}add_stoppable(e){if(!(e instanceof s))throw new Error("stoppable must be an instance of Stoppable");this.#r.push(e)}remove_stoppable(e){this.#r.indexOf(e)}stop(){for(this.#o=!0;this.#r.length>0;)this.#r.pop().stop()}}},92:(e,t,n)=>{"use strict";n.a(e,(async(e,s)=>{try{n.d(t,{l:()=>o});var i=n(660),r=e([i]);i=(r.then?(await r)():r)[0];class o extends i.Z.Subject{dispatch(e){this.next(e)}}s()}catch(e){s(e)}}))},176:(e,t,n)=>{"use strict";function s(e){for(const[t,n]of Object.entries(e))("object"==typeof n||Array.isArray(n))&&s(e[t]);return Object.freeze(e)}n.d(t,{j:()=>s})},896:(e,t,n)=>{"use strict";n.d(t,{pk:()=>c,kE:()=>_,k$:()=>l});const s={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let i;const r=new Uint8Array(16);function o(){if(!i&&(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!i))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(r)}const a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));const l=function(e,t,n){if(s.randomUUID&&!t&&!e)return s.randomUUID();const i=(e=e||{}).random||(e.rng||o)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=i[e];return t}return function(e,t=0){return(a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]).toLowerCase()}(i)};function c(){return`id-${l()}`}function _(){return l()}},951:(e,t,n)=>{"use strict";n.d(t,{V:()=>i});const s="data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=";async function i(){return new Audio(s).play()}},688:(e,t,n)=>{"use strict";n.a(e,(async(e,s)=>{try{n.d(t,{a:()=>a});var i=n(984),r=n(92),o=e([r]);r=(o.then?(await o)():o)[0];class a{constructor(e,t=null){if(!(e instanceof Node))throw new Error("target must be an instance of Node");if(t??={},"object"!=typeof t)throw new Error("options must be null, undefined, or an object");const{neutral_changes_observer:n}=t;if("function"!=typeof n)throw new Error("neutral_changes_observer must be a function");this.#a=e,this.#l=[],this.#c=-1,this.#_=void 0,this.#d=!1,this.#u=new MutationObserver(this.#m.bind(this)),Object.defineProperties(this,{neutral_changes:{value:new r.l,enumerable:!0}}),n&&(this.#h=this.neutral_changes.subscribe(n)),this.#u.observe(this.#a,{childList:!0,subtree:!0,attributeFilter:void 0,attributeOldValue:!0,characterDataOldValue:!0})}get is_connected(){this.#u}disconnect(){this.#u&&(this.#u.disconnect(),this.#u=void 0,this.#d=!1,this.#_=void 0,this.#c=-1,this.#l=[])}get is_neutral(){return this.#_===this.#c}set_neutral(){this.#_=this.#c,this.#p()}reset_neutral(){this.#_=void 0,this.#p()}reset(e=!1){this.#l.splice(0),this.#c=-1,this.#_=void 0,this.#d=!1,e?this.set_neutral():this.#p()}get can_perform_undo(){return this.#c>=0}perform_undo(){if(!this.can_perform_undo)return!1;try{this.#d=!0;const e=this.#l[this.#c--];(0,i.xe)(e.focus_node,e.focus_offset);for(let t=e.mutations.length;--t>=0;)this.#f(e.mutations[t]);return this.#p(),!0}finally{queueMicrotask((()=>{this.#d=!1}))}}get can_perform_redo(){return this.#c<this.#l.length-1}perform_redo(){if(!this.can_perform_redo)return!1;try{this.#d=!0;const e=this.#l[++this.#c];for(let t=0;t<e.mutations.length;t++)this.#b(e.mutations[t]);return this.#p(),!0}finally{queueMicrotask((()=>{this.#d=!1}))}}static MutationData=class{constructor(e,t=null){t&&Object.assign(this,t),Object.defineProperties(this,{mutation:{value:e,enumerable:!0}})}};#a;#l;#c;#_;#d;#u;#h;#f(e){if(!(e instanceof this.constructor.MutationData))throw new Error("mutation_data must be an instance of ChangeManager.MutationData");const{mutation:t}=e;switch(t.type){default:throw new Error(`unknown MutationRecord type: ${t.type}`);case"attributes":"attributeNamespace"in t?(0,i.IX)(t.target,t.attributeNamespace,t.attributeName,t.oldValue):t.target.setAttribute(t.attributeName,t.oldValue);break;case"characterData":t.target.data=t.oldValue;break;case"childList":for(let e=t.addedNodes.length;--e>=0;)t.target.removeChild(t.addedNodes[e]);for(let e=t.removedNodes.length;--e>=0;)t.target.insertBefore(t.removedNodes[e],t.nextSibling)}}#b(e){if(!(e instanceof this.constructor.MutationData))throw new Error("mutation_data must be an instance of ChangeManager.MutationData");const{mutation:t}=e;switch(t.type){default:throw new Error(`unknown MutationRecord type: ${t.type}`);case"attributes":"attributeNamespace"in t?(0,i.IX)(t.target,t.attributeNamespace,t.attributeName,e.newValue):t.target.setAttribute(t.attributeName,e.newValue);break;case"characterData":t.target.data=e.newValue;break;case"childList":for(let e=0;e<t.removedNodes.length;e++)t.target.removeChild(t.removedNodes[e]);for(let e=0;e<t.addedNodes.length;e++)t.target.insertBefore(t.addedNodes[e],t.nextSibling)}}#m(e,t){if(!this.#d){const t=e.map((e=>{const t={newValue:void 0};switch(e.type){case"attributes":{const n="attributeNamespace"in e?e.target.getAttributeNS(e.attributeNamespace,e.attributeName):e.target.getAttribute(e.attributeName);t.newValue=n;break}case"characterData":{const n=e.target.data;t.newValue=n;break}}return new this.constructor.MutationData(e,t)})),n=window.getSelection(),s={timestamp:Date.now(),focus_node:n.focusNode,focus_offset:n.focusOffset,mutations:t};this.#l.splice(this.#c+1,this.#l.length-(this.#c+1)),this.#c=this.#l.length-1,"number"==typeof this.#_&&this.#_>this.#c&&(this.#_=void 0),this.#l.push(s),this.#c=this.#l.length-1}this.#p()}#g(){this.neutral_changes.dispatch({is_neutral:this.is_neutral,change_manager:this})}#v;#p(){const e=this.is_neutral;void 0!==typeof this.#v&&this.#v===e||this.#g(),this.#v=e}}s()}catch(e){s(e)}}))},569:(e,t,n)=>{"use strict";n.a(e,(async(e,s)=>{try{n.d(t,{L_:()=>u,Vq:()=>_,aR:()=>d,cK:()=>m});var i=n(984),r=n(896),o=n(889);const a="file:///home/ed/code/logbook/lib/ui/dialog/_.js";(0,i.KP)(document.head,new URL("./dialog.css",a)),(0,i.KP)(document.head,new URL("../../../node_modules/dialog-polyfill/dist/dialog-polyfill.css",a)),await n(256)(new URL("../../../node_modules/dialog-polyfill/dist/dialog-polyfill.js",a));const l=globalThis.dialogPolyfill,c=new WeakMap;class _{static run(e,t){return(new this).run(e,t)}static is_modal_active(){return[...document.querySelectorAll(`dialog.${this._modal_dialog_css_class}`)].some((e=>e.open))}static instance_from_element(e){return c.get(e.closest("dialog"))}static _modal_dialog_css_class="modal_dialog";constructor(){this._completed=!1,this._promise=new o.i,this._promise.promise.finally((()=>{try{this._destroy_dialog_element()}catch(e){console.warn("ignoring error when finalizing dialog promise",e)}}));try{this._dialog_element_id=`dialog-${(0,r.k$)()}`,this._create_dialog_element(),c.set(this._dialog_element,this)}catch(e){this._cancel(e)}}get promise(){return this._promise.promise}run(...e){return this._populate_dialog_element(...e),l.registerDialog(this._dialog_element),this._dialog_element.showModal(),this.promise}_populate_dialog_element(...e){throw new Error("unimplemented")}_complete(e){this._completed=!0,this._promise.resolve(e)}_cancel(e){this._promise.reject(e??new Error("canceled"))}_create_dialog_element(){if("string"!=typeof this._dialog_element_id)throw new Error("this._dialog_element_id must already be set to a string before calling this method");if(void 0!==this._dialog_element)throw new Error("this._dialog_element must be undefined when calling this method");const e=document.getElementById("content")??(0,i.T1)({parent:document.body,attrs:{id:"content"}});if("DIV"!==e.tagName||e.parentElement!==document.body)throw new Error("pre-existing #content element is not a <div> that is a direct child of document.body");const t=document.getElementById("ui")??(0,i.T1)({before:e.firstChild,attrs:{id:"ui"}});if("DIV"!==t.tagName||t.parentElement!==e)throw new Error("pre-existing #ui element is not a <div> that is a direct child of the #content element");if(document.getElementById(this._dialog_element_id))throw new Error(`unexpected: dialog with id ${this._dialog_element_id} already exists`);const n=(0,i.T1)({parent:t,tag:"dialog",attrs:{id:this._dialog_element_id,class:this.constructor._modal_dialog_css_class}});this._dialog_text_container=(0,i.T1)({parent:n,attrs:{class:"dialog_text"}}),this._dialog_form=(0,i.T1)({parent:n,tag:"form",attrs:{method:"dialog"}}),this._dialog_element=n}_destroy_dialog_element(){this._dialog_element&&(c.delete(this._dialog_element),this._dialog_element.remove()),this._dialog_element.oncancel=null,this._dialog_element.onclose=null,this._dialog_element=void 0}}class d extends _{_populate_dialog_element(e,t){const{accept_button_label:n="Ok"}=t??{};this._dialog_text_container.innerText=e,(0,i.T1)({parent:this._dialog_form,tag:"input",attrs:{type:"submit",value:n}}),this._dialog_element.onclose=e=>this._complete()}}function u(e,t,n){if("string"!=typeof t||""===t)throw new Error("id must be a non-empty string");const{tag:s="input",type:r="text",label:o,label_after:a,attrs:l={}}=n??{};if("id"in l||"type"in l)throw new Error('attrs must not contain "id" or "type"');const c={id:t,...l};"input"===s&&(c.type=r);const _=(0,i.T1)({tag:s,attrs:c});let d;return o&&(d=(0,i.T1)({tag:"label",attrs:{for:t}}),d.innerText=o),a?(e.appendChild(_),e.appendChild(d)):(e.appendChild(d),e.appendChild(_)),_}function m(e,t,n){if("tag"in(n=n??{})||"type"in n)throw new Error('opts must not contain "tag" or "type"');const s=[];if(n.options)for(const{value:e,label:t}of n.options){const n={value:e??t},r=(0,i.T1)({tag:"option",attrs:n});r.innerText=t,s.push(r)}const r=u(e,t,{...n,tag:"select"});for(const e of s)r.appendChild(e);return r}s()}catch(h){s(h)}}),1)},984:(e,t,n)=>{"use strict";n.d(t,{Aj:()=>m,Dz:()=>c,Hp:()=>_,IX:()=>u,KP:()=>b,Ru:()=>o,Sh:()=>A,T1:()=>h,Xc:()=>p,cj:()=>E,gX:()=>a,h0:()=>v,r1:()=>T,rb:()=>f,v0:()=>l,xe:()=>w,yU:()=>k});var s=n(896),i=n(951);const r="file:///home/ed/code/logbook/lib/ui/dom-util.js";function o(e){console.error("initialization failed",e.stack),document.body.innerText="",document.body.classList.add("error");const t=document.createElement("h1");t.textContent="Initialization Failed";const n=document.createElement("pre");n.textContent=e.stack,document.body.appendChild(t),document.body.appendChild(n)}function a(e){if(e instanceof HTMLElement)e.innerText="";else{if(!(e instanceof Node))throw new Error("element must be an instance of Node");for(;e.firstChild;)e.removeChild(e.firstChild)}return e}function l(e){const t=e.getBoundingClientRect();return t.bottom>window.innerHeight&&window.scrollBy(0,t.bottom-window.innerHeight),e}function c(e,t){if(t){if("id"in t&&document.getElementById(d(t.id)))throw new Error(`element already exists with id ${t.id}`);for(const n in t){const s=t[n];null!=s?e.setAttribute(n,d(s)):e.removeAttribute(n)}}return e}function _(e,t){for(const n in t){const s=t[n];void 0!==s&&(null===s?e.style.removeProperty(n):e.style.setProperty(n,s))}return e}function d(e){return void 0===e?"":e.toString()}function u(e,t,n,s){t&&!n.includes(":")&&(n=`${new URL(t).pathname.split("/").findLast((e=>e.length>0))}:${n}`),e.setAttributeNS(t,n,s)}function m(e,t=null){const{parent:n=null,before:s=null}=e??{};let i=n;if(s&&!(s instanceof Node))throw new Error("before must be null, undefined, or an instance of Node");if(s&&!s.parentNode)throw new Error("before must have a parent");if(i){if(s&&s.parentElement!==i)throw new Error("inconsistent parent and before nodes specified")}else s&&(i=s.parentNode);if(t??=Element,i&&!(i instanceof t))throw new Error(`parent must be null, undefined, or an instance of ${t.name}`);return{parent:i,before:s}}function h(e){const{tag:t="div",namespace:n,attrs:i,style:r}=e??{},o=r?HTMLElement:Element,{parent:a,before:l}=m(e,o),c=n?document.createElementNS(n,t):document.createElement(t);let d=!1;if(i)for(const e in i){const t=i[e];null!=t&&c.setAttribute(e,t),"id"==e&&(d=!0)}return d||(c.id=(0,s.pk)()),r&&_(c,r),a&&a.insertBefore(c,l),c}function p(e,t,n=null){if(!(e instanceof HTMLElement))throw new Error("element must be an instance of HTMLElement");const{before:s=null,prevent_coalesce_next:i}=n??{};if(null!==s&&!(s instanceof Node))throw new Error("before must be null or an instance of Node");if(s&&s.parentNode!==e)throw new Error("before must be a child of element");if("string"!=typeof t&&(t=`${t??""}`),!t)return null;let r;if(!r){const n=s?s.previousSibling:e.lastChild;n?.nodeType===Node.TEXT_NODE&&(n.nodeValue+=t,r=n)}if(!r&&s&&!i){const e=s;e.nodeType===Node.TEXT_NODE&&(e.nodeValue=t+e.nodeValue,r=e)}return r||(r=document.createTextNode(t),e.insertBefore(r,s)),r}function f(e){return e.normalize(),e}function b(e,t,n=null,s=!1){if(!(e instanceof Element))throw new Error("parent must be an Element");if("rel"in(n=n??{})||"href"in n)throw new Error('attrs must not contain "rel" or "href"');let i;return s||(i=e.querySelector(`link[rel="stylesheet"][href="${t.toString().replaceAll('"','\\"')}"]`),i?.parentElement!==e&&(i=null)),i??h({parent:e,tag:"link",attrs:{rel:"stylesheet",href:t,...n}})}const g={};async function v(e,t,n=null,s=!1){const i=new URL(t,r),{promise_data:o,initial:a}=function(e){const t=e.toString();let n,s=g[t];return s?n=!1:(s={},s.promise=new Promise(((e,t)=>{s.resolve=e,s.reject=t})),g[t]=s,n=!0),{initial:n,promise_data:s}}(i);if(a){let l;function c(e){o.resolve?.(),d()}function _(e){o.reject?.(new Error(`error loading script ${i}`)),d()}function d(){l&&(l.removeEventListener("load",c),l.removeEventListener("error",_)),o.resolve=null,o.reject=null}try{l=function(e,t,n=null,s=!1){if(!(e instanceof Element))throw new Error("parent must be an Element");if("src"in(n=n??{}))throw new Error('attrs must not contain "src"');let i;return s||(i=e.querySelector(`script[src="${t.toString().replaceAll('"','\\"')}"]`),i?.parentElement!==e&&(i=null)),i??h({parent:e,tag:"script",attrs:{src:t,...n}})}(e,i,n,s),l.addEventListener("load",c,{once:!0}),l.addEventListener("error",_,{once:!0})}catch(u){o.reject?.(u),d()}}return o.promise}function y(e){const t=e?.parentNode?.childNodes;return t?Array.prototype.indexOf.call(t,e):void 0}function w(e,t){window.getSelection().setBaseAndExtent(e,t,e,t)}function A(e){const t=window.getSelection();t?.deleteFromDocument();let n={node:t?.focusNode??null,offset:t?.focusOffset??0};if(n=e(n),!n)throw new Error("updater must return { node, offset } for the new point");return t.setBaseAndExtent(n.node,n.offset,n.node,n.offset),!0}function E(e){const t=window.getSelection();if(t&&!t.isCollapsed)t.deleteFromDocument();else{let n={node:t?.focusNode??null,offset:t?.focusOffset??0};n=e(n),n?t.setBaseAndExtent(n.node,n.offset,n.node,n.offset):(0,i.V)()}return!0}function k(e,t){if("object"!=typeof e)throw new Error("point must be an object");let{node:n,offset:s}=e;if(!n)return null;if(null!=t)if("string"==typeof t)if(n instanceof Text)n.data=`${n.data.substring(0,s)}${t}${n.data.substring(s)}`,s+=t.length;else{const e=document.createTextNode(t);n.insertBefore(e,n.childNodes[s]),s++}else{if(!(t instanceof Node))throw new Error("thing must be a string or an instance of Node");if(n instanceof Text){const e=n.splitText(s);n.parentNode.insertBefore(t,e),n=e,s=0}else n.insertBefore(t,n.childNodes[s]),s++}return{node:n,offset:s}}function T(e,t=null){const{element_too:n,reverse:s}=t??{};let{node:i,offset:r}=e??{};if(!(i instanceof Node)||i.nodeType!==Node.TEXT_NODE&&i.nodeType!==Node.ELEMENT_NODE||"number"!=typeof r||r<0||r>(i.nodeType===Node.TEXT_NODE?i.length:i.childNodes.length))throw new Error("invalid point");for(;;){if(i.nodeType===Node.TEXT_NODE&&i.length>0)if(s){if(r>0)return r--,i.data=i.data.substring(0,r)+i.data.substring(r+1),{node:i,offset:r}}else if(r<i.length)return i.data=i.data.substring(0,r)+i.data.substring(r+1),{node:i,offset:r};if(i.nodeType!==Node.ELEMENT_NODE)break;if(i=i.childNodes[r],!i)return{node:i,offset:0};r=s?i.nodeType===Node.TEXT_NODE?i.length:i.childNodes.length:0}if(i.nodeType===Node.ELEMENT_NODE&&!i.hasChildNodes()){const e={node:i.parentNode,offset:y(i)};return i.parentNode.removeChild(i),e}const o=n?NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT:NodeFilter.SHOW_TEXT,a=document.createTreeWalker(document.body,o,{acceptNode:e=>e.nodeType===Node.TEXT_NODE&&e.length>0||e.nodeType===Node.ELEMENT_NODE&&(!e.hasChildNodes()||[...e.childNodes].every((e=>e.nodeType===Node.TEXT_NODE&&e.length<=0)))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});if(a.currentNode=i,i=s?a.previousNode():a.nextNode(),i){if(i.nodeType===Node.TEXT_NODE)return r=s?i.length-1:0,i.data=i.data.substring(0,r)+i.data.substring(r+1),{node:i,offset:r};{const e={node:i.parentNode,offset:y(i)};return i.parentNode.removeChild(i),e}}return null}},50:(e,t,n)=>{"use strict";n.a(e,(async(e,s)=>{try{n.d(t,{Qm:()=>o.Q,d4:()=>r.d,k7:()=>i.k});var i=n(306),r=n(395),o=n(91),a=e([o]);o=(a.then?(await a)():a)[0],s()}catch(e){s(e)}}))},91:(e,t,n)=>{"use strict";n.a(e,(async(e,s)=>{try{n.d(t,{Q:()=>_});var i=n(306),r=n(395),o=n(886),a=n(951),l=n(92),c=e([l]);l=(c.then?(await c)():c)[0];class _{constructor(e,t){if(!(e instanceof EventTarget))throw new Error("event_target must be and instance of EventTarget");if("function"!=typeof t)throw new Error("command_observer must be a function");this.#y=new o.w;const n=new l.l;this.#w=n.subscribe(t),this.#A=[],this.#E=null,Object.defineProperties(this,{event_target:{value:e,enumerable:!0},command_observer:{value:t,enumerable:!0},commands:{value:n,enumerable:!0}})}#y;#w;#A;#E;reset_key_map_stack(){this.#A.length>0&&(this.#A.splice(0),this.#k())}push_key_map(e){if(!(e instanceof r.d))throw new Error("key_map must be an instance of KeyMap");if(-1!==this.#A.indexOf(e))throw new Error("key_map already exists in stack");this.#A.unshift(e),this.#k()}pop_key_map(){const e=this.#A.shift();return e&&this.#k(),e}remove_key_map(e,t=!1){const n=this.#A.indexOf(e);return-1!==n&&(t?this.#A.splice(0,n+1):this.#A.splice(n,1),this.#k(),!0)}get is_attached(){return!!this.#E}attach(){if(this.is_attached)throw new Error("attach() called when already attached");if(!this.#y.empty)throw new Error("unexpected: attach() called with event listeners already present");if(this.#A.length<=0)return!1;this.#E=r.d.multi_mapper(...this.#A);const e=this.#E;let t,n;function s(){t=e,n=[]}s();const o=s,l=[[this.event_target,"blur",o,{capture:!0}],[this.event_target,"keydown",r=>{switch(r.key){case"Alt":case"AltGraph":case"CapsLock":case"Control":case"Fn":case"FnLock":case"Hyper":case"Meta":case"NumLock":case"ScrollLock":case"Shift":case"Super":case"Symbol":case"SymbolLock":case"OS":break;default:{const o=i.k.from_keyboard_event(r);n.push(o);const l=t.consume(o);if(l)if(r.preventDefault(),"string"==typeof l){const e={command:l,event:r,target:r.target,key_spec:o};this.commands.dispatch(e),s()}else t=l;else t!==e&&(r.preventDefault(),(0,a.V)()),s();break}}},{capture:!0}]];for(const[e,t,n,s]of l)this.#y.add(e,t,n,s);return!0}detach(){this.#y.remove_all(),this.#E=null}#k(){const e=this.is_attached;this.detach(),e&&this.attach()}}s()}catch(e){s(e)}}))},395:(e,t,n)=>{"use strict";n.d(t,{d:()=>i});var s=n(306);class i{constructor(e=null,t=null){Object.defineProperties(this,{bindings:{value:e,enumerable:!0},mapping:{value:this.constructor.#T(e),enumerable:!0},recognizer:{value:t,enumerable:!0}})}create_mapper(e=null){return new this.constructor.Mapper(this.mapping,this.recognizer,e)}static multi_mapper(...e){if(e.length<=0)throw new Error("at least one KeyMap instance must be given");if(!e.every((e=>e instanceof this)))throw new Error("arguments must all be KeyMap instances");return e.reduce(((e,t)=>t.create_mapper(e)),null)}static#T(e){if(null!=e&&"object"!=typeof e)throw new Error("bindings must be null/undefined or an object");const t={};for(const n in e){if(n.length<=0)throw new Error("bindings keys (command names) must not be empty strings");for(const i of e[n]){let e=t;const r=i.split(s.k.canonical_key_string_separator);for(let t=0;t<r.length;t++){const i=r[t],o=t>=r.length-1,a=new s.k(i).canonical,l=e[a];if("string"==typeof l||"object"==typeof l&&o){const e=r.slice(0,t+1).join(s.k.canonical_key_string_separator);throw new Error(`duplicate bindings specified for key sequence: ${e}`)}o?e[a]=n:e=l??(e[a]={})}}}return t}static Mapper=class e{constructor(e,t,n=null){if(null!=e&&"object"!=typeof e)throw new Error("mapping must be null/undefined or an object");if(null!=t&&"function"!=typeof t)throw new Error("recognizer must be null/undefined or a function");if(null!=n&&!(n instanceof this.constructor))throw new Error("fallback_mapper must be null/undefined or a KeyMap instance");if(!e&&!n)throw new Error("at least one of mapping or fallback_mapper must be given");Object.defineProperties(this,{mapping:{value:e,enumerable:!0},recognizer:{value:t,enumerable:!0},fallback_mapper:{value:n,enumerable:!0}})}consume(t){const n=t instanceof s.k?t:new s.k(t),i=this.recognizer?.(n);if("string"==typeof i)return i;const r=n.canonical,o=this.mapping?.[r];if("string"==typeof o)return o;const a=this.fallback_mapper?.consume(n);return"string"==typeof a?a:o||a?o?new e(o,null,a):a:void 0}}}},306:(e,t,n)=>{"use strict";n.d(t,{k:()=>s});class s{constructor(e,t=null){if("string"!=typeof e||e.length<=0)throw new Error("key_string must be a non-empty string");Object.defineProperties(this,{key_string:{value:e,enumerable:!0},context:{value:t,enumerable:!0}}),this.#N()}static canonical_key_modifier_separator="+";static canonical_key_string_separator=" ";static#x={meta:{code:"m",event_prop:"metaKey",glyph:"⌘",display_order:3,alternates:["cmd","command"]},ctrl:{code:"c",event_prop:"ctrlKey",glyph:"⌃",display_order:1,alternates:["control"]},shift:{code:"s",event_prop:"shiftKey",glyph:"⇧",display_order:2,alternates:[]},alt:{code:"a",event_prop:"altKey",glyph:"⌥",display_order:4,alternates:[]}};static#j={arrowleft:"←",arrowup:"↑",arrowright:"→",arrowdown:"↓",enter:"Enter",backspace:"Backspace",delete:"Delete"};static from_keyboard_event(e){const t=[];for(const n in this.#x){const s=this.#x[n];e[s.event_prop]&&t.push(s)}return new this([...t.map((e=>this.#L[e.code])),event.key].join(this.canonical_key_modifier_separator),e)}get glyphs(){if(void 0===this.#C){const e=this.key,t=e.toLowerCase(),n=this.modifier_descs.map((e=>e.glyph));t in this.constructor.#j?n.push(this.constructor.#j[t]):e.match(/^[a-zA-Z]$/)||e.match(/^[fF][0-9]{1,2}$/)?n.push(e.toUpperCase()):n.push(e),this.#C=n.join("")}return this.#C}#C;#N(){const e=this.key_string.split(/[+-]/);if(e.length<1||e.some((e=>e.length<=0)))if(this.key_string.match(/^[+-]$/))e.splice(0),e.push(this.key_string);else{if(!this.key_string.match(/[+-][+-]$/))throw new Error(`invalid key_string ${this.key_string}`);e.splice(-1),e[e.length-1]=this.key_string[this.key_string.length-1]}let t=e.at(-1);e.splice(-1);for(let t=0;t<e.length;t++)e[t]=e[t].toLowerCase();let n=t.toLowerCase();["up","down","left","right"].includes(n)&&(t=`Arrow${t}`,n=`arrow${n}`);const s=[];for(const t of e){const e=this.constructor.#O(t);if(!e)throw new Error(`invalid modifier "${t}" in key_string ${this.key_string}`);if(e.code in s)throw new Error(`redundant modifier "${t}" in key_string ${this.key_string}`);s.push(e)}s.sort(((e,t)=>e.display_order-t.display_order));const i=Object.values(s).reduce(((e,t)=>e|this.constructor.#S[t.code]),0),r=s.map((e=>e.code)).join("");let o=!0;o=0==(i&~this.constructor.shift_flag)&&!(1!==t.length||t.match(/^[\p{C}]$/u));const a=`${r}${this.constructor.canonical_key_modifier_separator}${o?t:n}`;Object.freeze(e),Object.freeze(s),Object.defineProperties(this,{key:{value:t,enumerable:!0},modifiers:{value:e,enumerable:!0},modifier_descs:{value:s,enumerable:!0},modifier_flags:{value:i,enumerable:!0},canonical_modifiers:{value:r,enumerable:!0},canonical:{value:a,enumerable:!0},is_printable:{value:o,enumerable:!0}});for(const e in this.constructor.#x)Object.defineProperty(this,`has_${e}`,{value:this.modifiers.includes(e),enumerable:!0})}static#D;static#M;static#I;static#O(e){return e=e.toLowerCase(),["cmdorctrl","commandorctrl"].includes(e)&&(e=(this.#I?"meta":"ctrl").toLowerCase()),this.#D[e]}static#L;static#U;static#P;static#S;static _init_static(){this.#I=(globalThis.navigator?.platform??globalThis.navigator?.userAgentData?.platform??"").toLowerCase().startsWith("mac"),this.#L={};for(const e in this.#x){const t=this.#x[e];this.#L[t.code]=e}this.#U=Object.fromEntries(Object.entries(this.#x).map((([e,{code:t,glyph:n}])=>[t,n]))),this.#P=Object.fromEntries(Object.entries(this.#x).map((([e,{code:t,display_order:n}])=>[t,n]))),this.#D=this.#z(),this.#M=Object.freeze(Object.fromEntries(Object.keys(this.#x).map((e=>this.#D[e])).map((e=>[e.code,e]))));let e=1;this.#S={};for(const t in this.#x){const n=this.#x[t];this.#S[t]=e,this.#S[n.code]=e,e<<=1}Object.freeze(this.#S);for(const e in this.#x)Object.defineProperty(this,`${e}_flag`,{value:this.#S[e],enumerable:!0})}static#z(){{const e="+-"+this.canonical_key_modifier_separator+this.canonical_key_string_separator,t=Object.keys(this.#x);if(t.some((e=>e!==e.toLowerCase())))throw new Error("KeySpec.#basic_modifier_desc_map keys must be lowercase");const n=t.map((e=>this.#x[e].alternates)).reduce(((e,t)=>[...e,...t]));if(n.some((e=>e!==e.toLowerCase())))throw new Error("KeySpec.#basic_modifier_desc_map alternates must be lowercase");if(new Set([...t,...n]).size!==t.length+n.length)throw new Error("KeySpec.#basic_modifier_desc_map keys and alternates must all be distinct");const s=t.map((e=>this.#x[e].code));for(const t of s){if(1!==t.length)throw new Error("KeySpec.#basic_modifier_desc_map codes must be single characters");if(e.includes(t))throw new Error(`KeySpec.#basic_modifier_desc_map codes are not allowed to be any of following: ${e}`)}if(new Set(s).size!==s.length)throw new Error("KeySpec.#basic_modifier_desc_map code values must be distinct");const i=t.map((e=>this.#x[e].event_prop));if(new Set(i).size!==i.length)throw new Error("KeySpec.#basic_modifier_desc_map event_prop values must be distinct")}const e={};function t(e,t,n){const s={modifier:t,basic_modifier:e,...n,alternates:[...new Set([e,t,...n.alternates])]};return Object.freeze(s)}for(const n in this.#x){const s=this.#x[n];e[n]=t(n,n,s);for(const i of s.alternates)e[i]=t(n,i,s)}return Object.freeze(e)}}s._init_static()},231:(e,t,n)=>{"use strict";n.a(e,(async(e,s)=>{try{n.d(t,{j:()=>_});var i=n(92),r=n(896),o=n(984),a=n(50),l=e([i,a]);[i,a]=l.then?(await l)():l;const c="file:///home/ed/code/logbook/lib/ui/menu/_.js";class _{static menu_element_tag_name="menu";static menuitem_element_tag_name="li";static find_previous_menuitem(e){let t=e.previousElementSibling;for(;t&&(!t.classList.contains("menuitem")||t.classList.contains("disabled"));)t=t.previousElementSibling;return t}static find_next_menuitem(e){let t=e.nextElementSibling;for(;t&&(!t.classList.contains("menuitem")||t.classList.contains("disabled"));)t=t.nextElementSibling;return t}static async create(e,t,n){return new this(e,t,n)}constructor(e,t,n){if(!(e instanceof Element))throw new Error("parent must be an instance of Element");if(null!=n&&"function"!=typeof n)throw new Error("get_command_bindings must be null, undefined, or a function");n??=()=>[];const s=new i.l,r=new i.l;Object.defineProperties(this,{get_command_bindings:{value:n,enumerable:!0},commands:{value:s,enumerable:!0},selects:{value:r,enumerable:!0}}),this.#B={},this.#R=this.#K(e,t)}#B;#R;get element(){return this.#R}#F(e){const t=this.#B[e];if(!t)throw new Error(`no element found for menu id "${e}"`);if(!t.classList.contains("menuitem"))throw new Error(`element for menu id "${e}" is not a menuitem`);return t}async activate(e=null){if(!(this.#R instanceof Element&&this.#R.classList.contains("menubar")))throw new Error('this.#menubar_container must be an Element with class "menubar"');const{set_focus:t}=e??{};if(!this.#R.querySelector(".selected")){const e=this.#R.querySelector(".menuitem");e&&this.#Q(e)}if(t)return new Promise((e=>setTimeout((()=>{this.#R.focus(),e()}))))}deactivate(){this.#W(this.#R)}set_menu_state(e,t){if(t??={},"object"!=typeof t)throw new Error("state_specs must be an object");const n=this.#F(e);for(const[e,s]of Object.entries(t??{}))switch(e){case"enabled":s?n.classList.remove("disabled"):n.classList.add("disabled");break;case"checked":s?n.classList.add("checked"):n.classList.remove("checked");break;default:throw new Error("unknown state name")}}#W(e){if(e){if(!(e instanceof Element)||!e.classList.contains("menubar")&&!e.classList.contains("menu"))throw new Error('menu_element must be an Element with class "menubar" or "menu"');e.classList.remove("active"),e.classList.remove("selected");for(const t of e.children)t.classList.remove("selected"),t.classList.contains("collection")&&this.#W(t.querySelector(".menu"));e.classList.contains("menubar")&&this.selects.dispatch({select:!1,target:e})}}#Q(e){if(!e.classList.contains("selected")){const t=e.closest(".menubar, .menu");if(t.classList.contains("menubar")&&!this.#R.querySelector(".selected")&&this.selects.dispatch({select:!0,target:e}),e.classList.add("selected"),e.classList.contains("collection")){e.querySelector(".menu").classList.add("active");const t=e.querySelector(".menu"),n=e.getBoundingClientRect();e.parentElement.classList.contains("menubar")?(t.style.top=`${n.y+n.height}px`,t.style.left=`${n.x}px`):(t.style.top=n.y-n.height+"px",t.style.left=`${n.x+n.width}px`)}for(const n of t.children)n!==e&&this.#H(n)}}#H(e){e.classList.contains("selected")&&(e.classList.remove("selected"),e.parentElement.classList.contains("menubar")&&!this.#R.querySelector(".selected")&&this.selects.dispatch({select:!1,target:e})),e.classList.contains("collection")&&this.#W(e.querySelector(".menu"))}#q(e){if(!(e instanceof Element))throw new Error("parent must be an instance of Element");(0,o.T1)({parent:e,tag:this.constructor.menuitem_element_tag_name,attrs:{class:"disabled menuitem menuitem-separator"}})}#V(e,t,n=!1){if(!(t instanceof Element))throw new Error("parent must be an instance of Element");if("string"==typeof e)return this.#q(t);const{label:s,collection:i,item:r,id:a}=e;if("string"!=typeof s)throw new Error("label must be specified as a string");if(r&&i)throw new Error("item and collection must not both be specified");if(i&&!Array.isArray(i))throw new Error("collection must be an array");if(r&&("object"!=typeof r||"string"!=typeof r.command))throw new Error('item must specify an object with a string property "command"');if(!["undefined","string"].includes(typeof a)||""===a)throw new Error("id must be a non-empty string");const l=this.#Z(s,n);if(r)this.#$(l,r.command);else{l.classList.add("collection");const e=(0,o.T1)({parent:l,tag:this.constructor.menu_element_tag_name,attrs:{class:"menu"}});n||((0,o.T1)({parent:l,attrs:{class:"menuitem-annotation collection-arrow"}}).innerText="▸"),i.forEach((t=>this.#V(t,e))),n&&l.addEventListener("click",(e=>{e.target.closest(".menuitem")===l&&(l.classList.contains("selected")?this.#H(l):this.#Q(l),e.stopPropagation(),e.preventDefault())}))}return a&&(this.#B[a]=l),t&&t.appendChild(l),l}#Z(e,t=!1){const n=(0,r.pk)(),s=(0,o.T1)({tag:this.constructor.menuitem_element_tag_name,attrs:{id:n,class:"menuitem"}});return(0,o.T1)({parent:s,attrs:{class:"menuitem-label"}}).innerText=e,s.addEventListener("mousemove",(e=>{t&&!this.#R.querySelector(".selected")||s.classList.contains("disabled")||this.#Q(s)})),s}#$(e,t){if(t){const n=this.get_command_bindings()[t];if(n){const t=(0,o.T1)({parent:e,attrs:{class:"menuitem-annotation"}});n.forEach((e=>{const n=new a.k7(e).glyphs;(0,o.T1)({parent:t,tag:"kbd"}).innerText=n}))}}e.addEventListener("click",(n=>{this.#W(e.closest(".menubar"));const s={command:t,event:n,target:n.target};this.commands.dispatch(s),n.stopPropagation(),n.preventDefault()}))}#K(e,t){const n=(0,o.T1)({parent:e,tag:this.constructor.menu_element_tag_name,attrs:{class:"active menubar",role:"navigation",tabindex:0},before:e.firstChild});return t.forEach((e=>this.#V(e,n,!0))),n.addEventListener("blur",(e=>{this.#W(n)})),n.addEventListener("keydown",(e=>{const t=n.querySelectorAll(".selected");if(t.length<=0){if(!["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Enter"," "].includes(e.key))return;{const e=n.querySelector(".menuitem");e&&this.#Q(e)}}else{const s=t[t.length-1],i=s.parentElement===n;let r,o,a,l;switch(i?(r="ArrowLeft",o="ArrowRight",a="ArrowUp",l="ArrowDown"):(r="ArrowUp",o="ArrowDown",a="ArrowLeft",l="ArrowRight"),e.key){case"Enter":case" ":s.click();break;case"Escape":this.#W(n);break;case r:{const e=this.constructor.find_previous_menuitem(s);e?this.#Q(e):i||s.classList.remove("selected");break}case o:{const e=this.constructor.find_next_menuitem(s);e&&this.#Q(e);break}case a:if(!i){const e=n.querySelector(".menuitem.selected"),t=this.constructor.find_previous_menuitem(e);t&&this.#Q(t)}break;case l:{let e=!1;if(s.classList.contains("collection")){const t=s.querySelector(".menuitem:not(.disabled)");t&&(this.#Q(t),e=!0)}if(!e&&!i){const e=n.querySelector(".menuitem.selected"),t=this.constructor.find_next_menuitem(e);t&&this.#Q(t)}break}default:return}}e.stopPropagation(),e.preventDefault()}),{capture:!0}),n}static _init_static(){(0,o.KP)(document.head,new URL("style.css",c))}}_._init_static(),s()}catch(e){s(e)}}))},88:(e,t,n)=>{"use strict";n.a(e,(async(e,s)=>{try{n.d(t,{W:()=>m});var i=n(984),r=n(53),o=n(886),a=n(50),l=n(688),c=n(545),_=n(951),d=e([r,a,l]);[r,a,l]=d.then?(await d)():d;const u="file:///home/ed/code/logbook/src/editor-cell-element/_.js";class m extends HTMLElement{static custom_element_name="editor-cell";static attribute__active="data-active";static attribute__visible="data-visible";constructor(){super(),this.#y=new o.w,this.#G=new a.Qm(this,this.#X.bind(this)),this.#Y=this.get_command_bindings();const e=new a.d4(this.constructor.get_initial_key_map_bindings(),this.constructor.key_map_insert_self_recognizer);this.push_key_map(e),this._tool_bar=null}#y;#G;#Y;get editable(){return!!this.hasAttribute("contenteditable")&&this.getAttribute("contenteditable")!==(!1).toString()}set_editable(e){e?this.setAttribute("contenteditable",(!0).toString()):this.removeAttribute("contenteditable")}reset_key_map_stack(){this.#G.reset_key_map_stack()}push_key_map(e){this.#G.push_key_map(e)}pop_key_map(){return this.#G.pop_key_map()}remove_key_map(e,t=!1){return this.#G.remove_key_map(e,t)}static key_map_insert_self_recognizer(e){return!!e.is_printable&&"insert-self"}async establish_tool_bar(){this._tool_bar||(this._tool_bar=await c.d.create_for(this,{editable:!1,visible:{initial:this.visible,on:e=>this.set_visible(!this.visible)},autoeval:!1,modified:!0}),this.parentElement.insertBefore(this._tool_bar,this))}remove_tool_bar(){this._tool_bar&&(this._tool_bar.remove(),this._tool_bar=void 0)}get_dom_extent(){if(document.body!==this&&document.body?.contains(this)){let e=this,t=this;return this._tool_bar&&(e.compareDocumentPosition(this._tool_bar)&Node.DOCUMENT_POSITION_PRECEDING&&(e=this._tool_bar),t.compareDocumentPosition(this._tool_bar)&Node.DOCUMENT_POSITION_FOLLOWING&&(t=this._tool_bar)),{first:e,last:t}}return null}static async create_cell(e=null){const{parent:t=document.body,before:n=null,editable:s=r.N.editable,innerText:o}=e??{},a=(0,i.T1)({parent:t,before:n,tag:this.custom_element_name,attrs:{tabindex:0}});return a.set_editable(s),o&&(a.innerText=o),await a.establish_tool_bar(),a}adjacent_cell(e=!1){const t=[...document.querySelectorAll(this.tagName)],n=t.indexOf(this);return-1===n?null:e?n>=t.length-1?null:t[n+1]:n<=0?null:t[n-1]}move_cell(e=null){const{parent:t,before:n}=(0,i.Aj)(e);if(t){const e=!!this._tool_bar;this.remove_tool_bar(),t.insertBefore(this,n),e&&this.establish_tool_bar()}else this.parentNode&&this.remove_cell()}remove_cell(){this.remove_tool_bar(),this.remove()}reset(){return this}static get_initial_key_map_bindings(){return{...r.N.constructor.get_global_initial_key_map_bindings()}}get_command_bindings(){return{...r.N.get_global_command_bindings(),"insert-self":this.command_handler__insert_self.bind(this),"insert-line-break":this.command_handler__insert_line_break.bind(this),"delete-text-forward":this.create_command_handler___delete({element_too:!1,reverse:!1}),"delete-text-reverse":this.create_command_handler___delete({element_too:!1,reverse:!0}),"delete-forward":this.create_command_handler___delete({element_too:!0,reverse:!1}),"delete-reverse":this.create_command_handler___delete({element_too:!0,reverse:!0}),cut:this.command_handler__cut.bind(this),copy:this.command_handler__copy.bind(this),paste:this.command_handler__paste.bind(this),"reset-cell":this.command_handler__reset_cell.bind(this),"toggle-cell-visible":this.command_handler__toggle_visible.bind(this)}}#X(e){this.perform_command(e).then((e=>{e||(0,_.V)()})).catch((t=>{console.error("error processing command",e,t),(0,_.V)()}))}async perform_command(e){if(e){const t=e.target;if(t&&this.contains(t)){const t=this.#Y[e.command];return!!t&&t(e)}return!1}return!1}command_handler__insert_self(e){const t=e.key_spec,n=t?.key??t?.canonical??"";return!!n&&(0,i.Sh)((e=>(0,i.yU)(e,n)))}command_handler__insert_line_break(e){return(0,i.Sh)((e=>(0,i.yU)(e,"\n")))}create_command_handler___delete(e){return t=>(0,i.cj)((t=>(0,i.r1)(t,e)))}async command_handler__cut(e){return document.execCommand("cut"),!0}async command_handler__copy(e){return document.execCommand("copy"),!0}async command_handler__paste(e){const t=await navigator.clipboard.readText();return!!t&&(0,i.Sh)((e=>(0,i.yU)(e,t)))}async command_handler__reset_cell(e){return this.reset(),!0}async command_handler__toggle_visible(e){return this.set_visible(!this.visible),!0}get active(){return!!this.hasAttribute(this.constructor.attribute__active)}set_active(e=!1){e?this.setAttribute(this.constructor.attribute__active,!0):this.removeAttribute(this.constructor.attribute__active)}get visible(){return!!this.hasAttribute(this.constructor.attribute__visible)}set_visible(e=!1){e=!!e,this._tool_bar.set_for("visible",e),e?this.setAttribute(this.constructor.attribute__visible,!0):this.removeAttribute(this.constructor.attribute__visible)}#J(){if(this.#y.empty()){function e(e){r.N.set_active_cell(this)}const t=[[this,"focus",e,{capture:!0}]];for(const[n,s,i,o]of t)this.#y.add(n,s,i,o)}}#ee(){this.#y.remove_all()}connectedCallback(){console.log("COMPONENT CONNECTED",this),this.#J(),this.#G.attach()}disconnectedCallback(){console.log("COMPONENT DISCONNECTED",this),this.#ee(),this.#G.detach()}adoptedCallback(){console.log("COMPONENT ADOPTED",this),this.#J(),this.#G.attach()}attributeChangedCallback(e,t,n){console.log("COMPONENT ATTRIBUTE CHANGED",this,{name:e,old_value:t,new_value:n})}static get observedAttributes(){return["xyzzy"]}static _init_static(){globalThis.customElements.define(this.custom_element_name,this),(0,i.KP)(document.head,new URL("style.css",u))}}m._init_static(),s()}catch(e){s(e)}}))},179:(e,t,n)=>{"use strict";n.a(e,(async(e,s)=>{try{n.d(t,{p:()=>u});var i=n(984),r=n(53),o=n(88),a=n(700),l=n(429),c=n(545),_=e([r,o]);[r,o]=_.then?(await _)():_;const d="file:///home/ed/code/logbook/src/eval-cell-element/_.js";class u extends o.W{static custom_element_name="eval-cell";static#te="data-input-type";static#ne="data-output-element-id";get input_type(){return this.getAttribute(this.constructor.#te)}set input_type(e){return this.setAttribute(this.constructor.#te,e),this._tool_bar?.set_type(e),e}constructor(){super(),this.#se=this.#ie.bind(this)}static get output_element_class(){return"eval-cell-output"}get output_element_id(){return this.getAttribute(this.constructor.#ne)}set output_element_id(e){if(null==e||""===e)this.setAttribute(this.constructor.#ne,"");else{const t=document.getElementById(e);if(!t)throw new Error("element with specified id does not exist");if(!(t instanceof HTMLElement))throw new Error("element specified by id must be an instance of HTMLElement");this.setAttribute(this.constructor.#ne,e)}return e}get output_element(){const e=this.output_element_id;if(e){const t=document.getElementById(e);return t&&t instanceof HTMLElement?t:(console.warn("bad configuration of EvalCellElement: id does not specify an HTMLElement"),null)}return null}set output_element(e){if(e??=null,e&&(!e.id||!(e instanceof HTMLElement)))throw new Error("element must be null, undefined, or an instance of HTMLElement with an id");const t=this.output_element;return t!==e&&(t&&t.removeEventListener("pointerdown",this.#se),e&&e.addEventListener("pointerdown",this.#se)),this.output_element_id=e?e.id:null,e}establish_output_element(){let e=this.output_element;if(!e){const t=this.get_dom_extent(),n=t?t.last.nextSibling:this.nextSibling,s=n?.parentElement??this.parentElement;e=(0,i.T1)({parent:s,before:n}),this.output_element=e}return e.classList.add(this.constructor.output_element_class),e}remove_output_element(){const e=this.output_element;return e&&(this.output_element=null,e.remove()),this}#ie(e){this.contains(document.activeElement)||(this.focus(),e.preventDefault(),e.stopPropagation())}#se;move_cell(e=null){const{parent:t,before:n}=(0,i.Aj)(e),s=this.output_element,r=s&&!!(this.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_PRECEDING);if(super.move_cell(e),t&&s){const e=r?this:n;t.insertBefore(s,e)}}remove_cell(){this.remove_output_element(),super.remove_cell()}reset(){super.reset();const e=this.output_element;return e&&(0,i.gX)(e),this}async eval(e=null){const{evaluator_class:t,output_element:n,eval_context:s}=e??{},o=t??await a.v.class_for_content(this);if(!(o===a.v||o.prototype instanceof a.v))throw new Error("evaluator_class must be an instance of Evaluator");let c;this.stop(),n?(c=n,this.output_element=c):c=this.establish_output_element(),(0,i.gX)(c);const _=new o(this,c,s);return this.#re=new l.X(_),this.#oe=!0,this._tool_bar?.set_for("running",!0),r.N.emit_eval_state(this,!0),_._perform_eval().then((()=>{this.#oe=void 0,this._tool_bar?.set_for("running",!1),r.N.emit_eval_state(this,!1)})).catch((e=>(this.stop(),_.output_context.invoke_renderer_for_type("error",e))))}#oe;#re;get evaluator_foreground(){return!!this.#oe}get can_stop(){return!!this.#re}stop(){if(this.#re)try{this.#re.stop()}catch(e){console.warn("error stopping evaluator",e,this.#re)}this.#re=void 0,this.#oe=void 0,this._tool_bar?.set_for("running",!1),r.N.emit_eval_state(this,!1)}async establish_tool_bar(){if(!this._tool_bar){let e=this.input_type||void 0;this._tool_bar=await c.d.create_for(this,{editable:!1,visible:{initial:this.visible,on:e=>this.set_visible(e.target.get_state())},autoeval:!1,type:{...e?{initial:e}:{},on:e=>{this.input_type=e.target.value}},running:!0,modified:!1,run:!1}),this.parentElement.insertBefore(this._tool_bar,this)}}get_dom_extent(){if(document.body!==this&&document.body?.contains(this)){let{first:e,last:t}=super.get_dom_extent();const n=this.output_element;return n&&(e.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_PRECEDING&&(e=n),t.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_FOLLOWING&&(t=n)),{first:e,last:t}}return null}static get_initial_key_map_bindings(){return{...super.get_initial_key_map_bindings(),eval:["CmdOrCtrl-Enter"]}}get_command_bindings(){return{...super.get_command_bindings(),eval:this.command_handler__eval.bind(this),"set-mode-markdown":this.command_handler__set_mode_markdown.bind(this),"set-mode-tex":this.command_handler__set_mode_tex.bind(this),"set-mode-javascript":this.command_handler__set_mode_javascript.bind(this)}}async command_handler__eval(e){return await this.eval({eval_context:r.N.global_eval_context}),!0}async command_handler__set_mode_markdown(e){return this.input_type="markdown",!0}async command_handler__set_mode_tex(e){return this.input_type="tex",!0}async command_handler__set_mode_javascript(e){return this.input_type="javascript",!0}static _init_static(){globalThis.customElements.define(this.custom_element_name,this,{}),(0,i.KP)(document.head,new URL("style.css",d))}}u._init_static(),s()}catch(e){s(e)}}))},700:(e,t,n)=>{"use strict";n.d(t,{v:()=>c,P:()=>_});var s=n(896),i=n(429),r=n(984);class o extends i.T{static type=void 0;get type(){return this.constructor.type}async render(e,t,n){throw new Error("NOT UNIMPLEMENTED")}static async class_from_type(e){return(await this.#ae())[e]}static async#ae(){if(!this.type_to_class_mapping){const e=await Promise.all(this.#le.map((e=>n(907)(new URL(e,"file:///home/ed/code/logbook/src/renderer/_.js")))));this.#ce=Object.fromEntries(e.map((e=>{const t=e.default;return[t.type,t]})))}return this.#ce}static#ce;static#le=["./text-renderer.js","./error-renderer.js","./markdown-renderer.js","./tex-renderer.js","./javascript-renderer/_.js","./image-data-renderer.js","./chart-renderer.js","./graphviz-renderer.js","./plotly-renderer.js"]}class a{constructor(e){if(!(e instanceof HTMLElement))throw new Error("element must be an instance of HTMLElement");Object.defineProperties(this,{element:{value:e,enumerable:!0}})}static get_svg_string(e){let t=(new XMLSerializer).serializeToString(e);return t=t.replace(/(\w+)?:?xlink=/g,"xmlns:xlink="),t=t.replace(/NS\d+:href/g,"xlink:href"),t}static clear_element(e){return(0,r.gX)(e)}static scroll_element_into_view(e){return(0,r.v0)(e)}static set_element_attrs(e,t){return(0,r.Dz)(e,t)}static update_element_style(e,t){return(0,r.Hp)(e,t)}static create_element_child(e,t=null){return(0,r.T1)({parent:e,...t??{}})}static create_element_child_text_node(e,t,n=null){return(0,r.Xc)(e,t,n)}static normalize_element_text(e){return(0,r.rb)(e)}clear(){return this.constructor.clear_element(this.element),this}scroll_into_view(){return this.constructor.scroll_element_into_view(this.element),this}set_attrs(e){return this.constructor.set_element_attrs(this.element,e),this}update_style(e){return this.constructor.update_element_style(this.element,e)}create_child(e=null){return this.constructor.create_element_child(this.element,e)}create_child_text_node(e,t=null){return this.constructor.create_element_child_text_node(this.element,e,t)}normalize_text(){return this.constuctor.normalize_element_text(this.element),this}async renderer_for_type(e){const t=await o.class_from_type(e);if(t)return new t;throw new Error(`unknown output type: ${e}`)}async invoke_renderer(e,t,n=null){return e.render(this,t,n).catch((t=>{throw e.stop(),t}))}async invoke_renderer_for_type(e,t,n=null){const s=await this.renderer_for_type(e);return this.invoke_renderer(s,t,n)}}const l="file:///home/ed/code/logbook/src/evaluator/_.js";class c extends i.T{static async eval(e,t,n=null){const s=new this(e,t,n);return s._perform_eval().catch((e=>s.output_context.invoke_renderer_for_type("error",e)))}constructor(e,t,n){if(super(),!(e instanceof HTMLElement))throw new Error("input_element must be an instance of HTMLElement");if(!(t instanceof HTMLElement))throw new Error("output_element must be an instance of HTMLElement");if(n??={},"object"!=typeof n)throw new Error("eval_context must be undefined, null, or an object");const i=new a(t);Object.defineProperties(this,{id:{value:(0,s.kE)(),enumerable:!0},input_element:{value:e,enumerable:!0},output_element:{value:t,enumerable:!0},eval_context:{value:n,enumerable:!0},output_context:{value:i,enumerable:!0}})}async _perform_eval(){throw new Error("NOT UNIMPLEMENTED")}static handled_input_types=[];static async class_for_content(e){if(!(e instanceof Element))throw new Error("input_element must be an instance of Element");const t=await _(),n=t[0],s=e.input_type;if(s)for(const e of t)if(e.handled_input_types.includes(s))return e;return n}}async function _(){const{MarkdownEvaluator:e}=await n(129)(new URL("./markdown-evaluator.js",l)),{TeXEvaluator:t}=await n(129)(new URL("./tex-evaluator.js",l)),{JavaScriptEvaluator:s}=await n(129)(new URL("./javascript-evaluator.js",l));return[e,t,s]}},27:(e,t,n)=>{"use strict";n.a(e,(async(e,t)=>{try{var s=n(179),i=n(53),r=e([s,i]);[s,i]=r.then?(await r)():r,await i.N.initialize(),t()}catch(e){t(e)}}),1)},53:(e,t,n)=>{"use strict";n.a(e,(async(e,s)=>{try{n.d(t,{N:()=>b});var i=n(88),r=n(179),o=n(545),a=n(92),l=n(984),c=n(231),_=n(688),d=n(345),u=n(713),m=n(951),h=e([i,r,a,c,_,u]);[i,r,a,c,_,u]=h.then?(await h)():h;const p="file:///home/ed/code/logbook/src/logbook-manager.js";class f{constructor(){this.#_e=!1,this.#de=null,this.#ue=!1,this.reset_global_eval_context(),this.#me=new a.l,this.#he=this.#me.subscribe(this.#pe.bind(this))}#_e;#de;#ue;#fe;#be;#me;#he;#ge;#ve;#ye;#we;#Ae;#Ee;#ke;get editable(){return this.#_e}set_editable(e){e=!!e,this.#_e=e,this.#ge.set_menu_state("toggle-editable",{checked:e}),this.#we.set_for("editable",e);for(const t of this.constructor.get_cells())t.set_editable(e)}get active_cell(){return this.#de}set_active_cell(e){this.#de=e??null;for(const e of this.constructor.get_cells())e.set_active(e===this.active_cell)}get controls_element(){return this.#fe}get content_element(){return this.#be}get global_eval_context(){return this.#Ae}reset_global_eval_context(){this.#Ae={}}reset(){for(const e of this.constructor.get_cells())e.reset();return this.reset_global_eval_context(),this.#ke=void 0,this}async clear(){(0,l.gX)(this.content_element),(await this.create_cell()).focus()}stop(){for(const e of this.constructor.get_cells())e.stop()}async initialize(){if(this.#ue)throw new Error("initialize() called more than once");this.#ue=!0;try{await this.#Te(),(0,l.KP)(document.head,new URL("style.css",p)),(0,l.KP)(document.head,new URL("style-hacks.css",p)),await this.#Ne(),await this.#xe();const e=this.constructor.get_cells();e.length;const t=e.find((e=>e.active))??e[0]??await this.create_cell();this.set_active_cell(t),t.focus(),this.set_editable(this.editable),document.body.innerText,this.#Ee=new _.a(this.content_element,{neutral_changes_observer:this.#je.bind(this)}),window.addEventListener("beforeunload",(e=>{if(!this.#Ee.is_neutral)return e.preventDefault(),e.returnValue=""})),this.#Ee.set_neutral()}catch(e){(0,l.Ru)(e)}}async create_cell(e=null){return r.p.create_cell({...e??{},parent:this.content_element})}static get_cells(){return[...document.getElementsByTagName(i.W.custom_element_name),...document.getElementsByTagName(r.p.custom_element_name)]}static controls_element_id="controls";static content_element_id="content";async#Te(){if(document.getElementById(this.constructor.controls_element_id))throw new Error(`bad format for document: element with id ${this.constructor.controls_element_id} already exists`);if(document.getElementById(this.constructor.content_element_id))throw new Error(`bad format for document: element with id ${this.constructor.content_element_id} already exists`);for(document.body||document.documentElement.appendChild(document.createElement("body")),this.#be=document.createElement("div"),this.#be.id=this.constructor.content_element_id;document.body.firstChild;)this.#be.appendChild(document.body.firstChild);this.#fe=document.createElement("div"),this.#fe.id=this.constructor.controls_element_id,document.body.appendChild(this.#fe),document.body.appendChild(this.#be);for(const e of this.constructor.get_cells()){await e.establish_tool_bar();const t=e.output_element;e.output_element=null,e.output_element=t}}#Le(){const e=document.getElementById(this.constructor.content_element_id);if(!e||e!==this.content_element)throw new Error("bad format for document");return`<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="utf-8">\n    <script type="module" src="../src/init.js"><\/script>\n</head>\n<body>\n${[...this.content_element?.querySelectorAll(`${r.p.custom_element_name}, .${r.p.output_element_class}`)].map((e=>e.outerHTML)).join("\n")}\n</body>\n</html>\n`}async#Ne(){}get_suggested_file_name(){return window.location.pathname.split("/").slice(-1)[0]}update_menu_state(){const e=this.constructor.get_cells(),t=this.active_cell,n=e.indexOf(t),s=this.#Ee.can_perform_undo,i=this.#Ee.can_perform_redo;this.#ge.set_menu_state("undo",{enabled:s}),this.#ge.set_menu_state("redo",{enabled:i}),this.#ge.set_menu_state("toggle-cell-visible",{checked:t?.visible}),this.#ge.set_menu_state("focus-up",{enabled:t&&n>0}),this.#ge.set_menu_state("focus-down",{enabled:t&&n<e.length-1}),this.#ge.set_menu_state("move-up",{enabled:t&&n>0}),this.#ge.set_menu_state("move-down",{enabled:t&&n<e.length-1}),this.#ge.set_menu_state("delete",{enabled:!!t}),this.#ge.set_menu_state("eval-and-refocus",{enabled:!!t}),this.#ge.set_menu_state("eval",{enabled:!!t}),this.#ge.set_menu_state("eval-before",{enabled:!!t}),this.#ge.set_menu_state("eval-all",{enabled:!!t}),this.#ge.set_menu_state("stop",{enabled:t?.can_stop}),this.#ge.set_menu_state("stop-all",{enabled:e.some((e=>e.can_stop))})}async#xe(){if(!this.controls_element)throw new Error("bad format for document: controls element does not exist");this.#ge=await c.j.create(this.controls_element,this.constructor.#Ce(),(()=>r.p.get_initial_key_map_bindings()),null),this.#ve=this.#ge.commands.subscribe(this.#Oe.bind(this)),this.#ye=this.#ge.selects.subscribe(this.update_menu_state.bind(this)),this.#we=await o.d.create_for(this.controls_element,{editable:{initial:this.editable,on:e=>this.set_editable(e.target.get_state())},modified:!0,running:!0}),this.#fe.appendChild(this.#we)}#Oe(e){const t=this.active_cell;if(t)if(t instanceof i.W){const n={...e,target:t};t.perform_command(n)}else(0,m.V)();else(0,m.V)()}static#Ce(){return[{label:"File",collection:[{label:"Recent logbooks",id:"recents",collection:[]},"---",{label:"Reset cells",item:{command:"reset"}},{label:"Clear document",item:{command:"clear"}},"---",{label:"Editable",item:{command:"toggle-editable"},id:"toggle-editable"},"---",{label:"Save",item:{command:"save"},id:"save"},{label:"Save as...",item:{command:"save-as"}},"---",{label:"Settings...",item:{command:"settings"}}]},{label:"Edit",collection:[{label:"Undo",item:{command:"undo"},id:"undo"},{label:"Redo",item:{command:"redo"},id:"redo"}]},{label:"Cell",collection:[{label:"Eval",item:{command:"eval-and-refocus"},id:"eval-and-refocus"},{label:"Eval and stay",item:{command:"eval"},id:"eval"},{label:"Eval before",item:{command:"eval-before"},id:"eval-before"},{label:"Eval all",item:{command:"eval-all"},id:"eval-all"},"---",{label:"Stop cell",item:{command:"stop"},id:"stop"},{label:"Stop all",item:{command:"stop-all"},id:"stop-all"},"---",{label:"Reset cell",item:{command:"reset-cell"}},{label:"Visible",item:{command:"toggle-cell-visible"},id:"toggle-cell-visible"},"---",{label:"Focus up",item:{command:"focus-up"},id:"focus-up"},{label:"Focus down",item:{command:"focus-down"},id:"focus-down"},"---",{label:"Move up",item:{command:"move-up"},id:"move-up"},{label:"Move down",item:{command:"move-down"},id:"move-down"},{label:"Add before",item:{command:"add-before"}},{label:"Add after",item:{command:"add-after"}},{label:"Delete",item:{command:"delete"},id:"delete"}]},{label:"Help",collection:[{label:"Help...",item:{command:"help"}}]}]}static get_global_initial_key_map_bindings(){return{"create-cell":["CmdOrCtrl-Shift-Alt-N"],reset:[],clear:[],save:["CmdOrCtrl-S"],"save-as":["CmdOrCtrl-Shift-S"],settings:["CmdOrCtrl-,"],"eval-and-refocus":["Shift-Enter"],"eval-before":["CmdOrCtrl-Shift-Enter"],"eval-all":["CmdOrCtrl-Shift-Alt-Enter"],stop:["CmdOrCtrl-Alt-!"],"stop-all":["CmdOrCtrl-Shift-Alt-!"],"focus-up":["Alt-Up"],"focus-down":["Alt-Down"],"move-up":["CmdOrCtrl-Alt-Up"],"move-down":["CmdOrCtrl-Alt-Down"],"add-before":["CmdOrCtrl-Alt-Shift-Up"],"add-after":["CmdOrCtrl-Alt-Shift-Down"],delete:["CmdOrCtrl-Alt-Backspace"],"set-mode-markdown":["Alt-M m"],"set-mode-tex":["Alt-M t"],"set-mode-javascript":["Alt-M j"],"toggle-cell-visible":["Alt-M v"],"toggle-editable":["Alt-M e"],undo:["CmdOrCtrl-Z"],redo:["CmdOrCtrl-Shift-Z"]}}get_global_command_bindings(){return{"create-cell":this.command_handler__create_cell.bind(this),reset:this.command_handler__reset.bind(this),clear:this.command_handler__clear.bind(this),save:this.command_handler__save.bind(this),"save-as":this.command_handler__save_as.bind(this),settings:this.command_handler__show_settings_dialog.bind(this),"eval-and-refocus":this.command_handler__eval_and_refocus.bind(this),"eval-before":this.command_handler__eval_before.bind(this),"eval-all":this.command_handler__eval_all.bind(this),stop:this.command_handler__stop.bind(this),"stop-all":this.command_handler__stop_all.bind(this),"focus-up":this.command_handler__focus_up.bind(this),"focus-down":this.command_handler__focus_down.bind(this),"move-up":this.command_handler__move_up.bind(this),"move-down":this.command_handler__move_down.bind(this),"add-before":this.command_handler__add_before.bind(this),"add-after":this.command_handler__add_after.bind(this),delete:this.command_handler__delete.bind(this),"toggle-editable":this.command_handler__toggle_editable.bind(this),undo:this.command_handler__undo.bind(this),redo:this.command_handler__redo.bind(this)}}#je(e){const{is_neutral:t}=e;this.#we.set_for("modified",!t),this.#ge.set_menu_state("save",{checked:!t})}emit_eval_state(e,t){this.#me.dispatch({cell:e,eval_state:t})}#pe(e){const{cell:t,eval_state:n}=e,s=this.constructor.get_cells().some((e=>e.evaluator_foreground));this.#we.set_for("running",s)}async command_handler__create_cell(e){let t=null;const n=e.target?.adjacent_cell?.(!0);n&&(t=n.get_dom_extent().first);const s=await this.create_cell({before:t});return!!s&&(s.focus(),!0)}async command_handler__reset(e){return this.reset(),!0}async command_handler__clear(e){return await this.clear(),!0}async command_handler__save(e){const t=await d.H.save(this.#Le.bind(this),{file_handle:this.#ke,prompt_options:{suggestedName:this.get_suggested_file_name()}}),{canceled:n,file_handle:s,stats:i}=t;return n||(this.#ke=s??void 0,this.#Ee.set_neutral()),!0}async command_handler__save_as(e){return this.#ke=void 0,await d.H.save(this.#Le.bind(this),{prompt_options:{suggestedName:this.get_suggested_file_name()}}),!0}command_handler__show_settings_dialog(e){return u.D.run(),!0}async command_handler__eval_and_refocus(e){const t=e.target;return!!(t&&t instanceof r.p)&&(await t.eval({eval_context:this.global_eval_context}),(t.adjacent_cell(!0)??await this.create_cell()).focus(),!0)}async command_handler__eval_before(e){const t=e.target;if(t&&t instanceof r.p){this.reset_global_eval_context();for(const e of this.constructor.get_cells()){if(e===t)break;await e.eval({eval_context:this.global_eval_context})}return!0}return!1}async command_handler__eval_all(e){const t=e.target;if(t&&t instanceof r.p){let e;this.stop(),this.reset_global_eval_context();for(const t of this.constructor.get_cells())await t.eval({eval_context:this.global_eval_context}),e=t;return e.focus(),!0}return!1}async command_handler__stop(e){const t=e.target;return!!(t&&t instanceof r.p)&&(t.stop(),!0)}async command_handler__stop_all(e){return this.stop(),!0}async command_handler__focus_up(e){const t=e.target.adjacent_cell(!1);return!!t&&(t.focus(),!0)}async command_handler__focus_down(e){const t=e.target.adjacent_cell(!0);return!!t&&(t.focus(),!0)}async command_handler__move_up(e){const t=e.target;if(t){const e=t.adjacent_cell(!1);return!!e&&(t.move_cell({before:e.get_dom_extent().first}),t.focus(),!0)}return!1}async command_handler__move_down(e){const t=e.target;if(t){const e=t.adjacent_cell(!0);return!!e&&(t.move_cell({before:e.get_dom_extent().last.nextSibling,parent:t.parentElement}),t.focus(),!0)}return!1}async command_handler__add_before(e){const t=e.target;return(await this.create_cell({before:t.get_dom_extent().first})).focus(),!0}async command_handler__add_after(e){const t=e.target;return(await this.create_cell({before:t.get_dom_extent().last.nextSibling,parent:t.parentElement})).focus(),!0}async command_handler__delete(e){const t=e.target;let n=t.adjacent_cell(!0)??t.adjacent_cell(!1);return t.remove_cell(),n||(n=await this.create_cell()),n.focus(),!0}async command_handler__toggle_editable(e){return this.set_editable(!this.editable),!0}async command_handler__undo(e){return this.#Ee?.perform_undo()}async command_handler__redo(e){return this.#Ee?.perform_redo()}}const b=new f;globalThis.logbook_manager=b,s()}catch(e){s(e)}}))},713:(e,t,n)=>{"use strict";n.a(e,(async(e,s)=>{try{n.d(t,{D:()=>u});var i=n(984),r=n(569),o=n(7),a=n(724),l=n(951),c=e([r,a]);[r,a]=c.then?(await c)():c;const _=new URL("./settings-dialog.css","file:///home/ed/code/logbook/src/settings-dialog/_.js");(0,i.KP)(document.head,_);const d=[{section:{name:"Editor",settings:[{id:"editor_options_indentUnit",label:"Indent",type:"text",settings_path:["editor_options","indentUnit"],analyze:e=>(0,a.Xg)(e,"Indent"),convert_to_number:!0},{id:"editor_options_tabSize",label:"Tab size",type:"text",settings_path:["editor_options","tabSize"],analyze:e=>(0,a.aD)(e,"Tab size"),convert_to_number:!0},{id:"editor_options_indentWithTabs",label:"Indent with tabs",type:"checkbox",settings_path:["editor_options","indentWithTabs"],analyze:e=>(0,a.hZ)(e,"Indent with tabs")},{id:"editor_options_keyMap",label:"Key map",type:"select",options:a.$I.map((e=>({value:e,label:e}))),settings_path:["editor_options","keyMap"],analyze:e=>(0,a.Br)(e,"Key map")}]}},{section:{name:"TeX Formatting",settings:[{id:"formatting_options_align",label:"Horizontal alignment",type:"select",options:a.Kp.map((e=>({value:e,label:e}))),settings_path:["formatting_options","align"],analyze:e=>(0,a.yj)(e,"Align")},{id:"formatting_options_indent",label:"Indentation",type:"text",settings_path:["formatting_options","indent"],analyze:e=>(0,a.fe)(e,"Indentation")}]}},{section:{name:"Appearance",settings:[{id:"theme_colors",label:"Theme",type:"select",options:a.LI.map((e=>({value:e,label:e}))),settings_path:["theme_colors"],analyze:e=>(0,a.K4)(e,"Theme colors")}]}}];class u extends r.Vq{static settings_dialog_css_class="settings-dialog";static run(e,t){const n=document.querySelector(`#content #ui .${this.settings_dialog_css_class}`);if(n){const e=r.Vq.instance_from_element(n);if(!e)throw new Error(`unexpected: Dialog.instance_from_element() returned null for element with class ${this.settings_dialog_css_class}`);return e.promise}return(new this).run()}_populate_dialog_element(){const e=(0,a.oj)();this._dialog_element.classList.add(this.constructor.settings_dialog_css_class),this._dialog_text_container.innerText="Settings";for(const{section:t}of d){const{name:n,settings:s}=t,c=(0,i.T1)({parent:this._dialog_form,attrs:{class:"section"}}),_=(0,i.T1)({parent:c,attrs:{"data-section":n}}),d=(0,i.T1)({parent:c,attrs:{class:"error-message"}});for(const t of s){const{id:n,label:s,type:c,settings_path:u,options:m,analyze:h,convert_to_number:p}=t,f=(0,i.T1)({parent:_,attrs:{"data-setting":void 0}});let b;b="select"===c?(0,r.cK)(f,n,{label:s,options:m}):(0,r.L_)(f,n,{label:s,type:c}),"checkbox"===c?b.checked=(0,o.Z)(e,u):b.value=(0,o.Z)(e,u);const g=async e=>{const t=(0,a.oj)(),n=async e=>{d.classList.add("active"),d.innerText=e;const t=document.getElementById(b.id);!this._completed&&t?(t.focus(),t instanceof HTMLInputElement&&"text"===t.type&&t.select(),await(0,l.V)()):await r.aR.run(`settings update failed: ${e}`)},s="checkbox"===c?b.checked:b.value;if(h){const e=h(s);if(e)return void await n(e)}(0,o.$)(t,u,p?+s:s);try{await(0,a.ZA)(t),d.classList.remove("active")}catch(e){await n(e.message)}};b.addEventListener("change",g),b.addEventListener("blur",g)}}(0,i.T1)({parent:this._dialog_form,tag:"input",attrs:{type:"button",value:"Done"}}).onclick=e=>this._dialog_element.close(),this._dialog_element.onclose=e=>this._complete()}}s()}catch(e){s(e)}}))},724:(e,t,n)=>{"use strict";n.a(e,(async(e,s)=>{try{n.d(t,{$I:()=>f,Br:()=>b,K4:()=>T,Kp:()=>v,LI:()=>k,Xg:()=>m,ZA:()=>O,aD:()=>h,fe:()=>A,hZ:()=>p,oj:()=>C,yj:()=>y});var i=n(92),r=n(176),o=n(659),a=e([i]);i=(a.then?(await a)():a)[0];const l={editor_options:{indentUnit:2,tabSize:4,indentWithTabs:!1,keyMap:"default"},formatting_options:{align:"left",indent:"0em"},theme_colors:"system"};(0,r.j)(l);const c=new i.l,_=/^([+-]?[0-9]+[.][0-9]*[Ee][+-]?[0-9]+|[+-]?[.][0-9]+[Ee][+-]?[0-9]+|[+-]?[0-9]+[Ee][+-]?[0-9]+|[+-]?[0-9]+[.][0-9]*|[+-]?[.][0-9]+|[+-]?[0-9]+)$/;function d(e,t){const{require_integer:n,reject_negative:s,reject_zero:i,reject_positive:r}=t??{};let o;if("number"==typeof e)o=e;else{if("string"!=typeof e)return!1;if(!e.trim().match(_))return!1;o=Number.parseFloat(e)}return!(isNaN(o)||n&&!Number.isInteger(o)||r&&o>0||i&&0===o||s&&o<0)}function u(e,t,n){if(!t.includes(e))return`${n??"value"} must be one of: ${t.join(", ")}`}function m(e,t){if(!d(e,{require_integer:!0,reject_negative:!0}))return`${t??"indentUnit"} must be a non-negative integer`}function h(e,t){if(!d(e,{require_integer:!0,reject_negative:!0}))return`${t??"tabSize"} must be a non-negative integer`}function p(e,t){if("boolean"!=typeof e)return`${t??"indentWithTabs"} must be a boolean value`}const f=["default","emacs","sublime","vim"];function b(e,t){return u(e,f,t??"keyMap")}function g(e,t){if("object"!=typeof e)return`${t??"editor_options"} must be an object`;if(!Object.keys(e).every((e=>["indentUnit","tabSize","indentWithTabs","keyMap"].includes(e))))return`${t??"editor_options"} may only have the keys "indentUnit", "tabSize", "indentWithTabs" and "keyMap"`;if("indentUnit"in e){const t=m(e.indentUnit);if(t)return t}if("tabSize"in e){const t=h(e.tabSize);if(t)return t}if("indentWithTabs"in e){const t=p(e.indentWithTabs);if(t)return t}if("keyMap"in e){const t=b(e.keyMap);if(t)return t}}const v=["left","center","right"];function y(e,t){return u(e,v,t??"align")}const w=["pt","pc","in","cm","mm","em","ex","mu"];function A(e,t){if(!w.every((e=>2===e.length)))throw new Error("unexpected: valid units contains a string whose length is not 2");const n=`${t??"indent"} must be a string containing a non-negative number followed by one of: ${w.join(", ")}`;if("string"!=typeof e)return n;const s=(e=e.trim()).slice(0,-2),i=e.slice(-2);return d(s,{reject_negative:!0})&&w.includes(i)?void 0:n}function E(e,t){if("object"!=typeof e)return`${t??"formatting_options"} must be an object`;if(!Object.keys(e).every((e=>["align","indent"].includes(e))))return`${t??"formatting_options"} may only have the keys "align" and "indent"`;if("align"in e){const t=y(e.align);if(t)return t}if("indent"in e){const t=A(e.indent);if(t)return t}}const k=["system","dark","light"];function T(e,t){return u(e,k,t??"theme_colors")}function N(e,t){if("object"!=typeof e)return`${t??"settings"} must be an object`;if(!Object.keys(e).every((e=>["editor_options","formatting_options","theme_colors"].includes(e))))return`${t??"settings"} may only have the keys "editor_options", "formatting_options" and "theme_colors"`;if(!("editor_options"in e))return`${t??"settings"} must contain an editor_options property`;{const t=g(e.editor_options);if(t)return t}if(!("formatting_options"in e))return`${t??"settings"} must contain an formmating_options property`;{const t=E(e.formatting_options);if(t)return t}if(!("theme_colors"in e))return`${t??"settings"} must contain an theme_colors property`;{const t=T(e.theme_colors);if(t)return t}}async function x(e){return o.zS.put(o.Fx,e)}async function j(){try{const e=await o.zS.get(o.Fx);if(!N(e))return e}catch(e){}return await x(l),l}(()=>{const e=N(l);if(e)throw new Error(`initial_settings: ${e}`)})();let L=await j();function C(){return e=L,JSON.parse(JSON.stringify(e));var e}async function O(e){const t=N(e);if(t)throw new Error(t);await x(e),L=e,c.dispatch()}s()}catch(S){s(S)}}),1)},659:(e,t,n)=>{"use strict";n.d(t,{Fx:()=>s,zS:()=>i});const s="settings-6c32f9d6-796c-4588-8a4b-35165a13d14d",i=new class{constructor(e="property-database-7a11272a-fce1-4e39-951c-44c375bc75ca",t="property-database-store-7a11272a-fce1-4e39-951c-44c375bc75ca"){Object.defineProperties(this,{database_name:{value:e},database_store_name:{value:t,enumerable:!0},_startup_promise:{value:new Promise(((n,s)=>{const i=indexedDB.open(e,1);i.onerror=()=>s(i.error),i.onsuccess=()=>n(i.result),i.onupgradeneeded=()=>{i.result.createObjectStore(t)}}))}})}async with_object_store(e,t){const n=await this._startup_promise;return new Promise(((s,i)=>{const r=n.transaction(this.database_store_name,e);r.oncomplete=()=>s(),r.onabort=r.onerror=()=>i(r.error),t(r.objectStore(this.database_store_name))}))}async get(e){let t;return await this.with_object_store("readonly",(n=>{t=n.get(e)})),t.result}async put(e,t){return this.with_object_store("readwrite",(n=>{n.put(t,e)}))}async delete(e){return this.with_object_store("readwrite",(t=>{t.delete(e)}))}async clear(){return this.with_object_store("readwrite",(e=>{e.clear()}))}async keys(){let e;return await this.with_object_store("readonly",(t=>{e=t.getAllKeys()})),e.result}}},545:(e,t,n)=>{"use strict";n.d(t,{d:()=>a});var s=n(886),i=n(984);class r extends HTMLElement{static custom_element_name="toggle-switch";static create(e=null){const{parent:t,class:n,title_for_on:s,title_for_off:r,svg:o}=e??{},a=(0,i.T1)({parent:t,tag:this.custom_element_name,attrs:{class:n,role:"switch","aria-checked":!1,title:r}});return a.#y.add(a,"change",(e=>{a.title=a.get_state()?s:r})),a}constructor(){super(),this.#y=new s.w,this.#y.add(this,"click",(e=>{this.set_state()}))}#y;get_state(){return"true"===this.getAttribute("aria-checked")}set_state(e=null){const t=this.get_state();e??=!t,e=!!e,this.setAttribute("aria-checked",e),t!==e&&this.dispatchEvent(new Event("change"))}connectedCallback(){console.log("COMPONENT CONNECTED",this),this.#y.reattach()}disconnectedCallback(){console.log("COMPONENT DISCONNECTED",this)}adoptedCallback(){console.log("COMPONENT ADOPTED",this),this.#y.reattach()}attributeChangedCallback(e,t,n){console.log("COMPONENT ATTRIBUTE CHANGED",this,{name:e,old_value:t,new_value:n})}static get observedAttributes(){return["xyzzy"]}static _init_static(){globalThis.customElements.define(this.custom_element_name,this),(0,i.KP)(document.head,new URL("style.css","file:///home/ed/code/logbook/src/toggle-switch-element/_.js"))}}r._init_static();var o=n(700);class a extends HTMLElement{static custom_element_name="tool-bar";static indicator_control__class="tool-bar-indicator";static indicator_control__attribute__value="data-indicator-value";static toggle_switch__editable__class="tool-bar-toggle-editable";static toggle_switch__visible__class="tool-bar-toggle-visible";static toggle_switch__autoeval__class="tool-bar-toggle-autoeval";static async create_for(e,t){const n=document.createElement(this.custom_element_name);if(!n)throw new Error("error creating tool bar");try{return await n.set_target(e,t),n}catch(e){throw n.remove(),e}}constructor(){super(),this.#a=null,this.#y=new s.w,this.#Se(),this.addEventListener("pointerdown",(e=>{this.#a.focus(),e.target instanceof a&&(e.preventDefault(),e.stopPropagation())}))}#y;#De;set_type(e){this.set_for("type",e)}#a;get target(){return this.#a}async set_target(e,t=null){if(null!=e&&!(e instanceof EventTarget))throw new Error("target must be null, undefined, or and instance of EventTarget");e?this.#a!==e&&(this.#a=e,await this.#Me(t)):(this.#a=null,this.#Se())}get_for(e,t){if(!(e in this.#De))throw new Error("unknown name");return this.#De[e].get()}set_for(e,t){if(!(e in this.#De))throw new Error("unknown name");this.#De[e].set(t)}async#Me(e=null){e??={},this.#Se();try{for(const[t,n,s,i]of this.#Ie()){let r=e[t];if(r){"object"!=typeof r&&(r={});const e=await n(r.on);"initial"in r&&i(e,r.initial),this.#De[t]={name:t,control:e,get:s.bind(a,e),set:i.bind(a,e)}}}}catch(e){throw this.#Se(),e}}#Se(){this.#y.remove_all(),(0,i.gX)(this),this.#De={}}#Ie(){return[["running",this.#Ue.bind(this),this.constructor.#Pe,this.constructor.#ze],["modified",this.#Be.bind(this),this.constructor.#Re,this.constructor.#Ke],["editable",this.#Fe.bind(this),this.constructor.#Qe,this.constructor.#We],["visible",this.#He.bind(this),this.constructor.#qe,this.constructor.#Ve],["autoeval",this.#Ze.bind(this),this.constructor.#$e,this.constructor.#Ge],["run",this.#Xe.bind(this),this.constructor.#Ye,this.constructor.#Je],["type",this.#et.bind(this),this.constructor.#tt,this.constructor.#nt]]}async#Fe(e=null){const t=r.create({parent:this,class:this.constructor.toggle_switch__editable__class,title_for_on:"edit mode on",title_for_off:"edit mode off"});return t.innerHTML='<?xml version="1.0" encoding="UTF-8"?>\n\x3c!--\n    Adapted from: https://commons.wikimedia.org/wiki/File:Ei-pencil.svg\n    Alexander Madyankin, Roman Shamin, MIT <http://opensource.org/licenses/mit-license.php>, via Wikimedia Commons\n--\x3e\n<svg\n  xmlns="http://www.w3.org/2000/svg"\n  version="1.1"\n  viewBox="0 0 50 50"\n>\n  <path class="accent-fill" d="M9.6 40.4 l2.5 -9.9 L27 15.6 l7.4 7.4 -14.9 14.9 -9.9 2.5z m4.3 -8.9 l-1.5 6.1 6.1 -1.5 L31.6 23 27 18.4 13.9 31.5z"/>\n  <path class="accent-fill" d="M17.8 37.3 c-.6 -2.5 -2.6 -4.5 -5.1 -5.1 l.5 -1.9 c3.2 .8 5.7 3.3 6.5 6.5 l-1.9 .5z"/>\n  <path class="accent-fill" d="M29.298 19.287 l1.414 1.414 -13.01 13.02 -1.414 -1.412z"/>\n  <path class="accent-fill" d="M11 39 l2.9 -.7 c-.3 -1.1 -1.1 -1.9 -2.2 -2.2 L11 39z"/>\n  <path class="accent-fill" d="M35 22.4 L27.6 15 l3-3 .5.1 c3.6 .5 6.4 3.3 6.9 6.9 l.1 .5 -3.1 2.9z M30.4 15 l4.6 4.6 .9 -.9 c-.5 -2.3 -2.3 -4.1 -4.6 -4.6 l-.9 .9z"/>\n</svg>\n',e&&this.#y.add(t,"change",e),t}static#Qe(e){return e.get_state()}static#We(e,t){e.set_state(t)}async#He(e=null){const t=r.create({parent:this,class:this.constructor.toggle_switch__visible__class,title_for_on:"visible",title_for_off:"not visible"});return t.innerHTML='<?xml version="1.0" encoding="UTF-8"?>\n\x3c!--\n    Adapted from: https://commons.wikimedia.org/wiki/File:ISO_7000_-_Ref-No_2030.svg\n    Vectorization:  Mrmw, CC0, via Wikimedia Commons\n--\x3e\n<svg\n  xmlns="http://www.w3.org/2000/svg"\n  version="1.1"\n  viewBox="0 0 200 170"\n>\n  <path class="accent-stroke" stroke="#000" stroke-width="5" fill="transparent"\n    d="m100 49.738 a97.452 97.452 0 0 0 -78.246 39.775 97.452 97.452 0 0 0 78.246 39.773 97.452 97.452 0 0 0 78.396 -39.975 97.452 97.452 0 0 0 -78.396 -39.574z"\n  />\n  <circle class="accent-stroke accent-fill" stroke="#000" stroke-width="5"\n    cx="100" cy="89.438" r="19.85"\n  />\n</svg>\n',e&&this.#y.add(t,"change",e),t}static#qe(e){return e.get_state()}static#Ve(e,t){e.set_state(t)}async#Ze(e=null){const t=(0,i.T1)({parent:this,tag:"input",attrs:{type:"checkbox",title:"autoeval..."}});return e&&this.#y.add(t,"change",e),this.#y.add(t,"change",(e=>{t.title=t.checked?"autoeval off...":"autoeval on..."})),t}static#$e(e){return e.checked}static#Ge(e,t){e.checked=!!t}async#et(e=null){const t=(0,i.T1)({parent:this,tag:"select",attrs:{title:"type..."}}),n=new Set((await(0,o.P)()).map((e=>e.handled_input_types)).flat()).values();let s=!1;for(const e of n)(0,i.T1)({parent:t,tag:"option",attrs:{title:"type...",label:e,...s?{}:{selected:!s},value:e}}),s=!0;return e&&this.#y.add(t,"change",e),this.#y.add(t,"change",(e=>{t.title=`type ${t.value}`})),t}static#tt(e){return e.value}static#nt(e,t){if(![...e.options].map((e=>e.value)).includes(t))throw new Error("setting unknown/illegal value");e.value=t}async#Ue(e=null){return this.#st("running","running...","done...",e)}static#Pe(e){return this.#it(e)}static#ze(e,t){this.#rt(e,t)}async#Be(e=null){return this.#st("modified","modified...","not modified...",e)}static#Re(e){return this.#it(e)}static#Ke(e,t){this.#rt(e,t)}async#Xe(e=null){}static#Ye(e){}static#Je(e,t){}#st(e,t,n,s=null){const r=(0,i.T1)({parent:this,attrs:{title:n,class:`${this.constructor.indicator_control__class} ${e}`}});return s&&this.#y.add(r,"change",s),this.#y.add(r,"change",(e=>{r.title=this.constructor.#it(r)?t:n})),r}static#it(e){return!!e.getAttribute(this.indicator_control__attribute__value)}static#rt(e,t){if(t!==this.#it(e)){e.setAttribute(this.indicator_control__attribute__value,t?"on":"");const n=new Event("change",{});e.dispatchEvent(n)}}connectedCallback(){console.log("COMPONENT CONNECTED",this),this.#y.reattach()}disconnectedCallback(){console.log("COMPONENT DISCONNECTED",this)}adoptedCallback(){console.log("COMPONENT ADOPTED",this),this.#y.reattach()}attributeChangedCallback(e,t,n){console.log("COMPONENT ATTRIBUTE CHANGED",this,{name:e,old_value:t,new_value:n})}static get observedAttributes(){return["xyzzy"]}static _init_static(){globalThis.customElements.define(this.custom_element_name,this),(0,i.KP)(document.head,new URL("style.css","file:///home/ed/code/logbook/src/tool-bar-element/_.js"))}}a._init_static()}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={exports:{}};return i[e](n,n.exports,o),n.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",s=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},o.a=(i,r,o)=>{var a;o&&((a=[]).d=-1);var l,c,_,d=new Set,u=i.exports,m=new Promise(((e,t)=>{_=t,c=e}));m[t]=u,m[e]=e=>(a&&e(a),d.forEach(e),m.catch((e=>{}))),i.exports=m,r((i=>{var r;l=(i=>i.map((i=>{if(null!==i&&"object"==typeof i){if(i[e])return i;if(i.then){var r=[];r.d=0,i.then((e=>{o[t]=e,s(r)}),(e=>{o[n]=e,s(r)}));var o={};return o[e]=e=>e(r),o}}var a={};return a[e]=e=>{},a[t]=i,a})))(i);var o=()=>l.map((e=>{if(e[n])throw e[n];return e[t]})),c=new Promise((t=>{(r=()=>t(o)).r=0;var n=e=>e!==a&&!d.has(e)&&(d.add(e),e&&!e.d&&(r.r++,e.push(r)));l.map((t=>t[e](n)))}));return r.r?c:o()}),(e=>(e?_(m[n]=e):c(u),s(a)))),a&&a.d<0&&(a.d=0)},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o(27)})();