{"version":3,"file":"main.js","mappings":"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","sources":["webpack://logbook/webpack/runtime/async module","webpack://logbook/webpack/runtime/load script","webpack://logbook/./src/style-hacks.css","webpack://logbook/./src/style.css","webpack://logbook/./node_modules/css-loader/dist/runtime/api.js","webpack://logbook/./node_modules/css-loader/dist/runtime/sourceMaps.js","webpack://logbook/./src/style-hacks.css?ece3","webpack://logbook/./src/style.css?7163","webpack://logbook/./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js","webpack://logbook/./node_modules/style-loader/dist/runtime/insertBySelector.js","webpack://logbook/./node_modules/style-loader/dist/runtime/insertStyleElement.js","webpack://logbook/./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js","webpack://logbook/./node_modules/style-loader/dist/runtime/styleDomAPI.js","webpack://logbook/./node_modules/style-loader/dist/runtime/styleTagTransform.js","webpack://logbook/./lib/sys/event-listener-manager.js","webpack://logbook/./lib/sys/fs-interface.js","webpack://logbook/./lib/sys/obj-path.js","webpack://logbook/./lib/sys/open-promise.js","webpack://logbook/./lib/sys/rxjs.js","webpack://logbook/./lib/sys/sprintf.js","webpack://logbook/./lib/sys/stoppable.js","webpack://logbook/./lib/sys/subscribable.js","webpack://logbook/./node_modules/uuid/dist/esm-browser/native.js","webpack://logbook/./node_modules/uuid/dist/esm-browser/rng.js","webpack://logbook/./node_modules/uuid/dist/esm-browser/stringify.js","webpack://logbook/./node_modules/uuid/dist/esm-browser/v4.js","webpack://logbook/./lib/sys/uuid.js","webpack://logbook/./lib/ui/beep.js","webpack://logbook/./lib/ui/canvas-tools.js","webpack://logbook/./lib/ui/dialog/_.js","webpack://logbook/./lib/ui/dom-tools.js","webpack://logbook/./lib/ui/key/key-event-manager.js","webpack://logbook/./lib/ui/key/key-map.js","webpack://logbook/./lib/ui/key/key-spec.js","webpack://logbook/./lib/ui/menu/_.js","webpack://logbook/./src/assets-server-url.js","webpack://logbook/./src/editor-cell-element/_.js","webpack://logbook/./src/eval-cell-element/_.js","webpack://logbook/./src/evaluator/_.js","webpack://logbook/./src/evaluator/evaluator.js","webpack://logbook/./src/evaluator/javascript-evaluator.js","webpack://logbook/./src/evaluator/markdown-evaluator.js","webpack://logbook/./src/evaluator/tex-evaluator.js","webpack://logbook/./src/global-bindings.js","webpack://logbook/./src/help-window.js","webpack://logbook/./src/init.js","webpack://logbook/./src/logbook-manager.js","webpack://logbook/./src/output-context.js","webpack://logbook/./src/renderer/_.js","webpack://logbook/./src/renderer/canvas-image-renderer.js","webpack://logbook/./src/renderer/d3.js","webpack://logbook/./src/renderer/error-renderer.js","webpack://logbook/./src/renderer/graphviz-renderer.js","webpack://logbook/./src/renderer/graphviz.js","webpack://logbook/./src/renderer/image-data-renderer.js","webpack://logbook/./src/renderer/javascript-renderer/_.js","webpack://logbook/./src/renderer/javascript-renderer/eval-worker/_.js","webpack://logbook/./src/renderer/markdown-renderer.js","webpack://logbook/./src/renderer/marked.js","webpack://logbook/./src/renderer/plotly-renderer.js","webpack://logbook/./src/renderer/plotly.js","webpack://logbook/./src/renderer/renderer.js","webpack://logbook/./src/renderer/tex-renderer.js","webpack://logbook/./src/renderer/text-renderer.js","webpack://logbook/./src/renderer/texzilla.js","webpack://logbook/./src/settings/settings-dialog/_.js","webpack://logbook/./src/settings/settings.js","webpack://logbook/./src/settings/storage.js","webpack://logbook/./lib/sys/idb.js","webpack://logbook/./src/settings/theme-settings.js","webpack://logbook/./src/toggle-switch-element/_.js","webpack://logbook/./src/tool-bar-element/_.js","webpack://logbook/webpack/bootstrap","webpack://logbook/webpack/runtime/compat get default export","webpack://logbook/webpack/runtime/define property getters","webpack://logbook/webpack/runtime/ensure chunk","webpack://logbook/webpack/runtime/get javascript chunk filename","webpack://logbook/webpack/runtime/global","webpack://logbook/webpack/runtime/hasOwnProperty shorthand","webpack://logbook/webpack/runtime/make namespace object","webpack://logbook/webpack/runtime/publicPath","webpack://logbook/webpack/runtime/jsonp chunk loading","webpack://logbook/webpack/runtime/nonce","webpack://logbook/webpack/startup"],"sourcesContent":["var webpackQueues = typeof Symbol === \"function\" ? Symbol(\"webpack queues\") : \"__webpack_queues__\";\nvar webpackExports = typeof Symbol === \"function\" ? Symbol(\"webpack exports\") : \"__webpack_exports__\";\nvar webpackError = typeof Symbol === \"function\" ? Symbol(\"webpack error\") : \"__webpack_error__\";\nvar resolveQueue = (queue) => {\n\tif(queue && queue.d < 1) {\n\t\tqueue.d = 1;\n\t\tqueue.forEach((fn) => (fn.r--));\n\t\tqueue.forEach((fn) => (fn.r-- ? fn.r++ : fn()));\n\t}\n}\nvar wrapDeps = (deps) => (deps.map((dep) => {\n\tif(dep !== null && typeof dep === \"object\") {\n\t\tif(dep[webpackQueues]) return dep;\n\t\tif(dep.then) {\n\t\t\tvar queue = [];\n\t\t\tqueue.d = 0;\n\t\t\tdep.then((r) => {\n\t\t\t\tobj[webpackExports] = r;\n\t\t\t\tresolveQueue(queue);\n\t\t\t}, (e) => {\n\t\t\t\tobj[webpackError] = e;\n\t\t\t\tresolveQueue(queue);\n\t\t\t});\n\t\t\tvar obj = {};\n\t\t\tobj[webpackQueues] = (fn) => (fn(queue));\n\t\t\treturn obj;\n\t\t}\n\t}\n\tvar ret = {};\n\tret[webpackQueues] = x => {};\n\tret[webpackExports] = dep;\n\treturn ret;\n}));\n__webpack_require__.a = (module, body, hasAwait) => {\n\tvar queue;\n\thasAwait && ((queue = []).d = -1);\n\tvar depQueues = new Set();\n\tvar exports = module.exports;\n\tvar currentDeps;\n\tvar outerResolve;\n\tvar reject;\n\tvar promise = new Promise((resolve, rej) => {\n\t\treject = rej;\n\t\touterResolve = resolve;\n\t});\n\tpromise[webpackExports] = exports;\n\tpromise[webpackQueues] = (fn) => (queue && fn(queue), depQueues.forEach(fn), promise[\"catch\"](x => {}));\n\tmodule.exports = promise;\n\tbody((deps) => {\n\t\tcurrentDeps = wrapDeps(deps);\n\t\tvar fn;\n\t\tvar getResult = () => (currentDeps.map((d) => {\n\t\t\tif(d[webpackError]) throw d[webpackError];\n\t\t\treturn d[webpackExports];\n\t\t}))\n\t\tvar promise = new Promise((resolve) => {\n\t\t\tfn = () => (resolve(getResult));\n\t\t\tfn.r = 0;\n\t\t\tvar fnQueue = (q) => (q !== queue && !depQueues.has(q) && (depQueues.add(q), q && !q.d && (fn.r++, q.push(fn))));\n\t\t\tcurrentDeps.map((dep) => (dep[webpackQueues](fnQueue)));\n\t\t});\n\t\treturn fn.r ? promise : getResult();\n\t}, (err) => ((err ? reject(promise[webpackError] = err) : outerResolve(exports)), resolveQueue(queue)));\n\tqueue && queue.d < 0 && (queue.d = 0);\n};","var inProgress = {};\nvar dataWebpackPrefix = \"logbook:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = (url, done, key, chunkId) => {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = (prev, event) => {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach((fn) => (fn(event)));\n\t\tif(prev) return prev(event);\n\t}\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `/* fix display of errors from TeXZilla */\n/* !!! review this later !!! */\nmerror > mtext {\n    display: block;  /* was \"block math\", but this prevents display beyond line 1 of the error message */\n    margin: 0.25em;  /* expand the margin on error messages from texzilla */\n}\n\np,\nh1, h2, h3, h4, h5, h6, h7, h8, h9 {\n    margin-block-start: 0.1em;\n    margin-block-end:   0.1em;\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/style-hacks.css\"],\"names\":[],\"mappings\":\"AAAA,wCAAwC;AACxC,8BAA8B;AAC9B;IACI,cAAc,GAAG,mFAAmF;IACpG,cAAc,GAAG,sDAAsD;AAC3E;;AAEA;;IAEI,yBAAyB;IACzB,yBAAyB;AAC7B\",\"sourcesContent\":[\"/* fix display of errors from TeXZilla */\\n/* !!! review this later !!! */\\nmerror > mtext {\\n    display: block;  /* was \\\"block math\\\", but this prevents display beyond line 1 of the error message */\\n    margin: 0.25em;  /* expand the margin on error messages from texzilla */\\n}\\n\\np,\\nh1, h2, h3, h4, h5, h6, h7, h8, h9 {\\n    margin-block-start: 0.1em;\\n    margin-block-end:   0.1em;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `/* all other stylesheets have been incorporated into this one (except no editor-cell-element) */\n\n/* See settings/theme-settings.js for definition of --theme-* properties */\n\n:root {\n    --input-output-split: 50vw;  /* must specify absolute amount, not %, otherwise .resize-handle will be misaligned */\n\n    --is-stacked: ;  /* is input/output displayed stacked or side-by-side (default) */\n\n    --resize-handle-size:          8px;   /* handle is a downward-pointing triangle with this height and twice this width */\n    --resize-handle-hairline-size: 1px;   /* (half) width of hairline displayed when dragging resize-handle */\n\n    --resize-handle-center-h: calc(var(--input-output-split) + (2 * var(--theme-cl-bdw)));\n}\n\nbody {\n    overflow: hidden;  /* inhibit scrolling for body */\n    margin: 0;\n    background-color: var(--theme-by-bgc);\n}\n\nheader {\n    display: flex;\n    align-items: flex-end;\n    justify-content: flex-start;\n\n    height: var(--theme-hd-h);\n    background-color: var(--theme-hd-bgc);\n}\n\nheader > tool-bar {  /* next to menu */\n    visibility: visible;\n    align-self: center;\n\n    max-height: fit-content;\n    padding: 0 0.5em;\n    border: 0;\n    background-color: transparent;  /* use underlying color from header */\n}\n\nmain {\n    margin: 2px 0 0 1px;  /* prevent top and left borders from getting absorbed into surrounding element */\n\n    /* enable scrolling for main element */\n    overflow: auto;\n    max-height: calc(100vh - var(--theme-hd-h));\n    max-width:  100vw;\n}\nmain > :first-child {\n    padding-top: 0;\n}\nmain > :not(:first-child) {\n    padding-top: var(--theme-cl-p-inter);\n}\n\n.cell-container {\n    display: flex;\n    flex-direction: row;\n    overflow: hidden;\n}\n\n.cell-input-container {\n    overflow: hidden;\n\n    border-width:  var(--theme-cl-bdw);\n    border-radius: var(--theme-cl-bdr);\n    border-style:  var(--theme-cl-bds);\n    border-color:  var(--theme-cl-bdc);\n}\n.cell-container[data-active] .cell-input-container {\n    border-color:  var(--theme-cl-bdc-active);\n}\n.cell-container[data-active]:focus-within .cell-input-container {\n    border-color:  var(--theme-cl-bdc-focus);\n}\n\n.resize-handle {\n    position: absolute;\n    left: calc(var(--resize-handle-center-h) - var(--resize-handle-size));\n    /* form a down-pointing arrow with a centered tip */\n    border-style: solid;\n    border-color: var(--theme-rh-bgc) transparent transparent transparent;\n    border-width: var(--resize-handle-size) var(--resize-handle-size) 0 var(--resize-handle-size);\n }\n.resize-handle:hover,\n.resize-handle.dragging {\n    border-color: var(--theme-rh-bgc-hover) transparent transparent transparent;\n}\n.resize-handle:hover::after,\n.resize-handle.dragging::after {\n    content: \" \";\n    position: absolute;\n    left: calc(0px - var(--resize-handle-hairline-size));\n    min-width: calc(2 * var(--resize-handle-hairline-size));\n    max-width: calc(2 * var(--resize-handle-hairline-size));\n    min-height: 100vh;\n    background-color: var(--theme-rh-bgc-hover);\n}\n\n.collapse-cells tool-bar,\n.collapse-cells eval-cell {\n    display: none;\n}\n.collapse-cells .cell-input-container {\n    border: 0;\n}\n\n.cell-input-container {\n    min-width: var(--input-output-split);\n    max-width: var(--input-output-split);\n}\n\n@media screen and (max-width: 40em) {\n    /* responsive: input/output stacked vs side-by-side */\n\n    :root {\n        --is-stacked: yes;\n    }\n\n    .cell-container {\n        flex-direction: column;\n    }\n    .cell-input-container {\n        min-width: unset;\n        max-width: unset;\n    }\n    .resize-handle {\n        display: none;\n    }\n}\n\n.eval-cell-output {\n    display: block;\n    overflow: auto;  /* enable h/v scrolling */\n\n    height: fit-content;\n\n    padding: var(--theme-ou-p);\n    color:            var(--theme-ou-fgc);\n    background-color: var(--theme-ou-bgc);\n}\n.eval-cell-output:empty,\n.eval-cell-output:not(:has(> *:not(:empty))) {\n    display: none;\n}\n\n.plain-text {\n    white-space: pre-wrap;  /* display white-space properly */\n    line-height: 140%;\n}\n\ntool-bar {\n    overflow: hidden;\n\n    visibility: visible;\n\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n    gap: var(--theme-tl-g);\n\n    max-height: fit-content;\n    padding: var(--theme-tl-p);\n    border: 0;\n\n    background-color: var(--theme-tl-bgc);\n}\n\neval-cell {\n    overflow: hidden;\n\n    display: block;\n    margin:  0;\n\n    caret-color: var(--theme-cl-ctc);\n    outline: 0px solid transparent;  /* disable default contenteditable outline */\n\n    white-space: pre-wrap;  /* properly display white-space */\n    font-family: var(--theme-cl-ff);\n    line-height: var(--theme-cl-lh);\n\n    color:            var(--theme-cl-fgc);\n    background-color: var(--theme-cl-bgc);\n\n    max-height:   fit-content;\n    padding:      var(--theme-cl-p);\n    border-width: 0;\n    border-top-color:    transparent;\n    border-left-color:   var(--theme-cl-bdc);\n    border-bottom-color: var(--theme-cl-bdc);\n    border-right-color:  var(--theme-cl-bdc);\n\n    border-radius: 0 0 var(--theme-cl-bdr) var(--theme-cl-bdr);\n    border-style:  var(--theme-cl-bds);\n}\n\neval-cell > textarea {\n    color:            var(--theme-cl-fgc);\n    background-color: var(--theme-cl-bgc);\n    resize: none;  /* remove resize control */\n    outline: none;  /* handled by parent eval-cell */\n    width: 100%;\n    padding: 0 0 1px 0;  /* 1px on bottom to prevent \"_\" from being hidden on bottom line */\n    border: 0;\n    margin: 0;\n}\n\n\n/* color selected by eval-cell input-type */\n\ntool-bar select {\n    border-radius: 0.5rem 0.5rem 0 0 / 30% 30% 0 0;\n    border-width: 0;\n}\n\ntool-bar select,  /* markdown is default */\ntool-bar > select:has(> option[value=\"markdown\"]:checked) {\n    color:            var(--theme-ty-fgc-markdown);\n    background-color: var(--theme-ty-bgc-markdown);\n}\n\ntool-bar > select:has(> option[value=\"javascript\"]:checked) {\n    color:            var(--theme-ty-fgc-javascript);\n    background-color: var(--theme-ty-bgc-javascript);\n}\n\ntool-bar > select:has(> option[value=\"tex\"]:checked) {\n    color:            var(--theme-ty-fgc-tex);\n    background-color: var(--theme-ty-bgc-tex);\n}\n\ntool-bar option {\n    color: initial;  /* setting other color causes poor drop-down list display; seen in Chromium 116 */\n}\n\ntool-bar:has(option),  /* markdown is default */\ntool-bar:has(option[value=\"markdown\"]:checked) {\n    border-bottom-color: var(--theme-ty-bgc-markdown);\n    background-color: color-mix(in srgb, var(--theme-tl-bgc), var(--theme-ty-bgc-markdown) var(--theme-tl-bgc-mix));\n}\n\ntool-bar:has(option[value=\"javascript\"]:checked) {\n    border-bottom-color: var(--theme-ty-bgc-javascript);\n    background-color: color-mix(in srgb, var(--theme-tl-bgc), var(--theme-ty-bgc-javascript) var(--theme-tl-bgc-mix));\n}\n\ntool-bar:has(option[value=\"tex\"]:checked) {\n    border-bottom-color: var(--theme-ty-bgc-tex);\n    background-color: color-mix(in srgb, var(--theme-tl-bgc), var(--theme-ty-bgc-tex) var(--theme-tl-bgc-mix));\n}\n\n\n/* === tool-bar indicators and controls === */\n\ntool-bar > * {\n    margin: 0;  /* pack controls within tool-bar; let flex gap handle spacing */\n}\n\n.tool-bar-indicator {\n    display: block;\n    width:  0.5em;\n    height: 0.5em;\n    margin: 0;\n    padding: 0;\n    border-radius: 50%;\n    border: 1px solid var(--theme-ti-bdc);\n    background-color: var(--theme-ti-bgc);\n}\n\n.tool-bar-indicator.running[data-indicator-value=\"on\"] {\n    border: 1px solid var(--theme-ti-bdc-running);\n    background-color: var(--theme-ti-bgc-running);\n}\n.tool-bar-indicator.modified[data-indicator-value=\"on\"] {\n    border: 1px solid var(--theme-ti-bdc-modified);\n    background-color: var(--theme-ti-bgc-modified);\n}\n\ntool-bar > select > option {\n    background-color: var(--theme-ty-bgc);\n}\n\n\n/* === toggle-switch === */\n\ntoggle-switch {\n    appearance: none;\n    border: 0;\n    width:  var(--theme-ts-w);\n    height: var(--theme-ts-h);\n}\n\ntoggle-switch svg {\n    width:  auto;\n    height: 100%;\n    background-color: transparent;\n}\n\ntoggle-switch.tool-bar-toggle-autoeval                      svg .accent-fill   { fill:   var(--theme-ts-flc-autoeval); }\ntoggle-switch.tool-bar-toggle-autoeval                      svg .accent-stroke { stroke: var(--theme-ts-stc-autoeval); }\ntoggle-switch.tool-bar-toggle-autoeval[aria-checked=\"true\"] svg .accent-fill   { fill:   var(--theme-ts-flc-autoeval-checked); }\ntoggle-switch.tool-bar-toggle-autoeval[aria-checked=\"true\"] svg .accent-stroke { stroke: var(--theme-ts-stc-autoeval-checked); }\n\n\n/* theme-aware graphics */\n\n[data-type=\"graphviz\"] svg polygon {\n    fill:   var(--theme-gr-bgc);\n    stroke: var(--theme-gr-fgc);\n}\n[data-type=\"graphviz\"] svg path,\n[data-type=\"graphviz\"] svg ellipse {\n    stroke: var(--theme-gr-fgc);\n}\n[data-type=\"graphviz\"] svg text {\n    fill: var(--theme-gr-fgc);\n}\n\n\n/* === menu === */\n\n.menu:not(.active) {\n    display: none;\n}\n\n.menubar {\n    margin: 0;\n    padding: 0.1rem 0 0.1rem 0;\n    background-color: var(--theme-mu-bgc);\n}\n\n.menubar > li {\n    display: inline;  /* horizontal orientation for top-level items of menubar */\n    padding: 0 0.5rem 0 0.5rem;\n}\n\n.menubar .menuitem {\n    list-style-type: none;\n    min-width: max-content;\n}\n\n.menuitem * {\n    user-select: none;\n}\n\n.menuitem .menuitem-label {\n    font-family: sans-serif;\n    font-size: 90%;\n}\n\n.menubar .menuitem.checked::before {\n    content: \"\\\\2713\";  /* unicode check mark */\n    position: absolute;\n    left: 0.5em;\n}\n\n.menubar div {\n    display: inline;\n}\n\n.menu {\n    position: absolute;\n    z-index: 999;\n    background-color: var(--theme-mu-bgc);\n    padding: 0.25rem 0 0.25rem 0;  /* override standard ul/li padding */\n    border-radius: 0.25rem;\n    border: 1px solid var(--theme-mu-bdc);\n    box-shadow: 3px 3px 16px var(--theme-mu-shc);\n\n    /* eliminate default styling for menu elements */\n    margin-block-start:   0;\n    margin-block-end:     0;\n    margin-inline-start:  0;\n    margin-inline-end:    0;\n    padding-inline-start: 0;\n}\n\n.menuitem {\n    color: var(--theme-mi-fgc);\n}\n\n.menuitem.disabled {\n    color: var(--theme-mi-fgc-disabled);\n}\n\n.menuitem.selected {\n    background-color: var(--theme-mi-bgc-selected);\n}\n\n.menu .menuitem:not(.menuitem-separator) {\n    padding: 0 0.5rem 0 1.5rem;\n}\n\n.menu .menuitem.menuitem-separator {\n    margin: 0.2rem 0 0.2rem 0;\n    height: 0px;\n    color: transparent;\n    border-bottom: 1px solid var(--theme-ms-bgc);\n}\n\n.menu .menuitem .menuitem-annotation {\n    margin-left: 2rem;\n    float: right;\n}\n\n.menu .menuitem kbd {\n    margin: 0 0 0 0.5rem;\n}\n\n\n/* === dialog === */\n\ndialog {\n    border-radius: 0.5em;\n    box-shadow: 3px 3px 16px var(--theme-dg-shc);\n}\n\ndialog button,\ndialog input[type=\"button\"] {\n    margin: 1.75em 0 0 0;\n}\n\ndialog .dialog_decline {\n    display: inline;\n}\n\ndialog .dialog_accept {\n    display: inline;\n}\n\n\n/* === settings-dialog === */\n\n.settings-dialog {\n    background-color: var(--theme-st-bgc);\n}\n\n.settings-dialog .dialog-text {\n    font-style: italic;\n}\n\n.settings-dialog [data-section] {\n    position: relative;\n    display: grid;\n    grid-template-columns: min-content min-content;\n    min-width: max-content;\n    margin: 1.75em 0 0 0;\n    padding: 1em 0.5em 0.5em;\n    border-radius: 8px;\n    border: 1px solid var(--theme-st-bdc-section);\n    color:            var(--theme-st-fgc-section);\n    background-color: var(--theme-st-bgc-section);\n}\n\n.settings-dialog [data-section]::before {  /* named section heading */\n    position: absolute;\n    content: attr(data-section);\n    left: 0.8em;\n    top: -0.7em;\n    padding: 0 1em;\n    border-radius: 4px;\n    border: 1px solid var(--theme-st-bdc-section-heading);\n    color:            var(--theme-st-fgc-section-heading);\n    background-color: var(--theme-st-bgc-section-heading);\n    font-style: italic;\n}\n\n.settings-dialog [data-section] label {\n    align-self: center;\n    justify-self: end;\n    white-space: nowrap;\n    user-select: none;\n}\n\n.settings-dialog [data-section] input,\n.settings-dialog [data-section] select {\n    align-self: center;\n    justify-self: start;\n    color:            var(--theme-st-fgc-section-setting);\n    background-color: var(--theme-st-bgc-section-setting);\n    margin: 0.25em;\n}\n\n.settings-dialog [data-section] input[type=\"text\"] {\n    width: 5em;\n}\n\n.settings-dialog .warning {\n    display: none;\n    width: 13em;\n    margin: 1.75em 0 0 1em;\n    padding: 0.5em;\n    border-radius: 8px;\n    border: 1px solid var(--theme-st-bdc-warning);\n    color:            var(--theme-st-fgc-warning);\n    background-color: var(--theme-st-bgc-warning);\n}\n.settings-dialog .warning p:first-child {\n    margin-block-start: 0;\n}\n.settings-dialog .warning p:last-child {\n    margin-block-end: 0;\n}\n.settings-dialog .show-emacs-warning .emacs-warning {\n    display: block;\n}\n\n.settings-dialog .error-message {\n    display: none;\n    width: 13em;\n    margin: 1.75em 0 0 1em;\n    padding: 0.5em;\n    border-radius: 5pt;\n    border: 1px solid var(--theme-st-bdc-error);\n    color:            var(--theme-st-fgc-error);\n    background-color: var(--theme-st-bgc-error);\n}\n.settings-dialog .error-message.active {\n    display: block;\n}\n\n\n/* === global error messages === */\n\nbody > .error-message {\n    display: block;\n    margin: 1.75em;\n    padding: 0.5em;\n    border-radius: 5pt;\n    border: 1px solid var(--theme-by-bdc-error);\n    color:            var(--theme-by-fgc-error);\n    background-color: var(--theme-by-bgc-error);\n}\n\n\n/* === print media queries === */\n\n@media not print {\n    /* nothing for now */\n}\n\n@media print {\n\n    header {\n        display: none;\n    }\n\n    main {\n        overflow: visible;\n    }\n\n    .resize-handle,\n    .resize-handle::after {\n        display: none;\n    }\n\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/style.css\"],\"names\":[],\"mappings\":\"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\",\"sourcesContent\":[\"/* all other stylesheets have been incorporated into this one (except no editor-cell-element) */\\n\\n/* See settings/theme-settings.js for definition of --theme-* properties */\\n\\n:root {\\n    --input-output-split: 50vw;  /* must specify absolute amount, not %, otherwise .resize-handle will be misaligned */\\n\\n    --is-stacked: ;  /* is input/output displayed stacked or side-by-side (default) */\\n\\n    --resize-handle-size:          8px;   /* handle is a downward-pointing triangle with this height and twice this width */\\n    --resize-handle-hairline-size: 1px;   /* (half) width of hairline displayed when dragging resize-handle */\\n\\n    --resize-handle-center-h: calc(var(--input-output-split) + (2 * var(--theme-cl-bdw)));\\n}\\n\\nbody {\\n    overflow: hidden;  /* inhibit scrolling for body */\\n    margin: 0;\\n    background-color: var(--theme-by-bgc);\\n}\\n\\nheader {\\n    display: flex;\\n    align-items: flex-end;\\n    justify-content: flex-start;\\n\\n    height: var(--theme-hd-h);\\n    background-color: var(--theme-hd-bgc);\\n}\\n\\nheader > tool-bar {  /* next to menu */\\n    visibility: visible;\\n    align-self: center;\\n\\n    max-height: fit-content;\\n    padding: 0 0.5em;\\n    border: 0;\\n    background-color: transparent;  /* use underlying color from header */\\n}\\n\\nmain {\\n    margin: 2px 0 0 1px;  /* prevent top and left borders from getting absorbed into surrounding element */\\n\\n    /* enable scrolling for main element */\\n    overflow: auto;\\n    max-height: calc(100vh - var(--theme-hd-h));\\n    max-width:  100vw;\\n}\\nmain > :first-child {\\n    padding-top: 0;\\n}\\nmain > :not(:first-child) {\\n    padding-top: var(--theme-cl-p-inter);\\n}\\n\\n.cell-container {\\n    display: flex;\\n    flex-direction: row;\\n    overflow: hidden;\\n}\\n\\n.cell-input-container {\\n    overflow: hidden;\\n\\n    border-width:  var(--theme-cl-bdw);\\n    border-radius: var(--theme-cl-bdr);\\n    border-style:  var(--theme-cl-bds);\\n    border-color:  var(--theme-cl-bdc);\\n}\\n.cell-container[data-active] .cell-input-container {\\n    border-color:  var(--theme-cl-bdc-active);\\n}\\n.cell-container[data-active]:focus-within .cell-input-container {\\n    border-color:  var(--theme-cl-bdc-focus);\\n}\\n\\n.resize-handle {\\n    position: absolute;\\n    left: calc(var(--resize-handle-center-h) - var(--resize-handle-size));\\n    /* form a down-pointing arrow with a centered tip */\\n    border-style: solid;\\n    border-color: var(--theme-rh-bgc) transparent transparent transparent;\\n    border-width: var(--resize-handle-size) var(--resize-handle-size) 0 var(--resize-handle-size);\\n }\\n.resize-handle:hover,\\n.resize-handle.dragging {\\n    border-color: var(--theme-rh-bgc-hover) transparent transparent transparent;\\n}\\n.resize-handle:hover::after,\\n.resize-handle.dragging::after {\\n    content: \\\" \\\";\\n    position: absolute;\\n    left: calc(0px - var(--resize-handle-hairline-size));\\n    min-width: calc(2 * var(--resize-handle-hairline-size));\\n    max-width: calc(2 * var(--resize-handle-hairline-size));\\n    min-height: 100vh;\\n    background-color: var(--theme-rh-bgc-hover);\\n}\\n\\n.collapse-cells tool-bar,\\n.collapse-cells eval-cell {\\n    display: none;\\n}\\n.collapse-cells .cell-input-container {\\n    border: 0;\\n}\\n\\n.cell-input-container {\\n    min-width: var(--input-output-split);\\n    max-width: var(--input-output-split);\\n}\\n\\n@media screen and (max-width: 40em) {\\n    /* responsive: input/output stacked vs side-by-side */\\n\\n    :root {\\n        --is-stacked: yes;\\n    }\\n\\n    .cell-container {\\n        flex-direction: column;\\n    }\\n    .cell-input-container {\\n        min-width: unset;\\n        max-width: unset;\\n    }\\n    .resize-handle {\\n        display: none;\\n    }\\n}\\n\\n.eval-cell-output {\\n    display: block;\\n    overflow: auto;  /* enable h/v scrolling */\\n\\n    height: fit-content;\\n\\n    padding: var(--theme-ou-p);\\n    color:            var(--theme-ou-fgc);\\n    background-color: var(--theme-ou-bgc);\\n}\\n.eval-cell-output:empty,\\n.eval-cell-output:not(:has(> *:not(:empty))) {\\n    display: none;\\n}\\n\\n.plain-text {\\n    white-space: pre-wrap;  /* display white-space properly */\\n    line-height: 140%;\\n}\\n\\ntool-bar {\\n    overflow: hidden;\\n\\n    visibility: visible;\\n\\n    display: flex;\\n    align-items: center;\\n    justify-content: flex-start;\\n    gap: var(--theme-tl-g);\\n\\n    max-height: fit-content;\\n    padding: var(--theme-tl-p);\\n    border: 0;\\n\\n    background-color: var(--theme-tl-bgc);\\n}\\n\\neval-cell {\\n    overflow: hidden;\\n\\n    display: block;\\n    margin:  0;\\n\\n    caret-color: var(--theme-cl-ctc);\\n    outline: 0px solid transparent;  /* disable default contenteditable outline */\\n\\n    white-space: pre-wrap;  /* properly display white-space */\\n    font-family: var(--theme-cl-ff);\\n    line-height: var(--theme-cl-lh);\\n\\n    color:            var(--theme-cl-fgc);\\n    background-color: var(--theme-cl-bgc);\\n\\n    max-height:   fit-content;\\n    padding:      var(--theme-cl-p);\\n    border-width: 0;\\n    border-top-color:    transparent;\\n    border-left-color:   var(--theme-cl-bdc);\\n    border-bottom-color: var(--theme-cl-bdc);\\n    border-right-color:  var(--theme-cl-bdc);\\n\\n    border-radius: 0 0 var(--theme-cl-bdr) var(--theme-cl-bdr);\\n    border-style:  var(--theme-cl-bds);\\n}\\n\\neval-cell > textarea {\\n    color:            var(--theme-cl-fgc);\\n    background-color: var(--theme-cl-bgc);\\n    resize: none;  /* remove resize control */\\n    outline: none;  /* handled by parent eval-cell */\\n    width: 100%;\\n    padding: 0 0 1px 0;  /* 1px on bottom to prevent \\\"_\\\" from being hidden on bottom line */\\n    border: 0;\\n    margin: 0;\\n}\\n\\n\\n/* color selected by eval-cell input-type */\\n\\ntool-bar select {\\n    border-radius: 0.5rem 0.5rem 0 0 / 30% 30% 0 0;\\n    border-width: 0;\\n}\\n\\ntool-bar select,  /* markdown is default */\\ntool-bar > select:has(> option[value=\\\"markdown\\\"]:checked) {\\n    color:            var(--theme-ty-fgc-markdown);\\n    background-color: var(--theme-ty-bgc-markdown);\\n}\\n\\ntool-bar > select:has(> option[value=\\\"javascript\\\"]:checked) {\\n    color:            var(--theme-ty-fgc-javascript);\\n    background-color: var(--theme-ty-bgc-javascript);\\n}\\n\\ntool-bar > select:has(> option[value=\\\"tex\\\"]:checked) {\\n    color:            var(--theme-ty-fgc-tex);\\n    background-color: var(--theme-ty-bgc-tex);\\n}\\n\\ntool-bar option {\\n    color: initial;  /* setting other color causes poor drop-down list display; seen in Chromium 116 */\\n}\\n\\ntool-bar:has(option),  /* markdown is default */\\ntool-bar:has(option[value=\\\"markdown\\\"]:checked) {\\n    border-bottom-color: var(--theme-ty-bgc-markdown);\\n    background-color: color-mix(in srgb, var(--theme-tl-bgc), var(--theme-ty-bgc-markdown) var(--theme-tl-bgc-mix));\\n}\\n\\ntool-bar:has(option[value=\\\"javascript\\\"]:checked) {\\n    border-bottom-color: var(--theme-ty-bgc-javascript);\\n    background-color: color-mix(in srgb, var(--theme-tl-bgc), var(--theme-ty-bgc-javascript) var(--theme-tl-bgc-mix));\\n}\\n\\ntool-bar:has(option[value=\\\"tex\\\"]:checked) {\\n    border-bottom-color: var(--theme-ty-bgc-tex);\\n    background-color: color-mix(in srgb, var(--theme-tl-bgc), var(--theme-ty-bgc-tex) var(--theme-tl-bgc-mix));\\n}\\n\\n\\n/* === tool-bar indicators and controls === */\\n\\ntool-bar > * {\\n    margin: 0;  /* pack controls within tool-bar; let flex gap handle spacing */\\n}\\n\\n.tool-bar-indicator {\\n    display: block;\\n    width:  0.5em;\\n    height: 0.5em;\\n    margin: 0;\\n    padding: 0;\\n    border-radius: 50%;\\n    border: 1px solid var(--theme-ti-bdc);\\n    background-color: var(--theme-ti-bgc);\\n}\\n\\n.tool-bar-indicator.running[data-indicator-value=\\\"on\\\"] {\\n    border: 1px solid var(--theme-ti-bdc-running);\\n    background-color: var(--theme-ti-bgc-running);\\n}\\n.tool-bar-indicator.modified[data-indicator-value=\\\"on\\\"] {\\n    border: 1px solid var(--theme-ti-bdc-modified);\\n    background-color: var(--theme-ti-bgc-modified);\\n}\\n\\ntool-bar > select > option {\\n    background-color: var(--theme-ty-bgc);\\n}\\n\\n\\n/* === toggle-switch === */\\n\\ntoggle-switch {\\n    appearance: none;\\n    border: 0;\\n    width:  var(--theme-ts-w);\\n    height: var(--theme-ts-h);\\n}\\n\\ntoggle-switch svg {\\n    width:  auto;\\n    height: 100%;\\n    background-color: transparent;\\n}\\n\\ntoggle-switch.tool-bar-toggle-autoeval                      svg .accent-fill   { fill:   var(--theme-ts-flc-autoeval); }\\ntoggle-switch.tool-bar-toggle-autoeval                      svg .accent-stroke { stroke: var(--theme-ts-stc-autoeval); }\\ntoggle-switch.tool-bar-toggle-autoeval[aria-checked=\\\"true\\\"] svg .accent-fill   { fill:   var(--theme-ts-flc-autoeval-checked); }\\ntoggle-switch.tool-bar-toggle-autoeval[aria-checked=\\\"true\\\"] svg .accent-stroke { stroke: var(--theme-ts-stc-autoeval-checked); }\\n\\n\\n/* theme-aware graphics */\\n\\n[data-type=\\\"graphviz\\\"] svg polygon {\\n    fill:   var(--theme-gr-bgc);\\n    stroke: var(--theme-gr-fgc);\\n}\\n[data-type=\\\"graphviz\\\"] svg path,\\n[data-type=\\\"graphviz\\\"] svg ellipse {\\n    stroke: var(--theme-gr-fgc);\\n}\\n[data-type=\\\"graphviz\\\"] svg text {\\n    fill: var(--theme-gr-fgc);\\n}\\n\\n\\n/* === menu === */\\n\\n.menu:not(.active) {\\n    display: none;\\n}\\n\\n.menubar {\\n    margin: 0;\\n    padding: 0.1rem 0 0.1rem 0;\\n    background-color: var(--theme-mu-bgc);\\n}\\n\\n.menubar > li {\\n    display: inline;  /* horizontal orientation for top-level items of menubar */\\n    padding: 0 0.5rem 0 0.5rem;\\n}\\n\\n.menubar .menuitem {\\n    list-style-type: none;\\n    min-width: max-content;\\n}\\n\\n.menuitem * {\\n    user-select: none;\\n}\\n\\n.menuitem .menuitem-label {\\n    font-family: sans-serif;\\n    font-size: 90%;\\n}\\n\\n.menubar .menuitem.checked::before {\\n    content: \\\"\\\\2713\\\";  /* unicode check mark */\\n    position: absolute;\\n    left: 0.5em;\\n}\\n\\n.menubar div {\\n    display: inline;\\n}\\n\\n.menu {\\n    position: absolute;\\n    z-index: 999;\\n    background-color: var(--theme-mu-bgc);\\n    padding: 0.25rem 0 0.25rem 0;  /* override standard ul/li padding */\\n    border-radius: 0.25rem;\\n    border: 1px solid var(--theme-mu-bdc);\\n    box-shadow: 3px 3px 16px var(--theme-mu-shc);\\n\\n    /* eliminate default styling for menu elements */\\n    margin-block-start:   0;\\n    margin-block-end:     0;\\n    margin-inline-start:  0;\\n    margin-inline-end:    0;\\n    padding-inline-start: 0;\\n}\\n\\n.menuitem {\\n    color: var(--theme-mi-fgc);\\n}\\n\\n.menuitem.disabled {\\n    color: var(--theme-mi-fgc-disabled);\\n}\\n\\n.menuitem.selected {\\n    background-color: var(--theme-mi-bgc-selected);\\n}\\n\\n.menu .menuitem:not(.menuitem-separator) {\\n    padding: 0 0.5rem 0 1.5rem;\\n}\\n\\n.menu .menuitem.menuitem-separator {\\n    margin: 0.2rem 0 0.2rem 0;\\n    height: 0px;\\n    color: transparent;\\n    border-bottom: 1px solid var(--theme-ms-bgc);\\n}\\n\\n.menu .menuitem .menuitem-annotation {\\n    margin-left: 2rem;\\n    float: right;\\n}\\n\\n.menu .menuitem kbd {\\n    margin: 0 0 0 0.5rem;\\n}\\n\\n\\n/* === dialog === */\\n\\ndialog {\\n    border-radius: 0.5em;\\n    box-shadow: 3px 3px 16px var(--theme-dg-shc);\\n}\\n\\ndialog button,\\ndialog input[type=\\\"button\\\"] {\\n    margin: 1.75em 0 0 0;\\n}\\n\\ndialog .dialog_decline {\\n    display: inline;\\n}\\n\\ndialog .dialog_accept {\\n    display: inline;\\n}\\n\\n\\n/* === settings-dialog === */\\n\\n.settings-dialog {\\n    background-color: var(--theme-st-bgc);\\n}\\n\\n.settings-dialog .dialog-text {\\n    font-style: italic;\\n}\\n\\n.settings-dialog [data-section] {\\n    position: relative;\\n    display: grid;\\n    grid-template-columns: min-content min-content;\\n    min-width: max-content;\\n    margin: 1.75em 0 0 0;\\n    padding: 1em 0.5em 0.5em;\\n    border-radius: 8px;\\n    border: 1px solid var(--theme-st-bdc-section);\\n    color:            var(--theme-st-fgc-section);\\n    background-color: var(--theme-st-bgc-section);\\n}\\n\\n.settings-dialog [data-section]::before {  /* named section heading */\\n    position: absolute;\\n    content: attr(data-section);\\n    left: 0.8em;\\n    top: -0.7em;\\n    padding: 0 1em;\\n    border-radius: 4px;\\n    border: 1px solid var(--theme-st-bdc-section-heading);\\n    color:            var(--theme-st-fgc-section-heading);\\n    background-color: var(--theme-st-bgc-section-heading);\\n    font-style: italic;\\n}\\n\\n.settings-dialog [data-section] label {\\n    align-self: center;\\n    justify-self: end;\\n    white-space: nowrap;\\n    user-select: none;\\n}\\n\\n.settings-dialog [data-section] input,\\n.settings-dialog [data-section] select {\\n    align-self: center;\\n    justify-self: start;\\n    color:            var(--theme-st-fgc-section-setting);\\n    background-color: var(--theme-st-bgc-section-setting);\\n    margin: 0.25em;\\n}\\n\\n.settings-dialog [data-section] input[type=\\\"text\\\"] {\\n    width: 5em;\\n}\\n\\n.settings-dialog .warning {\\n    display: none;\\n    width: 13em;\\n    margin: 1.75em 0 0 1em;\\n    padding: 0.5em;\\n    border-radius: 8px;\\n    border: 1px solid var(--theme-st-bdc-warning);\\n    color:            var(--theme-st-fgc-warning);\\n    background-color: var(--theme-st-bgc-warning);\\n}\\n.settings-dialog .warning p:first-child {\\n    margin-block-start: 0;\\n}\\n.settings-dialog .warning p:last-child {\\n    margin-block-end: 0;\\n}\\n.settings-dialog .show-emacs-warning .emacs-warning {\\n    display: block;\\n}\\n\\n.settings-dialog .error-message {\\n    display: none;\\n    width: 13em;\\n    margin: 1.75em 0 0 1em;\\n    padding: 0.5em;\\n    border-radius: 5pt;\\n    border: 1px solid var(--theme-st-bdc-error);\\n    color:            var(--theme-st-fgc-error);\\n    background-color: var(--theme-st-bgc-error);\\n}\\n.settings-dialog .error-message.active {\\n    display: block;\\n}\\n\\n\\n/* === global error messages === */\\n\\nbody > .error-message {\\n    display: block;\\n    margin: 1.75em;\\n    padding: 0.5em;\\n    border-radius: 5pt;\\n    border: 1px solid var(--theme-by-bdc-error);\\n    color:            var(--theme-by-fgc-error);\\n    background-color: var(--theme-by-bgc-error);\\n}\\n\\n\\n/* === print media queries === */\\n\\n@media not print {\\n    /* nothing for now */\\n}\\n\\n@media print {\\n\\n    header {\\n        display: none;\\n    }\\n\\n    main {\\n        overflow: visible;\\n    }\\n\\n    .resize-handle,\\n    .resize-handle::after {\\n        display: none;\\n    }\\n\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};","\n      import API from \"!../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../node_modules/css-loader/dist/cjs.js!./style-hacks.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../node_modules/css-loader/dist/cjs.js!./style-hacks.css\";\n       export default content && content.locals ? content.locals : undefined;\n","\n      import API from \"!../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../node_modules/css-loader/dist/cjs.js!./style.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../node_modules/css-loader/dist/cjs.js!./style.css\";\n       export default content && content.locals ? content.locals : undefined;\n","\"use strict\";\n\nvar stylesInDOM = [];\nfunction getIndexByIdentifier(identifier) {\n  var result = -1;\n  for (var i = 0; i < stylesInDOM.length; i++) {\n    if (stylesInDOM[i].identifier === identifier) {\n      result = i;\n      break;\n    }\n  }\n  return result;\n}\nfunction modulesToDom(list, options) {\n  var idCountMap = {};\n  var identifiers = [];\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i];\n    var id = options.base ? item[0] + options.base : item[0];\n    var count = idCountMap[id] || 0;\n    var identifier = \"\".concat(id, \" \").concat(count);\n    idCountMap[id] = count + 1;\n    var indexByIdentifier = getIndexByIdentifier(identifier);\n    var obj = {\n      css: item[1],\n      media: item[2],\n      sourceMap: item[3],\n      supports: item[4],\n      layer: item[5]\n    };\n    if (indexByIdentifier !== -1) {\n      stylesInDOM[indexByIdentifier].references++;\n      stylesInDOM[indexByIdentifier].updater(obj);\n    } else {\n      var updater = addElementStyle(obj, options);\n      options.byIndex = i;\n      stylesInDOM.splice(i, 0, {\n        identifier: identifier,\n        updater: updater,\n        references: 1\n      });\n    }\n    identifiers.push(identifier);\n  }\n  return identifiers;\n}\nfunction addElementStyle(obj, options) {\n  var api = options.domAPI(options);\n  api.update(obj);\n  var updater = function updater(newObj) {\n    if (newObj) {\n      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap && newObj.supports === obj.supports && newObj.layer === obj.layer) {\n        return;\n      }\n      api.update(obj = newObj);\n    } else {\n      api.remove();\n    }\n  };\n  return updater;\n}\nmodule.exports = function (list, options) {\n  options = options || {};\n  list = list || [];\n  var lastIdentifiers = modulesToDom(list, options);\n  return function update(newList) {\n    newList = newList || [];\n    for (var i = 0; i < lastIdentifiers.length; i++) {\n      var identifier = lastIdentifiers[i];\n      var index = getIndexByIdentifier(identifier);\n      stylesInDOM[index].references--;\n    }\n    var newLastIdentifiers = modulesToDom(newList, options);\n    for (var _i = 0; _i < lastIdentifiers.length; _i++) {\n      var _identifier = lastIdentifiers[_i];\n      var _index = getIndexByIdentifier(_identifier);\n      if (stylesInDOM[_index].references === 0) {\n        stylesInDOM[_index].updater();\n        stylesInDOM.splice(_index, 1);\n      }\n    }\n    lastIdentifiers = newLastIdentifiers;\n  };\n};","\"use strict\";\n\nvar memo = {};\n\n/* istanbul ignore next  */\nfunction getTarget(target) {\n  if (typeof memo[target] === \"undefined\") {\n    var styleTarget = document.querySelector(target);\n\n    // Special case to return head of iframe instead of iframe itself\n    if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n      try {\n        // This will throw an exception if access to iframe is blocked\n        // due to cross-origin restrictions\n        styleTarget = styleTarget.contentDocument.head;\n      } catch (e) {\n        // istanbul ignore next\n        styleTarget = null;\n      }\n    }\n    memo[target] = styleTarget;\n  }\n  return memo[target];\n}\n\n/* istanbul ignore next  */\nfunction insertBySelector(insert, style) {\n  var target = getTarget(insert);\n  if (!target) {\n    throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.\");\n  }\n  target.appendChild(style);\n}\nmodule.exports = insertBySelector;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction insertStyleElement(options) {\n  var element = document.createElement(\"style\");\n  options.setAttributes(element, options.attributes);\n  options.insert(element, options.options);\n  return element;\n}\nmodule.exports = insertStyleElement;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction setAttributesWithoutAttributes(styleElement) {\n  var nonce = typeof __webpack_nonce__ !== \"undefined\" ? __webpack_nonce__ : null;\n  if (nonce) {\n    styleElement.setAttribute(\"nonce\", nonce);\n  }\n}\nmodule.exports = setAttributesWithoutAttributes;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction apply(styleElement, options, obj) {\n  var css = \"\";\n  if (obj.supports) {\n    css += \"@supports (\".concat(obj.supports, \") {\");\n  }\n  if (obj.media) {\n    css += \"@media \".concat(obj.media, \" {\");\n  }\n  var needLayer = typeof obj.layer !== \"undefined\";\n  if (needLayer) {\n    css += \"@layer\".concat(obj.layer.length > 0 ? \" \".concat(obj.layer) : \"\", \" {\");\n  }\n  css += obj.css;\n  if (needLayer) {\n    css += \"}\";\n  }\n  if (obj.media) {\n    css += \"}\";\n  }\n  if (obj.supports) {\n    css += \"}\";\n  }\n  var sourceMap = obj.sourceMap;\n  if (sourceMap && typeof btoa !== \"undefined\") {\n    css += \"\\n/*# sourceMappingURL=data:application/json;base64,\".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), \" */\");\n  }\n\n  // For old IE\n  /* istanbul ignore if  */\n  options.styleTagTransform(css, styleElement, options.options);\n}\nfunction removeStyleElement(styleElement) {\n  // istanbul ignore if\n  if (styleElement.parentNode === null) {\n    return false;\n  }\n  styleElement.parentNode.removeChild(styleElement);\n}\n\n/* istanbul ignore next  */\nfunction domAPI(options) {\n  if (typeof document === \"undefined\") {\n    return {\n      update: function update() {},\n      remove: function remove() {}\n    };\n  }\n  var styleElement = options.insertStyleElement(options);\n  return {\n    update: function update(obj) {\n      apply(styleElement, options, obj);\n    },\n    remove: function remove() {\n      removeStyleElement(styleElement);\n    }\n  };\n}\nmodule.exports = domAPI;","\"use strict\";\n\n/* istanbul ignore next  */\nfunction styleTagTransform(css, styleElement) {\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css;\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild);\n    }\n    styleElement.appendChild(document.createTextNode(css));\n  }\n}\nmodule.exports = styleTagTransform;","export class EventListenerManager {\n    constructor(attached=false) {\n        this.#specs    = [];\n        this.#attached = !!attached;\n    }\n    #specs;     // array of { element, type, listener, options }\n    #attached;  // true iff event handlers have been attached\n\n    empty    (){ return this.#specs.length <= 0; }\n    attached (){ return this.#attached; }\n\n    add(target, type, listener, options) {\n        //!!! options is not copied, and yet is used later\n        //!!! could use structuredClone(), but would that prevent remove() from finding?\n        const spec = { target, type, listener, options };\n        this.constructor.#validate_spec(spec);\n        if (this.#first_spec_index_of(spec) !== -1) {\n            throw new Error('equivalent event handler already added');\n        }\n        if (this.#attached) {\n            target.addEventListener(type, listener, options);\n        }\n        this.#specs.push(spec);\n    }\n\n    remove(target, type, listener, options) {\n        const spec = { target, type, listener, options };\n        this.constructor.#validate_spec(spec);\n        const index = this.#first_spec_index_of(spec);\n        if (index === -1) {\n            throw new Error('specified event handler not found');\n        }\n        this.#specs.splice(index, 1);\n        if (this.#attached) {\n            target.removeEventListener(target, type, options);\n        }\n    }\n\n    remove_all() {\n        if (this.#attached) {\n            for (const spec of this.#specs) {\n                const { target, type, listener, options } = spec;\n                target.removeEventListener(type, listener, options);\n            }\n        }\n        this.#specs.splice(0);  // remove all entries\n    }\n\n    attach() {\n        if (!this.#attached) {\n            for (const spec of this.#specs) {\n                const { target, type, listener, options } = spec;\n                target.removeEventListener(type, listener, options);\n                target.addEventListener(type, listener, options);\n            }\n            this.#attached = true;\n        }\n    }\n\n    detach() {\n        if (this.#attached) {\n            for (const spec of this.#specs) {\n                const { target, type, listener, options } = spec;\n                target.removeEventListener(type, listener, options);\n                target.addEventListener(type, listener, options);\n            }\n            this.#attached = false;\n        }\n    }\n\n\n    // === INTERNAL ===\n\n    // returns -1 if not found, otherwise a positive integer\n    #first_spec_index_of(search_spec) {\n        for (let i = 0; i < this.#specs.length; i++) {\n            if (this.constructor.#same_specs(search_spec, this.#specs[i])) {\n                return i;\n            }\n        }\n        return -1;\n    }\n\n    // returns true iff spec is for a listener that uses \"capture\"\n    static #validate_spec(spec) {\n        if (typeof spec !== 'object') {\n            throw new Error('spec must be an object');\n        }\n        let uses_capture = false;\n        const { target, type, listener, options } = spec;\n        if (!(target instanceof EventTarget)) {\n            throw new Error('target must be an instance of EventTarget');\n        }\n        if (typeof type !== 'string') {\n            throw new Error('type in spec must be a string');\n        }\n        if (typeof listener !== 'function') {\n            throw new Error('listener in spec must be a function');\n        }\n        // removeEventListener() only pays attention to the \"capture\" effect\n        // of a handler when determining which handler to remove.\n        if (typeof options === 'boolean') {\n            uses_capture = options;\n        } else if (typeof options === 'object') {\n            uses_capture = !!options.capture;\n        } else if (typeof options !== 'undefined') {\n            throw new Error('options in spec must be a undefined, boolean, or an object');\n        }\n        return uses_capture;\n    }\n\n    // return truthy iff spec1 and spec2 are the same for the purposes of removal\n    static #same_specs(spec1, spec2) {\n        const uses_capture1 = this.#validate_spec(spec1);\n        const uses_capture2 = this.#validate_spec(spec2);\n        if (uses_capture1 !== uses_capture2) {\n            return false;\n        } else {\n            return (spec1.target === spec2.target && spec1.type === spec2.type && spec1.listener === spec2.listener);\n        }\n        //!!! should other members of options be checked (e.g., \"once\")?\n    }\n}\n","import {\n    OpenPromise,\n} from './open-promise.js';\n\n\nclass FsInterface {\n    // Determine if the File System Access API is available\n    static fsaapi_available = ( globalThis.FileSystemHandle &&\n                                globalThis.FileSystemFileHandle &&\n                                globalThis.FileSystemDirectoryHandle &&\n                                typeof globalThis.showOpenFilePicker  === 'function' &&\n                                typeof globalThis.showSaveFilePicker  === 'function' &&\n                                typeof globalThis.showDirectoryPicker === 'function'    );\n\n    static ensure_fsaapi_available() {\n        if (!this.fsaapi_available) {\n            throw new Error('unexpected: File System API is not available');\n        }\n    }\n\n    get fsaapi_available (){ return this.constructor.fsaapi_available; }\n\n    /** Verify permission to access the given FileSystemHandle, prompting the user if necessary\n     *  @param {FileSystemHandle} file_handle\n     *  @param {boolean} for_writing\n     *  @return {Promise} resolves if permission granted, rejects if permission not granted\n     */\n    async verify_permission(file_handle, for_writing=false) {\n        this.constructor.ensure_fsaapi_available();\n        const options = {};\n        if (for_writing) {\n            options.writable = true;  // File System API legacy\n            options.mode = 'readwrite';\n        }\n        return ( await file_handle.queryPermission(options)   === 'granted' ||\n                 await file_handle.requestPermission(options) === 'granted'    );\n    }\n\n    /** Save text to the file associated with a FileSystemFileHandle,\n     *  with the FileSystemFileHandle possibly gotten from prompting user.\n     *  @param {function} get_text nullary function to obtain text to be saved\n     *  @param {Object} options: {\n     *             file_handle?:    FileSystemFileHandle,  // if given, then open from file_handle without dialog\n     *             prompt_options?: Object,                // if given, then options for showSaveFilePicker() dialog\n     *         }\n     *  @return {Promise} resolves to { canceled: true }|{ file_handle: FileSystemFileHandle, stats: Object }\n     *          where stats is as returned by get_fs_stats_for_file()\n     */\n    async save(get_text, options) {\n        if (!this.fsaapi_available) {\n            return this.legacy_save(get_text, options);\n        }\n\n        options = options ?? {};\n\n        let file_handle = options.file_handle;\n        if (!file_handle) {\n            const prompt_result = await this.prompt_for_save(options.prompt_options);\n            if (prompt_result.canceled) {\n                return { canceled: true };\n            }\n            file_handle = prompt_result.file_handle;\n        }\n\n        await this.verify_permission(file_handle, true);\n        const text = get_text();\n        const writable = await file_handle.createWritable();\n        await writable.write(text);\n        await writable.close();\n        const stats = await this.get_fs_stats_for_file_handle(file_handle);\n\n        return { file_handle, stats };\n    }\n\n    /** Load text from the file associated with a FileSystemFileHandle,\n     *  with the FileSystemFileHandle possibly gotten from prompting user.\n     *  @param {Object} options {\n     *             file_handle?:    FileSystemFileHandle,  // if given, then open from file_handle without dialog\n     *             prompt_options?: Object,                // if given, then options for showOpenFilePicker() dialog\n     *         }\n     *  @return {Promise} resolves to { canceled: true }|{ file_handle: FileSystemFileHandle, text: string, stats: Object }\n     *          where stats is as returned by get_fs_stats_for_file()\n     */\n    async open(options) {\n        if (!this.fsaapi_available) {\n            return this.legacy_open(options);\n        }\n\n        options = options ?? {};\n\n        let file_handle = options.file_handle;\n        if (!file_handle) {\n            const prompt_result = await this.prompt_for_open(options.prompt_options);\n            if (prompt_result.canceled) {\n                return { canceled: true };\n            }\n            file_handle = prompt_result.file_handle;\n        }\n\n        await this.verify_permission(file_handle, false);\n        const file = await file_handle.getFile();\n        const text = await file.text();\n        const stats = this.get_fs_stats_for_file(file);\n\n        return { file_handle, text, stats };\n    }\n\n    /** Return stats for the file associated with a FileSystemFileHandle\n     *  @param {FileSystemFileHandle} file_handle\n     *  @return {Promise} resolves to stats as returned by get_fs_stats_for_file()\n     */\n    async get_fs_stats_for_file_handle(file_handle) {\n        this.constructor.ensure_fsaapi_available();\n        await this.verify_permission(file_handle);\n        const file = await file_handle.getFile();\n        return this.get_fs_stats_for_file(file);\n    }\n\n    /** Return stats for the file\n     *  @param {File} file\n     *  @return {object} stats: {\n     *              lastModified:  number,  // the \"last modified\" time of the file in milliseconds since the UNIX epoch (January 1, 1970 at Midnight UTC)\n     *              last_modified: number,  // synonym for lastModified\n     *              name:          string,  // name of file\n     *              size:          number,  // size of file in bytes\n     *              type:          string,  // MIME type of file contents\n     *          }\n     */\n    get_fs_stats_for_file(file) {\n        const {\n            lastModified,\n            lastModified: last_modified,\n            name,\n            size,\n            type,\n        } = file;\n\n        return {\n            lastModified,\n            last_modified,\n            name,\n            size,\n            type,\n        };\n    }\n\n    /** Show a file picker for the user to select a file for saving\n     *  @param {object|undefined} options for showSaveFilePicker()\n     *  @return {Promise} resolves to { canceled: true }|{ file_handle: FileSystemFileHandle }\n     */\n    async prompt_for_save(options=undefined) {\n        this.constructor.ensure_fsaapi_available();\n        const result = await this._prompt(globalThis.showSaveFilePicker, options);\n        return result\n            ? { file_handle: result }\n            : { canceled: true };\n    }\n\n    /** Show a file picker for the user to select a file for loading\n     *  @param {object|undefined} options for showOpenFilePicker()\n     *  @return {Promise} resolves to { canceled: true }|{ file_handle: FileSystemFileHandle }\n     */\n    async prompt_for_open(options=undefined) {\n        this.constructor.ensure_fsaapi_available();\n        options = options ?? {};\n        const result = await this._prompt(globalThis.showOpenFilePicker, { ...options, multiple: false });\n        return result\n            ? { file_handle: result[0] }\n            : { canceled: true };\n    }\n\n    async _prompt(picker, options) {\n        options = options ?? {};\n        let result;\n        try {\n            return await picker(options);\n        } catch (err) {\n            // Chromium no longer throws AbortError, instead it throws\n            // a DOMException, so just count any exception as \"canceled\"\n            return undefined;  // indicate: canceled\n        }\n    }\n\n    // === LEGACY ===\n\n    /** Save text to a file chosen by the user with the legacy File API.\n     *  @param {function} get_text nullary function to obtain text to be saved\n     *  @param {Object} options {\n     *             prompt_options?: Object,  // if given, then options for showSaveFilePicker() dialog (will be converted)\n     *         }\n     *  @return {Promise} resolves to { canceled: true }|{ stats: Object }\n     *          where stats is as returned by get_fs_stats_for_file()\n     */\n    async legacy_save(get_text, options) {\n        return new Promise((resolve, reject) => {\n            const text = get_text();\n            const a_el = document.createElement('a');\n            a_el.download = options?.name ?? 'Untitled.logbook';\n            a_el.href = URL.createObjectURL(new Blob([text], { type: 'text/plain'}));\n            // document.body.addEventListener('focus', ...) does not get activated, even if capture is set, so must use onfocus property\n            document.body.onfocus = (event) => {\n                document.body.onfocus = null;\n                URL.revokeObjectURL(a_el.href);\n                a_el.href = null;\n                resolve({});//!!! no stats\n            };\n            a_el.click();\n        });\n    }\n\n    /** Load text from the file associated with a FileSystemFileHandle,\n     *  with the FileSystemFileHandle possibly gotten from prompting user.\n     *  @param {Object} options {\n     *             prompt_options?: Object,  // if given, then options for showOpenFilePicker() dialog (will be converted)\n     *         }\n     *  @return {Promise} resolves to { canceled: true }|{ text: string, stats: Object }\n     *          where stats is as returned by get_fs_stats_for_file()\n     */\n    async legacy_open(options) {\n        const accept = this._convert_options_for_legacy(options);\n\n        // For browsers that do not support the File System Access API (e.g., Firefox)\n        // opening files is implemented by a file-type input element.  There is a\n        // problem with that, though: if the user activates the file open panel and\n        // then cancels, no event is emitted that we can use to subsequently remove\n        // the input element.\n        // Another issue is that the input element will not activate in Firefox (at\n        // the time of writing) unless the input element is part of the DOM.\n        // Fortunately, the input element need not be displayed in order for it to\n        // work.\n        // Therefore, once we create the input element, we just leave it in the DOM,\n        // hidden, and reuse it whenever necessary.\n\n        let i_el = document.getElementById(this.constructor.legacy_file_input_element_id);\n        if (!i_el) {\n            i_el = document.createElement('input');\n            i_el.id = this.constructor.legacy_file_input_element_id;\n            i_el.classList.add('hidden-fs-interface-element');  // css class definition in notebook/notebook.css\n            i_el.type = 'file';\n            if (accept) {\n                i_el.accept = accept;\n            }\n            document.body.insertBefore(i_el, document.body.firstChild);  // put at beginning of document body\n        }\n\n        const op = new OpenPromise();\n\n        i_el.onchange = async (event) => {\n            if (i_el.files.length <= 0) {\n                op.resolve({ canceled: true });\n            } else {\n                const file = i_el.files[0];\n                const text  = await file.text();\n                const stats = this.get_fs_stats_for_file(file);\n                op.resolve({\n                    text,\n                    stats,\n                });\n            }\n        };\n\n        // activate the file open panel\n        i_el.click();\n\n        return op.promise;\n    }\n\n    static legacy_file_input_element_id = 'legacy_file_input_element_id';\n\n    _convert_options_for_legacy(options) {\n        options = options ?? {};\n        const options_accept = options?.prompt_options?.types?.[0]?.accept;\n        const accept = !options_accept ? undefined : Object.keys(options_accept);\n        return accept;\n    }\n}\n\nexport const fs_interface = new FsInterface();\n","export function get_obj_path(obj, path) {\n    for (const segment of path) {\n        obj = (obj ?? {})[segment];\n    }\n    return obj;\n}\n\nexport function set_obj_path(obj, path, value) {\n    if (path.length < 1) {\n        throw new Error('path must contain at least one segment');\n    }\n    for (const segment of path.slice(0, -1)) {\n        if (typeof obj[segment] === 'undefined') {\n            obj[segment] = {};\n        }\n        obj = obj[segment];\n    }\n    obj[path.slice(-1)[0]] = value;\n}\n","/** a Promise-like object with its resolve and reject methods exposed externally\n */\nexport class OpenPromise {\n    constructor() {\n        let resolve, reject;\n        const promise = new Promise((o, x) => { resolve = o; reject = x; });\n        Object.defineProperties(this, {\n            promise: {\n                value: promise,\n            },\n            resolve: {\n                value: resolve,\n            },\n            reject: {\n                value: reject,\n            },\n            then: {\n                value: promise.then.bind(promise),\n            },\n            catch: {\n                value: promise.catch.bind(promise),\n            },\n            finally: {\n                value: promise.finally.bind(promise),\n            },\n        });\n    }\n\n    async await() { return await this.promise; }\n}\n","import {\n    load_script,\n} from '../ui/dom-tools.js';\n\nimport {\n    assets_server_url,\n} from '../../src/assets-server-url.js';\n\n\n// The \"esm\" distribution of rxjs is suitable for nodejs but not for\n// within browsers (at least currently) because it internally imports\n// files without specifying their \".js\" extensions assuming that the\n// extension will be implicitly added.  Imports in browsers require\n// an explicit full path.\n// Therefore, load the bundle version (which stores the result in\n// globalThis.rxjs) and deal with it that way\n// DOES NOT WORK: import * as rxjs from '../../node_modules/rxjs/dist/esm/index.js';\n\nawait load_script(document.head, assets_server_url('dist/rxjs.umd.min.js'));\n\nexport default { ...globalThis.rxjs };\nglobalThis.rxjs = undefined;  // remove from global environment\n","import {\n    load_script,\n} from '../ui/dom-tools.js';\n\nimport {\n    assets_server_url,\n} from '../../src/assets-server-url.js';\n\n\nawait load_script(document.head, assets_server_url('dist/sprintf.min.js'));\n\nexport const sprintf = globalThis.sprintf;\n","import {\n    Subscribable,\n} from './subscribable.js';\n\n\nexport class Stoppable {\n    /** create a new Stoppable object\n     *  @param {Object} target object that may be stopped\n     *  @param {Function} stopper function that takes target and stops it; default: (target) => target.stop()\n     *  @param {Boolean} multiple_stops whether or not target's stop method may be called multiple times\n     */\n    constructor(target, stopper=null, multiple_stops=false) {\n        if (target === null || typeof target === 'undefined') {\n            throw new Error('target must not be null or undefined');\n        }\n        stopper ??= (target) => target.stop();  // default\n        if (typeof stopper !== 'function') {\n            throw new Error('stopper must be a function taking target as a parameter');\n        }\n        Object.defineProperties(this, {\n            target: {\n                value: target,\n                enumerable: true,\n            },\n            stopper: {\n                value: stopper,\n                enumerable: true,\n            },\n            multiple_stops: {\n                value: multiple_stops,\n                enumerable: true,\n            },\n        });\n        this.#stop_count = 0;\n    }\n    #stop_count;\n\n    get stop_count (){ return this.#stop_count; }\n\n    get stopped (){ return this.#stop_count > 0; }\n\n    /** @return {Boolean} true iff stopper called on target,\n     */\n    stop() {\n        if (!this.multiple_stops && this.stopped) {\n            return false;  // indicate: stop not called\n        } else {\n            this.stopper(this.target);\n            this.#stop_count++;\n            return true;  // indicate: stop called\n        }\n    }\n}\n\nexport class StoppableObjectsManager {\n    constructor() {\n        this.#stoppable_objects = [];\n        this.#stopped           = false;\n        this.#stop_states       = new Subscribable();\n    }\n    #stoppable_objects;  // array of Stoppable objects\n    #stopped;            // true iff this.stop() has been called, false otherwise\n    #stop_states;        // Subscribable to receive stop state updates\n\n    get stopped     (){ return this.#stopped; }\n    get stop_states (){ return this.#stop_states; }\n\n    /** add a Stoppable to this.#stoppable_objects\n     *  @param {Stoppable} stoppable\n     */\n    add_stoppable(stoppable) {\n        if (!(stoppable instanceof Stoppable)) {\n            throw new Error('stoppable must be an instance of Stoppable');\n        }\n        this.#stoppable_objects.push(stoppable);\n    }\n\n    /** remove a Stoppable object from this.#stoppable_objects\n     *  @param {Stoppable} stoppable\n     *  @return {Boolean} found and removed?\n     */\n    remove_stoppable(stoppable) {\n        const index = this.#stoppable_objects.indexOf(stoppable);\n        if (index !== -1) {\n            this.#stoppable_objects.splice(index, 1);\n        }\n    }\n\n    /** stop and remove all stoppables from this.#stoppable_objects.\n     *  dispatch change to this.stop_states.\n     */\n    stop() {\n        const changed = !this.#stopped;\n        this.#stopped = true;\n        while (this.#stoppable_objects.length > 0) {\n            const stoppable = this.#stoppable_objects.pop();\n            try {\n                stoppable.stop();\n            } catch (error) {\n                console.warn('error while stopping', stoppable, error);\n            }\n        }\n        if (changed) {\n            this.stop_states.dispatch({\n                manager: this,\n                stopped: this.#stopped,\n            });\n        }\n    }\n}\n","import rxjs from '../../lib/sys/rxjs.js';\n\n\nexport class Subscribable extends rxjs.Subject {\n    dispatch(event_data) {\n        this.next(event_data);\n    }\n}\n","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default {\n  randomUUID\n};","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nlet getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nconst byteToHex = [];\n\nfor (let i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).slice(1));\n}\n\nexport function unsafeStringify(arr, offset = 0) {\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  return (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase();\n}\n\nfunction stringify(arr, offset = 0) {\n  const uuid = unsafeStringify(arr, offset); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  if (native.randomUUID && !buf && !options) {\n    return native.randomUUID();\n  }\n\n  options = options || {};\n  const rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (let i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return unsafeStringify(rnds);\n}\n\nexport default v4;","import v4 from '../../node_modules/uuid/dist/esm-browser/v4.js';\n\nexport const uuidv4 = v4;\n\nexport function generate_object_id() {\n    // html element ids cannot start with a number\n    // (if it does, document.querySelector throws error: '... is not a valid selector')\n    return `id-${uuidv4()}`;\n}\n\nexport function generate_uuid() {\n    return uuidv4();\n}\n","// from https://stackoverflow.com/questions/879152/how-do-i-make-javascript-beep\n\nexport const beep_data_uri = 'data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=';\n\nexport async function beep() {\n    const snd = new Audio(beep_data_uri);\n    return snd.play();\n}\n","/** Draw an arc centered a (x, y) with radius r.\n * @param {CanvasRenderingContext2D} ctx\n * @param {Number} x  // center x\n * @param {Number} y  // center y\n * @param {Number} r  // radius\n * @param {Object} options: {\n *     a0?:               Number,   // default: 0\n *     a1?:               Number,   // default: 2*Math.PI\n *     counterclockwise?: Boolean,  // default: false\n *     no_close_path?:    Boolean,  // default: false\n *     no_fill?:          Boolean,  // default: false\n *     no_stroke?:        Boolean,  // default: false\n * }\n */\nexport function draw_arc(ctx, x, y, r, options=null) {\n    if (!(ctx instanceof CanvasRenderingContext2D)) {\n        throw new Error('ctx must be an instance of CanvasRenderingContext2D');\n    }\n    const {\n        a0               = 0,\n        a1               = 2*Math.PI,\n        counterclockwise = false,\n        no_close_path    = false,\n        no_fill          = false,\n        no_stroke        = false,\n    } = (options ?? {});\n\n    ctx.beginPath();\n    ctx.arc(x, y, r, a0, a1, counterclockwise);\n    if (!no_close_path) {\n        ctx.closePath();\n    }\n    if (!no_fill) {\n        ctx.fill();\n    }\n    if (!no_stroke) {\n        ctx.stroke();\n    }\n}\n\n/** Ratio of default dot size to current line width (ctx.lineWidth),\n * used by draw_dot().\n */\nexport const default_dot_size_to_line_width_ratio = 3;\n\n/** Draw a dot at (x, y).\n * @param {CanvasRenderingContext2D} ctx\n * @param {Number} x  // center x\n * @param {Number} y  // center y\n * @param {Object} options: {\n *     r?:                Number,   // default: (default_dot_size_to_line_width_ratio * ctx.lineWidth)\n *     a0?:               Number,   // default: 0\n *     a1?:               Number,   // default: 2*Math.PI\n *     counterclockwise?: Boolean,  // default: false\n *     no_close_path?:    Boolean,  // default: false\n *     no_fill?:          Boolean,  // default: false\n *     no_stroke?:        Boolean,  // default: false\n * }\n * The dot is filled with the same color as the stroke: ctx.strokeStyle.\n */\nexport function draw_dot(ctx, x, y, options=null) {\n    if (!(ctx instanceof CanvasRenderingContext2D)) {\n        throw new Error('ctx must be an instance of CanvasRenderingContext2D');\n    }\n    const {\n        r = (default_dot_size_to_line_width_ratio * ctx.lineWidth),\n    } = (options ?? {});\n\n    const old_fill_style = ctx.fillStyle;\n    ctx.fillStyle = ctx.strokeStyle;\n    try {\n        draw_arc(ctx, x, y, r, options);\n    } finally {\n        ctx.fillStyle = old_fill_style;\n    }\n}\n\n/** Return the angle in radians to the x-axis represented by the vector (dx, dy).\n * @param  {Number} dx\n * @param  {Number} dy\n * @return {Number} angle in radians in the range [0, 2*Math.PI]\n * angle_from_heading(0, 0) returns 0.\n */\nexport function angle_from_heading(dx, dy) {\n    if (dx === 0) {\n        return (dy < 0) ? -Math.PI/2 : (dy > 0) ? Math.PI/2 : 0;\n    } else if (dy === 0) {\n        return (dx < 0) ? -Math.PI : 0;\n    } else {\n        const t = dy/dx;\n        const a = Math.atan(t);  // a in [-Math.PI/2, Math.PI/2]\n        if (dx < 0) {\n            if (dy < 0) {\n                return a + Math.PI;\n            } else {  // dy > 0\n                return a + Math.PI;\n            }\n        } else {  // dx > 0\n            if (dy < 0) {\n                return a + 2*Math.PI;\n            } else {  // dy > 0\n                return a;\n            }\n        }\n    }\n}\n\n/** Draw a line from (x0, y0) to (x1, y1).\n * @param {CanvasRenderingContext2D} ctx\n * @param {Number} x0  // start x\n * @param {Number} y0  // start y\n * @param {Number} x1  // end x\n * @param {Number} y1  // end y\n * @param {Object} options: {\n *     label?:         String,  // text of label to apply\n *     label_options?: Object,  // options suitable for draw_flipped_text()\n * }\n */\nexport function draw_line(ctx, x0, y0, x1, y1, options=null) {\n    if (!(ctx instanceof CanvasRenderingContext2D)) {\n        throw new Error('ctx must be an instance of CanvasRenderingContext2D');\n    }\n    const {\n        label,\n        label_options,\n    } = (options ?? {});\n    if (label && typeof label !== 'string') {\n        throw new Error('label must be undefined or a string');\n    }\n    if (label_options && typeof label_options !== 'object') {\n        throw new Error('label_options must be undefined or an object');\n    }\n    ctx.beginPath();\n    ctx.moveTo(x0, y0);\n    ctx.lineTo(x1, y1);\n    ctx.stroke();\n    if (label) {\n        draw_flipped_text(ctx, label, (x0+x1)/2, (y0+y1)/2, {\n            angle: angle_from_heading(x1-x0, y1-y0),  // set angle to match line (unless given in label_options)\n            ...(label_options ?? {}),\n        });\n    }\n}\n\n/** Ratio of default tick length to current line width (ctx.lineWidth),\n * used by draw_tick().\n */\nexport const default_tick_length_to_line_width_ratio = 8;\n\n/** Draw a tick mark at (x, y) perpendicular to the vector (hx, hy).\n * @param {CanvasRenderingContext2D} ctx\n * @param {Number} x   // center x\n * @param {Number} y   // center y\n * @param {Number} hx  // heading x\n * @param {Number} hy  // heading y\n * @param {Object} options: {\n *     len?: Number,  // tick length; default: (default_tick_length_to_line_width_ratio * ctx.lineWidth)\n * }\n * The tick is drawn perpendicular to the given heading (hx, hy).\n */\nexport function draw_tick(ctx, x, y, hx, hy, options=null) {\n    if (!(ctx instanceof CanvasRenderingContext2D)) {\n        throw new Error('ctx must be an instance of CanvasRenderingContext2D');\n    }\n    const {\n        len = (default_tick_length_to_line_width_ratio * ctx.lineWidth),\n    } = (options ?? {});\n    const hmag = Math.sqrt(hx*hx + hy*hy);\n    const px = -len*hy/hmag;\n    const py =  len*hx/hmag;\n    draw_line(ctx, x-px/2, y-py/2, x+px/2, y+py/2);\n}\n\n/** Draw ticks along the line segment from (x0, y0) to (x1, y1).\n * @param {CanvasRenderingContext2D} ctx\n * @param {Number} x0   // start x\n * @param {Number} y0   // start y\n * @param {Number} x1   // end x\n * @param {Number} y1   // end y\n * @param {Number} inc  // distance between ticks\n * @param {Object} options: {\n *     draw_initial: Boolean,  // also draw initial tick at (x0, y0)?\n *     ...{ options for draw_tick() }\n * }\n */\nexport function draw_ticks(ctx, x0, y0, x1, y1, inc, options=null) {\n    if (!(ctx instanceof CanvasRenderingContext2D)) {\n        throw new Error('ctx must be an instance of CanvasRenderingContext2D');\n    }\n    if (typeof inc !== 'number' || inc <= 0) {\n        throw new Error('inc must be a positive number');\n    }\n    const {\n        draw_initial = false,\n    } = (options ?? {});\n    const dx = x1 - x0;\n    const dy = y1 - y0;\n    const mag = Math.sqrt(dx*dx + dy*dy);\n    const x_inc = inc*dx/mag;\n    const y_inc = inc*dy/mag;\n    for (let x = x0, y = y0, first = true; x <= x1 && y <= y1; x += x_inc, y += y_inc, first = false) {\n        if (draw_initial || !first) {\n            draw_tick(ctx, x, y, dx, dy, options);\n        }\n    }\n}\n\n/** Draw text flipped top-to-bottom and centered at (x, y).\n * @param {CanvasRenderingContext2D} ctx\n * @param {String} text,  // text to draw\n * @param {Number} x      // center x\n * @param {Number} y      // center y\n * @param {Object} options: {\n *     stroke_only?: Boolean,  // only stroke if true, otherwise fill text\n *     clear?:       Boolean,  // clear background before rendering text?  true: clear to transparent, \"color\": fill with color\n *     padding?:     Number,   // padding to apply to rectangle when clearing\n *     angle?:       Number,   // orientation angle (radians)\n *     dxr?:         Number,   // x offset as a ratio to text width;  0: none, 1: offset by full width\n *     dyr?:         Number,   // y offset as a ratio to text height; 0: none, 1: offset by full height\n * }\n * The height used for the dyr calculation is (actualBoundingBoxAscent - actualBoundingBoxDescent).\n * With dxr = dyr = 0 (or undefined), the text will be output centered on (x, y)\n */\nexport function draw_flipped_text(ctx, text, x, y, options=null) {\n    if (!(ctx instanceof CanvasRenderingContext2D)) {\n        throw new Error('ctx must be an instance of CanvasRenderingContext2D');\n    }\n    const {\n        stroke_only,\n        clear,\n        padding,\n        angle,\n        dxr,\n        dyr,\n    } = (options ?? {});\n    if (!['undefined', 'number'].includes(typeof padding)) {\n        throw new Error('padding must be undefined or a number');\n    }\n    const initial_transform = ctx.getTransform();\n    try {\n        const metrics = ctx.measureText(text);\n        const width  = metrics.width;\n        const height = (metrics.actualBoundingBoxAscent - metrics.actualBoundingBoxDescent);\n        ctx.translate(x, y);\n        ctx.scale(1, -1);  // flip\n        if (angle) {  // note: angle === 0 fails this test, but that is consistent with not rotating\n            ctx.rotate(-angle);\n        }\n        ctx.translate(-width/2, height/2);  // center text\n        let x0 = 0, y0 = -height, x1 = width, y1 = 0;  // enclosing rectangle\n        if (dxr) {\n            const dx = dxr*width;\n            ctx.translate(dx, 0);\n        }\n        if (dyr) {\n            const dy = -dyr*height;\n            ctx.translate(0, dy);\n        }\n        if (clear) {\n            if (padding) {\n                x0 -= padding;\n                x1 += padding;\n                y0 -= padding;\n                y1 += padding;\n            }\n            ctx.clearRect(x0, y0, x1-x0, y1-y0);  // do regardless in case fill color has transparency\n            if (typeof clear === 'string') {\n                const old_fill_style = ctx.fillStyle;\n                try {\n                    ctx.fillStyle = clear;  // clear specifies a color\n                    ctx.fillRect(x0, y0, x1-x0, y1-y0);\n                } finally {\n                    ctx.fillStyle = old_fill_style;\n                }\n            }\n        }\n        ctx[stroke_only ? 'strokeText' : 'fillText'](text, 0, 0);\n    } finally {\n        ctx.setTransform(initial_transform);\n    }\n}\n\n/** Ratio of default arrowhead length to current line width (ctx.lineWidth),\n * used by draw_arrowhead() and draw_arrow().\n */\nexport const default_arrowhead_length_to_line_width_ratio = 10;\n\n/** Draw an arrowhead with tip at (x, y) pointing in direction (hx, hy).\n * @param {CanvasRenderingContext2D} ctx\n * @param {Number} x   // tip x\n * @param {Number} y   // tip y\n * @param (Number} hx  // heading x\n * @param (Number} hy  // heading y\n * @param {Object} options: {\n *     tip_angle?: Number,          // angle of tip of arrowhead; default: Math.PI/6\n *     len?:       Number,          // length of arrowhead lines; default: (default_arrowhead_length_to_line_width_ratio * ctx.lineWidth)\n *     reversed?:  Boolean,         // reverse direction of arrow?\n *     tick?:      Boolean|Number,  // also draw tick at (x, y)?  If a number, then the length of the tick\n * }\n */\nexport function draw_arrowhead(ctx, x, y, hx, hy, options=null) {\n    if (!(ctx instanceof CanvasRenderingContext2D)) {\n        throw new Error('ctx must be an instance of CanvasRenderingContext2D');\n    }\n    const TWOPI = 2*Math.PI;\n    const {\n        len       = (default_arrowhead_length_to_line_width_ratio * ctx.lineWidth),\n        reversed  = false,\n        tick      = false,\n    } = (options ?? {});\n    let tip_angle = options?.tip_angle ?? Math.PI/6;\n    tip_angle -= TWOPI*Math.floor(tip_angle/TWOPI);  // normalize tip_angle between [0, TWOPI]\n    if (reversed) {\n        tip_angle = TWOPI - tip_angle;\n    }\n    const heading_angle = angle_from_heading(hx, hy);\n    const heading_deflection = (Math.PI - tip_angle/2);\n    const tip_heading1 = heading_angle + heading_deflection;\n    const tip_heading2 = heading_angle - heading_deflection;\n    draw_line(ctx, x, y, x + len*Math.cos(tip_heading1), y + len*Math.sin(tip_heading1));\n    draw_line(ctx, x, y, x + len*Math.cos(tip_heading2), y + len*Math.sin(tip_heading2));\n    if (tick) {  // note: tick === 0 fails this test, but that is consistent with not drawing\n        const tick_options = {};\n        if (typeof tick === 'number') {\n            tick_options.len = tick;\n        }\n        draw_tick(ctx, x, y, hx, hy, tick_options);\n    }\n}\n\n/** Draw a line with arrowhead from (x0, y0) to (x1, y1).\n * @param {CanvasRenderingContext2D} ctx\n * @param {Number} x0  // start x\n * @param {Number} y0  // start y\n * @param {Number} x1  // end x\n * @param {Number} y1  // end y\n * @param {Object} options: {\n *     double?: Boolean,  // draw arrowheads at each end?\n *     ...{ options for draw_line() }\n *     ...{ options for draw_arrowhead() }\n * }\n */\nexport function draw_arrow(ctx, x0, y0, x1, y1, options=null) {\n    if (!(ctx instanceof CanvasRenderingContext2D)) {\n        throw new Error('ctx must be an instance of CanvasRenderingContext2D');\n    }\n    const {\n        double,\n    } = (options ?? {});\n    draw_line(ctx, x0, y0, x1, y1, options);\n    const hx = (x1 - x0);\n    const hy = (y1 - y0);\n    draw_arrowhead(ctx, x1, y1, hx, hy, options);\n    if (double) {\n        draw_arrowhead(ctx, x0, y0, -hx, -hy, options);\n    }\n}\n","const current_script_url = import.meta.url;  // save for later\n\nimport {\n    create_element,\n} from '../dom-tools.js';\n\nimport {\n    uuidv4,\n} from '../../sys/uuid.js';\n\nimport {\n    OpenPromise,\n} from '../../sys/open-promise.js';\n\nimport {\n    assets_server_url,\n} from '../../../src/assets-server-url.js';\n\n// import {\n//     create_stylesheet_link,\n// } from '../dom-tools.js';\nexport async function load_stylesheet() {\n    // create_stylesheet_link(document.head, new URL('./dialog.css', assets_server_url(current_script_url)));\n    await import('./dialog.css');  // webpack implementation\n}\n\n\n// === DIALOG BASE CLASS ===\n\nconst _dialog_element_to_instance_map = new WeakMap();\n\nexport class Dialog {\n    /** run a new instance of this dialog class\n     *  @param {string} message to be passed to instance run() method\n     *  @param {Object|undefined|null} options to be passed to instance run() method\n     *  @return {Promise}\n     */\n    static run(message, options) { return new this().run(message, options); }\n\n    static is_modal_active() {\n        return [ ...document.querySelectorAll(`dialog.${this._modal_dialog_css_class}`) ].some(d => d.open);\n    }\n\n    /** Return the dialog instance associated with an element, if any.\n     *  @param {Element} element an HTML element in the DOM\n     *  @return {Element|null} null if element is not a dialog or a child\n     *          of a dialog, otherwise the associated Dialog instance.\n     */\n    static instance_from_element(element) {\n        return _dialog_element_to_instance_map.get(element.closest('dialog'));\n    }\n\n    static _modal_dialog_css_class = 'modal_dialog';\n\n    constructor() {\n        this._completed = false;\n        this._promise = new OpenPromise();\n        this._promise.promise.finally(() => {\n            try {\n                this._destroy_dialog_element();\n            } catch (error) {\n                console.warn('ignoring error when finalizing dialog promise', error);\n            }\n        });\n        try {\n            this._dialog_element_id = `dialog-${uuidv4()}`;\n            this._create_dialog_element();\n            _dialog_element_to_instance_map.set(this._dialog_element, this);\n        } catch (error) {\n            this._cancel(error);\n        }\n    }\n\n    get promise (){ return this._promise.promise; }\n\n    run(...args) {\n        this._populate_dialog_element(...args);\n        this._dialog_element.showModal();\n        return this.promise;\n    }\n\n\n    // === INTERNAL METHODS ===\n\n    // To be overridden to provide the content of the dialog.\n    // this.dialog_element will have already been set and will be part of the DOM.\n    _populate_dialog_element(...args) {\n        throw new Error('unimplemented');\n    }\n\n    // to be called when dialog is complete\n    _complete(result) {\n        this._completed = true;\n        this._promise.resolve(result);\n    }\n\n    // to be called when dialog is canceled\n    _cancel(error) {\n        this._promise.reject(error ?? new Error('canceled'));\n    }\n\n    // expects this._dialog_element_id is already set, sets this._dialog_element\n    _create_dialog_element() {\n        if (typeof this._dialog_element_id !== 'string') {\n            throw new Error('this._dialog_element_id must already be set to a string before calling this method');\n        }\n        if (typeof this._dialog_element !== 'undefined') {\n            throw new Error('this._dialog_element must be undefined when calling this method');\n        }\n        const header_element = document.querySelector('header') ??\n              create_element({ parent: document.body, tag: 'header' });\n        if (header_element.parentElement !== document.body) {\n            throw new Error('pre-existing header element is not a direct child of document.body');\n        }\n        const ui_element = document.getElementById('ui') ??\n              create_element({\n                  before: header_element.firstChild,  // prepend\n                  attrs:  { id: 'ui' },\n              });\n        if (ui_element.tagName !== 'DIV' || ui_element.parentElement !== header_element) {\n            throw new Error('pre-existing #ui element is not a <div> that is a direct child of the header element');\n        }\n        if (document.getElementById(this._dialog_element_id)) {\n            throw new Error(`unexpected: dialog with id ${this._dialog_element_id} already exists`);\n        }\n        const dialog_element = create_element({\n            parent: ui_element,\n            tag:    'dialog',\n            attrs: {\n                id: this._dialog_element_id,\n                class: this.constructor._modal_dialog_css_class,\n            },\n        });\n        this._dialog_text_container = create_element({\n            parent: dialog_element,\n            tag: 'h2',\n            attrs: {\n                class: 'dialog-text',\n            },\n        });\n        this._dialog_form = create_element({\n            parent: dialog_element,\n            tag:    'form',\n            attrs: {\n                method: 'dialog',\n            },\n        });\n        this._dialog_element = dialog_element;\n    }\n\n    _destroy_dialog_element() {\n        if (this._dialog_element) {\n            _dialog_element_to_instance_map.delete(this._dialog_element);\n            this._dialog_element.remove();\n        }\n        this._dialog_element.oncancel = null;\n        this._dialog_element.onclose = null;\n        this._dialog_element = undefined;\n    }\n}\n\nexport class AlertDialog extends Dialog {\n    _populate_dialog_element(message, options) {\n        const {\n            accept_button_label = 'Ok',\n        } = (options ?? {});\n        this._dialog_text_container.innerText = message;\n        const accept_button = create_element({\n            parent: this._dialog_form,\n            tag:    'input',\n            attrs: {\n                type: 'submit',\n                value: accept_button_label,\n            },\n        });\n        this._dialog_element.onclose = (event) => this._complete();\n    }\n}\n\nexport class ConfirmDialog extends Dialog {\n    _populate_dialog_element(message, options) {\n        const {\n            decline_button_label = 'No',\n            accept_button_label  = 'Yes',\n        } = (options ?? {});\n        this._dialog_text_container.innerText = message;\n        const decline_button = create_element({\n            parent: this._dialog_form,\n            tag:    'input',\n            attrs: {\n                type: 'button',\n                value: decline_button_label,\n            },\n        });\n        decline_button.innerText = decline_button_label;\n        decline_button.onclick = (event) => this._complete(false);\n        const accept_button = create_element({\n            parent: this._dialog_form,\n            tag:    'input',\n            attrs: {\n                type: 'submit',\n                value: accept_button_label,\n            },\n        });\n        this._dialog_element.oncancel = (event) => this._complete(false);\n        this._dialog_element.onclose = (event) => this._complete(this._dialog_element.returnValue === accept_button_label);\n    }\n}\n\n\n// === UTILITY FUNCTIONS ===\n\n/** create a new HTML control as a child of the given parent with an optional label element\n *  @param {HTMLElement} parent\n *  @param {string} id for control element\n *  @param {Object|undefined|null} options: {\n *             tag?:         string,   // tag name for element; default: 'input'\n *             type?:        string,   // type name for element; default: 'text' (only used if tag === 'input')\n *             label?:       string,   // if !!label, then create a label element\n *             label_after?: boolean,  // if !!label_after, the add label after element, otherwise before\n *             attrs?:       object,   // attributes to set on the new control element\n *         }\n *  @return {Element} the new control element\n */\nexport function create_control_element(parent, id, options) {\n    if (typeof id !== 'string' || id === '') {\n        throw new Error('id must be a non-empty string');\n    }\n    const {\n        tag  = 'input',\n        type = 'text',\n        label,\n        label_after,\n        attrs = {},\n    } = (options ?? {});\n\n    if ('id' in attrs || 'type' in attrs) {\n        throw new Error('attrs must not contain \"id\" or \"type\"');\n    }\n    const control_opts = {\n        id,\n        ...attrs,\n    };\n    if (tag === 'input') {\n        control_opts.type = type;\n    }\n    const control = create_element({\n        tag,\n        attrs: control_opts,\n    });\n    let control_label;\n    if (label) {\n        control_label = create_element({\n            tag: 'label',\n            attrs: {\n                for: id,\n            },\n        });\n        control_label.innerText = label;\n    }\n\n    if (label_after) {\n        parent.appendChild(control);\n        parent.appendChild(control_label);\n    } else {\n        parent.appendChild(control_label);\n        parent.appendChild(control);\n    }\n\n    return control;\n}\n\n/** create a new HTML <select> and associated <option> elements\n *  as a child of the given parent with an optional label element\n *  @param {HTMLElement} parent\n *  @param {string} id for control element\n *  @param {Object|undefined|null} opts: {\n *             tag?:         string,    // tag name for element; default: 'input'\n *             label?:       string,    // if !!label, then create a label element\n *             label_after?: boolean,   // if !!label_after, the add label after element, otherwise before\n *             attrs?:       object,    // attributes to set on the new <select> element\n *             options?:     object[],  // array of objects, each of which contain \"value\" and \"label\" keys (value defaults to label)\n *                                      // values are the option attributes.  If no \"value\"\n *                                      // attribute is specified then the key is used.\n *         }\n * Note: we are assuming that opts.options is specified with an key-order-preserving object.\n *  @return {Element} the new <select> element\n */\nexport function create_select_element(parent, id, opts) {\n    opts = opts ?? {};\n    if ('tag' in opts || 'type' in opts) {\n        throw new Error('opts must not contain \"tag\" or \"type\"');\n    }\n    const option_elements = [];\n    if (opts.options) {\n        for (const { value, label } of opts.options) {\n            const option_attrs = { value: (value ?? label) };\n            const option_element = create_element({\n                tag: 'option',\n                attrs: option_attrs,\n            });\n            option_element.innerText = label;\n            option_elements.push(option_element);\n        }\n    }\n    const select_opts = {\n        ...opts,\n        tag: 'select',\n    };\n    const select_element = create_control_element(parent, id, select_opts);\n    for (const option_element of option_elements) {\n        select_element.appendChild(option_element);\n    }\n    return select_element;\n}\n","const current_script_url = import.meta.url;  // save for later\n\nimport {\n    generate_object_id,\n} from '../sys/uuid.js';\n\nimport {\n    beep,\n} from './beep.js';\n\nimport {\n    assets_server_url,\n} from '../../src/assets-server-url.js';\n\n\n// === ESCAPE TEXT AND HTML ===\n\nexport function escape_unescaped_$(s) {\n    // Note: add $ to the end and then remove the last two characters ('\\\\$') from\n    // the result.  Why?  Because the RE does not work correctly when the remaining\n    // part after a match does not contain a non-escaped $.  This workaround works\n    // correctly even if s ends with \\.\n    const re = /((\\\\?.)*?)\\$/g;\n    return (s + '$').replace(re, (...args) => `${args[1]}\\\\$`).slice(0, -2);\n}\n\n/** escape_for_html(s)\n *  convert all '<' and '>' to their corresponding HTML entities\n *  @param {string} string to be converted\n *  @return {string} converted string\n */\nexport function escape_for_html(s) {\n    return s.replaceAll('<', '&lt;').replaceAll('>', '&gt;');\n}\n\n/** make_string_literal(s)\n *  @param {string} s\n *  @return {string} string representation of a string literal for s\n */\nexport function make_string_literal(s) {\n    return `'${[ ...s ].map(s => s === \"'\" ? \"\\\\'\" : s).join('')}'`;\n}\n\n\n// === TIMEOUT / NEXT TICK UTILITIES ===\n\nexport async function delay_ms(ms, resolve_result=undefined) {\n    return new Promise(resolve => setTimeout(resolve, (ms ?? 0), resolve_result));\n}\n\nexport async function next_tick() {\n    return new Promise(resolve => setTimeout(resolve));\n}\n\nexport async function next_micro_tick() {\n    return new Promise(resolve => queueMicrotask(resolve));\n}\n\n\n// === DOCUMENT UTILITIES ===\n\n/** temporarily set document.designMode while executing thunk\n *  @param {Boolean} on\n *  @param {Function} thunk zero-parameter function to execute with temporary setting\n *  @return {any} return value of thunk()\n * thunk may be an async function or a regular function.\n */\nexport async function with_designMode(on, thunk) {\n    return new Promise((resolve, reject) => {\n        const original_setting = document.designMode;\n        document.designMode = (on ? 'on' : 'off');\n        delay_ms(0)\n            .then(() => thunk())\n            .then(thunk_result => delay_ms(0, thunk_result))\n            .then(resolve)\n            .finally(() => {\n                document.designMode = original_setting;\n            });\n    });\n}\n\n\n// === ELEMENT UTILITIES ===\n\n/** set an event handler on the given textarea so that it automatically resizes based on content\n * @param {HTMLTextAreaElement} textarea\n * The oninput event handler attribute of textarea is changed and used by this function.\n */\nexport function setup_textarea_auto_resize(textarea, max_height_px=null) {\n    if (!(textarea instanceof HTMLTextAreaElement)) {\n        throw new Error('textarea must be an instance of HTMLTextAreaElement');\n    }\n    if (typeof max_height_px !== 'undefined' && max_height_px !== null && (typeof max_height_px !== 'number' || max_height_px <= 0)) {\n        throw new Error('max_height_px must be undefined, null, or a positive number');\n    }\n    const initial_height = (textarea.scrollHeight > 0) ? `${textarea.scrollHeight}px` : '0.5em';\n    textarea.setAttribute('style', `height:${initial_height}; overflow-y:hidden;`);\n    textarea.oninput = function textarea_input_handler(event) {\n        const textarea = event.target.closest('textarea');\n        textarea.style.height = '1px';  // prevent height from interfering with scrollHeight\n        const cs = window.getComputedStyle(textarea);\n        // note: all css dimensional values are floating-point values followed by 'px'\n        const paddingY = parseFloat(cs.paddingTop) + parseFloat(cs.paddingBottom);\n        const calculated_height = textarea.scrollHeight - paddingY;\n        const new_height = (max_height_px && calculated_height > max_height_px) ? max_height_px : calculated_height;\n        textarea.style.height = `${new_height}px`;\n    };\n}\n/** trigger resize on a textarea that was setup for auto resize by\n *  setup_textarea_auto_resize().\n * @param {HTMLTextAreaElement} textarea\n */\nexport function trigger_textarea_auto_resize(textarea) {\n    if (!(textarea instanceof HTMLTextAreaElement)) {\n        throw new Error('textarea must be an instance of HTMLTextAreaElement');\n    }\n    textarea.dispatchEvent(new Event('input'));  // trigger resize\n}\n\n/** find the nearest ancestor of node that matches selector\n *  @param {Node} node for which to find nearest ancestor\n *  @param {String} selector to match\n *  @param {Boolean} strict_ancestor if true, then don't return node even if it matches\n *  @return {Element} the ancestor or null if none found\n */\nexport function find_matching_ancestor(node, selector, strict_ancestor=false) {\n    for (let scan = (strict_ancestor ? node.parentNode : node); scan; scan = scan.parentNode) {\n        if (scan instanceof Element) {\n            if (scan.matches(selector)) {\n                return scan;\n            }\n        }\n    }\n    return null;  // indicate: not found\n}\n\n/** remove all child elements and nodes of element\n *  @param {Node} element\n *  @return {Node} element\n */\nexport function clear_element(element) {\n    if (element instanceof HTMLElement) {\n        element.innerText = '';  // removes all child elements and nodes, and their event handlers\n    } else if (element instanceof Node) {\n        while (element.firstChild) {\n            // note that removeChild() does not remove the\n            // event handlers from the removed node, but\n            // we are letting the node go so it will be\n            // garbage-collected soon....\n            element.removeChild(element.firstChild);\n        }\n    } else {\n        throw new Error('element must be an instance of Node');\n    }\n    return element;\n}\n\n/** scroll element into view\n *  @param {Element} element\n *  @return {Element} element\n */\nexport function scroll_element_into_view(element) {\n    const element_rect = element.getBoundingClientRect();\n    if (element_rect.bottom > window.innerHeight) {\n        window.scrollBy(0, (element_rect.bottom - window.innerHeight));\n    }\n    return element;\n}\n\n/** set attributes on an element which are taken from an object.\n *  @param {Element} element\n *  @param {Object|undefined|null} attrs\n *  @return {Element} element\n * Attributes specified in attrs with a value of either null or undefined are cause\n * the corresponding property to be removed.\n * Attribute values obtained by calling toString() on the values in attrs\n * except that values which are undefined are translated to ''.\n */\nexport function set_element_attrs(element, attrs) {\n    if (attrs) {\n        if ('id' in attrs && document.getElementById(_attr_value(attrs.id))) {\n            throw new Error(`element already exists with id ${attrs.id}`);\n        }\n        for (const k in attrs) {\n            const v = attrs[k];\n            if (v !== null && typeof v !== 'undefined') {\n                element.setAttribute(k, _attr_value(v));\n            } else {\n                element.removeAttribute(k);\n            }\n        }\n    }\n    return element;\n}\n\n/** add/remove style properties on element\n *  @param {HTMLElement} element\n *  @param {Object} spec collection of properties to add or remove.\n *                  If the value of an entry is null or undefined, then\n *                  the corresponding property is removed.  If the value\n *                  of an entry is null, then the property is removed.\n *                  If the value of an entry is undefined, then that\n *                  entry is ignored.  Otherwise, the value of the\n *                  corresponding property is set.\n *  @return {HTMLElement} element\n */\nexport function update_element_style(element, spec) {\n    for (const name in spec) {\n        const value = spec[name];\n        if (typeof value !== 'undefined') {\n            if (value === null) {\n                element.style.removeProperty(name);\n            } else {\n                element.style.setProperty(name, value);\n            }\n        }\n    }\n    return element;\n}\n\nfunction _attr_value(v) {\n    return (typeof v === 'undefined') ? '' : v.toString();\n}\n\n\n/** safely set namespaced attributes\n *  @param {Element} element on which to set attribute\n *  @param {String|null} namespace\n *  @param {String} name of attribute\n *  @param {any} value\n * According to MDN, https://developer.mozilla.org/en-US/docs/Web/API/Element/setAttributeNS :\n *     setAttributeNS is the only method for namespaced attributes which\n *     expects the fully qualified name, i.e. \"namespace:localname\".\n */\nexport function safe_setAttributeNS(element, namespace, name, value) {\n    //!!! is this a correct implementation???\n    if (namespace && !name.includes(':')) {\n        // use the last non-empty component of the namespace\n        //!!! is this correct?\n        const namespace_components = new URL(namespace).pathname.split('/');\n        const namespace_specfier = namespace_components.findLast(s => s.length > 0);\n        name = `${namespace_specfier}:${name}`;\n    }\n    element.setAttributeNS(namespace, name, value);\n}\n\n\n/** validate the \"parent\" and \"before\" properties from options and return their validated values.\n *  @param {null|undefined|Object} options\n *  @param {Class} required_parent_class (default Element)\n *  @return {Object} result: { parent: Node|null, before: Node|null }\n */\nexport function validate_parent_and_before_from_options(options, required_parent_class=null) {\n    const {\n        parent: parent_from_options = null,\n        before = null,\n    } = (options ?? {});\n\n    let parent = parent_from_options;\n    if (before && !(before instanceof Node)) {\n        throw new Error('before must be null, undefined, or an instance of Node');\n    }\n\n    if (before && !before.parentNode) {\n        throw new Error('before must have a parent');\n    }\n\n    // resolve parent and before\n    if (parent) {\n        if (before && before.parentElement !== parent) {\n            throw new Error('inconsistent parent and before nodes specified');\n        }\n    } else {\n        if (before) {\n            parent = before.parentNode;\n        }\n    }\n\n    if (parent && required_parent_class && !(parent instanceof required_parent_class)) {\n        throw new Error(`parent must be null, undefined, or an instance of ${required_parent_class.name}`);\n    }\n\n    return { parent, before };\n}\n\n/** This is the key under which create_element_mapping() and\n *   create_element(..., true) returns the top-level object.\n */\nexport const mapping_default_key = 'default';\n\n/** create_element(options=null, return_mapping=false)\n *  create a new element with the given characteristics\n *  @param {Object|undefined|null} options: {\n *      _key?:      String,            // if return_mapping, associate the created element with this value as the key\n *      parent?:    HTMLElement|null,  // parent element, null or undefined for none; may be simply an Element if style not specified\n *      before?:    Node|null,         // sibling node before which to insert; append if null or undefined\n *      tag?:       string,            // tag name for new element; default: 'div'\n *      namespace?: string,            // namespace for new element creation\n *      attrs?:     object,            // attributes to set on new element\n *      style?:     object,            // style properties for new element\n *      set_id?:    Boolean            // if true, allocate and set an id for the element (if id not specified in attrs)\n *      children?:  ELDEF[],           // array of children to create (recursive)\n *  }\n *  @param {Boolean} return_mapping (default false)\n *  @return {Element|Object} the new element or the element mapping object\n *\n * A unique id will be assigned to the element unless that element already has\n * an id attribute specified (in attrs).\n * Attributes specified in attrs with a value of either null or undefined are ignored.\n * The before node, if specified, must have a parent that must match parent if\n * parent is specified.\n * If neither parent nor before is specified, the new element will have no parent.\n * Warning: '!important' in style specifications does not work!  (Should use priority method.)\n * The definitions in \"children\", if specified, should not contain \"parent\" or \"before\".\n * attrs may contain a \"class\" property, and this should be a string or an array of strings,\n * each of which must not contain whitespace.\n *\n * If return_mapping, then return a mapping object from keys found in \"_key\" properties\n * in the options.  Each of these keys will be mapped to the corresponding object, and\n * mapping_default_key is mapped to the top-level object.  Note that duplicate keys or\n * keys that specify the same value as mapping_default_key will overwrite earlier values.\n * Elements specified in options are created in a post-order traversal of options.children.\n * This means that a _key specified in options as mapping_default_key will not be returned\n * because mapping_default_key is set after traversiing the children.\n */\nexport function create_element(options=null, return_mapping=false) {\n    options ??= {};\n    if (typeof options !== 'object') {\n        throw new Error('options must be null, undefined, or an object');\n    }\n    const {\n        _key,\n        tag = 'div',\n        namespace,\n        attrs,\n        style,\n        set_id,\n        children,\n    } = options;\n\n    const {\n        parent,\n        before,\n    } = validate_parent_and_before_from_options(options);\n\n    if ( typeof children !== 'undefined' && children !== null &&\n         !( Array.isArray(children) &&\n            children.every(child => ['object', 'string' ].includes(typeof child)) )\n       ) {\n        throw new Error('children must be an array of objects');\n    }\n\n    const element = namespace\n          ? document.createElementNS(namespace, tag)\n          : document.createElement(tag);\n\n    let element_id_specified = false;\n    if (attrs) {\n        for (const k in attrs) {\n            let v = attrs[k];\n            if (k === 'class' && Array.isArray(v)) {\n                if (!v.every(c => !c.match(/\\s/))) {\n                    throw new Error('attrs.class must be a string or an array of strings not containing whitespace');\n                }\n                v = v.join(' ');\n            }\n            if (v !== null && typeof v !== 'undefined') {\n                element.setAttribute(k, v);\n            }\n            if (k == 'id') {\n                element_id_specified = true;\n            }\n        }\n    }\n    if (!element_id_specified && set_id) {\n        element.id = generate_object_id();\n    }\n\n    // update style after attrs in case a style attribute is also specified\n    if (style) {\n        update_element_style(element, style);\n    }\n\n    const mapping = return_mapping ? {} : undefined;\n\n    if (children) {\n        for (const child_desc of children) {\n            if (typeof child_desc === 'string') {\n                element.appendChild(document.createTextNode(child_desc));\n            } else {\n                if (child_desc.parent || child_desc.before) {\n                    console.warn('ignoring \"parent\" and/or \"before\" specified in child descriptor');\n                }\n                const child_result = create_element({\n                    ...child_desc,\n                    parent: element,\n                    before: undefined,\n                }, return_mapping);\n\n                if (return_mapping) {\n                    Object.assign(mapping, child_result);\n                }\n            }\n        }\n    }\n\n    if (return_mapping) {\n        mapping[mapping_default_key] = element;\n        if ([ 'string', 'symbol' ].includes(typeof _key)) {\n            mapping[_key] = element;\n        }\n    }\n\n    if (parent) {\n        parent.insertBefore(element, before);\n    }\n\n    return return_mapping ? mapping : element;\n}\n\n/** create_element_mapping(options=null)\n *  use create_element() passing return_mapping=true.\n */\nexport function create_element_mapping(options=null) {\n    return create_element(options, true);\n}\n\n/** move the given node according to options\n *  @param {Object|undefined|null} options: {\n *      parent?: Node|null,  // parent node, null or undefined for none\n *      before?: Node|null,  // sibling node before which to insert; append if null or undefined\n *  }\n * parent and before cannot both be null/undefined.\n */\nexport function move_node(node, options=null) {\n    if (!(node instanceof Node)) {\n        throw new Error('node must be an instance of Node');\n    }\n    const {\n        parent,\n        before,\n    } = validate_parent_and_before_from_options(options);\n    if (!parent) {\n        throw new Error('options must specify either \"parent\" or \"before\"');\n    }\n    parent.insertBefore(node, before);\n}\n\n/** create or update a child text node of the given element\n *  @param {HTMLElement} element  //!!! may be sufficient to be a Node\n *  @param {any} text to be contained in the new text node\n *  @param {Object|undefined|null} options: {\n *      before?: null|Node,  // child node or element before which to insert; append if null or undefined\n *      prevent_coalesce_next?: boolean,\n *  }\n *  @return {Node|null} the new or modified text node, or null if the converted text is ''\n *\n * Text will be converted to a string (if not already a string).  A text value\n * of null or undefined is equivalent to ''.\n *\n * The text will be coalesced into the immediately previous text node, if any.\n * Otherwise, if the next node is a text node the text will be coealesced\n * into the beginning text of it unless options.prevent_coalesce_next.\n * options.prevent_coalesce_next makes sure that the same options.before\n * node can be used repeatedly with the expected results.  However,\n * options.prevent_coalesce_next may leave element non-normalized.\n * On the other hand, if !options.prevent_coalesce_next, the element\n * will not become non-normalized (but may be non-normalized if it\n * already was).\n * Note that the text is inserted into the document purely as text, and\n * no escaping or cleaning for HTML is performed (it should not be necessary).\n */\nexport function create_element_child_text_node(element, text, options=null) {\n    if (!(element instanceof HTMLElement)) {\n        throw new Error('element must be an instance of HTMLElement');\n    }\n\n    const {\n        before = null,\n        prevent_coalesce_next,\n    } = (options ?? {});\n\n    if (before !== null && !(before instanceof Node)) {\n        throw new Error('before must be null or an instance of Node');\n    }\n    if (before && before.parentNode !== element) {\n        throw new Error('before must be a child of element');\n    }\n\n    if (typeof text !== 'string') {\n        text = `${text ?? ''}`;\n    }\n    if (!text) {\n        return null;\n    }\n\n    let node;  // this will be the node that contains the text\n    if (!node) {\n        const previous = before ? before.previousSibling : element.lastChild;\n        if (previous?.nodeType === Node.TEXT_NODE) {\n            previous.nodeValue += text;\n            node = previous;\n        }\n    }\n    if (!node && before && !prevent_coalesce_next) {  // if no before then there will be no next node\n        const next = before;\n        if (next.nodeType === Node.TEXT_NODE) {\n            next.nodeValue = text + next.nodeValue;\n            node = next;\n        }\n    }\n    if (!node) {\n        node = document.createTextNode(text);\n        element.insertBefore(node, before);\n    }\n\n    return node;\n}\n\n/** normalize the text node children of element, meaning that text nodes\n *  are non-empty and no text nodes are adjacent.\n *  @param {Element} element\n *  @return {Element} element\n */\nexport function normalize_element_text(element) {\n    element.normalize();\n    return element;\n}\n\n/** create_stylesheet_link(parent, stylesheet_url, attrs)\n *  @param {Element} parent\n *  @param {string} stylesheet_url\n *  @param {Object|undefined|null} attrs\n *  @param {boolean} permit_duplication if true then do not recreate element if already present\n *  @return {HTMLElement} the new <link> element\n */\nexport function create_stylesheet_link(parent, stylesheet_url, attrs=null, permit_duplication=false) {\n    if (!(parent instanceof Element)) {\n        throw new Error('parent must be an Element');\n    }\n    attrs = attrs ?? {};\n    if ('rel' in attrs || 'href' in attrs) {\n        throw new Error('attrs must not contain \"rel\" or \"href\"');\n    }\n    let link_element;\n    if (!permit_duplication) {\n        // note that the duplication does not take into account attrs\n        link_element = parent.querySelector(`link[rel=\"stylesheet\"][href=\"${stylesheet_url.toString().replaceAll('\"', '\\\\\"')}\"]`);\n        // make sure link_element that was found is a direct child of parent\n        if (link_element?.parentElement !== parent) {\n            link_element = null;\n        }\n    }\n    return link_element ?? create_element({\n        parent,\n        tag: 'link',\n        attrs: {\n            rel: \"stylesheet\",\n            href: stylesheet_url,\n            ...attrs,\n        },\n    });\n}\n\n/** create_inline_stylesheet(parent, stylesheet_text, attrs)\n *  @param {Element} parent\n *  @param {string} stylesheet_text\n *  @param {Object|undefined|null} attrs\n *  @return {HTMLStyleElement} the new <style> element\n */\nexport function create_inline_stylesheet(parent, stylesheet_text, attrs) {\n    if (!(parent instanceof Element)) {\n        throw new Error('parent must be an Element');\n    }\n    const style_el = create_element({\n        tag: 'style',\n        attrs,\n    });\n    style_el.appendChild(document.createTextNode(stylesheet_text));\n    parent.appendChild(style_el);\n    return style_el;\n}\n\n/** create_script(parent, script_url, attrs=null, permit_duplication=false)\n *  @param {Element} parent\n *  @param {string} script_url\n *  @param {Object|undefined|null} attrs\n *  @param {boolean} permit_duplication if true then do not recreate element if already present\n *  @return {HTMLStyleElement} the new <style> element\n */\nexport function create_script(parent, script_url, attrs=null, permit_duplication=false) {\n    if (!(parent instanceof Element)) {\n        throw new Error('parent must be an Element');\n    }\n    attrs = attrs ?? {};\n    if ('src' in attrs) {\n        throw new Error('attrs must not contain \"src\"');\n    }\n    let script_element;\n    if (!permit_duplication) {\n        // note that the duplication does not take into account attrs\n        script_element = parent.querySelector(`script[src=\"${script_url.toString().replaceAll('\"', '\\\\\"')}\"]`);\n        // make sure script_element that was found is a direct child of parent\n        if (script_element?.parentElement !== parent) {\n            script_element = null;\n        }\n    }\n    return script_element ?? create_element({\n        parent,\n        tag: 'script',\n        attrs: {\n            src: script_url,\n            ...attrs,\n        },\n    });\n}\n\n/** create_inline_script(parent, script_text, attrs)\n *  @param {Element} parent\n *  @param {string} script_text\n *  @param {Object|undefined|null} attrs\n *  @return {HTMLScriptElement} the new <script> element\n */\nexport function create_inline_script(parent, script_text, attrs) {\n    if (!(parent instanceof Element)) {\n        throw new Error('parent must be an Element');\n    }\n    if (attrs && 'src' in attrs) {\n        throw new Error('attrs must not contain \"src\"');\n    }\n    const script_el = create_element({\n        tag: 'script',\n        attrs,\n    });\n    script_el.appendChild(document.createTextNode(script_text));\n    parent.appendChild(script_el);\n    return script_el;\n}\n\n\n// === SCRIPT LOADING ===\n\nconst _script_promise_data = {};  // map: url -> { promise?: Promise, resolve?: any=>void, reject?: any=>void }\n\n// _establish_script_promise_data(script_url) returns\n// { promise_data, initial } where promise_data is\n// _script_promise_data[script_url] and initial is true\n// iff the promise was newly created.\nfunction _establish_script_promise_data(full_script_url) {\n    const data_key = full_script_url.toString();\n    let promise_data = _script_promise_data[data_key];\n    let initial;\n    if (promise_data) {\n        initial = false;\n    } else {\n        promise_data = {};\n        promise_data.promise = new Promise((resolve, reject) => {\n            promise_data.resolve = resolve;\n            promise_data.reject  = reject;\n        });\n        _script_promise_data[data_key] = promise_data;\n        initial = true;\n    }\n    return { initial, promise_data };\n}\n\n/** async function load_script(parent, script_url, attrs=null, permit_duplication=false)\n *  @param {Node} parent the parent element for script\n *  @param {string} script_url url of script to load (the script tag will be created without defer or async attributes)\n *  @param {Object|undefined|null} attrs\n *  @param {boolean} permit_duplication if true then do not recreate element if already present\n *  @return {Promise}\n *  Use this to load a script and wait for its 'load' event.\n *  Only the first invokation for a particular script_url will create\n *  the script element.  Others will simply wait for the script to load\n *  or for error.\n */\nexport async function load_script(parent, script_url, attrs=null, permit_duplication=false) {\n    const full_script_url = new URL(script_url, assets_server_url(current_script_url));\n    const { promise_data, initial } = _establish_script_promise_data(full_script_url);\n    if (initial) {\n        let script_el;\n        function script_load_handler(event) {\n            promise_data.resolve?.();\n            reset();\n        }\n        function script_load_error_handler(event) {\n            promise_data.reject?.(new Error(`error loading script ${full_script_url}`));\n            reset();\n        }\n        function reset() {\n            if (script_el) {\n                script_el.removeEventListener('load',  script_load_handler);\n                script_el.removeEventListener('error', script_load_error_handler);\n            }\n            promise_data.resolve = null;\n            promise_data.reject  = null;\n        }\n        try {\n            script_el = create_script(parent, full_script_url, attrs, permit_duplication);\n            script_el.addEventListener('load',  script_load_handler,       { once: true });\n            script_el.addEventListener('error', script_load_error_handler, { once: true });\n        } catch (err) {\n            promise_data.reject?.(err);\n            reset();\n        }\n    }\n    return promise_data.promise;\n}\n\n/** async function load_script_and_wait_for_condition(parent, script_url, condition_poll_fn, attrs=null, permit_duplication=false)\n *  @param {Node} parent the parent element for script\n *  @param {string} script_url url of script to load (the script tag will be created without defer or async attributes)\n *  @param {() => boolean} condition_poll_fn function that will return true when script has loaded\n *  @param {Object|undefined|null} attrs\n *  @param {boolean} permit_duplication if true then do not recreate element if already present\n *  @return {Promise}\n *  Use this to load a script where you want to poll for condition\n *  that will be triggered asynchronously by the script, in which\n *  case waiting for the load event will not work because it fires\n *  when script execution completes but not when some later condition\n *  is triggered asynchronously by the script.\n *  Only the first invokation for a particular script_url will create\n *  the script element.  Others will simply wait for the script to load\n *  or for error.\n */\nexport async function load_script_and_wait_for_condition(parent, script_url, condition_poll_fn, attrs=null, permit_duplication=false) {\n    const full_script_url = new URL(script_url, assets_server_url(current_script_url));\n    const { promise_data, initial } = _establish_script_promise_data(full_script_url);\n    if (initial) {\n        let script_el;\n        let wait_timer_id;\n        function script_load_error_handler(event) {\n            promise_data.reject?.(new Error(`error loading script ${full_script_url}`));\n            reset();\n        }\n        function wait() {\n            if (condition_poll_fn()) {\n                promise_data.resolve?.();\n                reset();\n            } else {\n                wait_timer_id = setTimeout(wait);  // check again on next tick\n            }\n        }\n        function reset() {\n            if (typeof wait_timer_id !== 'undefined') {\n                clearTimeout(wait_timer_id);\n                wait_timer_id = undefined;\n            }\n            if (script_el) {\n                script_el.removeEventListener('error', script_load_error_handler);\n            }\n            promise_data.resolve = null;\n            promise_data.reject  = null;\n        }\n        try {\n            script_el = create_script(parent, full_script_url, attrs, permit_duplication);\n            script_el.addEventListener('error', script_load_error_handler, { once: true });\n            wait();\n        } catch (err) {\n            promise_data.reject?.(err);\n            reset();\n        }\n    }\n    return promise_data.promise;\n}\n\n\n// === NODE OFFSET IN PARENT ===\n\nexport function find_child_offset(child) {\n    const parent_child_nodes = child?.parentNode?.childNodes;\n    if (!parent_child_nodes) {\n        return undefined;\n    } else {\n        return Array.prototype.indexOf.call(parent_child_nodes, child);\n    }\n}\n\n\n// === SELECTION/POINT ===\n\nexport function set_selection_focus(node, offset) {\n    window.getSelection().setBaseAndExtent(node, offset, node, offset);\n}\n\nexport function save_current_selection() {\n    const selection = window.getSelection();\n    const {\n        anchorNode,\n        anchorOffset,\n        focusNode,\n        focusOffset,\n    } = selection;\n    const ranges = [];\n    for (let i = 0; i < selection.rangeCount; i++) {\n        ranges.push(selection.getRangeAt(i).cloneRange());\n    }\n    return {\n        anchorNode,\n        anchorOffset,\n        focusNode,\n        focusOffset,\n        ranges,\n    };\n}\n\nexport function restore_selection(saved) {\n    const selection = window.getSelection();\n    selection.removeAllRanges();\n    for (const range of saved.ranges) {\n        selection.addRange(range);\n    }\n    selection.setBaseAndExtent(\n        saved.anchorNode, saved.anchorOffset,\n        saved.focusNode, saved.focusOffset\n    );\n}\n\nexport function manage_selection_for_insert(updater) {\n    const selection = window.getSelection();\n    selection?.deleteFromDocument();  // delete current selection, if any\n    let point = {\n        node:   selection?.focusNode   ?? null,\n        offset: selection?.focusOffset ?? 0,\n    };\n    point = updater(point);\n    if (!point) {\n        throw new Error('updater must return { node, offset } for the new point');\n    }\n    selection.setBaseAndExtent(point.node, point.offset, point.node, point.offset);\n    return true;  // indicate: success\n}\n\nexport function manage_selection_for_delete(updater) {\n    const selection = window.getSelection();\n    if (selection && !selection.isCollapsed) {\n        selection.deleteFromDocument();\n        // leave selection in the resultant collapsed state\n    } else {\n        let point = {\n            node:   selection?.focusNode   ?? null,\n            offset: selection?.focusOffset ?? 0,\n        };\n        point = updater(point);\n        if (!point) {\n            beep();  // there was nothing to delete\n        } else {\n            selection.setBaseAndExtent(point.node, point.offset, point.node, point.offset);\n        }\n    }\n    return true;  // indicate: success\n}\n\n// modifies point, returns true iff successful\nexport function move_point_forward(point) {\n    if (!point?.node) {\n        return false;  // nowhere to move from\n    }\n//!!! check this:\n    const child_count = (point.node.nodeType === Node.TEXT_NODE) ? point.node.length : point.node.childNodes.length;\n    if (point.offset < child_count) {\n        point.offset++;  // new point is within same (Text) node\n        return true;\n    } else {\n        const tree_walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT);\n        tree_walker.currentNode = point.node;\n        point.node = tree_walker.nextNode();\n        if (!point.node) {\n            point.offset = 0;\n            return false;\n        }\n        if (point.node.nodeType === Node.TEXT_NODE) {\n            point.offset = 0;\n        } else {\n            // must point to this Element node from its parent\n            point.offset = find_child_offset(point.node);\n            point.node = point.node.parentNode;\n        }\n        return true;\n    }\n}\n\n// modifies point, returns true iff successful\nexport function move_point_reverse(point) {\n    if (!point?.node) {\n        return false;  // nowhere to move from\n    }\n    if (point.offset > 0) {\n        point.offset--;  // new point is within same node\n        return true;\n    } else {\n        const tree_walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT);\n        tree_walker.currentNode = point.node;\n        point.node = tree_walker.previousNode();\n        if (!point.node) {\n            point.offset = 0;\n            return false;\n        }\n        if (point.node.nodeType === Node.TEXT_NODE) {\n            point.offset = point.node.length;\n        } else {\n            // must point to this Element node from its parent\n            point.offset = find_child_offset(point.node);\n            point.node = point.node.parentNode;\n        }\n        return true;\n    }\n}\n\n// modifies point, returns true iff successful\nexport function move_point(point, reverse=false) {\n    return (reverse ? move_point_reverse : move_point_forward)(point);\n}\n\n// returns new point { node, offset } if successful, otherwise null\nexport function insert_at(point, thing) {\n    if (typeof point !== 'object') {\n        throw new Error('point must be an object');\n    }\n    let { node, offset } = point;\n    if (!node) {\n        return null;\n    }\n    if (typeof thing !== 'undefined' && thing !== null) {\n        if (typeof thing === 'string') {\n            if (node instanceof Text) {\n                node.data = `${node.data.substring(0, offset)}${thing}${node.data.substring(offset)}`;\n                // update offset\n                offset += thing.length;\n            } else {\n                const text_node = document.createTextNode(thing);\n                node.insertBefore(text_node, node.childNodes[offset]);\n                // update offset\n                offset++;\n            }\n        } else if (thing instanceof Node) {\n            // note that thing may be a DocumentFragment here\n            if (node instanceof Text) {\n                //!!! could be more careful not to create empty text nodes here\n                const next_node = node.splitText(offset);\n                node.parentNode.insertBefore(thing, next_node);\n                // update node, offset\n                node = next_node;\n                offset = 0;\n            } else {\n                node.insertBefore(thing, node.childNodes[offset]);\n                offset++;\n            }\n        } else {\n            throw new Error('thing must be a string or an instance of Node');\n        }\n    }\n    return { node, offset };\n}\n\n// returns new point { node, offset } if successful, otherwise null\nexport function delete_nearest_leaf(point, options=null) {\n    const { element_too, reverse } = options ?? {};\n\n    // validate point\n    let { node, offset } = point ?? {};\n    if ( !(node instanceof Node) ||\n         (node.nodeType !== Node.TEXT_NODE && node.nodeType !== Node.ELEMENT_NODE) ||\n         typeof offset !== 'number' ||\n         offset < 0 ||\n         offset > ((node.nodeType === Node.TEXT_NODE) ? node.length : node.childNodes.length)\n       ) {\n        throw new Error('invalid point');\n    }\n\n    for (;;) {\n        // if node is a non-empty Text and offset is within range then handle directly here\n        if (node.nodeType === Node.TEXT_NODE && node.length > 0) {\n            if (reverse) {\n                if (offset > 0) {\n                    offset--;\n                    node.data = node.data.substring(0, offset) + node.data.substring(offset+1);\n                    return { node, offset };\n                }\n            } else {\n                if (offset < node.length) {\n                    node.data = node.data.substring(0, offset) + node.data.substring(offset+1);\n                    return { node, offset };\n                }\n            }\n        }\n\n        // At this point node is a Text node only if the deletion is to happen\n        // outside it (i.e., the offset was out of the node's bounds), in which\n        // case the we assume the offset indicated just one character outside\n        // (otherwise, the original point was invalid).\n        if (node.nodeType === Node.ELEMENT_NODE) {\n            // shift to node at given offset\n            node = node.childNodes[offset];\n            if (!node) {\n                return { node, offset: 0 };\n            }\n            if (reverse) {\n                const child_count = (node.nodeType === Node.TEXT_NODE) ? node.length : node.childNodes.length;\n                offset = child_count;\n            } else {\n                offset = 0;\n            }\n            continue;  // reprocess with new node, offset\n        }\n\n        break;\n    }\n\n    // if node is an empty (leaf) Element then handle directly here\n    if (node.nodeType === Node.ELEMENT_NODE && !node.hasChildNodes()) {\n        const new_point = { node: node.parentNode, offset: find_child_offset(node) };\n        node.parentNode.removeChild(node);\n        return new_point;\n    }\n\n    // use a TreeWalker to find a non-empty Text or a leaf Element\n    const tree_walker_filter = element_too\n          ? NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT\n          : NodeFilter.SHOW_TEXT;\n    const tree_walker = document.createTreeWalker(document.body, tree_walker_filter, {\n        acceptNode(node) {\n            // accept only non-empty Text nodes or empty (leaf) Element nodes\n            // (the characters in Text nodes are \"leaf\" items)\n            if ( (node.nodeType === Node.TEXT_NODE    && node.length > 0) ||\n                 (node.nodeType === Node.ELEMENT_NODE && (!node.hasChildNodes() || [ ...node.childNodes ].every(n => n.nodeType === Node.TEXT_NODE && n.length <= 0)))\n               ) {\n                return NodeFilter.FILTER_ACCEPT;\n            } else {\n                return NodeFilter.FILTER_SKIP;\n            }\n        }\n    });\n    tree_walker.currentNode = node;\n    node = reverse ? tree_walker.previousNode() : tree_walker.nextNode();\n    if (!node) {\n        return null;  // nothing found\n    } else {\n        if (node.nodeType === Node.TEXT_NODE) {\n            offset = reverse ? node.length-1 : 0;\n            node.data = node.data.substring(0, offset) + node.data.substring(offset+1);\n            return { node, offset };\n        } else {\n            const new_point = { node: node.parentNode, offset: find_child_offset(node) };\n            node.parentNode.removeChild(node);\n            return new_point;\n        }\n    }\n}\n\n\n// === MISC ===\n\nexport function is_text_direction_ltr(element) {\n    const dir_str = document.defaultView?.getComputedStyle?.(element)?.direction;\n    switch (dir_str) {\n    case 'ltr':  return true;\n    case 'rtl':  return false;\n    case 'auto': return true;\n    default:     throw new Error('unexpected direction value');\n    }\n}\n","import {\n    KeySpec,\n} from './key-spec.js';\n\nimport {\n    KeyMap,\n} from './key-map.js';\n\nimport {\n    EventListenerManager,\n} from '../../sys/event-listener-manager.js';\n\nimport {\n    beep,\n} from '../beep.js';\n\nimport {\n    Subscribable,\n} from '../../sys/subscribable.js';\n\n\nexport class KeyEventManager {\n    /** KeyEventManager constructor\n     *  @param {EventTarget} event_target the source of events\n     *  @param {Function} command_observer function to handle command events\n     */\n    constructor(event_target, command_observer) {\n        if (!(event_target instanceof EventTarget)) {\n            throw new Error('event_target must be and instance of EventTarget');\n        }\n        if (typeof command_observer !== 'function') {\n            throw new Error('command_observer must be a function');\n        }\n\n        this.#event_listener_manager = new EventListenerManager();\n\n        const commands = new Subscribable();  // emits command_context: { command: string, event: Event, target: Element, key_spec: KeySpec }\n        this.#commands_subscription = commands.subscribe(command_observer);\n        // note: we do not unsubscribe\n\n        this.#key_map_stack = [];    // stack grows from the front, i.e., the first item is the last pushed\n        this.#key_mapper    = null;  // set iff attached\n\n        Object.defineProperties(this, {\n            event_target: {\n                value:      event_target,\n                enumerable: true,\n            },\n            command_observer: {\n                value:      command_observer,\n                enumerable: true,\n            },\n            commands: {\n                value:      commands,\n                enumerable: true,\n            },\n        });\n    }\n    #event_listener_manager;\n    #commands_subscription;\n    #key_map_stack;\n    #key_mapper;   // set iff attached\n    #key_handler;  // set iff attached\n\n    reset_key_map_stack() {\n        if (this.#key_map_stack.length > 0) {\n            this.#key_map_stack.splice(0);  // clear stack\n            this.#rebuild();\n        }\n    }\n    push_key_map(key_map) {\n        if (!(key_map instanceof KeyMap)) {\n            throw new Error('key_map must be an instance of KeyMap');\n        }\n        if (this.#key_map_stack.indexOf(key_map) !== -1) {\n            throw new Error('key_map already exists in stack');\n        }\n        this.#key_map_stack.unshift(key_map);\n        this.#rebuild();\n    }\n    pop_key_map() {\n        const popped_key_map = this.#key_map_stack.shift();\n        if (popped_key_map) {\n            this.#rebuild();\n        }\n        return popped_key_map;\n    }\n    remove_key_map(key_map, remove_subsequent_too=false) {\n        const index = this.#key_map_stack.indexOf(key_map);\n        if (index === -1) {\n            return false;\n        } else {\n            if (remove_subsequent_too) {\n                this.#key_map_stack.splice(0, index+1);  // delete this and newer items\n            } else {\n                this.#key_map_stack.splice(index, 1);  // delete only this item\n            }\n            this.#rebuild();\n            return true;\n        }\n    }\n\n    get is_attached (){ return !!this.#key_mapper; }  // this.#key_mapper set iff attached\n\n    /** attach to event_target and start listening for events.\n     *  @return {Boolean} true iff successful\n     */\n    attach() {\n        if (this.is_attached) {\n            throw new Error('attach() called when already attached');\n        }\n\n        // this.#key_mapper is null\n        if (this.#key_map_stack.length <= 0) {\n            return false;  // indicate: attach failed\n        }\n\n        this.#key_mapper = KeyMap.multi_mapper(...this.#key_map_stack);\n\n        const initial_state = this.#key_mapper;\n        let state;         // current \"location\" in key mapper\n        let key_sequence;  // current sequence of key_specs that have been seen\n\n        function reset() {\n            state = initial_state;\n            key_sequence = [];\n        }\n        reset();\n\n        const blur_handler = reset;  // attached to this.event_target\n\n        const key_handler = (event) => {  // attached to this.event_target\n            switch (event.key) {\n            case 'Alt':\n            case 'AltGraph':\n            case 'CapsLock':\n            case 'Control':\n            case 'Fn':\n            case 'FnLock':\n            case 'Hyper':\n            case 'Meta':\n            case 'NumLock':\n            case 'ScrollLock':\n            case 'Shift':\n            case 'Super':\n            case 'Symbol':\n            case 'SymbolLock':\n            case 'OS':  // Firefox quirk\n                // modifier key, ignore\n                break;\n\n            default: {\n                const key_spec = KeySpec.from_keyboard_event(event);\n                key_sequence.push(key_spec);\n                const mapping_result = state.consume(key_spec);\n                if (!mapping_result) {\n                    // failed\n                    if (state !== initial_state) {\n                        // beep only if at least one keypress has already been accepted\n                        event.preventDefault();\n                        beep();\n                    }\n                    // if still in initial_state, then no event.preventDefault()\n                    reset();\n                } else {\n                    event.preventDefault();\n                    if (typeof mapping_result === 'string') {\n                        const command = mapping_result;\n                        const command_context = { command, event, target: event.target, key_spec };\n                        this.commands.dispatch(command_context);\n                        reset();\n                    } else {\n                        state = mapping_result;\n                    }\n                }\n                break;\n            }\n            }\n        };\n\n        this.#key_handler = key_handler;  // for inject_key_event()\n\n        this.#event_listener_manager.remove_all();  // prepare to re-add below\n        const listener_specs = [\n            [ this.event_target, 'blur',    blur_handler, { capture: true } ],\n            [ this.event_target, 'keydown', key_handler,  { capture: true } ],\n        ];\n        for (const [ target, type, listener, options ] of listener_specs) {\n            this.#event_listener_manager.add(target, type, listener, options);\n        }\n        this.#event_listener_manager.attach();\n\n        return true;  // indicate: successfully attached\n    }\n\n    /** detach from event_target and stop listening for events.\n     *  no-op if called when this.#event_listener_manager is already empty.\n     */\n    detach() {\n        this.#event_listener_manager.remove_all();\n        this.#key_mapper  = null;\n        this.#key_handler = undefined;\n    }\n\n    inject_key_event(key_event) {\n        this.#key_handler?.(key_event);\n    }\n\n\n    // === INTERNAL ===\n\n    #rebuild() {\n        // rebuild the event handlers and state machine.\n        const was_attached = this.is_attached;\n        this.detach();\n        if (was_attached) {\n            this.attach();  // will fail if key_map stack is empty\n        }\n    }\n}\n","import {\n    KeySpec,\n} from './key-spec.js';\n\n\nexport class KeyMap {\n    constructor(bindings=null, recognizer=null) {\n        Object.defineProperties(this, {\n            bindings: {  // key/command bindings\n                value:      bindings,\n                enumerable: true,\n            },\n            mapping: {  // canonical_key_string->(false|command|another_mapping)\n                value:      this.constructor.#create_mapping(bindings),\n                enumerable: true,\n            },\n            recognizer: {  // key_spec => (false|command)\n                value:      recognizer,\n                enumerable: true,\n            },\n        });\n    }\n\n    create_mapper(fallback_mapper=null) {\n        return new this.constructor.Mapper(this.mapping, this.recognizer, fallback_mapper);\n    }\n\n    static multi_mapper(...key_maps) {\n        if (key_maps.length <= 0) {\n            throw new Error('at least one KeyMap instance must be given');\n        }\n        if (!key_maps.every(m => m instanceof this)) {\n            throw new Error('arguments must all be KeyMap instances');\n        }\n        return key_maps.reduce((mapper, key_map) => key_map.create_mapper(mapper), null);\n    }\n\n    static #create_mapping(bindings) {\n        if (bindings !== null && typeof bindings !== 'undefined' && typeof bindings !== 'object') {\n            throw new Error('bindings must be null/undefined or an object');\n        }\n        const mapping = {};\n        for (const command in bindings) {\n            if (command.length <= 0) {\n                throw new Error('bindings keys (command names) must not be empty strings');\n            }\n            for (const key_sequence of bindings[command]) {\n                let seq_mapping = mapping;  // current mapping being acted upon by current key_string of sequence\n                const seq_key_strings = key_sequence.split(KeySpec.canonical_key_string_separator);\n                for (let i = 0; i < seq_key_strings.length; i++) {\n                    const key_string = seq_key_strings[i];\n                    const is_last = (i >= seq_key_strings.length-1);\n                    const canonical_key_string = new KeySpec(key_string).canonical;\n                    const existing = seq_mapping[canonical_key_string];\n                    if (typeof existing === 'string' || (typeof existing === 'object' && is_last)) {\n                        // something else already mapped here...\n                        const seq_so_far = seq_key_strings.slice(0, i+1).join(KeySpec.canonical_key_string_separator);\n                        throw new Error(`duplicate bindings specified for key sequence: ${seq_so_far}`);\n                    }\n                    if (!is_last) {\n                        seq_mapping = existing ?? (seq_mapping[canonical_key_string] = {});\n                    } else {\n                        seq_mapping[canonical_key_string] = command;  // and then we're done...\n                    }\n                }\n            }\n        }\n        return mapping;\n    }\n\n    static Mapper = class Mapper {\n        constructor(mapping, recognizer, fallback_mapper=null) {\n            if (mapping !== null && typeof mapping !== 'undefined' && typeof mapping !== 'object') {\n                throw new Error('mapping must be null/undefined or an object');\n            }\n            if (recognizer !== null && typeof recognizer !== 'undefined' && typeof recognizer !== 'function') {\n                throw new Error('recognizer must be null/undefined or a function');\n            }\n            if (fallback_mapper !== null && typeof fallback_mapper !== 'undefined' && !(fallback_mapper instanceof this.constructor)) {\n                throw new Error('fallback_mapper must be null/undefined or a KeyMap instance');\n            }\n            if (!mapping && !fallback_mapper) {\n                throw new Error('at least one of mapping or fallback_mapper must be given');\n            }\n            Object.defineProperties(this, {\n                mapping: {\n                    value:      mapping,\n                    enumerable: true,\n                },\n                recognizer: {\n                    value:      recognizer,\n                    enumerable: true,\n                },\n                fallback_mapper: {\n                    value:      fallback_mapper,\n                    enumerable: true,\n                },\n            });\n        }\n\n        // returns a command string (complete), or undefined (failed), or a new Mapper instance (waiting for next key in sequence)\n        consume(key_string_or_key_spec) {\n            const key_spec = (key_string_or_key_spec instanceof KeySpec)\n                  ? key_string_or_key_spec\n                  : new KeySpec(key_string_or_key_spec);\n            const recognizer_result = this.recognizer?.(key_spec);\n            // this.recognizer takes precedence over this.mapping\n            if (typeof recognizer_result === 'string') {\n                return recognizer_result;\n            }\n            // this.mapping takes precedence over this.fallback_mapper\n            const canonical_key_string = key_spec.canonical;\n            const mapping_result = this.mapping?.[canonical_key_string];  // returns: undefined, string, or another mapping (object)\n            if (typeof mapping_result === 'string') {\n                return mapping_result;\n            }\n            const fallback_mapper_result = this.fallback_mapper?.consume(key_spec);\n            if (typeof fallback_mapper_result === 'string') {\n                return fallback_mapper_result;\n            }\n            if (!mapping_result && !fallback_mapper_result) {\n                return undefined;  // indicate: failed\n            }\n            return mapping_result\n                ? new Mapper(mapping_result, null, fallback_mapper_result)\n                : fallback_mapper_result;  // no need to compose with mapping_result (which is undefined)\n        }\n    };\n}\n","export class KeySpec {\n    constructor(key_string, context=null) {\n        if (typeof key_string !== 'string' || key_string.length <= 0) {\n            throw new Error('key_string must be a non-empty string');\n        }\n        Object.defineProperties(this, {\n            key_string: {\n                value:      key_string,\n                enumerable: true,\n            },\n            context: {\n                value:      context,\n                enumerable: true,\n            },\n        });\n        this.#init();\n    }\n\n\n    // === CONSTANTS ===\n\n    static canonical_key_modifier_separator = '+';  // separator between modifier codes and key in a canonical key string\n    static canonical_key_string_separator   = ' ';  // separator between key_strings in a canonical key binding\n\n    // #basic_modifier_desc_map is the definition from which #modifier_desc_map and #modifier_code_desc_map are derived\n    static #basic_modifier_desc_map = {\n        meta:  { code: 'm', event_prop: 'metaKey',  glyph: '\\u2318', display_order: 3, alternates: [ 'cmd', 'command' ] },\n        ctrl:  { code: 'c', event_prop: 'ctrlKey',  glyph: '\\u2303', display_order: 1, alternates: [ 'control' ] },\n        shift: { code: 's', event_prop: 'shiftKey', glyph: '\\u21E7', display_order: 2, alternates: [] },\n        alt:   { code: 'a', event_prop: 'altKey',   glyph: '\\u2325', display_order: 4, alternates: [] },\n    };\n\n    static #other_key_glyphs = {\n        arrowleft:  '\\u2190',\n        arrowup:    '\\u2191',\n        arrowright: '\\u2192',\n        arrowdown:  '\\u2193',\n        enter:      'Enter',\n        backspace:  'Backspace',\n        delete:     'Delete',\n    };\n\n\n    // === PARSING ===\n\n    static from_keyboard_event(keyboard_event) {\n        const modifier_descs = [];\n        for (const modifier in this.#basic_modifier_desc_map) {\n            const desc = this.#basic_modifier_desc_map[modifier];\n            if (keyboard_event[desc.event_prop]) {\n                modifier_descs.push(desc);\n            }\n        }\n        const modifier_strings = modifier_descs\n              .map(desc => this.#modifier_code_to_modifier[desc.code]);\n        let key = event.key;\n        const key_string = [ ...modifier_strings, key ].join(this.canonical_key_modifier_separator);\n        // attaching keyboard_event as context enables commands like \"insert-self\"\n        return new this(key_string, keyboard_event);\n    }\n\n    get glyphs (){\n        if (typeof this.#glyphs === 'undefined') {\n            // cache result\n            const key = this.key;\n            const klc = key.toLowerCase();\n            const result_segments = this.modifier_descs.map(desc => desc.glyph);\n            if (klc in this.constructor.#other_key_glyphs) {\n                result_segments.push(this.constructor.#other_key_glyphs[klc]);\n            } else if (key.match(/^[a-zA-Z]$/) || key.match(/^[fF][0-9]{1,2}$/)) {\n                result_segments.push(key.toUpperCase());\n            } else {\n                result_segments.push(key);\n            }\n            this.#glyphs = result_segments.join('');\n        }\n        return this.#glyphs;\n    }\n    #glyphs;  // memoization\n\n\n    // === INTERNAL ===\n\n    #init() {\n        const modifiers = this.key_string.split(/[+-]/);\n        if (modifiers.length < 1 || modifiers.some(s => s.length <= 0)) {\n            // check for case where key is '+' or '-', e.g., \"-\" or \"shift++\":\n            if (this.key_string.match(/^[+-]$/)) {  // + or - alone?\n                modifiers.splice(0);  // remove all entries\n                modifiers.push(this.key_string);  // then add back this.key_string\n            } else if (this.key_string.match(/[+-][+-]$/)) {  // with modifier?\n                // remove last (empty) string:\n                modifiers.splice(-1);\n                // change new last (empty) string to the '+' or '-' that was specified:\n                modifiers[modifiers.length-1] = this.key_string[this.key_string.length-1];\n            } else {\n                throw new Error(`invalid key_string ${this.key_string}`);\n            }\n        }\n        let key = modifiers.at(-1);  // note: not converted to lowercase\n        modifiers.splice(-1);  // remove key from modifiers\n        for (let i = 0; i < modifiers.length; i++) {\n            modifiers[i] = modifiers[i].toLowerCase();\n        }\n        let klc = key.toLowerCase();\n        if (['up', 'down', 'left', 'right'].includes(klc)) {\n            key = `Arrow${key}`;\n            klc = `arrow${klc}`;\n        }\n        const modifier_descs = [];\n        for (const modifier of modifiers) {\n            const desc = this.constructor.#key_string_modifier_to_desc(modifier);\n            if (!desc) {\n                throw new Error(`invalid modifier \"${modifier}\" in key_string ${this.key_string}`);\n            }\n            if (desc.code in modifier_descs) {//!!! incorrect comparison\n                throw new Error(`redundant modifier \"${modifier}\" in key_string ${this.key_string}`);\n            }\n            modifier_descs.push(desc);\n        }\n        modifier_descs.sort((a, b) => (a.display_order - b.display_order));  // sort in-place\n        const modifier_flags = Object.values(modifier_descs)\n              .reduce((flags, desc) => (flags | this.constructor.#modifier_to_flag[desc.code]), 0);\n        const canonical_modifiers = modifier_descs\n              .map(desc => desc.code)\n              .join('');\n        // determine is_printable\n        let is_printable = true;\n        if ((modifier_flags & ~this.constructor.shift_flag) !== 0) {\n            // not printable if any modifier other than shift is applied\n            is_printable = false;\n        } else {\n            // \\p{C}: see https://unicode.org/reports/tr18/#General_Category_Property (\"Control\" characters)\n            is_printable = !(key.length !== 1 || key.match(/^[\\p{C}]$/u));\n        }\n        // note: preserve alphabetic case if is_printable, otherwise use lower-cased key\n        const canonical = `${canonical_modifiers}${this.constructor.canonical_key_modifier_separator}${is_printable ? key : klc}`;\n\n        Object.freeze(modifiers);\n        Object.freeze(modifier_descs);\n\n        Object.defineProperties(this, {\n            key: {\n                value:      key,\n                enumerable: true,\n            },\n            modifiers: {\n                value:      modifiers,\n                enumerable: true,\n            },\n            modifier_descs: {\n                value:      modifier_descs,\n                enumerable: true,\n            },\n            modifier_flags: {\n                value:      modifier_flags,\n                enumerable: true,\n            },\n            canonical_modifiers: {\n                value:      canonical_modifiers,\n                enumerable: true,\n            },\n            canonical: {\n                value:      canonical,\n                enumerable: true,\n            },\n            is_printable: {\n                value:      is_printable,\n                enumerable: true,\n            },\n        });\n\n        for (const modifier in this.constructor.#basic_modifier_desc_map) {\n            Object.defineProperty(this, `has_${modifier}`, {\n                value:      this.modifiers.includes(modifier),\n                enumerable: true,\n            });\n        }\n\n    }\n\n    // modifier_desc: {\n    //     modifier:       string,  // modifier string\n    //     basic_modifier: string,  // canonical modifier string\n    //     code:           string,  // canonical code for modifier\n    //     event_prop:     string,  // corresponding property in KeyboardEvent object\n    //     alternates:     string,  // all alternates, including basic_modifier\n    // }\n    static #modifier_desc_map;       // modifier_string->modifier_desc; initialized in this._init_static()\n    static #modifier_code_desc_map;  // modifier_code->modifier_desc;   initialized in this._init_static()\n\n    static #is_on_macos;  // initialized in this._init_static()\n\n    static #key_string_modifier_to_desc(modifier) {\n        modifier = modifier.toLowerCase();\n        if (['cmdorctrl', 'commandorctrl'].includes(modifier)) {\n            const CmdOrCtrl = this.#is_on_macos ? 'meta' : 'ctrl';\n            modifier = CmdOrCtrl.toLowerCase();\n        }\n        return this.#modifier_desc_map[modifier];\n    }\n\n    static #modifier_code_to_modifier;       // code->modifier; initialized in this.#_init_static()\n    static #modifier_code_to_glyph;          // code->glyph;    initialized in this.#_init_static()\n    static #modifier_code_to_display_order;  // code->number;   initialized in this.#_init_static()\n\n    static #modifier_to_flag;  // (code|full)->bit_field_integer\n\n    // Safari does not support static initialization blocks in classes (at the time of writing), so do it this way:\n    static _init_static() {\n        this.#is_on_macos = (globalThis.navigator?.userAgentData?.platform ?? globalThis.navigator?.platform ?? '').toLowerCase().startsWith('mac');\n\n        this.#modifier_code_to_modifier = {};  // code->modifier\n        for (const modifier in this.#basic_modifier_desc_map) {\n            const desc = this.#basic_modifier_desc_map[modifier];\n            this.#modifier_code_to_modifier[desc.code] = modifier;\n        }\n\n        this.#modifier_code_to_glyph =  // code->glyph\n            Object.fromEntries(\n                Object.entries(this.#basic_modifier_desc_map)\n                    .map(([modifier_key, { code, glyph }]) => [ code, glyph ])\n            );\n\n        this.#modifier_code_to_display_order =  // code->number\n            Object.fromEntries(\n                Object.entries(this.#basic_modifier_desc_map)\n                    .map(([modifier_key, { code, display_order }]) => [ code, display_order ])\n            );\n\n        this.#modifier_desc_map = this.#build_modifier_desc_map();  // modifier_string->modifier_desc\n\n        this.#modifier_code_desc_map =  // modifier_code->modifier_desc\n            Object.freeze(\n                Object.fromEntries(\n                    Object.keys(this.#basic_modifier_desc_map)\n                        .map(k => this.#modifier_desc_map[k])\n                        .map(desc => [ desc.code, desc ])\n                )\n            );\n\n        let current_bit = 1;\n        this.#modifier_to_flag = {};  // (code|full)->bit_field_integer\n        for (const modifier in this.#basic_modifier_desc_map) {\n            const desc = this.#basic_modifier_desc_map[modifier];\n            this.#modifier_to_flag[modifier]  = current_bit;\n            this.#modifier_to_flag[desc.code] = current_bit;\n            current_bit <<= 1;\n        }\n        Object.freeze(this.#modifier_to_flag);\n\n        for (const modifier in this.#basic_modifier_desc_map) {\n            Object.defineProperty(this, `${modifier}_flag`, {\n                value:      this.#modifier_to_flag[modifier],\n                enumerable: true,\n            });\n        }\n    }\n\n    static #build_modifier_desc_map() {\n        // validate this.#basic_modifier_desc_map:\n        {\n            const disallowed_modifier_codes = ('+-' + this.canonical_key_modifier_separator + this.canonical_key_string_separator);\n\n            const keys = Object.keys(this.#basic_modifier_desc_map);\n            if (keys.some(k => k !== k.toLowerCase())) {\n                throw new Error('KeySpec.#basic_modifier_desc_map keys must be lowercase');\n            }\n            const all_alternates = keys.map(k => this.#basic_modifier_desc_map[k].alternates).reduce((acc, a) => [...acc, ...a]);\n            if (all_alternates.some(k => k !== k.toLowerCase())) {\n                throw new Error('KeySpec.#basic_modifier_desc_map alternates must be lowercase');\n            }\n            if (new Set([...keys, ...all_alternates]).size !== (keys.length + all_alternates.length)) {\n                throw new Error('KeySpec.#basic_modifier_desc_map keys and alternates must all be distinct');\n            }\n            const codes = keys.map(k => this.#basic_modifier_desc_map[k].code);\n            for (const code of codes) {\n                if (code.length !== 1) {\n                    throw new Error('KeySpec.#basic_modifier_desc_map codes must be single characters');\n                }\n                if (disallowed_modifier_codes.includes(code)) {\n                    throw new Error(`KeySpec.#basic_modifier_desc_map codes are not allowed to be any of following: ${disallowed_modifier_codes}`);\n                }\n            }\n            if (new Set(codes).size !== codes.length) {\n                throw new Error('KeySpec.#basic_modifier_desc_map code values must be distinct');\n            }\n            const props = keys.map(k => this.#basic_modifier_desc_map[k].event_prop);\n            if (new Set(props).size !== props.length) {\n                throw new Error('KeySpec.#basic_modifier_desc_map event_prop values must be distinct');\n            }\n        }\n        // validation passed; build the map\n        const mdm = {};\n        function create_extended_desc(basic_modifier_key, modifier_key, desc) {\n            const ext_desc = {\n                modifier: modifier_key,\n                basic_modifier: basic_modifier_key,\n                ...desc,\n                alternates: [ ...new Set([ basic_modifier_key, modifier_key, ...desc.alternates ]) ],\n            };\n            return Object.freeze(ext_desc);\n        }\n        for (const bmdm_key in this.#basic_modifier_desc_map) {\n            const desc = this.#basic_modifier_desc_map[bmdm_key];\n            mdm[bmdm_key] = create_extended_desc(bmdm_key, bmdm_key, desc);\n            for (const alt_key of desc.alternates) {\n                mdm[alt_key] = create_extended_desc(bmdm_key, alt_key, desc);\n            }\n        }\n        return Object.freeze(mdm);\n    }\n}\n\n// Safari does not support static initialization blocks in classes (at the time of writing), so do it this way:\nKeySpec._init_static();\n","const current_script_url = import.meta.url;  // save for later\n\nimport {\n    Subscribable,\n} from '../../sys/subscribable.js';\n\nimport {\n    create_element,\n} from '../dom-tools.js';\n\nimport {\n    KeySpec,\n} from '../key/_.js';\n\nimport {\n    assets_server_url,\n} from '../../../src/assets-server-url.js';\n\n// import {\n//     create_stylesheet_link,\n// } from '../dom-tools.js';\nexport async function load_stylesheet() {\n    // create_stylesheet_link(document.head, new URL('./style.css', assets_server_url(current_script_url)));\n    await import('./style.css');  // webpack implementation\n}\n\n\n// === MENUBAR CLASS ===\n\n// css classification classes: menubar, menu, menuitem\n// other css classes: disabled, selected, active\n// also: menuitem-label, menuitem-separator, menuitem-annotation, collection, collection-arrow\n\nexport class MenuBar {\n    static menu_element_tag_name     = 'menu';\n    static menuitem_element_tag_name = 'li';\n\n    static find_previous_menuitem(menuitem) {\n        let mi = menuitem.previousElementSibling;\n        while (mi && (!mi.classList.contains('menuitem') || mi.classList.contains('disabled'))) {\n            mi = mi.previousElementSibling;\n        }\n        return mi;\n    }\n\n    static find_next_menuitem(menuitem) {\n        let mi = menuitem.nextElementSibling;\n        while (mi && (!mi.classList.contains('menuitem') || mi.classList.contains('disabled'))) {\n            mi = mi.nextElementSibling;\n        }\n        return mi;\n    }\n\n    /** call this static method, not the constructor directly\n     *  @param {Element} parent\n     *  @param {Object} menubar_spec: {\n     *      ...\n     *  }\n     *  @param {Function|null|undefined} get_command_bindings\n     *  @return {MenuBar} menu bar instance\n     */\n    static create(parent, menubar_spec, get_command_bindings) {\n        const menubar = new this(parent, menubar_spec, get_command_bindings);\n        return menubar;\n    }\n\n    constructor(parent, menubar_spec, get_command_bindings) {\n        if (!(parent instanceof Element)) {\n            throw new Error('parent must be an instance of Element');\n        }\n        if (get_command_bindings !== null && typeof get_command_bindings !== 'undefined' && typeof get_command_bindings !== 'function') {\n            throw new Error('get_command_bindings must be null, undefined, or a function');\n        }\n\n        get_command_bindings ??= () => [];\n\n        const commands = new Subscribable();  // emits command_context: { command: string, event: Event, target: Element }\n        const selects  = new Subscribable();  // emits { select: Boolean, target: Element }  // select: true is sent before, select: false is sent after\n\n        Object.defineProperties(this, {\n            get_command_bindings: {\n                value:      get_command_bindings,\n                enumerable: true,\n            },\n            commands: {\n                value:      commands,\n                enumerable: true,\n            },\n            selects: {\n                value:      selects,\n                enumerable: true,\n            },\n        });\n\n        this.#menu_id_to_element = {};\n        this.#menubar_container = this.#build_menubar(parent, menubar_spec);\n    }\n    #menu_id_to_element;\n    #menubar_container;\n\n    get element (){ return this.#menubar_container; }\n\n    #get_menu_element(menu_id) {\n        const element = this.#menu_id_to_element[menu_id];\n        if (!element) {\n            throw new Error(`no element found for menu id \"${menu_id}\"`);\n        }\n        if (!element.classList.contains('menuitem')) {\n            throw new Error(`element for menu id \"${menu_id}\" is not a menuitem`);\n        }\n        return element;\n    }\n\n    /** activate menu\n     *  @param {Object} options: {\n     *      set_focus?: Boolean,  // set focus, too?\n     *  }\n     */\n    async activate(options=null) {\n        if (!(this.#menubar_container instanceof Element) || !this.#menubar_container.classList.contains('menubar')) {\n            throw new Error('this.#menubar_container must be an Element with class \"menubar\"');\n        }\n        const {\n            set_focus,\n        } = (options ?? {});\n        if (!this.#menubar_container.querySelector('.selected')) {\n            // select the first menuitem of the menubar\n            const menubar_first_menuitem = this.#menubar_container.querySelector('.menuitem');\n            if (menubar_first_menuitem) {\n                this.#select_menuitem(menubar_first_menuitem);\n            }\n        }\n        if (set_focus) {\n            return new Promise(resolve => setTimeout(() => {\n                this.#menubar_container.focus();\n                resolve();\n            }));\n        }\n    }\n\n    /** deactivate menu\n     */\n    deactivate() {\n        this.#deactivate_menu(this.#menubar_container);\n    }\n\n    set_menu_state(menu_id, state_specs) {\n        state_specs ??= {};\n        if (typeof state_specs !== 'object') {\n            throw new Error('state_specs must be an object');\n        }\n        const element = this.#get_menu_element(menu_id);\n        for (const [ name, value ] of Object.entries(state_specs ?? {})) {\n            switch (name) {\n            case 'enabled': {\n                if (value) {\n                    element.classList.remove('disabled');\n                } else {\n                    element.classList.add('disabled');\n                }\n                break;\n            }\n            case 'checked': {\n                if (value) {\n                    element.classList.add('checked');\n                } else {\n                    element.classList.remove('checked');\n                }\n                break;\n            }\n            default: {\n                throw new Error('unknown state name');\n            }\n            }\n        }\n    }\n\n\n    // === INTERNAL ===\n\n    /** deactivate the menubar or menu that contains the given menuitem\n     *  and reset all subordinate state.\n     *  @param {Element|undefined|null} menu_element an Element object with class either .menubar or .menu\n     *  This is compatible with menuitem elements that are contained\n     *  in either a .menubar or .menu element.\n     */\n    #deactivate_menu(menu_element) {\n        if (menu_element) {\n            if ( !(menu_element instanceof Element) ||\n                 (!menu_element.classList.contains('menubar') && !menu_element.classList.contains('menu')) ) {\n                throw new Error('menu_element must be an Element with class \"menubar\" or \"menu\"');\n            }\n            menu_element.classList.remove('active');\n            menu_element.classList.remove('selected');\n            for (const mi of menu_element.children) {\n                mi.classList.remove('selected');\n                if (mi.classList.contains('collection')) {\n                    this.#deactivate_menu(mi.querySelector('.menu'));\n                }\n            }\n            if (menu_element.classList.contains('menubar')) {\n                this.selects.dispatch({ select: false, target: menu_element });\n            }\n        }\n    }\n\n    /** select the given menuitem and deselect all others\n     *  @param {Element} menuitem_element\n     *  This is compatible with menuitem elements that are contained\n     *  in either a .menubar or .menu element.\n     */\n    #select_menuitem(menuitem_element) {\n        if (!menuitem_element.classList.contains('selected')) {\n            // change selection only if not already selected\n            const container = menuitem_element.closest('.menubar, .menu');\n            if (container.classList.contains('menubar') && !this.#menubar_container.querySelector('.selected')) {\n                this.selects.dispatch({ select: true, target: menuitem_element });\n            }\n            // add .selected to menuitem_element\n            menuitem_element.classList.add('selected');\n            if (menuitem_element.classList.contains('collection')) {\n                // make it \"active\" so that the submenu is displayed\n                menuitem_element.querySelector('.menu').classList.add('active');\n                // adjust the position of the collection\n                const collection = menuitem_element.querySelector('.menu');\n                const menuitem_element_br = menuitem_element.getBoundingClientRect();\n                if (menuitem_element.parentElement.classList.contains('menubar')) {\n                    collection.style.top  = `${menuitem_element_br.y + menuitem_element_br.height}px`;\n                    collection.style.left = `${menuitem_element_br.x}px`;\n                } else {\n                    collection.style.top  = `${menuitem_element_br.y - menuitem_element_br.height}px`;\n                    collection.style.left = `${menuitem_element_br.x + menuitem_element_br.width}px`;\n                }\n            }\n            // we updated menuitem_element first so that we don't erroneously\n            // fire a selects event with select: false while we deselect all\n            // other children now\n            for (const mi of container.children) {\n                if (mi !== menuitem_element) {\n                    this.#deselect_menuitem(mi);\n                }\n            }\n        }\n    }\n\n    /** deselect the given menuitem\n     *  @param {Element} menuitem_element\n     *  This is compatible with menuitem elements that are contained\n     *  in either a .menubar or .menu element.\n     */\n    #deselect_menuitem(menuitem_element) {\n        if (menuitem_element.classList.contains('selected')) {\n            menuitem_element.classList.remove('selected');\n            if (menuitem_element.parentElement.classList.contains('menubar') && !this.#menubar_container.querySelector('.selected')) {\n                this.selects.dispatch({ select: false, target: menuitem_element });\n            }\n        }\n        if (menuitem_element.classList.contains('collection')) {\n            this.#deactivate_menu(menuitem_element.querySelector('.menu'));\n        }\n    }\n\n    /** Return a new menu Element object which represents a separator.\n     *  @param {Element} parent\n     */\n    #build_menu_item_separator(parent) {\n        if (!(parent instanceof Element)) {\n            throw new Error('parent must be an instance of Element');\n        }\n        const element = create_element({\n            parent,\n            tag: this.constructor.menuitem_element_tag_name,\n        });\n        element.classList.add('disabled', 'menuitem', 'menuitem-separator');\n    }\n\n    /** Return a new menu Element object for the given menu_spec.\n     *  @param {object|string} menu_spec specification for menu item or collection.\n     *         If a string, then create a separator (regardless of the string contents).\n     *  @param {Element} parent\n     *  @param {boolean} (optional) toplevel if the menu is the top-level \"menubar\" menu\n     *         default value: false\n     *  @return {Element} new menu Element\n     *  Also updates this.#menu_id_to_element\n     */\n    #build_menu(menu_spec, parent, toplevel=false) {\n        if (!(parent instanceof Element)) {\n            throw new Error('parent must be an instance of Element');\n        }\n        if (typeof menu_spec === 'string') {\n            return this.#build_menu_item_separator(parent);\n        }\n\n        const {\n            label,\n            collection,\n            item,\n            id: menu_id,\n        } = menu_spec;\n\n        if (typeof label !== 'string') {\n            throw new Error('label must be specified as a string');\n        }\n        if (item && collection) {\n            throw new Error('item and collection must not both be specified');\n        }\n        if (collection) {\n            if (!Array.isArray(collection)) {\n                throw new Error('collection must be an array');\n            }\n        }\n        if (item) {\n            if (typeof item !== 'object' || typeof item.command !== 'string') {\n                throw new Error('item must specify an object with a string property \"command\"');\n            }\n        }\n        if (!['undefined', 'string'].includes(typeof menu_id) || menu_id === '') {\n            throw new Error('id must be a non-empty string');\n        }\n\n        // both items and collections are menuitem elements, but the collection also has children...\n        const element = this.#build_menuitem(label, toplevel);\n\n        if (item) {\n            this.#add_item_menuitem_annotations_and_click_handler(element, item.command);\n        } else {\n            // collection\n            element.classList.add('collection');\n\n            const collection_element = create_element({\n                parent: element,\n                tag:    this.constructor.menu_element_tag_name,\n            });\n            collection_element.classList.add('menu');\n            if (!toplevel) {\n                const el = create_element({\n                    parent: element,\n                    attrs: {\n                        class: [ 'menuitem-annotation', 'collection-arrow' ],\n                    },\n                });\n                el.textContent = '\\u25b8';  // right-pointing triangle\n            }\n            collection.forEach(spec => this.#build_menu(spec, collection_element));\n\n            if (toplevel) {\n                element.addEventListener('click', (event) => {\n                    if (event.target.closest('.menuitem') === element) {  // make sure click is not in a child (submenu)\n                        if (element.classList.contains('selected')) {\n                            this.#deselect_menuitem(element);\n                        } else {\n                            this.#select_menuitem(element);\n                        }\n                        event.stopPropagation();\n                        event.preventDefault();\n                    }\n                });\n            }\n        }\n\n        if (menu_id) {\n            this.#menu_id_to_element[menu_id] = element;\n        }\n\n        // wait to add to parent until everything else happens without error\n        if (parent) {\n            parent.appendChild(element);\n        }\n\n        return element;\n    }\n\n    #build_menuitem(label, toplevel=false) {\n        // both items and collections are menuitem elements, but the collection also has children...\n        const menuitem = create_element({\n            tag: this.constructor.menuitem_element_tag_name,\n            attrs: {\n                set_id: true,\n                class: 'menuitem',\n            },\n        });\n\n        // add the label\n        const lbl = create_element({\n            parent: menuitem,\n            attrs: {\n                class: 'menuitem-label',\n            },\n        });\n        lbl.innerText = label;\n\n        menuitem.addEventListener('mousemove', (event) => {\n            // don't pop open top-level menus unless one is already selected\n            // this means that the user must click the top-level menu to get things started\n            if (!toplevel || this.#menubar_container.querySelector('.selected')) {\n                if (!menuitem.classList.contains('disabled')) {\n                    this.#select_menuitem(menuitem);\n                }\n            }\n        });\n        return menuitem;\n    }\n    #add_item_menuitem_annotations_and_click_handler(menuitem, command) {\n        if (command) {\n            const command_bindings = this.get_command_bindings();\n            const kbd_bindings = command_bindings[command];\n            if (kbd_bindings) {\n                const kbd_container = create_element({\n                    parent: menuitem,\n                    attrs: {\n                        class: 'menuitem-annotation',\n                    },\n                });\n                // create <kbd>...</kbd> elements\n                kbd_bindings.forEach(binding => {\n                    const binding_glyphs = new KeySpec(binding).glyphs;\n                    create_element({ parent: kbd_container, tag: 'kbd' }).textContent = binding_glyphs;\n                });\n            }\n        }\n\n        menuitem.addEventListener('click', (event) => {\n            this.#deactivate_menu(menuitem.closest('.menubar'));\n            const command_context = { command, event, target: event.target };\n            this.commands.dispatch(command_context);\n            event.stopPropagation();\n            event.preventDefault();\n        });\n    }\n\n    #build_menubar(parent, menubar_spec) {\n        const menubar_container = create_element({\n            parent,\n            tag: this.constructor.menu_element_tag_name,\n            attrs: {\n                role:     'navigation',\n                tabindex: 0,\n                class: [ 'active', 'menubar' ],\n            },\n            before: parent.firstChild,  // prepend\n        });\n        menubar_spec.forEach(spec => this.#build_menu(spec, menubar_container, true));\n\n        // add event listener to close menu when focus is lost\n        menubar_container.addEventListener('blur', (event) => {\n            this.#deactivate_menu(menubar_container);\n        });\n\n        // add keyboard navigation event listener\n        menubar_container.addEventListener('keydown', (event) => {\n            const selected_elements = menubar_container.querySelectorAll('.selected');\n            if (selected_elements.length <= 0) {\n                if (! ['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Enter', ' '].includes(event.key)) {\n                    return;  // do not handle or alter propagation\n                } else {\n                    // select the first menuitem of the menubar\n                    const menubar_first_menuitem = menubar_container.querySelector('.menuitem');\n                    if (menubar_first_menuitem) {\n                        this.#select_menuitem(menubar_first_menuitem);\n                    }\n                }\n            } else {\n                const menuitem = selected_elements[selected_elements.length-1];\n\n                const is_in_menubar = (menuitem.parentElement === menubar_container);\n\n                let key_menu_prev, key_menu_next, key_cross_prev, key_cross_next;\n                if (is_in_menubar) {\n                    key_menu_prev  = 'ArrowLeft';\n                    key_menu_next  = 'ArrowRight';\n                    key_cross_prev = 'ArrowUp';\n                    key_cross_next = 'ArrowDown';\n                } else {\n                    key_menu_prev  = 'ArrowUp';\n                    key_menu_next  = 'ArrowDown';\n                    key_cross_prev = 'ArrowLeft';\n                    key_cross_next = 'ArrowRight';\n                }\n\n                switch (event.key) {\n                case 'Enter':\n                case ' ': {\n                    menuitem.click();\n                    break;\n                }\n                case 'Escape': {\n                    this.#deactivate_menu(menubar_container);\n                    break;\n                }\n                case key_menu_prev: {\n                    const mi = this.constructor.find_previous_menuitem(menuitem);\n                    if (mi) {\n                        this.#select_menuitem(mi);\n                    } else if (!is_in_menubar) {\n                        menuitem.classList.remove('selected');  // parent menuitem will still be selected\n                    }\n                    break;\n                }\n                case key_menu_next: {\n                    const mi = this.constructor.find_next_menuitem(menuitem);\n                    if (mi) {\n                        this.#select_menuitem(mi);\n                    }\n                    break;\n                }\n                case key_cross_prev: {\n                    if (!is_in_menubar) {\n                        const menubar_menuitem = menubar_container.querySelector('.menuitem.selected');\n                        const mbi = this.constructor.find_previous_menuitem(menubar_menuitem);\n                        if (mbi) {\n                            this.#select_menuitem(mbi);\n                        }\n                    }\n                    break;\n                }\n                case key_cross_next: {\n                    let navigated_into_collection = false;\n                    if (menuitem.classList.contains('collection')) {\n                        // enter collection if possible\n                        const mi = menuitem.querySelector('.menuitem:not(.disabled)');\n                        if (mi) {\n                            this.#select_menuitem(mi);\n                            navigated_into_collection = true;\n                        }\n                    }\n                    if (!navigated_into_collection && !is_in_menubar) {\n                        const menubar_menuitem = menubar_container.querySelector('.menuitem.selected');\n                        const mbi = this.constructor.find_next_menuitem(menubar_menuitem);\n                        if (mbi) {\n                            this.#select_menuitem(mbi);\n                        }\n                    }\n                    break;\n                }\n\n                default:\n                    return;  // do not handle or alter propagation\n                }\n            }\n\n            // if we get here, assume the event was handled and therefore\n            // we should stop propagation and prevent default action.\n            event.stopPropagation();\n            event.preventDefault();\n        }, {\n            capture: true,\n        });\n\n        return menubar_container;\n    }\n}\n","const current_script_url = import.meta.url;  // save for later\n\nconst assets_server_script = document.querySelector('script');\nif (!assets_server_script || !assets_server_script.src) {\n    throw new Error('no script for assets server found in document');\n}\nconst assets_server_root = new URL('..', assets_server_script.src);  // assumes script src points to is one directory level below the server root\nconst local_server_root  = new URL('..', current_script_url);        // assumes this script is located one directory level below server root\n\n\n/** @return {URL} url resolved against the running server url\n */\nexport function assets_server_url(local_url) {\n    if (typeof local_url === 'string') {\n        local_url = new URL(local_url, local_server_root);\n    }\n    if (!(local_url instanceof URL)) {\n        throw new Error('local_url must be a string or an instance of URL');\n    }\n\n    if ( local_url.protocol !== 'file:' ||\n         local_server_root.protocol !== 'file:' ||\n         assets_server_root.protocol === 'file:' ||\n         !local_url.href.startsWith(local_server_root.href) ) {\n        return local_url;  // nothing to do...\n    } else {\n        const relative = local_url.href.slice(local_server_root.href.length);\n        return new URL(assets_server_root.href + relative);\n    }\n}\n","const current_script_url = import.meta.url;  // save for later\n\nimport {\n    create_element,\n    clear_element,\n    escape_for_html,\n    setup_textarea_auto_resize,\n    trigger_textarea_auto_resize,\n    manage_selection_for_insert,\n    manage_selection_for_delete,\n    insert_at,\n    delete_nearest_leaf,\n    validate_parent_and_before_from_options,\n} from '../../lib/ui/dom-tools.js';\n\nimport {\n    LogbookManager,\n} from '../logbook-manager.js';\n\nimport {\n    EventListenerManager,\n} from '../../lib/sys/event-listener-manager.js';\n\nimport {\n    ToolBarElement,\n} from '../tool-bar-element/_.js';\n\nimport {\n    beep,\n} from '../../lib/ui/beep.js';\n\n// import {\n//     assets_server_url,\n// } from '../assets-server-url.js';\n// import {\n//     create_stylesheet_link,\n// } from '../../lib/ui/dom-tools.js';\nexport async function load_stylesheet() {\n    // create_stylesheet_link(document.head, new URL('./style.css', assets_server_url(current_script_url)));\n    await import('./style.css');  // webpack implementation\n}\n\n\nexport class EditorCellElement extends HTMLElement {\n    static custom_element_name = 'editor-cell';\n\n    static attribute__active  = 'data-active';\n\n    constructor() {\n        super();\n        this.#event_listener_manager = new EventListenerManager();\n\n        this.#connect_focus_listeners();\n\n        // _tool_bar is used instead of #tool_bar so that subclasses have access (see establish_tool_bar())\n        this._tool_bar = null;\n\n        this.#resize_observer = new ResizeObserver(this.#resize_observer_handler.bind(this));\n        this.#resize_observer.observe(this);\n    }\n    #event_listener_manager;\n    #resize_observer;\n\n\n    // === TEXT CONTENT ===\n\n    get_text() {\n        return this.#has_text_container()\n            ? this.#get_text_container().value\n            : this.textContent;\n    }\n\n    // this works even if the cell is not editable\n    set_text(text) {\n        if (this.#has_text_container()) {\n            this.#get_text_container().value = text;\n        } else {\n            this.textContent = text;\n        }\n    }\n\n    /** @return {String} an HTML representation of the current state of this cell\n     * The 'contenteditable' and this.constructor.attribute__active are ignored\n     * and the text container element, if it exists, is omitted and the text\n     * made a direct child of the cell.\n     */\n    get_outer_html() {\n        const tag = this.tagName.toLowerCase();\n        const attr_segments = [];\n        for (const name of this.getAttributeNames()) {\n            if (name !== 'contenteditable' && name !== this.constructor.attribute__active) {\n                const value = this.getAttribute(name);\n                const encoded_value = escape_for_html(value).replaceAll('\"', '&quot;');//!!!\n                attr_segments.push(`${name}=\"${encoded_value}\"`);\n            }\n        }\n        const text_content = escape_for_html(this.get_text());\n        return `<${tag} ${attr_segments.join(' ')}>${text_content}</${tag}>`;\n    }\n\n    #get_text_container() {\n        return this.#has_text_container() ? this.firstChild : this;\n    }\n\n    #has_text_container() {\n        const first_child = this.firstChild;\n        return (first_child instanceof HTMLTextAreaElement) && !first_child.nextSibling;\n    }\n\n    #establish_editable_text_container() {\n        if (!this.#has_text_container()) {\n            const text = this.get_text();\n            clear_element(this);\n            const editable_element = create_element({\n                parent: this,\n                tag: 'textarea',\n                set_id: true,  // prevent warning: \"A form field element should have an id or name attribute\"\n                attrs: {\n                    spellcheck: false,\n                },\n            });\n            setup_textarea_auto_resize(editable_element);\n            this.set_text(text);  // will be added to the new editable_element textarea\n            editable_element.setSelectionRange(0, 0);  // move cursor to beginning of text\n            this.#trigger_text_container_resize();\n        }\n    }\n\n    #remove_text_container() {\n        if (this.#has_text_container()) {\n            const text = this.get_text();\n            clear_element(this);  // remove text_container element\n            this.set_text(text);  // will be added directly to this because no text_container\n        }\n    }\n\n    /** override focus() so that we can direct focus to the contained textarea\n     *  if necessary.  Setting a tabindex=\"0\" attribute on this cell solves the\n     *  problem but then causes another: SHIFT-Tab out of a textarea with a\n     *  tabindex=\"0\" parent fails.  So we just have to do it the hard way.\n     */\n    focus() {\n        if (!this.#has_text_container()) {\n            super.focus();  // will most likely fail, but that would be appropriate\n        } else {\n            const text_container = this.#get_text_container();\n            const ss = text_container.selectionStart ?? 0;\n            const se = text_container.selectionEnd   ?? 0;\n            text_container.focus();\n            text_container.setSelectionRange(ss, se);\n        }\n    }\n\n    #trigger_text_container_resize() {\n        if (this.#has_text_container()) {\n            const editable_element = this.#get_text_container();\n            trigger_textarea_auto_resize(editable_element);\n        }\n    }\n\n    #resize_observer_handler() {\n        this.#trigger_text_container_resize();\n    }\n\n\n    // === EDITABLE ===\n\n    get editable (){\n        return this.#has_text_container();\n    }\n\n    set_editable(editable) {\n        this.removeAttribute('contenteditable');  // editability established by text container element\n        if (editable) {\n            this.#establish_editable_text_container();\n            this._tool_bar.enable_for('type', true);\n        } else {\n            this.#remove_text_container();\n            this._tool_bar.enable_for('type', false);\n        }\n    }\n\n\n    // === ACTIVE ===\n\n    get active (){\n        const attribute_element = this.#active_element_mapper ? this.#active_element_mapper(this) : this;\n        return !!attribute_element.hasAttribute(this.constructor.attribute__active);\n    }\n\n    set_active(state=false) {\n        state = !!state;\n        const attribute_element = this.#active_element_mapper ? this.#active_element_mapper(this) : this;\n        if (attribute_element.active !== state) {  // avoid creating an unnecessary dom mutation\n            if (state) {\n                attribute_element.setAttribute(this.constructor.attribute__active, true);\n            } else {\n                attribute_element.removeAttribute(this.constructor.attribute__active);\n            }\n        }\n    }\n\n    set_active_element_mapper(mapper=null) {\n        const current_active_state = this.active;\n        this.set_active(false);  // remove attribute from prior mapped element\n        this.#active_element_mapper = mapper ?? undefined;\n        this.set_active(current_active_state);  // set current state on newly-mapped element\n    }\n    #active_element_mapper;  // initially undefined\n\n\n    // === TOOL BAR ===\n\n    establish_tool_bar() {\n        if (!this._tool_bar) {\n            this._tool_bar = ToolBarElement.create_for(this, {\n                autoeval: false,\n                modified: true,\n            });\n            this.parentElement.insertBefore(this._tool_bar, this);\n        }\n    }\n\n    remove_tool_bar() {\n        if (this._tool_bar) {\n            this._tool_bar.remove();\n            this._tool_bar = undefined;\n        }\n    }\n\n\n    // === DOM ===\n\n    /** return the first and last elements in the DOM that are associated with this editor-cell\n     *  @return {Object|null} null if this is not in the DOM body, otherwise { first: Element, last: Element }\n     * This is useful if the cell and associated elements like a tool-bar are just \"loose\"\n     * in the document without any enclosing structure.\n     */\n    get_dom_extent() {\n        if (document.body === this || !document.body?.contains(this)) {\n            return null;  // indicate: not in DOM body\n        } else {\n            let first = this,\n                last  = this;\n            if (this._tool_bar) {\n                if (first.compareDocumentPosition(this._tool_bar) & Node.DOCUMENT_POSITION_PRECEDING) {\n                    first = this._tool_bar;\n                }\n                if (last.compareDocumentPosition(this._tool_bar) & Node.DOCUMENT_POSITION_FOLLOWING) {\n                    last = this._tool_bar;\n                }\n            }\n            return { first, last };\n        }\n    }\n\n    /** create a new element instance for tag this.custom_element_name with standard settings\n     *  @param {null|undefined|Object} options: {\n     *      parent?:                Node,                   // default: document.body\n     *      before?:                Node,                   // default: null\n     *      editable:               Boolean,                // set editable?  default: current logbook editable setting\n     *      innerText:              String,                 // cell text to set\n     *      active_element_mapper?: null|Element=>Element,  // mapper from an EditorCellElement to the element on which \"data-active\" will be set\n     *  }\n     *  @return {EditorCellElement} new cell  // may be a subclass of EditorCellElement depending on this.custom_element_name\n     */\n    static create_cell(options=null) {\n        const {\n            parent = document.body,\n            before = null,\n            editable = LogbookManager.singleton.editable,\n            innerText,\n            active_element_mapper,\n        } = (options ?? {});\n\n        const cell = create_element({\n            parent,\n            before,\n            tag: this.custom_element_name,\n        });\n\n        if (innerText) {\n            cell.set_text(innerText);\n        }\n        if (active_element_mapper) {\n            cell.set_active_element_mapper(active_element_mapper);\n        }\n\n        cell.establish_tool_bar();\n\n        // these settings must be done after the tool-bar is established\n        cell.set_editable(editable);\n\n        return cell;\n    }\n\n    /** return the next cell in the document with this.tagName, or null if none\n     *  @param {Boolean} forward (default false) if true, return the next cell, otherwise previous\n     *  @return {null|Element} the adjacent cell, or null if not found\n     */\n    adjacent_cell(forward=false) {\n        // note that this.tagName is a selector for elements with that tag name\n        const cells = [ ...document.querySelectorAll(this.tagName) ];\n        const index = cells.indexOf(this);\n        if (index === -1) {\n            return null;\n        } else {\n            if (forward) {\n                if (index >= cells.length-1) {\n                    return null;\n                } else {\n                    return cells[index+1];\n                }\n            } else {\n                if (index <= 0) {\n                    return null;\n                } else {\n                    return cells[index-1];\n                }\n            }\n        }\n    }\n\n    /** move (or remove) this cell within the DOM\n     *  @param {null|undefined|Object} options: {\n     *      parent?: Node,  // default: null  // new parent, or null/undefined to remove\n     *      before?: Node,  // default: null  // new before node\n     *  }\n     */\n    move_cell(options=null) {\n        const { parent, before } = validate_parent_and_before_from_options(options);\n        if (!parent) {\n            if (this.parentNode) {\n                this.remove_cell();\n            }\n        } else {\n            const had_tool_bar = !!this._tool_bar;\n            this.remove_tool_bar();\n            parent.insertBefore(this, before);\n            if (had_tool_bar) {\n                this.establish_tool_bar();\n            }\n        }\n    }\n\n    /** remove this cell from the DOM\n     */\n    remove_cell() {\n        this.remove_tool_bar();\n        this.remove();\n    }\n\n    /** reset the cell; this base class version does nothing\n     *  @return {EvalCellElement} this\n     */\n    reset() {\n        return this;\n    }\n\n\n    // === FOCUS LISTENERS / ACTIVE ===\n\n    #connect_focus_listeners() {\n        function focus_handler(event) {\n            // LogbookManager.singleton.set_active_cell() clears/sets the \"active\" attributes of cells\n            LogbookManager.singleton.set_active_cell(this);\n            if (this.#has_text_container()) {\n                this.#get_text_container().focus();\n            }\n        }\n        const listener_specs = [\n            [ this, 'focus', focus_handler, { capture: true } ],\n        ];\n        for (const [ target, type, listener, options ] of listener_specs) {\n            this.#event_listener_manager.add(target, type, listener, options);\n        }\n    }\n\n\n    // === WEB COMPONENT LIFECYCLE ===\n\n    #update_for_connected() {\n        this.#event_listener_manager.attach();\n        this.removeAttribute('tabindex');  // focusable parent for textarea causes SHIFT-Tab not to work\n        // trigger resize in case this could not be performed ebfore when \"editable\" was set,\n        // probably because the element was not yet connected to the DOM at that time.\n        // setTimeout() is used to make sure the computed styles are available (at this point they are not).\n        setTimeout(() => this.#trigger_text_container_resize());\n    }\n\n    #update_for_disconnected() {\n        this.#event_listener_manager.detach();\n    }\n\n    // connectedCallback:\n    //     Invoked each time the custom element is appended into a document-connected element.\n    //     This will happen each time the node is moved, and may happen before the element's contents have been fully parsed.\n    //     Note: connectedCallback may be called once your element is no longer connected, use Node.isConnected to make sure.\n    connectedCallback() {\n        this.#update_for_connected();\n    }\n\n    // disconnectedCallback:\n    //     Invoked each time the custom element is disconnected from the document's DOM.\n    disconnectedCallback() {\n        this.#update_for_disconnected();\n    }\n\n    // adoptedCallback:\n    //     Invoked each time the custom element is moved to a new document.\n    adoptedCallback() {\n        this.#update_for_connected();\n    }\n\n    // attributeChangedCallback:\n    //     Invoked each time one of the custom element's attributes is added, removed, or changed.\n    //     Which attributes to notice change for is specified in a static get observedAttributes method\n    attributeChangedCallback(name, old_value, new_value) {\n        switch (name) {\n        case 'xyzzy': {\n            //!!!\n            break;\n        }\n        }\n        //!!!\n    }\n\n    static get observedAttributes() {\n        return [\n            'xyzzy',//!!!\n        ];\n    }\n\n\n    // === INTERNAL ===\n\n    // Safari does not support static initialization blocks in classes (at the time of writing), so do it this way:\n    static _init_static() {\n        globalThis.customElements.define(this.custom_element_name, this);\n    }\n}\n\n// Safari does not support static initialization blocks in classes (at the time of writing), so do it this way:\nEditorCellElement._init_static();\n","const current_script_url = import.meta.url;  // save for later\n\nimport {\n    create_element,\n    clear_element,\n    validate_parent_and_before_from_options,\n} from '../../lib/ui/dom-tools.js';\n\nimport {\n    LogbookManager,\n} from '../logbook-manager.js';\n\nimport {\n    EditorCellElement,\n} from '../editor-cell-element/_.js';\n\nimport {\n    Evaluator,\n} from '../evaluator/_.js';\n\nimport {\n    Stoppable,\n} from '../../lib/sys/stoppable.js';\n\nimport {\n    ToolBarElement,\n} from '../tool-bar-element/_.js';\n\nimport {\n    beep,\n} from '../../lib/ui/beep.js';\n\nimport {\n    assets_server_url,\n} from '../assets-server-url.js';\n\n// import {\n//     create_stylesheet_link,\n// } from '../../lib/ui/dom-tools.js';\nexport async function load_stylesheet() {\n    // create_stylesheet_link(document.head, new URL('./style.css', assets_server_url(current_script_url)));\n    await import('./style.css');  // webpack implementation\n}\n\n\nexport class EvalCellElement extends EditorCellElement {\n    static custom_element_name = 'eval-cell';\n\n    static #attribute__input_type        = 'data-input-type';\n    static #attribute__output_element_id = 'data-output-element-id';\n\n    get input_type (){ return this.getAttribute(this.constructor.#attribute__input_type); }\n    set input_type (input_type){\n        this.setAttribute(this.constructor.#attribute__input_type, input_type);\n        this._tool_bar?.set_type(input_type);\n    }\n\n\n    // === OUTPUT ELEMENT ===\n\n    // CSS class for output elements created by establish_output_element()\n    static get output_element_class (){ return 'eval-cell-output'; }\n\n    get output_element_id (){\n        return this.getAttribute(this.constructor.#attribute__output_element_id);\n    }\n\n    // note: handlers are not set or removed, use the output_element() setter\n    // instead if this is required.\n    // if id is not undefined or null, then an element with that id must exist in the DOM\n    set output_element_id (id){\n        if (id === null || typeof id === 'undefined' || id === '') {\n            this.setAttribute(this.constructor.#attribute__output_element_id, '');\n        } else {\n            const element = document.getElementById(id);\n            if (!element) {\n                throw new Error('element with specified id does not exist');\n            }\n            if (!(element instanceof HTMLElement)) {\n                throw new Error('element specified by id must be an instance of HTMLElement');\n            }\n            this.setAttribute(this.constructor.#attribute__output_element_id, id);\n        }\n    }\n\n    get output_element (){\n        const oid = this.output_element_id;\n        if (!oid) {\n            return null;\n        } else {\n            const element = document.getElementById(oid);\n            if (!element || !(element instanceof HTMLElement)) {\n                console.warn('bad configuration for EvalCellElement: id does not specify an HTMLElement');\n                return null;\n            } else {\n                return element;\n            }\n        }\n    }\n\n    // element must exist in the dom\n    set output_element (element){\n        element ??= null;\n        if (element && (!element.id || !(element instanceof HTMLElement))) {\n            throw new Error('element must be null, undefined, or an instance of HTMLElement with an id');\n        }\n        if (element) {\n            const element_with_element_id = document.getElementById(element.id);\n            if (element_with_element_id !== element) {\n                throw new Error('another element already exists with the same id as element');\n            }\n        }\n        this.output_element_id = element ? element.id : null;\n    }\n\n    /** create a new output element suitable for instances of this class\n     *  @param {null|undefined|Object} options: {\n     *      parent?: Node,\n     *      before?: Node,\n     *  }\n     *  @return {HTMLElement} new output element\n     */\n    static create_output_element(options=null) {\n        const {\n            parent,\n            before,\n        } = (options ?? {});\n        return create_element({\n            parent,\n            before,\n            tag: 'output',\n            set_id: true,  // output_element needs an id for reference by its eval-cell\n            attrs: {\n                class: [ this.output_element_class ],\n            },\n        });\n    }\n\n    /** create an output element, if necessary, and set its standard attributes\n     *  @return {HTMLElement} output element;\n     */\n    establish_output_element() {\n        let output_element = this.output_element;\n        if (!output_element) {\n            const dom_extent = this.get_dom_extent();\n            const before = dom_extent ? dom_extent.last.nextSibling : this.nextSibling;\n            const parent = before?.parentElement ?? this.parentElement;\n            this.output_element = this.constructor.create_output_element({ parent, before });\n        }\n        output_element.classList.add(this.constructor.output_element_class);  // ensure that required class is set\n        return output_element;\n    }\n\n    /** remove the output_element, if any, from this eval-cell and from the DOM\n     *  @return {EvalCellElement} this\n     */\n    remove_output_element() {\n        const output_element = this.output_element;\n        if (output_element) {\n            this.output_element = null;\n            output_element.remove();\n        }\n        return this;\n    }\n\n\n    // === OUTPUT ELEMENT AWARE OVERRIDES ===\n\n    /** move (or remove) this cell within the DOM\n     *  @param {null|undefined|Object} options: {\n     *      parent?: Node,  // default: null  // new parent, or null/undefined to remove\n     *      before?: Node,  // default: null  // new before node\n     *  }\n     */\n    move_cell(options=null) {\n        const { parent, before } = validate_parent_and_before_from_options(options);\n        const output_element = this.output_element;\n        const output_element_precedes = output_element && !!(this.compareDocumentPosition(output_element) & Node.DOCUMENT_POSITION_PRECEDING);\n        super.move_cell(options);\n        // if !parent, then cell and output_element will have  been removed\n        if (parent && output_element) {\n            const element_after_output = output_element_precedes ? this : before;\n            parent.insertBefore(output_element, element_after_output);\n        }\n    }\n\n    /** override of EditorCellElement.remove_cell().\n     *  remove this cell and its output_element, if any, from the DOM\n     */\n    remove_cell() {\n        this.remove_output_element();\n        super.remove_cell();\n    }\n\n    /** reset the cell; remove the output_element, if any\n     *  @return {EvalCellElement} this\n     */\n    reset() {\n        super.reset();\n        const output_element = this.output_element;\n        if (!output_element) {\n            this.establish_output_element();\n        } else {\n            clear_element(output_element);\n        }\n        return this;\n    }\n\n    // === EVAL ===\n\n    /** evaluate the contents of this element\n     *  @param {null|undefined|Object} options: {\n     *      evaluator_class?: Evaluator,  // evaluator class to use\n     *      eval_context?:    Object,     // default: a new {}; will be \"this\" during expression evaluation.\n     *  }\n     *  @return {Promise} promise returned by evaluator_class eval method\n     * If evaluator_class is not given, then Evaluator.class_for_content() is called to get one.\n     */\n    async eval(options=null) {  // options: { evaluator_class?, output_element?, eval_context? }\n        const {\n            evaluator_class: evaluator_class_from_options,\n            eval_context,\n        } = (options ?? {});\n\n        const evaluator_class = evaluator_class_from_options ?? Evaluator.class_for_content(this);\n\n        if (!(evaluator_class === Evaluator || evaluator_class.prototype instanceof Evaluator)) {\n            throw new Error('evaluator_class must be an instance of Evaluator');\n        }\n\n        // stop current evaluator, if any\n        this.stop();  // clears this.#evaluator_stoppable\n\n        const output_element = this.establish_output_element();  // return existing or create\n        clear_element(output_element);\n\n        // allocate the evaluator, store it, then eval\n        const evaluator = new evaluator_class(this, output_element, eval_context);\n\n        this.#evaluator_stoppable = new Stoppable(evaluator);  // already cleared by this.stop() above\n        this.#evaluator_foreground = true;\n        this._tool_bar?.set_for('running', true);\n        LogbookManager.singleton.emit_eval_state(this, true);\n\n        // yield momentarily so that running indicator ui will be drawn before we eval\n        await new Promise(resolve => setTimeout(resolve));\n\n        return evaluator._perform_eval()\n            .then(() => {\n                this.#evaluator_foreground = undefined;\n                this._tool_bar?.set_for('running', false);\n                LogbookManager.singleton.emit_eval_state(this, false);\n            })\n            .catch(error => {\n                this.stop();  // stop anything that may have been started\n                return evaluator.ocx.render_error(error);\n            });\n    }\n    #evaluator_foreground;  // true iff evaluating and before return\n    #evaluator_stoppable;\n\n    /** @return true iff an evaluation is running and has not yet returned\n     */\n    get evaluator_foreground (){ return !!this.#evaluator_foreground; }\n\n    /** @return true iff an evaluation has run and returned (but may still have pending asynchonous evaluations)\n     */\n    get can_stop (){ return !!this.#evaluator_stoppable; }\n\n    stop() {\n        if (this.#evaluator_stoppable) {\n            try {\n                this.#evaluator_stoppable.stop();\n            } catch (error) {\n                console.warn('error stopping evaluator', error, this.#evaluator_stoppable);\n                // continue...\n            }\n        }\n        this.#evaluator_stoppable  = undefined;\n        this.#evaluator_foreground = undefined;\n        this._tool_bar?.set_for('running', false);\n        LogbookManager.singleton.emit_eval_state(this, false);\n    }\n\n    establish_tool_bar() {  // override of EditorCellElement.establish_tool_bar()\n        if (!this._tool_bar) {\n            let initial_type = this.input_type || undefined;\n            this._tool_bar = ToolBarElement.create_for(this, {\n                autoeval: false,\n                type: {\n                    ...(initial_type ? { initial: initial_type } : {}),\n                    on: (event) => {\n                        this.input_type = event.target.value;\n                        return true;\n                    },\n                },\n                running:  true,\n                modified: false,\n                run:      false,\n            });\n            this.parentElement.insertBefore(this._tool_bar, this);\n        }\n    }\n\n    // === DOM ===\n\n    /** create a new EvalCellElement instance with standard settings\n     *  @param {null|undefined|Object} options: {\n     *      // options for EditorCellElement.create_cell()\n     *      parent?:   Node,     // default: document.body\n     *      before?:   Node,     // default: null\n     *      innerText: String,   // cell.innerText to set\n     *\n     *      // options for this.create_cell()\n     *      output_element: {HTMLElement} output_element to use\n     *  }\n     *  @return {EvalCellElement} new cell\n     */\n    static create_cell(options=null) {\n        const {\n            output_element,\n        } = (options ?? {});\n        const cell = super.create_cell(options);\n        // all cells are ensured to have output elements (for layout coherence)\n        if (output_element) {\n            cell.output_element = output_element;\n        } else {\n            cell.establish_output_element();\n        }\n        return cell;\n    }\n\n    /** return the first and last elements in the DOM that are associated with this eval-cell\n     *  @return {Object|null} null if this is not in the DOM body, otherwise { first: Element, last: Element }\n     */\n    get_dom_extent() {\n        if (document.body === this || !document.body?.contains(this)) {\n            return null;  // indicate: not in DOM body\n        } else {\n            let { first, last } = super.get_dom_extent();\n            const output_element = this.output_element;\n            if (output_element) {\n                if (first.compareDocumentPosition(output_element) & Node.DOCUMENT_POSITION_PRECEDING) {\n                    first = output_element;\n                }\n                if (last.compareDocumentPosition(output_element) & Node.DOCUMENT_POSITION_FOLLOWING) {\n                    last = output_element;\n                }\n            }\n            return { first, last };\n        }\n    }\n\n\n    // === INTERNAL ===\n\n    // Safari does not support static initialization blocks in classes (at the time of writing), so do it this way:\n    static _init_static() {\n        // Error when using the \"extends\" property on Chromium 112.0.5615.49:\n        //     caught DOMException: Failed to execute 'define' on 'CustomElementRegistry': \"eval-cell\" is a valid custom element name at EvalCellElement._init_static\n        // This is probably correct.  The documentation for customElements.define() states:\n        //     extends: String specifying the name of a built-in element to extend.\n        // built-in element, not custom element\n        const options = {\n            //!!! extends: EditorCellElement.custom_element_name,\n        };\n        globalThis.customElements.define(this.custom_element_name, this, options);\n    }\n}\n\n// Safari does not support static initialization blocks in classes (at the time of writing), so do it this way:\nEvalCellElement._init_static();\n","// Evaluator is defined in a separate file to break dependency cycle in get_evaluator_classes()\nexport {\n    Evaluator,\n} from './evaluator.js';\n\nimport { MarkdownEvaluator   } from './markdown-evaluator.js';\nimport { TeXEvaluator        } from './tex-evaluator.js';\nimport { JavaScriptEvaluator } from './javascript-evaluator.js';\n\n/** return an array of all known evaluator classes, with the first entry being considered as the \"default\"\n *  @return {String[]} array of evaluator classes\n */\nexport function get_evaluator_classes() {\n    return [\n        MarkdownEvaluator,  // first entry is the default\n        TeXEvaluator,\n        JavaScriptEvaluator,\n    ];\n}\n","import {\n    generate_uuid,\n} from '../../lib/sys/uuid.js';\n\nimport {\n    StoppableObjectsManager,\n} from '../../lib/sys/stoppable.js';\n\nimport {\n    OutputContext,\n} from '../output-context.js';\n\nimport {\n    get_evaluator_classes,\n} from './_.js';\n\n\nexport class Evaluator extends StoppableObjectsManager {\n    /** Call this function instead of constructing an instance with new.\n     *  @param {HTMLElement} input_element the source element\n     *  @param {HTMLElement} output_element the destination element\n     *  @param {undefined|null|Object} eval_context, default {}\n     *  @return {Promise} resolves to the new instance after its\n     *          _perform_eval method resolves.  Note that the return\n     *          of the _perform_eval method does not necessarily mean\n     *          that the evaluation is \"done\".\n     * If an object is passed as eval_context, then that object may be modified\n     * as a result of the evaluation.  This is the basis for persistence of\n     * state across evaluations.\n     */\n    static async eval(input_element, output_element, eval_context=null) {\n        const instance = new this(input_element, output_element, eval_context);\n        return instance._perform_eval()\n            .catch(error => instance.ocx.render_error(error));\n    }\n\n    // do not call the constructor via new, instead use the static async method Evaluator.eval()\n    constructor(input_element, output_element, eval_context) {\n        super();\n        if (!(input_element instanceof HTMLElement)) {\n            throw new Error('input_element must be an instance of HTMLElement');\n        }\n        if (!(output_element instanceof HTMLElement)) {\n            throw new Error('output_element must be an instance of HTMLElement');\n        }\n\n        eval_context ??= {};\n        if (typeof eval_context !== 'object') {\n            throw new Error('eval_context must be undefined, null, or an object');\n        }\n\n        const ocx = new OutputContext(output_element);\n\n        Object.defineProperties(this, {\n            id: {\n                value: generate_uuid(),\n                enumerable: true,\n            },\n            input_element: {\n                value: input_element,\n                enumerable: true,\n            },\n            output_element: {\n                value: output_element,\n                enumerable: true,\n            },\n            eval_context: {\n                value: eval_context,\n                enumerable: true,\n            },\n            ocx: {\n                value: ocx,\n                enumerable: true,\n            },\n        });\n    }\n\n    async _perform_eval() {\n        // to be implemented by subclasses\n        // exceptions thrown out of this function will be handled in this.constructor.eval()\n        throw new Error('NOT IMPLEMENTED');\n    }\n\n\n    // === RECOGNIZER ===\n\n    /** array of input_type strings for input types handled by this evaluator\n     *  must be overridden in subclasses\n     */\n    static handled_input_types = [];\n\n    /** return an evauluator class for a given input_element\n     *  @param {Element} input_element\n     *  @return {Class} evaluator class\n     */\n    static class_for_content(input_element) {\n        if (!(input_element instanceof Element)) {\n            throw new Error('input_element must be an instance of Element');\n        }\n\n        const evaluator_classes = get_evaluator_classes();\n\n        const default_evaluator_class = evaluator_classes[0];\n\n        // check if there is an evaluator that handles the input_element input_type\n        const input_type = input_element.input_type;\n        if (input_type) {\n            // use the first evaluator that handles a specifically-set\n            // input_type on the input_element\n            for (const evaluator_class of evaluator_classes) {\n                if (evaluator_class.handled_input_types.includes(input_type)) {\n                    return evaluator_class;\n                }\n            }\n        }\n\n        return default_evaluator_class;\n    }\n}\n","import {\n    Evaluator,\n} from './evaluator.js';\n\nimport {\n    Stoppable,\n} from '../../lib/sys/stoppable.js';\n\n\nexport class JavaScriptEvaluator extends Evaluator {\n    static handled_input_types = [\n        'javascript',\n    ];\n\n    async _perform_eval() {\n        const options = {\n            style:  undefined,//!!!\n            eval_context: this.eval_context,\n        };\n        const renderer = this.ocx.renderer_for_type('javascript');\n        this.add_stoppable(new Stoppable(renderer));\n        const code = this.input_element.get_text();\n        return this.ocx.invoke_renderer(renderer, code, options);\n    }\n}\n","import {\n    Evaluator,\n} from './evaluator.js';\n\nimport {\n    Stoppable,\n} from '../../lib/sys/stoppable.js';\n\n\nexport class MarkdownEvaluator extends Evaluator {\n    static handled_input_types = [\n        'markdown',\n    ];\n\n    async _perform_eval() {\n        const options = {\n            //!!!\n        };\n        const renderer = this.ocx.renderer_for_type('markdown');\n        this.add_stoppable(new Stoppable(renderer));\n        return this.ocx.invoke_renderer(renderer, this.input_element.get_text(), options);\n    }\n}\n","import {\n    Evaluator,\n} from './evaluator.js';\n\nimport {\n    Stoppable,\n} from '../../lib/sys/stoppable.js';\n\n\nexport class TeXEvaluator extends Evaluator {\n    static handled_input_types = [\n        'tex',\n    ];\n\n    async _perform_eval() {\n        const options = {\n            style:  undefined,//!!!\n            inline: false,//!!!\n            rtl:    false,//!!!\n        };\n        const renderer = this.ocx.renderer_for_type('tex');\n        this.add_stoppable(new Stoppable(renderer));\n        return this.ocx.invoke_renderer(renderer, this.input_element.get_text(), options);\n    }\n}\n","/** return the initial menu specification\n *  @return {Object} menu specification\n */\nexport function get_menubar_spec() {\n    return [\n        { label: 'File', collection: [\n            { label: 'Recent logbooks', id: 'recents', collection: [\n                // ...\n            ] },\n            '---',\n            { label: 'Reset cells',     item: { command: 'reset',            }, id: 'reset' },\n            { label: 'Clear document',  item: { command: 'clear',            }, id: 'clear' },\n            '---',\n            { label: 'Save',            item: { command: 'save',             }, id: 'save' },\n            { label: 'Save as...',      item: { command: 'save-as',          } },\n            '---',\n            { label: 'Settings...',     item: { command: 'settings',         } },\n        ] },\n\n        { label: 'Cell', collection: [\n            { label: 'Eval',            item: { command: 'eval-and-refocus', }, id: 'eval-and-refocus' },\n            { label: 'Eval and stay',   item: { command: 'eval',             }, id: 'eval' },\n            { label: 'Eval before',     item: { command: 'eval-before',      }, id: 'eval-before' },\n            { label: 'Eval all',        item: { command: 'eval-all',         }, id: 'eval-all' },\n            '---',\n            { label: 'Stop cell',       item: { command: 'stop',             }, id: 'stop' },\n            { label: 'Stop all',        item: { command: 'stop-all',         }, id: 'stop-all' },\n            '---',\n            { label: 'Reset cell',      item: { command: 'reset-cell',       }, id: 'reset-cell' },\n            '---',\n            { label: 'Focus up',        item: { command: 'focus-up',         }, id: 'focus-up' },\n            { label: 'Focus down',      item: { command: 'focus-down',       }, id: 'focus-down' },\n            '---',\n            { label: 'Move up',         item: { command: 'move-up',          }, id: 'move-up' },\n            { label: 'Move down',       item: { command: 'move-down',        }, id: 'move-down' },\n            { label: 'Add before',      item: { command: 'add-before',       }, id: 'add-before' },\n            { label: 'Add after',       item: { command: 'add-after',        }, id: 'add-after' },\n            { label: 'Delete',          item: { command: 'delete',           }, id: 'delete' },\n            '---',\n            { label: 'Shrink inputs',   item: { command: 'shrink-inputs',    }, id: 'shrink-inputs' },\n            { label: 'Enlarge inputs',  item: { command: 'enlarge-inputs',   }, id: 'enlarge-inputs' },\n            { label: 'Collapse inputs', item: { command: 'collapse-inputs',  }, id: 'collapse-inputs' },\n            { label: 'Expand inputs',   item: { command: 'expand-inputs',    }, id: 'expand-inputs' },\n        ] },\n\n        { label: 'Help', collection: [\n            { label: 'Help...',         item: { command: 'help',             } },\n        ] },\n    ];\n}\n\n\n/** return the initial key map bindings\n *  @return {Object} mapping from command strings to arrays of triggering key sequences\n */\nexport function get_global_initial_key_map_bindings() {\n    return {\n        'create-cell':         [ 'CmdOrCtrl-Shift-Alt-N' ],\n\n        'reset-cell':          [ ],\n        'reset':               [ ],\n        'clear':               [ ],\n\n        'save':                [ 'CmdOrCtrl-S' ],\n        'save-as':             [ 'CmdOrCtrl-Shift-S' ],\n\n        'eval':                [ 'CmdOrCtrl-Enter' ],\n        'eval-and-refocus':    [ 'Shift-Enter' ],\n        'eval-before':         [ 'CmdOrCtrl-Shift-Enter' ],\n        'eval-all':            [ 'CmdOrCtrl-Shift-Alt-Enter' ],\n\n        'stop':                [ 'CmdOrCtrl-Alt-!' ],\n        'stop-all':            [ 'CmdOrCtrl-Shift-Alt-!' ],\n\n        'focus-up':            [ 'Alt-Up' ],\n        'focus-down':          [ 'Alt-Down' ],\n\n        'move-up':             [ 'CmdOrCtrl-Alt-Up' ],\n        'move-down':           [ 'CmdOrCtrl-Alt-Down' ],\n        'add-before':          [ 'CmdOrCtrl-Alt-Shift-Up' ],\n        'add-after':           [ 'CmdOrCtrl-Alt-Shift-Down' ],\n        'delete':              [ 'CmdOrCtrl-Alt-Backspace' ],\n\n        'set-mode-markdown':   [ 'Alt-M m' ],\n        'set-mode-tex':        [ 'Alt-M t' ],\n        'set-mode-javascript': [ 'Alt-M j' ],\n\n        'shrink-inputs':       [ 'CmdOrCtrl-Alt-Left' ],\n        'enlarge-inputs':      [ 'CmdOrCtrl-Alt-Right' ],\n        'collapse-inputs':     [ 'CmdOrCtrl-Shift-Alt-Left' ],\n        'expand-inputs':       [ 'CmdOrCtrl-Shift-Alt-Right' ],\n\n        'settings':            [ 'CmdOrCtrl-,' ],\n        'help':                [ ],\n    };\n}\n\n/** return global command bindings\n *  @param {Object} implementor of command_handlers\n *  @return {Object} mapping from command strings to functions implementing that command\n * The handler functions are taken from the implementor argument.\n */\nexport function get_global_command_bindings(implementor) {\n    const command_bindings = {\n        'create-cell':         implementor.command_handler__create_cell,\n\n        'reset-cell':          implementor.command_handler__reset_cell,\n        'reset':               implementor.command_handler__reset,\n        'clear':               implementor.command_handler__clear,\n\n        'save':                implementor.command_handler__save,\n        'save-as':             implementor.command_handler__save_as,\n\n        'eval':                implementor.command_handler__eval,\n        'eval-and-refocus':    implementor.command_handler__eval_and_refocus,\n        'eval-before':         implementor.command_handler__eval_before,\n        'eval-all':            implementor.command_handler__eval_all,\n\n        'stop':                implementor.command_handler__stop,\n        'stop-all':            implementor.command_handler__stop_all,\n\n        'focus-up':            implementor.command_handler__focus_up,\n        'focus-down':          implementor.command_handler__focus_down,\n\n        'move-up':             implementor.command_handler__move_up,\n        'move-down':           implementor.command_handler__move_down,\n        'add-before':          implementor.command_handler__add_before,\n        'add-after':           implementor.command_handler__add_after,\n        'delete':              implementor.command_handler__delete,\n\n        'set-mode-markdown':   implementor.command_handler__set_mode_markdown,\n        'set-mode-tex':        implementor.command_handler__set_mode_tex,\n        'set-mode-javascript': implementor.command_handler__set_mode_javascript,\n\n        'shrink-inputs':       implementor.command_handler__shrink_inputs,\n        'enlarge-inputs':      implementor.command_handler__enlarge_inputs,\n        'collapse-inputs':     implementor.command_handler__collapse_inputs,\n        'expand-inputs':       implementor.command_handler__expand_inputs,\n\n        'settings':            implementor.command_handler__show_settings_dialog,\n        'help':                implementor.command_handler__show_help,\n    };\n\n    // bind \"this\" for the implemented functions\n    for (const command in command_bindings) {\n        command_bindings[command] = command_bindings[command].bind(implementor);\n    }\n\n    return command_bindings;\n}\n","const current_script_url = import.meta.url;  // save for later\n\nimport {\n    assets_server_url,\n} from './assets-server-url.js';\n\n\nexport function open_help_window() {\n    window.open(new URL('../help.html', assets_server_url(current_script_url)));\n}\n","// ensure that the various custom elements have been defined\n// this is not entirely necessary but gets stylesheets, etc loaded right away\nimport './toggle-switch-element/_.js';\nimport './tool-bar-element/_.js';\nimport './editor-cell-element/_.js';\nimport './eval-cell-element/_.js';\n\nimport {\n    LogbookManager,\n} from './logbook-manager.js';\n\n\nif (document.readyState === 'interactive' || document.readyState === 'complete') {\n    trigger_document_initialization();\n} else {\n    window.addEventListener('load', (load_event) => {\n        trigger_document_initialization();\n    }, {\n        once: true,\n    });\n}\n\nfunction trigger_document_initialization() {\n    LogbookManager.singleton;  // accessing this getter will trigger document initialization\n\n    const {\n        view_var_name,\n        view_var_value_edit,\n        view_var_value_output,\n        autoeval_var_name,\n    } = LogbookManager;\n\n    // update view according to parameter\n    const view_value = new URLSearchParams(document.location.search).get(view_var_name)  // from URL search\n          ?? document.body?.getAttribute(view_var_name)                                  // from document.body\n          ?? document.documentElement.getAttribute(view_var_name);                       // from document.documentElement\n\n    const autoeval_value = new URLSearchParams(document.location.search).get(autoeval_var_name)  // from URL search\n          ?? document.body?.getAttribute(autoeval_var_name)                                      // from document.body\n          ?? document.documentElement.getAttribute(autoeval_var_name);                           // from document.documentElement\n\n    switch (view_value) {\n    case view_var_value_edit:   LogbookManager.singleton.expand_input_output_split(true); break;\n    case view_var_value_output: LogbookManager.singleton.collapse_input_output_split();   break;\n\n    default: {\n        if (view_value) {\n            console.warn(`ignored unknown \"${view_var_name}\" parameter \"${view_value}\"`);\n        }\n        break;\n    }\n    }\n\n    if (autoeval_value || autoeval_value === '') {\n        switch (autoeval_value) {\n        case false.toString(): break;\n\n        default: {\n            LogbookManager.singleton.inject_command('eval-all');\n            break;\n        }\n        }\n    }\n\n    globalThis.logbook_manager = LogbookManager.singleton;//!!!\n}\n","import {\n    EvalCellElement,\n} from './eval-cell-element/_.js';\n\nimport {\n    ToolBarElement,\n} from './tool-bar-element/_.js';\n\nimport {\n    Subscribable,\n} from '../lib/sys/subscribable.js';\n\nimport {\n    StoppableObjectsManager,\n} from '../lib/sys/stoppable.js';\n\nimport {\n    KeyEventManager,\n    KeyMap,\n} from '../lib/ui/key/_.js';\n\nimport {\n    get_global_command_bindings,\n    get_global_initial_key_map_bindings,\n    get_menubar_spec,\n} from './global-bindings.js';\n\nimport {\n    create_element,\n    clear_element,\n    move_node,\n} from '../lib/ui/dom-tools.js';\n\nimport {\n    Renderer,\n} from './renderer/_.js';\n\nimport {\n    MenuBar,\n} from '../lib/ui/menu/_.js';\n\nimport {\n    SettingsDialog,\n} from './settings/_.js';\n\nimport {\n    ConfirmDialog,\n} from '../lib/ui/dialog/_.js';\n\nimport {\n    fs_interface,\n} from '../lib/sys/fs-interface.js';\n\nimport {\n    beep,\n} from '../lib/ui/beep.js';\n\nimport {\n    open_help_window,\n} from './help-window.js';\n\nimport {\n    assets_server_url,\n} from './assets-server-url.js';\n\n\n// import {\n//     create_stylesheet_link,\n// } from '../lib/ui/dom-tools.js';\n// {\n//     const server_url = assets_server_url(current_script_url);  // current_script_url is from initial import.meta.url\n//     create_stylesheet_link(document.head, new URL('./style.css',       server_url));\n//     create_stylesheet_link(document.head, new URL('./style-hacks.css', server_url));\n// }\nimport './style.css';        // webpack implementation\nimport './style-hacks.css';  // webpack implementation\n\n\nexport class LogbookManager {\n    static get singleton() {\n        if (!this.#singleton) {\n            this.#singleton = new this();\n            this.#singleton.initialize();\n        }\n        return this.#singleton;\n    }\n    static #singleton;\n\n    // document variables\n    static view_var_name         = 'view';\n    static view_var_value_edit   = 'edit';\n    static view_var_value_output = 'output';\n\n    static autoeval_var_name     = 'autoeval';\n\n\n    constructor() {\n        this.#editable = true;\n        this.#active_cell = null;\n        this.#initialize_called = false;\n\n        this.reset_global_eval_context();\n\n        this.#eval_states = new Subscribable();  //!!! this.#eval_states_subscription is never unsubscribed\n        this.#eval_states_subscription = this.#eval_states.subscribe(this.#eval_states_observer.bind(this));\n\n        this.#command_bindings = get_global_command_bindings(this);\n\n        this.#key_event_manager = new KeyEventManager(window, this.#command_observer.bind(this));\n        const key_map = new KeyMap(get_global_initial_key_map_bindings());\n        this.push_key_map(key_map);\n        this.#key_event_manager.attach();\n\n        this.#multi_eval_manager = null;\n    }\n    #editable;\n    #active_cell;\n    #initialize_called;\n    #global_eval_context;  // persistent eval_context for eval commands\n    #header_element;  // element inserted into document by initialize() to hold menus, etc\n    #eval_states;\n    #eval_states_subscription;\n    #command_bindings;\n    #key_event_manager;\n    #main_element;  // element wrapped around original body content by initialize()\n    #tool_bar;\n    #resize_handle_element;  // resize element; created in this.#initialize_document_structure()\n    #menubar;\n    #menubar_commands_subscription;\n    #menubar_selects_subscription;\n    #file_handle;\n    #multi_eval_manager;  // used by, e.g., command_handler__eval_all()\n\n    static resize_handle_class                = 'resize-handle';\n    static resize_handle_dragging_state_class = 'dragging';\n    static collapse_cells_state_class         = 'collapse-cells';\n    static input_output_split_css_variable    = '--input-output-split';\n    static is_stacked_css_variable            = '--is-stacked';\n\n    // these ratios are with respect to the width of the main element\n    static max_split_ratio       = 0.85;   // always leave some room for output elements\n    static collapse_split_ratio  = 0.001;  // point at which cell contents collapses, leaving only output showing\n    static split_step_size_ratio = 0.05;   // amount to shrink or enlarge the current split\n    static split_neutral_ratio   = 0.50;   // \"neutral\" split position\n\n    get header_element (){ return this.#header_element; }\n    get main_element   (){ return this.#main_element; }\n\n    get editable (){ return this.#editable; }\n    set_editable(editable) {\n        editable = !!editable;  // ensure Boolean\n        this.#editable = editable;\n        for (const cell of this.constructor.get_cells()) {\n            cell.set_editable(editable);\n        }\n    }\n\n    get active_cell (){ return this.#active_cell; }\n    set_active_cell(cell) {\n        this.#active_cell = (cell ?? null);\n        for (const cell of this.constructor.get_cells()) {\n            cell.set_active(cell === this.active_cell);\n        }\n    }\n\n    /** return an ordered list of the EvalCellElement (eval-cell) cells in the document\n     *  @return {Array} the cells in the document\n     * Note that EditorCellElement elements are not returned even though\n     * EditorCellElement is a base class of EvalCellElement.  This is not ambiguous\n     * because they have different tag names (editor-cell vs eval-cell).\n     */\n    static get_cells() {\n        return [ ...document.getElementsByTagName(EvalCellElement.custom_element_name) ];\n    }\n\n    get global_eval_context (){ return this.#global_eval_context; }\n    reset_global_eval_context() {\n        this.#global_eval_context = {};\n    }\n\n    /** reset the document, meaning that all cells will be reset,\n     *  and this.global_eval_context will be reset.  Also, the\n     *  saved file handle this.#file_handle set to undefined.\n     *  @return {LogbookManager} this\n     */\n    reset() {\n        this.stop();\n        Renderer.reset_classes();\n        this.reset_global_eval_context();\n        this.#file_handle = undefined;\n        for (const cell of this.constructor.get_cells()) {\n            cell.reset();\n        }\n        return this;\n    }\n\n    /** clear the current document\n     */\n    clear() {\n        this.reset();\n        clear_element(this.main_element);\n        this.main_element.appendChild(this.#resize_handle_element);  // add resize handle back\n        const first_cell = this.create_cell();\n        first_cell.focus();\n        this.set_active_cell(first_cell);  // focus sets active_cell but asynchronously, so set active_cell explicitly\n        this.expand_input_output_split();  // ensure that new new empty cell is visible to the user\n    }\n\n    stop() {\n        try {\n            this.#multi_eval_manager?.stop();\n            this.#multi_eval_manager = null;\n        } catch (error) {\n            console.warn('error while stopping this.#multi_eval_manager', this.#multi_eval_manager, error);\n        }\n\n        for (const cell of this.constructor.get_cells()) {\n            try {\n                cell.stop();\n            } catch (error) {\n                console.warn('error while stopping cell', cell, error);\n            }\n        }\n    }\n\n    initialize() {\n        if (this.#initialize_called) {\n            throw new Error('initialize() called more than once');\n        }\n        this.#initialize_called = true;\n\n        try {\n\n            // establish this.#main_element / this.main_element\n            this.#initialize_document_structure();\n\n            this.#setup_csp();\n            this.#setup_header();\n\n            this.set_editable(this.editable);  // update all cells consistently\n\n            // validate structure of document\n            const cells = this.constructor.get_cells();\n            if (cells.length > 0) {\n//!!! improve this or eliminate !!!\n            }\n\n            // ensure all incoming cells have output elements (for layout coherence)\n            for (const cell of cells) {\n//!!! review this !!!\n                cell.establish_output_element();\n            }\n\n            // set up active cell\n            // ... find the first incoming \"active\" cell, or the first cell, or create a new cell\n            const active_cell = cells.find(cell => cell.active) ?? cells[0] ?? this.create_cell();\n            this.set_active_cell(active_cell);  // also resets \"active\" tool on all cells except for active_cell\n            active_cell.focus();\n\n            // add event handler for this.#resize_handle_element\n            this.#resize_handle_element.addEventListener('mousedown', (event) => this.#enter_resize_mode(event));  //!!! event handler never removed\n\n            // add \"changes may not be saved\" prompt for when document is being closed while modified\n            window.addEventListener('beforeunload', (event) => {\n                if (true/*!!! always warn for now !!!*/) {\n                    event.preventDefault();\n                    return (event.returnValue = '');\n                }\n            });  //!!! event handler never removed\n\n        } catch (error) {\n            show_initialization_failed(error);\n        }\n    }\n\n\n    // === KEY MAP STACK ===\n\n    reset_key_map_stack() {\n        this.#key_event_manager.reset_key_map_stack();\n    }\n    push_key_map(key_map) {\n        this.#key_event_manager.push_key_map(key_map);\n    }\n    pop_key_map() {\n        return this.#key_event_manager.pop_key_map();\n    }\n    remove_key_map(key_map, remove_subsequent_too=false) {\n        return this.#key_event_manager.remove_key_map(key_map, remove_subsequent_too);\n    }\n\n\n    // === DOCUMENT STRUCTURE ===\n\n    static header_element_tag = 'header';\n    static main_element_tag   = 'main';\n\n    /** create a new cell in the document\n     *  @param (Object|null|undefined} options\n     *  @return {EvalCellElement} cell\n     * options is passed to EvalCellElement.create_cell() but\n     * with \"parent\", \"before\" and \"output_element\" overridden.\n     * The new cell is put within an element structure.\n     * \"parent\" and \"before\" are used to create the cell structure,\n     * and \"output_element\" and \"active_element_mapper\" are ignored.\n     */\n    create_cell(options=null) {\n        options ??= {};\n        if (options.output_element) {\n            console.warn('options.output_element ignored');\n        }\n        if (options.active_element_mapper) {\n            console.warn('options.active_element_mapper ignored');\n        }\n        const {\n            parent,\n            before,\n        } = options;\n        const {\n            cell_parent,\n            cell_before,\n            output_element_parent,\n            output_element_before,\n        } = this.#create_cell_element_structure({ parent, before });\n        const output_element = EvalCellElement.create_output_element({\n            parent: output_element_parent,\n            before: output_element_before,\n        });\n        const cell = EvalCellElement.create_cell({\n            editable: this.editable,\n            ...options,\n            parent: cell_parent,\n            before: cell_before,\n            output_element,\n            active_element_mapper: this.constructor.active_element_mapper.bind(this.constructor),\n        });\n        return cell;\n    }\n\n    // put everything in the body into a new top-level main element\n    #initialize_document_structure() {\n        if (document.querySelector(this.constructor.header_element_tag)) {\n            throw new Error(`bad format for document: element with id ${this.constructor.header_element_tag} already exists`);\n        }\n        if (document.querySelector(this.constructor.main_element_tag)) {\n            throw new Error(`bad format for document: element with id ${this.constructor.main_element_tag} already exists`);\n        }\n\n        // establish head element if not already present\n        if (!document.head) {\n            document.documentElement.insertBefore(document.createElement('head'), document.documentElement.firstChild);\n            // document.head is now set\n        }\n        // establish favicon\n        if (!document.querySelector('link[rel=\"icon\"]')) {\n            create_element({\n                parent: document.head,\n                tag:    'link',\n                attrs: {\n                    rel: 'icon',\n                    href: assets_server_url('dist/favicon.ico'),\n                },\n            });\n        }\n        // establish body element if not already present\n        if (!document.body) {\n            document.documentElement.appendChild(document.createElement('body'));\n            // document.body is now set\n        }\n        // create the main element and move the current children of the body to it\n        this.#main_element = document.createElement(this.constructor.main_element_tag);\n        // create the this.#resize_handle_element element as the first child of this.#main_element\n        this.#resize_handle_element = create_element({\n            parent: this.#main_element,\n            attrs: {\n                class: [ this.constructor.resize_handle_class ],\n            },\n        });\n        // move the cells and their associated output_elements (if any)\n        for (const cell of document.querySelectorAll(EvalCellElement.custom_element_name)) {\n            const {\n                cell_parent,\n                cell_before,\n                output_element_parent,\n                output_element_before,\n            } = this.#create_cell_element_structure({ parent: this.#main_element });\n            cell_parent.insertBefore(cell, cell_before);  // moves cell\n            const output_element = cell.output_element;\n            if (output_element) {\n                output_element_parent.insertBefore(output_element, output_element_before);  // moves output_element\n            } else {\n                // create output_element if none exists\n                cell.output_element = EvalCellElement.create_output_element({\n                    parent: output_element_parent,\n                    before: output_element_before,\n                });\n            }\n            // don't call cell.set_active_element_mapper() before the cell's structure is established\n            cell.set_active_element_mapper(this.constructor.active_element_mapper.bind(this.constructor));\n        }\n        // now remove any remaining (extraneous) nodes from the document\n        while (document.body.firstChild) {\n            const node = document.body.firstChild;\n            node.parentNode.removeChild(node);\n            if (node.nodeType !== Node.TEXT_NODE || node.nodeValue.trim().length > 0) {  // don't warn when removing empty-ish TEXT nodes\n                console.warn('removed extraneous node from incoming document', node);\n            }\n        }\n        // create header element\n        this.#header_element = document.createElement(this.constructor.header_element_tag);\n        // add header and main elements\n        document.body.appendChild(this.#header_element);\n        document.body.appendChild(this.#main_element);\n\n        // add a tool-bar element to each pre-existing cell\n        for (const cell of this.constructor.get_cells()) {\n            cell.establish_tool_bar();\n            // the following will establish the event handlers for cell\n            const current_output_element = cell.output_element;\n            cell.output_element = null;\n            cell.output_element = current_output_element;\n        }\n    }\n    #assets_server_root;\n    #local_server_root;\n\n    #setup_csp(enabled=false) {\n        if (enabled) {\n\n            // === CONTENT SECURITY POLICY ===\n\n            // set a Content-Security-Policy that will permit us\n            // to dynamically load associated content\n\n            const csp_header_content = [\n                //!!! audit this !!!\n                \"default-src 'self' 'unsafe-eval'\",\n                \"style-src   'self' 'unsafe-inline' *\",\n                \"script-src  'self' 'unsafe-inline' 'unsafe-eval' *\",\n                \"img-src     'self' data: blob: *\",\n                \"media-src   'self' data: blob: *\",\n                \"connect-src data:\",\n            ].join('; ');\n\n            create_element({\n                parent: document.head,\n                tag:    'meta',\n                attrs: {\n                    \"http-equiv\": \"Content-Security-Policy\",\n                    \"content\":    csp_header_content,\n                },\n            });\n        }\n    }\n\n    #setup_header() {\n        if (!this.header_element) {\n            throw new Error(`bad format for document: header element does not exist`);\n        }\n        const get_recents = null;//!!! implement this\n        this.#menubar = MenuBar.create(this.header_element, get_menubar_spec(), get_global_initial_key_map_bindings, get_recents);\n        //!!! this.#menubar_commands_subscription is never unsubscribed\n        this.#menubar_commands_subscription = this.#menubar.commands.subscribe(this.#command_observer.bind(this));\n        //!!! this.#menubar_selects_subscription is never unsubscribed\n        this.#menubar_selects_subscription = this.#menubar.selects.subscribe(this.#update_menu_state.bind(this));\n\n        // add a tool-bar element to the header document\n        this.#tool_bar = ToolBarElement.create_for(this.#header_element, {\n            /*!!! autoeval: {\n                initial: this.autoeval,\n                on: (event) => {\n                    this.set_autoeval(!this.autoeval);\n                    return true;\n                }, !!!*/\n            modified: true,\n            running:  true,\n        });\n        this.#header_element.appendChild(this.#tool_bar);\n    }\n\n\n    // === SAVE HANDLING ====\n\n    static #essential_elements_selector = [\n        EvalCellElement.custom_element_name,         // html tag (i.e., type)\n        `.${EvalCellElement.output_element_class}`,  // css class\n    ].join(',');\n\n    #save_serializer() {\n        const queried_main_element = document.querySelector(this.constructor.main_element_tag);\n        if (!queried_main_element || queried_main_element !== this.main_element) {\n            throw new Error('bad format for document');\n        }\n        if (!this.main_element) {\n            throw new Error('bad format for document: this.main_element not set');\n        }\n\n        const {\n            view_var_name,\n            autoeval_var_name,\n        } = this.constructor;\n        const view_value = document.body?.getAttribute(view_var_name)   // from document.body\n              ?? document.documentElement.getAttribute(view_var_name);  // from document.documentElement\n        const autoeval_value = document.body?.getAttribute(autoeval_var_name)  // from document.body\n              ?? document.documentElement.getAttribute(autoeval_var_name);     // from document.documentElement\n        const html_additional_attributes = `\\\n${typeof view_value     !== 'string' ? '' : ` ${view_var_name}${     !view_value     ? '' : `=\"${view_value.replaceAll(     '\"', '&quot;' )}\"` }`}\\\n${typeof autoeval_value !== 'string' ? '' : ` ${autoeval_var_name}${ !autoeval_value ? '' : `=\"${autoeval_value.replaceAll( '\"', '&quot;' )}\"` }`}\\\n`;\n        const main_js_script_code = document.querySelector('head script').outerHTML;\n        const contents = [ ...this.main_element.querySelectorAll(this.constructor.#essential_elements_selector) ]\n              .map(e => (e instanceof EvalCellElement) ? e.get_outer_html() : e.outerHTML)\n              .join('\\n');\n        return `\\\n<!DOCTYPE html>\n<html lang=\"en\"${html_additional_attributes}>\n<head>\n    <meta charset=\"utf-8\">\n    ${main_js_script_code}\n</head>\n<body>\n${contents}\n</body>\n</html>\n`;\n}\n\n    get_suggested_file_name() {\n        return window.location.pathname.split('/').slice(-1)[0];\n    }\n\n\n    // === RESIZE HANDLING ===\n\n    #enter_resize_mode(mousedown_event) {\n        if (!this.active_cell) {\n            // the this.active_cell is used to with getComputedStyle() to retrieve current split in px\n            throw new Error('resize failed: no active cell');\n        }\n        mousedown_event.preventDefault();\n        mousedown_event.stopPropagation();\n\n        // keep showing \"hover\" state while dragging even if mouse moves out of the resize handle\n        this.#resize_handle_element.classList.add(this.constructor.resize_handle_dragging_state_class);\n\n        const resize_metrics = this.get_resize_metrics();\n        const {\n            mouse_x_min,\n            mouse_x_max,\n            split_collapse_px,\n        } = resize_metrics;\n\n        let current_x = mousedown_event.x;\n        const resize_handler = (event) => {\n            const dx = (current_x < mouse_x_min || current_x > mouse_x_max) ? 0 : (event.x - current_x);\n            current_x = event.x;\n            const current_split_px = this.get_current_split_px();\n            const new_split_px = current_split_px + dx;\n            this.#set_input_output_split_given_resize_metrics(new_split_px, resize_metrics);\n        };\n        document.addEventListener('mousemove', resize_handler);  // remove in 'mouseup' handler\n        document.addEventListener('mouseup', (event) => {\n            // note: 'mouseup' event is fired if the user switches windows while dragging\n            document.removeEventListener('mousemove', resize_handler);\n            this.#resize_handle_element.classList.remove(this.constructor.resize_handle_dragging_state_class);\n        }, {\n            once: true,\n        });\n    }\n\n    is_collapsed() {\n        return this.#main_element.classList.contains(this.constructor.collapse_cells_state_class);\n    }\n\n    is_stacked() {\n        const var_value = window.getComputedStyle(document.documentElement).getPropertyValue(this.constructor.is_stacked_css_variable);\n        return (var_value.trim().length > 0);\n    }\n\n    get_current_split_px() {\n        if (!this.active_cell) {\n            throw new Error('no active cell');\n        }\n        const active_cell_input_container = this.constructor.#cell_input_container_element(this.active_cell);\n        const current_split_px = parseFloat(window.getComputedStyle(active_cell_input_container).width);  // = var(--input-output-split)\n        return current_split_px;\n    }\n\n    step_input_output_split_size(enlarge=false) {\n        const resize_metrics = this.get_resize_metrics();\n        const {\n            split_step_size_px,\n        } = resize_metrics;\n        const current_split_px = this.get_current_split_px();\n        const new_split_px = enlarge\n              ? current_split_px + split_step_size_px\n              : current_split_px - split_step_size_px;\n        this.#set_input_output_split_given_resize_metrics(new_split_px, resize_metrics);\n    }\n\n    collapse_input_output_split() {\n        const resize_metrics = this.get_resize_metrics();\n        const new_split_px = resize_metrics.split_min_px;\n        this.#set_input_output_split_given_resize_metrics(new_split_px, resize_metrics);\n    }\n\n    expand_input_output_split(max=false) {\n        const resize_metrics = this.get_resize_metrics();\n        const current_split_px = this.get_current_split_px();\n        const new_split_px = resize_metrics.split_max_px;  // could instead be resize_metrics.split_neutral_px\n        if ( (max || current_split_px <= 0) &&  // don't change if already visible and !max\n             current_split_px < new_split_px    // don't shrink if already currently larger\n           ) {\n            this.#set_input_output_split_given_resize_metrics(new_split_px, resize_metrics);\n        }\n    }\n\n    set_input_output_split(new_split_px) {\n        this.#set_input_output_split_given_resize_metrics(new_split_px, this.get_resize_metrics());\n    }\n\n    #set_input_output_split_given_resize_metrics(new_split_px, resize_metrics) {\n        if (typeof new_split_px !== 'number') {\n            throw new Error('new_split_px must be a number');\n        }\n        if (typeof resize_metrics !== 'object') {\n            throw new Error('resize_metrics must be an object');\n        }\n        const {\n            split_min_px,\n            split_max_px,\n            split_collapse_px,\n        } = resize_metrics;\n\n        const new_split =\n              ( (new_split_px < split_min_px)\n                ? `${split_min_px}px`\n                : ( (new_split_px > split_max_px)\n                    ? `${split_max_px}px`\n                    : `${new_split_px}px` ) );\n\n        document.documentElement.style.setProperty(this.constructor.input_output_split_css_variable, new_split);\n\n        // update collapsed state\n        if (new_split_px <= resize_metrics.split_collapse_px) {\n            this.#main_element.classList.add(this.constructor.collapse_cells_state_class);\n        } else {\n            this.#main_element.classList.remove(this.constructor.collapse_cells_state_class);\n        }\n    }\n\n    get_resize_metrics() {\n        // note: parseFloat() stops at the first non-number character, e.g., a trailing \"px\" as in \"123px\"\n\n        const main_element_computed_style = window.getComputedStyle(this.#main_element);\n        const main_element_margin_left_px = parseFloat(main_element_computed_style.marginLeft);\n        const main_element_width_px       = parseFloat(main_element_computed_style.width);\n\n        const split_min_px       = 0;\n        const split_max_px       = main_element_width_px * this.constructor.max_split_ratio;\n        const split_collapse_px  = main_element_width_px * this.constructor.collapse_split_ratio;\n        const split_step_size_px = main_element_width_px * this.constructor.split_step_size_ratio;\n        const split_neutral_px   = main_element_width_px * this.constructor.split_neutral_ratio;\n        const mouse_x_min        = main_element_margin_left_px + split_min_px;\n        const mouse_x_max        = main_element_margin_left_px + split_max_px;\n\n        return {\n            split_min_px,        // minimum split\n            split_max_px,        // maximum split\n            split_collapse_px,   // split value at which collapse occurs\n            split_step_size_px,  // step size for shrink and expand\n            split_neutral_px,    // neutral split amount\n            mouse_x_min,         // mouse position\n            mouse_x_max,         // mouse position\n        };\n    }\n\n\n    // === CELL ELEMENT STRUCTURE ===\n\n    static cell_container_class       = 'cell-container';\n    static cell_input_container_class = 'cell-input-container';\n\n    /** create the element structure to contain a cell and its output_element\n     *  @param {null|undefined|Object} options: {\n     *      parent?: Node,  // default: this.main_element\n     *      before?: Node,  // default: null\n     *  }\n     *  @return {Object} structure_details: {\n     *      cell_container:        HTMLElement,  // the container element of the structure\n     *      cell_input_container:  HTMLElement,  // the input subcontainer element of the structure\n     *      cell_parent:           HTMLElement,  // parent for cell\n     *      cell_before:           HTMLElement,  // null or element before which to put cell\n     *      output_element_parent: HTMLElement,  // parent for output_element\n     *      output_element_before: HTMLElement,  // null or element before which to put output_element\n     *  }\n     */\n    #create_cell_element_structure(options=null) {\n        const {\n            parent = this.main_element,\n            before = null,\n        } = (options ?? {});\n        const cell_container = create_element({\n            parent,\n            before,\n            attrs: {\n                class: [ this.constructor.cell_container_class ],\n            },\n        });\n        const cell_input_container = create_element({\n            parent: cell_container,\n            attrs: {\n                class: [ this.constructor.cell_input_container_class ],\n            },\n        });\n        const cell_parent = cell_input_container;\n        const cell_before = null;  // i.e., append\n        const output_element_parent = cell_container;\n        const output_element_before = null;  // i.e., append\n        return {\n            cell_container,\n            cell_input_container,\n            cell_parent,\n            cell_before,\n            output_element_parent,\n            output_element_before,\n        };\n    }\n\n    static #cell_container_element(cell) {\n        if (!(cell instanceof EvalCellElement)) {\n            throw new Error('cell must be an instance of EvalCellElement');\n        }\n        const cell_container = cell.parentElement?.parentElement;\n        if (!cell_container || !cell_container.parentElement || !cell_container.classList.contains(this.cell_container_class)) {\n            throw new Error('incorrect cell structure');\n        }\n        return cell_container;\n    }\n\n    static #cell_input_container_element(cell) {\n        const cell_container = this.#cell_container_element(cell);\n        const cell_input_container = cell_container.querySelector(`.${this.cell_input_container_class}`);\n        if (!cell_input_container) {\n            throw new Error('incorrect cell structure');\n        }\n        return cell_input_container;\n    }\n\n    // mapping from this editor cell element to the element on which \"data-active\" will be set\n    static active_element_mapper(editor_element) {\n        return this.#cell_container_element(editor_element);\n    }\n\n\n    // === COMMAND HANDLER INTERFACE ===\n\n    inject_key_event(key_event) {\n        if (!this.contains(key_event.target)) {\n            // try to set target to the currently active cell\n            const active_cell = LogbookManager.singleton.active_cell;\n            if (active_cell) {\n                // this is a clumsy clone of event, but it will only be used internally from this point\n                // the goal is to clone the event but change target and currentTarget\n                key_event = {\n                    ...key_event,  // captures almost nothing, e.g., just the \"isTrusted\" property\n\n                    key:           key_event.key,       // non-enumerable getter\n                    metaKey:       key_event.metaKey,   // non-enumerable getter\n                    ctrlKey:       key_event.ctrlKey,   // non-enumerable getter\n                    shiftKey:      key_event.shiftKey,  // non-enumerable getter\n                    altKey:        key_event.altKey,    // non-enumerable getter\n\n                    preventDefault:  event.preventDefault.bind(event),\n                    stopPropagation: event.stopPropagation.bind(event),\n\n                    target:        active_cell,\n                    currentTarget: active_cell,\n                };\n            }\n        }\n        this.#key_event_manager.inject_key_event(key_event);\n    }\n\n    #command_observer(command_context) {\n        let success = false;\n        try {\n            success = this.#perform_command(command_context);\n        } catch (error) {\n            console.error('error processing command', command_context, error);\n        }\n        if (!success) {\n            beep();\n        }\n    }\n\n    inject_command(command) {\n        return this.#perform_command({ command, target: this.active_cell });\n    }\n\n    #perform_command(command_context) {\n        if (!command_context) {\n            return false;  // indicate: command not handled\n        } else {\n            const target = command_context.target;\n            if (!target) {\n                return false;  // indicate: command not handled\n            } else {\n                const updated_command_context = {\n                    ...command_context,\n                    target: this.active_cell,\n                };\n                const bindings_fn = this.#command_bindings[updated_command_context.command];\n                if (!bindings_fn) {\n                    return false;  // indicate: command not handled\n                } else {\n                    return bindings_fn(updated_command_context);\n                }\n            }\n        }\n    }\n\n    #update_menu_state() {\n        const cells        = this.constructor.get_cells();\n        const active_cell  = this.active_cell;\n        const active_index = cells.indexOf(active_cell);\n        const editable     = this.editable;\n\n        this.#menubar.set_menu_state('clear',            { enabled: editable });\n        this.#menubar.set_menu_state('reset',            { enabled: editable });\n        this.#menubar.set_menu_state('reset-cell',       { enabled: editable });\n\n        this.#menubar.set_menu_state('focus-up',         { enabled: (active_cell && active_index > 0) });\n        this.#menubar.set_menu_state('focus-down',       { enabled: (active_cell && active_index < cells.length-1) });\n        this.#menubar.set_menu_state('move-up',          { enabled: (active_cell && active_index > 0) });\n        this.#menubar.set_menu_state('move-down',        { enabled: (active_cell && active_index < cells.length-1) });\n        this.#menubar.set_menu_state('add-before',       { enabled: editable && active_cell });\n        this.#menubar.set_menu_state('add-after',        { enabled: editable && active_cell });\n        this.#menubar.set_menu_state('delete',           { enabled: editable && active_cell });\n\n        this.#menubar.set_menu_state('eval-and-refocus', { enabled: editable && active_cell });\n        this.#menubar.set_menu_state('eval',             { enabled: editable && active_cell });\n        this.#menubar.set_menu_state('eval-before',      { enabled: editable && active_cell });\n        this.#menubar.set_menu_state('eval-all',         { enabled: editable && active_cell });\n\n        this.#menubar.set_menu_state('stop',             { enabled: active_cell?.can_stop });\n        this.#menubar.set_menu_state('stop-all',         { enabled: cells.some(cell => cell.can_stop) });\n\n        const neutral = true;  //!!! until we figure out how to detect a changed document\n        this.#tool_bar.set_for('modified', !neutral);\n        this.#menubar.set_menu_state('save', { enabled: !neutral });\n\n        /*\n          recents\n        */\n    }\n\n\n    // === EVAL STATES ===\n\n    emit_eval_state(cell, eval_state) {\n        this.#eval_states.dispatch({ cell, eval_state });\n    }\n\n    #eval_states_observer(data) {\n        // data is ignored\n        const {\n            cell,\n            eval_state,\n        } = data;\n        const something_foreground = this.constructor.get_cells().some(cell => cell.evaluator_foreground);\n        this.#tool_bar.set_for('running', something_foreground);\n    }\n\n\n    // === COMMAND HANDLERS ===\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    command_handler__create_cell(command_context) {\n        let before = null;\n        const next_cell = command_context.target?.adjacent_cell?.(true);\n        if (next_cell) {\n            before = this.constructor.#cell_container_element(next_cell);\n        }\n        const cell = this.create_cell({ before });\n        if (!cell) {\n            return false;\n        } else {\n            cell.focus();\n            this.set_active_cell(cell);  // focus sets active_cell but asynchronously, so set active_cell explicitly\n            return true;\n        }\n    }\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    command_handler__reset_cell(command_context) {\n        const cell = command_context.target;\n        if (!cell || !(cell instanceof EvalCellElement)) {\n            return false;\n        } else {\n            cell.reset();\n            return true;\n        }\n    }\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    command_handler__reset(command_context) {\n        this.reset();\n        return true;\n    }\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    async command_handler__clear(command_context) {\n        if (!await ConfirmDialog.run('Clear document?')) {\n            this.active_cell?.focus();\n            return false;\n        }\n        this.clear();\n        return true;\n    }\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    async command_handler__save(command_context) {\n        const save_result = await fs_interface.save(this.#save_serializer.bind(this), {\n            file_handle: this.#file_handle,\n            prompt_options: {\n                suggestedName: this.get_suggested_file_name(),//!!!\n            },\n        });\n        const {\n            canceled,\n            file_handle,\n            stats,\n        } = save_result;\n        if (!canceled) {\n            //!!!\n            this.#file_handle = file_handle ?? undefined;\n        }\n        return true;\n    }\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    async command_handler__save_as(command_context) {\n        this.#file_handle = undefined;\n        await fs_interface.save(this.#save_serializer.bind(this), {\n            prompt_options: {\n                suggestedName: this.get_suggested_file_name(),//!!!\n            },\n        });\n        return true;\n    }\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    async command_handler__eval(command_context) {\n        const cell = command_context.target;\n        if (!cell || !(cell instanceof EvalCellElement)) {\n            return false;\n        } else {\n            await cell.eval({\n                eval_context: LogbookManager.singleton.global_eval_context,\n            });\n            return true;\n        }\n    }\n\n    /** eval target cell and refocus to next cell (or a new one if at the end of the document)\n     *  @return {Boolean} true iff command successfully handled\n     */\n    async command_handler__eval_and_refocus(command_context) {\n        const cell = command_context.target;\n        if (!cell || !(cell instanceof EvalCellElement)) {\n            return false;\n        } else {\n            await cell.eval({\n                eval_context: this.global_eval_context,\n            });\n            const next_cell = cell.adjacent_cell(true) ?? this.create_cell();\n            next_cell.focus();\n            return true;\n        }\n    }\n\n    /** reset global eval context and then eval all cells in the document\n     *  from the beginning up to but not including the target cell.\n     *  @return {Boolean} true iff command successfully handled\n     */\n    async command_handler__eval_before(command_context) {\n        const cell = command_context.target;\n        if (!cell || !(cell instanceof EvalCellElement)) {\n            return false;\n        } else {\n            this.stop();  // also clears this.#multi_eval_manager\n            const em = this.#multi_eval_manager = new StoppableObjectsManager();\n            try {\n                this.reset_global_eval_context();\n                for (const iter_cell of this.constructor.get_cells()) {\n                    if (em.stopped) {\n                        break;\n                    }\n                    iter_cell.focus();\n                    if (iter_cell === cell) {\n                        break;\n                    }\n                    await iter_cell.eval({\n                        eval_context: this.global_eval_context,\n                    });\n                }\n            } finally {\n                this.#multi_eval_manager = null;\n            }\n            return true;\n        }\n    }\n\n    /** stop all running evaluations, reset global eval context and then eval all cells in the document\n     *  from first to last, and set focus to the last.\n     *  @return {Boolean} true iff command successfully handled\n     */\n    async command_handler__eval_all(command_context) {\n        const cell = command_context.target;\n        if (!cell || !(cell instanceof EvalCellElement)) {\n            return false;\n        } else {\n            this.stop();  // also clears this.#multi_eval_manager\n            const em = this.#multi_eval_manager = new StoppableObjectsManager();\n            try {\n                this.reset_global_eval_context();\n                for (const iter_cell of this.constructor.get_cells()) {\n                    if (em.stopped) {\n                        break;\n                    }\n                    iter_cell.focus();\n                    await iter_cell.eval({\n                        eval_context: this.global_eval_context,\n                    });\n                }\n            } finally {\n                this.#multi_eval_manager = null;\n            }\n            return true;\n        }\n    }\n\n    /** stop evaluation for the active cell.\n     *  @return {Boolean} true iff command successfully handled\n     */\n    command_handler__stop(command_context) {\n        const cell = command_context.target;\n        if (!cell || !(cell instanceof EvalCellElement)) {\n            return false;\n        } else {\n            cell.stop();\n            return true;\n        }\n    }\n\n    /** stop all running evaluations.\n     *  @return {Boolean} true iff command successfully handled\n     */\n    command_handler__stop_all(command_context) {\n        this.stop();\n        return true;\n    }\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    command_handler__focus_up(command_context) {\n        const focus_cell = command_context.target.adjacent_cell(false);\n        if (!focus_cell) {\n            return false;\n        } else {\n            focus_cell.focus();\n            return true;\n        }\n    }\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    command_handler__focus_down(command_context) {\n        const focus_cell = command_context.target.adjacent_cell(true);\n        if (!focus_cell) {\n            return false;\n        } else {\n            focus_cell.focus();\n            return true;\n        }\n    }\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    command_handler__move_up(command_context) {\n        const cell = command_context.target;\n        if (!cell) {\n            return false;\n        } else {\n            const previous = cell.adjacent_cell(false);\n            if (!previous) {\n                return false;\n            } else {\n                // beacause we are storing the cell, toolbar and output element\n                // in an element structure, just move the entire structure instead\n                // of using cell.move_cell()\n                const cell_container = this.constructor.#cell_container_element(cell);\n                const parent = cell_container.parentElement;\n                const before = this.constructor.#cell_container_element(previous);\n                move_node(cell_container, { parent, before });\n                cell.focus();\n                return true;\n            }\n        }\n    }\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    command_handler__move_down(command_context) {\n        const cell = command_context.target;\n        if (!cell) {\n            return false;\n        } else {\n            const next = cell.adjacent_cell(true);\n            if (!next) {\n                return false;\n            } else {\n                // beacause we are storing the cell, toolbar and output element\n                // in an element structure, just move the entire structure instead\n                // of using cell.move_cell()\n                const cell_container = this.constructor.#cell_container_element(cell);\n                const parent = cell_container.parentElement;\n                const before = this.constructor.#cell_container_element(next).nextSibling;\n                move_node(cell_container, { parent, before });\n                cell.focus();\n                return true;\n            }\n        }\n    }\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    command_handler__add_before(command_context) {\n        const cell = command_context.target;\n        if (!cell) {\n            return false;\n        }\n        const cell_container = this.constructor.#cell_container_element(cell);\n        const new_cell = this.create_cell({\n            before: cell_container,\n        });\n        new_cell.focus();\n        return true;\n    }\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    command_handler__add_after(command_context) {\n        const cell = command_context.target;\n        if (!cell) {\n            return false;\n        }\n        const cell_container = this.constructor.#cell_container_element(cell);\n        const new_cell = this.create_cell({\n            before: cell_container.nextSibling,\n            parent: cell_container.parentElement,  // necessary if before is null\n        });\n        new_cell.focus();\n        return true;\n    }\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    async command_handler__delete(command_context) {\n        const cell = command_context.target;\n        if (!cell) {\n            return false;\n        }\n        if (cell.get_text().trim().length > 0 || cell.output_element?.firstChild) {\n            if (!await ConfirmDialog.run('Cannot undo delete of non-empty cell.\\nContinue?')) {\n                cell.focus();\n                return false;\n            }\n        }\n        let next_cell = cell.adjacent_cell(true) ?? cell.adjacent_cell(false);\n        // beacause we are storing the cell, toolbar and output element\n        // in an element structure, just remove the entire structure instead\n        // of using cell.remove_cell()\n        this.constructor.#cell_container_element(cell).remove();\n        let new_cell_created = false;\n        if (!next_cell) {\n            next_cell = this.create_cell();\n            new_cell_created = true;\n        }\n        next_cell.focus();\n        this.set_active_cell(next_cell);  // focus sets active_cell but asynchronously, so set active_cell explicitly\n        if (new_cell_created) {\n            this.expand_input_output_split();  // ensure that new new empty cell is visible to the user\n        }\n        return true;\n    }\n\n    /** set the active cell's input_type to \"markdown\".\n     *  @return {Boolean} true iff command successfully handled\n     */\n    command_handler__set_mode_markdown(command_context) {\n        const cell = command_context.target;\n        if (!cell || !(cell instanceof EvalCellElement)) {\n            return false;\n        } else {\n            cell.input_type = 'markdown';\n            return true;\n        }\n    }\n\n    /** set the active cell's input_type to \"tex\".\n     *  @return {Boolean} true iff command successfully handled\n     */\n    command_handler__set_mode_tex(command_context) {\n        const cell = command_context.target;\n        if (!cell || !(cell instanceof EvalCellElement)) {\n            return false;\n        } else {\n            cell.input_type = 'tex';\n            return true;\n        }\n    }\n\n    /** set the active cell's input_type to \"javascript\".\n     *  @return {Boolean} true iff command successfully handled\n     */\n    command_handler__set_mode_javascript(command_context) {\n        const cell = command_context.target;\n        if (!cell || !(cell instanceof EvalCellElement)) {\n            return false;\n        } else {\n            cell.input_type = 'javascript';\n            return true;\n        }\n    }\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    command_handler__shrink_inputs(command_context) {\n        this.step_input_output_split_size(false);\n        this.active_cell.focus();\n        return true;\n    }\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    command_handler__enlarge_inputs(command_context) {\n        this.step_input_output_split_size(true);\n        this.active_cell.focus();\n        return true;\n    }\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    command_handler__collapse_inputs(command_context) {\n        this.collapse_input_output_split();\n        return true;\n    }\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    command_handler__expand_inputs(command_context) {\n        this.expand_input_output_split();\n        this.active_cell.focus();\n        return true;\n    }\n\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    command_handler__show_settings_dialog(command_context) {\n        SettingsDialog.run();\n        return true;\n    }\n\n    /** @return {Boolean} true iff command successfully handled\n     */\n    command_handler__show_help(command_context) {\n        open_help_window();\n        return true;\n    }\n}\n\n\n// === INITIALIZATION FAILED DISPLAY ===\n\nexport function show_initialization_failed(error) {\n    console.error('initialization failed', error.stack);\n    clear_element(document.body);\n    const error_h1 = document.createElement('h1');\n    error_h1.innerText = 'Initialization Failed';\n    const error_pre = document.createElement('pre');\n    error_pre.classList.add('error-message');\n    error_pre.innerText = error.stack;\n    document.body.appendChild(error_h1);\n    document.body.appendChild(error_pre);\n}\n","import {\n    clear_element,\n    scroll_element_into_view,\n    set_element_attrs,\n    update_element_style,\n    create_element,\n    create_element_mapping,\n    create_element_child_text_node,\n    normalize_element_text,\n} from '../lib/ui/dom-tools.js';\n\nimport {\n    Subscribable,\n} from '../lib/sys/subscribable.js';\n\nimport {\n    Stoppable,\n} from '../lib/sys/stoppable.js';\n\nimport {\n    Renderer,\n} from './renderer/_.js';\n\nimport {\n    delay_ms        as util_delay_ms,\n    next_tick       as util_next_tick,\n    next_micro_tick as util_next_micro_tick,\n} from '../lib/ui/dom-tools.js';\n\nimport {\n    sprintf as lib_sprintf,\n} from '../lib/sys/sprintf.js';\n\n\nexport class OutputContext {\n    constructor(element) {\n        if (!(element instanceof HTMLElement)) {\n            throw new Error('element must be an instance of HTMLElement');\n        }\n        Object.defineProperties(this, {\n            element: {\n                value: element,\n                enumerable: true,\n            },\n        });\n        this.#new_stoppables = new Subscribable();\n        this.#stopped = false;\n    }\n    #new_stoppables;\n    #stopped;\n\n    get new_stoppables (){ return this.#new_stoppables; }\n\n    get stopped (){ return this.#stopped; }  // once stopped, always stopped\n    stop() {\n        this.#stopped = true;\n    }\n\n\n    // === STATIC UTILITY ===\n\n    static sprintf(format, ...args) {\n        return lib_sprintf(format, ...args);\n    }\n\n    static async sleep(s) {\n        return util_delay_ms(1000*s);\n    }\n\n    static async delay_ms(ms) {\n        return util_delay_ms(ms);\n    }\n\n    static async next_tick() {\n        return util_next_tick();\n    }\n\n    static async next_micro_tick() {\n        return util_next_micro_tick();\n    }\n\n\n    // === STATIC OPERATIONS ===\n\n    static get_svg_string(svg_node) {\n        const serializer = new XMLSerializer();\n        let svg_string = serializer.serializeToString(svg_node);\n        svg_string = svg_string.replace(/(\\w+)?:?xlink=/g, 'xmlns:xlink=');  // fix root xlink without namespace\n        svg_string = svg_string.replace(/NS\\d+:href/g, 'xlink:href');  // Safari NS namespace fix\n        return svg_string;\n    }\n\n    /** remove all child elements and nodes of element\n     *  @param {HTMLElement} element\n     *  @return {HTMLElement} element\n     */\n    static clear_element(element) {\n        return clear_element(element);\n    }\n\n    /** scroll element into view\n     *  @param {Element} element\n     *  @return {Element} element\n     */\n    static scroll_element_into_view(element) {\n        return scroll_element_into_view(element);  // from dom-tools.js\n    }\n\n    /** set attributes on an element which are taken from an object.\n     *  @param {Element} element\n     *  @param {Object|undefined|null} attrs\n     *  @return {Element} element\n     *  Attribute values obtained by calling toString() on the values in attrs\n     *  except that values which are undefined are translated to ''.\n     */\n    static set_element_attrs(element, attrs) {\n        return set_element_attrs(element, attrs);  // from dom-tools.js\n    }\n\n    /** add/remove style properties on element\n     *  @param {HTMLElement} element\n     *  @param {Object} spec collection of properties to add or remove.\n     *                  If the value of an entry is null or undefined, then\n     *                  the corresponding property is removed.  If the value\n     *                  of an entry is null, then the property is removed.\n     *                  If the value of an entry is undefined, then that\n     *                  entry is ignored.  Otherwise, the value of the\n     *                  corresponding property is set.\n     *  @return {HTMLElement} element\n     */\n    static update_element_style(element, spec) {\n        return update_element_style(element, spec);  // from dom-tools.js\n    }\n\n    /** create_element(options=null, return_mapping=false)\n     *  create a new element with the given characteristics\n     *  @param {Object|undefined|null} options: {\n     *      _key?:      String,            // if return_mapping, associate the created element with this value as the key\n     *      parent?:    HTMLElement|null,  // parent element, null or undefined for none; may be simply an Element if style not specified\n     *      before?:    Node|null,         // sibling node before which to insert; append if null or undefined\n     *      tag?:       string,            // tag name for new element; default: 'div'\n     *      namespace?: string,            // namespace for new element creation\n     *      attrs?:     object,            // attributes to set on new element\n     *      style?:     object,            // style properties for new element\n     *      set_id?:    Boolean            // if true, allocate and set an id for the element (if id not specified in attrs)\n     *      children?:  ELDEF[],           // array of children to create (recursive)\n     *  }\n     *  @param {Boolean} return_mapping (default false)\n     *  @return {Element|Object} the new element or the element mapping object\n     *\n     * A unique id will be assigned to the element unless that element already has\n     * an id attribute specified (in attrs).\n     * Attributes specified in attrs with a value of either null or undefined are ignored.\n     * The before node, if specified, must have a parent that must match parent if\n     * parent is specified.\n     * If neither parent nor before is specified, the new element will have no parent.\n     * Warning: '!important' in style specifications does not work!  (Should use priority method.)\n     * The definitions in \"children\", if specified, should not contain \"parent\" or \"before\".\n     * attrs may contain a \"class\" property, and this should be a string or an array of strings,\n     * each of which must not contain whitespace.\n     *\n     * If return_mapping, then return a mapping object from keys found in \"_key\" properties\n     * in the options.  Each of these keys will be mapped to the corresponding object, and\n     * mapping_default_key is mapped to the top-level object.  Note that duplicate keys or\n     * keys that specify the same value as mapping_default_key will overwrite earlier values.\n     * Elements specified in options are created in a post-order traversal of options.children.\n     * This means that a _key specified in options as mapping_default_key will not be returned\n     * because mapping_default_key is set after traversiing the children.\n     */\n    static create_element(options=null, return_mapping=false) {\n        return create_element(options, return_mapping);  // from dom-tools.js\n    }\n\n    /** create a element with the given characteristics and return a mapping.\n     *  See this.create_element() for a description of options.\n     */\n    static create_element_mapping(options=null) {\n        return this.create_element_mapping(options, true);\n    }\n\n    /** create a new child element of the given element with the given characteristics\n     *  See this.create_element() for a description of options.\n     */\n    static create_element_child(element, options=null, return_mapping=false) {\n        if (typeof options?.parent !== 'undefined' || typeof options?.before !== 'undefined') {\n            console.warn('options.parent and/or options.before override element argument');\n        } else {\n            options = {\n                ...(options ?? {}),\n                parent: element,\n                before: null,\n            };\n        }\n        return create_element(options, return_mapping);  // from dom-tools.js\n    }\n\n    /** create a new child element of the given element with the given characteristics and return a mapping.\n     *  See this.create_element() for a description of options.\n     */\n    static create_element_child_mapping(element, options=null) {\n        return this.create_element_child(options, true);\n    }\n\n    /** create or update a child text node of the given element\n     *  @param {HTMLElement} element\n     *  @param {any} text to be contained in the new text node\n     *  @param {Object|undefined|null} options: {\n     *             before?: null|Node,  // child node or element before which to insert; append if null or undefined\n     *             prevent_coalesce_next?: boolean,\n     *         }\n     *  @return {Node|null} the new or modified text node, or null if the converted text is ''\n     *\n     * Text will be converted to a string (if not already a string).  A text value\n     * of null or undefined is equivalent to ''.\n     *\n     * The text will be coalesced into the immediately previous text node, if any.\n     * Otherwise, if the next node is a text node the text will be coealesced\n     * into the beginning text of it unless options.prevent_coalesce_next.\n     * options.prevent_coalesce_next makes sure that the same options.before\n     * node can be used repeatedly with the expected results.  However,\n     * options.prevent_coalesce_next may leave element non-normalized.\n     * On the other hand, if !options.prevent_coalesce_next, the element\n     * will not become non-normalized (but may be non-normalized if it\n     * already was).\n     */\n    static create_element_child_text_node(element, text, options=null) {\n        return create_element_child_text_node(element, text, options);  // from dom-tools.js\n    }\n\n    /** normalize the text node children of element, meaning that text nodes\n     *  are non-empty and no text nodes are adjacent.\n     *  @param {Element} element\n     *  @return {Element} element\n     */\n    static normalize_element_text(element) {\n        return normalize_element_text(element);  // from dom-tools.js\n    }\n\n\n    // === ABORT IF STOPPED ===\n\n    /** abort by throwing an error if this.stopped, otherwise do nothing.\n     */\n    abort_if_stopped(operation) {\n        if (this.stopped) {\n            operation ??= 'operation';\n            throw new Error(`${operation} invoked on stopped output context`);\n        }\n    }\n\n    /** wrap the given function so that when it is called,\n     *  this.abort_if_stopped() will be called first to\n     *  terminate rendering.\n     */\n    AIS(f) {\n        if (typeof f !== 'function') {\n            throw new Error('f must be a function');\n        }\n        const AsyncFunction = (async () => {}).constructor;\n        if (f instanceof AsyncFunction) {\n            return async (...args) => {\n                this.abort_if_stopped(f.name);\n                const result = await f.apply(null, args);\n                this.abort_if_stopped(f.name);\n                return result;\n            };\n        } else {\n            return (...args) => {\n                this.abort_if_stopped(f.name);\n                const result = f.apply(null, args);\n                this.abort_if_stopped(f.name);\n                return result;\n            };\n        }\n    }\n\n\n    // === UTILITY ===\n\n    /** @param {String} format\n     *  @param {any[]} args\n     *  @return {String} formatted string\n     */\n    sprintf(format, ...args) {\n        this.abort_if_stopped();\n        return this.constructor.sprintf(format, ...args);\n    }\n\n    /** @param {Number} s delay in seconds\n     *  @return {Promise} promise which will resolve after s seconds\n     */\n    async sleep(s) {\n        this.abort_if_stopped();\n        return this.constructor.delay_ms(1000*s);\n    }\n\n    /** @param {Number} ms delay in milliseconds\n     *  @return {Promise} promise which will resolve after ms milliseconds\n     */\n    async delay_ms(ms) {\n        this.abort_if_stopped();\n        return this.constructor.delay_ms(ms);\n    }\n\n    /** @return {Promise} promise which will resolve after next \"tick\"\n     * setTimeout() is used.\n     */\n    async next_tick() {\n        this.abort_if_stopped();\n        return this.constructor.next_tick();\n    }\n\n    /** @return {Promise} promise which will resolve after next \"tick\"\n     * queueMicrotask() is used.\n     */\n    async next_micro_tick() {\n        this.abort_if_stopped();\n        return this.constructor.next_micro_tick();\n    }\n\n\n    // === BASIC OPERATIONS ===\n\n    /** remove all child elements and nodes of this.element via this.constructor.clear_element()\n     *  @return this\n     */\n    clear() {\n        this.abort_if_stopped();\n        this.constructor.clear_element(this.element);\n        return this;\n    }\n\n    /** scroll this.element into view via this.constructor.scroll_element_into_view()\n     *  @return this\n     */\n    scroll_into_view() {\n        this.abort_if_stopped();\n        this.constructor.scroll_element_into_view(this.element);\n        return this;\n    }\n\n    /** set attributes on an element which are taken from an object, via this.constructor.set_element_attrs()\n     *  @return this\n     */\n    set_attrs(attrs) {\n        this.abort_if_stopped();\n        this.constructor.set_element_attrs(this.element, attrs);\n        return this;\n    }\n\n    /** add/remove style properties on this.element via this.constructor.update_element_style()\n     *  @return this\n     */\n    update_style(spec) {\n        this.abort_if_stopped();\n        this.constructor.update_element_style(this.element, spec);\n        return this;\n    }\n\n    /** create a new child element of this.element via this.constructor.create_element_child()\n     *  See this.constructor.create_element() for a description of options.\n     *  @return {HTMLElement} the new child element or a mapping if return_mapping.\n     */\n    create_child(options=null, return_mapping=false) {\n        this.abort_if_stopped();\n        return this.constructor.create_element_child(this.element, options, return_mapping);\n    }\n\n    /** create a new child element of this.element via this.constructor.create_element_child_mapping() and return a mapping.\n     *  See this.constructor.create_element() for a description of options.\n     *  @return {HTMLElement} the new child element or a mapping if return_mapping.\n     */\n    create_child_mapping(options=null) {\n        this.abort_if_stopped();\n        return this.create_child(options, true);\n    }\n\n    /** create a new OutputContext from a new child element of this.element created via this.create_child()\n     *  @return {OutputContext} the new child OutputContext\n     */\n    create_child_ocx(options=null) {\n        this.abort_if_stopped();\n        options ??= {};\n        const parent_style_attr = this.element.getAttribute('style');\n        if (parent_style_attr) {\n            options.attrs = {\n                ...(options.attrs ?? {}),\n                style: parent_style_attr,  // inherit parent's style attribute (vs style)\n            };\n        }\n        return new this.constructor(this.create_child(options));\n    }\n\n    /** create or update a child text node of this.element via this.constructor.create_element_child_text_node()\n     *  @return {Node|null} the new or modified text node, or null if the converted text is ''\n     */\n    create_child_text_node(text, options=null) {\n        this.abort_if_stopped();\n        return this.constructor.create_element_child_text_node(this.element, text, options);\n    }\n\n    /** normalize this.element via this.constructor.normalize_element_text()\n     *  @return this\n     */\n    normalize_text() {\n        this.abort_if_stopped();\n        this.constuctor.normalize_element_text(this.element);\n        return this;\n    }\n\n\n    // === ADVANCED OPERATIONS ===\n\n    /** options may also include a substitute \"ocx\" which will override the ocx argument\n     */\n    async render(type, value, options=null) {\n        const ocx = options?.ocx ?? this;\n        const renderer = ocx.renderer_for_type(type);\n        return ocx.invoke_renderer(renderer, value, options)\n            .catch(error => ocx.render_error(error));\n    }\n\n    /** options may also include a substitute \"ocx\" which will override the ocx argument\n     */\n    async render_text(text, options=null) {\n        const ocx = options?.ocx ?? this;\n        text ??= '';\n        if (typeof text !== 'string') {\n            text = text?.toString() ?? '';\n        }\n        return ocx.render('text', text, options);\n    }\n\n    /** options may also include a substitute \"ocx\" which will override the ocx argument\n     */\n    async render_error(error, options=null) {\n        const ocx = options?.ocx ?? this;\n        return ocx.render('error', error, options);\n    }\n\n    /** options may also include a substitute \"ocx\" which will override the ocx argument\n     */\n    async render_value(value, options=null) {\n        const ocx = options?.ocx ?? this;\n        // transform value to text and then render as text\n        let text;\n        if (typeof value === 'undefined') {\n            text = '[undefined]';\n        } else if (typeof value?.toString === 'function') {\n            text = value.toString();\n        } else {\n            text = '[unprintable value]';\n        }\n        return ocx.render_text(text, options);\n    }\n\n    /** options may also include a substitute \"ocx\" which will override the ocx argument\n     */\n    async println(text, options=null) {\n        const ocx = options?.ocx ?? this;\n        return ocx.render_text((text ?? '') + '\\n', options);\n    }\n\n    /** options may also include a substitute \"ocx\" which will override the ocx argument\n     */\n    async printf(format, ...args) {\n        const ocx = this;  // no options...\n        if (typeof format !== 'undefined' && format !== null) {\n            if (typeof format !== 'string') {\n                format = format.toString();\n            }\n            const text = ocx.constructor.sprintf(format, ...args);\n            return ocx.render_text(text).\n                catch(error => ocx.render_error(error));\n        }\n    }\n\n    /** options may also include a substitute \"ocx\" which will override the ocx argument\n     */\n    async print__(options=null) {\n        const ocx = options?.ocx ?? this;\n        ocx.create_child({ tag: 'hr' });\n    }\n\n    /** options may also include a substitute \"ocx\" which will override the ocx argument\n     * options: { style?: Object, eval_context?: Object, inline?: Boolean }\n     */\n    async javascript(code, options=null) {\n        const ocx = options?.ocx ?? this;\n        return ocx.render('javascript', code, options);\n    }\n\n    /** options may also include a substitute \"ocx\" which will override the ocx argument\n     */\n    async markdown(code, options=null) {\n        const ocx = options?.ocx ?? this;\n        return ocx.render('markdown', code, options);\n    }\n\n    /** options may also include a substitute \"ocx\" which will override the ocx argument\n     */\n    async tex(code, options=null) {\n        const ocx = options?.ocx ?? this;\n        return ocx.render('tex', code, options);\n    }\n\n    /** options may also include a substitute \"ocx\" which will override the ocx argument\n     */\n    async image_data(code, options=null) {\n        const ocx = options?.ocx ?? this;\n        return ocx.render('image_data', code, options);\n    }\n\n    /** options may also include a substitute \"ocx\" which will override the ocx argument\n     */\n    async graphviz(code, options=null) {\n        const ocx = options?.ocx ?? this;\n        return ocx.render('graphviz', code, options);\n    }\n\n    /** options may also include a substitute \"ocx\" which will override the ocx argument\n     */\n    async plotly(code, options=null) {\n        const ocx = options?.ocx ?? this;\n        return ocx.render('plotly', code, options);\n    }\n\n    /** options may also include a substitute \"ocx\" which will override the ocx argument\n     */\n    async canvas_image(canvas_renderer, options=null) {\n        const ocx = options?.ocx ?? this;\n        return ocx.render('canvas-image', canvas_renderer, options);\n    }\n\n\n    // === RENDERER INTERFACE ===\n\n    /** return a new instance of the appropriate Renderer class for the given type\n     *  @param {String} type\n     *  @return {Renderer} renderer_class\n     */\n    renderer_for_type(type) {\n        this.abort_if_stopped();\n        const renderer_class = Renderer.class_from_type(type);\n        if (!renderer_class) {\n            throw new Error(`unknown output type \"${type}\"`);\n        } else {\n            return new renderer_class();\n        }\n    }\n\n    /** run the given renderer with the given arguments and this ocx\n     *  @param {Renderer} renderer instance\n     *  @param {any} value\n     *  @param {Object} options for renderer\n     *  @return {any} return value from renderer\n     * A new Stoppable created from renderer is dispatched through #new_stoppables\n     */\n    async invoke_renderer(renderer, value, options=null) {\n        const ocx = options?.ocx ?? this;\n        ocx.abort_if_stopped();\n        ocx.#new_stoppables.dispatch(new Stoppable(renderer));\n        return renderer.render(ocx, value, options)\n            .catch(error => {\n                renderer.stop();  // stop anything that may have been started\n                throw error;      // propagate the error\n            })\n            .finally(() => ocx.abort_if_stopped());\n    }\n\n    /** find a renderer and invoke it for the given arguemnts\n     *  @param {String} type\n     *  @param {any} value\n     *  @param {Object} options for renderer\n     *  @return {any} return value from renderer\n     */\n    async invoke_renderer_for_type(type, value, options=null) {\n        const ocx = options?.ocx ?? this;\n        ocx.abort_if_stopped();\n        const renderer = ocx.renderer_for_type(type);\n        return ocx.invoke_renderer(renderer, value, options)\n            .finally(() => ocx.abort_if_stopped());\n    }\n}\n","// Renderer is defined in a separate file to break dependency cycle in get_renderer_classes()\n\nimport {\n    Renderer as imported_Renderer,\n} from './renderer.js';\n\nexport const Renderer = imported_Renderer;  // re-export base class\n\nimport { TextRenderer        } from './text-renderer.js';\nimport { ErrorRenderer       } from './error-renderer.js';\nimport { MarkdownRenderer    } from './markdown-renderer.js';\nimport { TeXRenderer         } from './tex-renderer.js';\nimport { JavaScriptRenderer  } from './javascript-renderer/_.js';\nimport { ImageDataRenderer   } from './image-data-renderer.js';\nimport { GraphvizRenderer    } from './graphviz-renderer.js';\nimport { PlotlyRenderer      } from './plotly-renderer.js';\nimport { CanvasImageRenderer } from './canvas-image-renderer.js';\n\nconst initial_renderer_classes = [\n    TextRenderer,\n    ErrorRenderer,\n    MarkdownRenderer,\n    TeXRenderer,\n    JavaScriptRenderer,\n    ImageDataRenderer,\n    GraphvizRenderer,\n    PlotlyRenderer,\n    CanvasImageRenderer,\n];\n\n/**\n * @param {any} thing to test\n * @return {Boolean} whether or not thing is a strict subclass of Renderer\n */\nfunction is_renderer_subclass(thing) {\n    return (thing?.prototype instanceof Renderer);\n}\n\n\n// === RENDERER CLASSES STATE (INITIALIZED BELOW) ===\n\nlet renderer_classes;            // Array of Renderer subclasses, priority order, all with unique type properties\nlet type_to_renderer_class_map;  // Map type->RendererClass, derived from current renderer_classes\n\n\n// === RENDERER CLASSSES ACCESS/UPDATE ===\n\nexport function renderer_class_from_type(type) {\n    return type_to_renderer_class_map.get(type);\n}\n\nexport function get_renderer_classes() {\n    return [ ...renderer_classes ];\n}\n\n/** set a new collection of Renderer classes\n *  @param {Renderer[]} new_renderer_classes an array of Renderer classes\n * new_renderer_classes must not contain renderers with duplicated types\n * ErrorRenderer will be added to the list if no \"error\" renderer is specified.\n * This is done so that, at the very least, an error renderer will be available\n * when evaluating.\n */\nexport function set_renderer_classes(new_renderer_classes) {\n    if (!Array.isArray(new_renderer_classes)) {\n        throw new Error('new_renderer_classes must be an Array');\n    }\n    const types_seen = new Set();\n    let error_renderer_seen = false;\n    for (const rc of new_renderer_classes) {\n        if (!is_renderer_subclass(rc)) {\n            throw new Error('new_renderer_classes must be an Array of Renderer subsclasses');\n        }\n        if (types_seen.has(rc.type)) {\n            throw new Error(`new_renderer_classes contains multiple entries with type \"${rc.type}\"`);\n        }\n        if (rc.type === ErrorRenderer.type) {\n            error_renderer_seen = true;\n        }\n        types_seen.add(rc.type);\n    }\n    // validation passed, establish new state\n    if (!error_renderer_seen) {\n        // make sure that an error renderer is always available\n        new_renderer_classes = [ ...new_renderer_classes, ErrorRenderer ];\n    }\n    renderer_classes = [ ...new_renderer_classes ];\n    type_to_renderer_class_map =\n        new Map(\n            renderer_classes.map(renderer_class => {\n                return [ renderer_class.type, renderer_class ];\n            })\n        );\n}\n\nexport function reset_to_initial_renderer_classes() {  // called in initialization below\n    set_renderer_classes(initial_renderer_classes);\n}\n\nexport function add_renderer_class(renderer_class) {\n    if (!is_renderer_subclass(renderer_class)) {\n        throw new Error('renderer_class must be a subclass of Renderer');\n    }\n    const new_renderer_classes = [\n        renderer_class,\n        ...renderer_classes.filter(rc => rc.type !== renderer_class.type),\n    ];\n    set_renderer_classes(new_renderer_classes);\n}\n\nexport function remove_renderer_class(renderer_class) {\n    const new_renderer_classes = renderer_classes.filter(rc => rc.type !== renderer_class.type);\n    set_renderer_classes(new_renderer_classes);\n}\n\n\n// === INITIALIZATION ===\n\nreset_to_initial_renderer_classes();\n","import {\n    Renderer,\n} from './renderer.js';\n\n\nexport class CanvasImageRenderer extends Renderer {\n    static type = 'canvas-image';\n\n    async render(ocx, canvas_renderer, options) {\n        if (typeof canvas_renderer !== 'function') {\n            throw new Error('canvas_renderer must be a function');\n        }\n\n        options ??= {};\n\n        if (typeof options.tag !== 'undefined') {\n            console.warn('overriding options.tag value', options.tag);\n        }\n        if (typeof options.attrs?.['data-type'] !== 'undefined') {\n            console.warn('overriding options.attrs[\"data-type\"] value', options.attrs['data-type']);\n        }\n        if (typeof options.attrs?.['src'] !== 'undefined') {\n            console.warn('overriding options.src value', options.attrs.src);\n        }\n\n        const image_options = {\n            ...options,\n            tag: 'img',\n            attrs: {\n                ...(options.attrs ?? {}),\n                'data-type': this.type,\n                // \"src\" set below\n            },\n        };\n        \n        // note: \"width\" and \"height\" attributes, if specified in options, will be\n        // applied to both the canvas element and the img element.  This is ok because\n        // these attributes represent size in px in both element types.\n        \n        const canvas = ocx.constructor.create_element({\n            tag: 'canvas',\n            attrs: {\n                ...(options.attrs ?? {}),\n                width:  options.attrs?.width,\n                height: options.attrs?.height,\n            },\n        });\n        await canvas_renderer(canvas);\n        image_options.attrs.src = canvas.toDataURL();\n\n        const image = ocx.create_child(image_options);\n        return image;\n    }\n}\n","import {\n    load_script,\n} from '../../lib/ui/dom-tools.js';\n\nimport {\n    assets_server_url,\n} from '../assets-server-url.js';\n\n\nlet d3;\n\nexport async function load_d3() {\n    if (!d3) {\n        await load_script(document.head, assets_server_url('dist/d3.min.js'));  // defines globalThis.d3\n        d3 = globalThis.d3;\n    }\n    return d3;\n}\n","import {\n    Renderer,\n} from './renderer.js';\n\n\nexport class ErrorRenderer extends Renderer {\n    static type = 'error';\n\n    static error_element_class      = 'error';\n    static error_element_text_color = 'red';//!!! should be configurable\n\n    async render(ocx, error_object, options) {\n        const style = options?.style;\n\n        const text_segments = [];\n        if (error_object.stack) {\n            text_segments.push(error_object.stack);\n        } else {\n            text_segments.push(error_object.message || 'error');\n        }\n        const text = text_segments.join('\\n');\n\n        const parent = ocx.create_child({\n            tag: 'pre',\n            attrs: {\n                'data-type': this.type,\n            },\n            style: {\n                ...(style ?? {}),\n                color: this.constructor.error_element_text_color,\n            }\n        });\n        parent.innerText = text;  // innerText sanitizes text\n\n        return parent;\n    }\n}\n","import {\n    Renderer,\n} from './renderer.js';\n\nimport {\n    render as graphviz_render,\n} from './graphviz.js';\n\n\nexport class GraphvizRenderer extends Renderer {\n    static type = 'graphviz';\n\n    // Format of config object: {\n    //     node_config?: string,\n    //     nodes[]?: (string | [ string/*name*/, string/*node_options*/ ])[],\n    //     edges[]?: [ string/*from*/, string/*to*/, { label?: string, ... }? ][],\n    // }\n\n    // may throw an error\n    async render(ocx, config, options) {\n        const style = options?.style;\n\n        const element = ocx.create_child({\n            attrs: {\n                'data-type': this.type,\n            },\n            style,\n            set_id: true,  // required for selector below\n        });\n        const element_selector = `#${element.id}`;\n\n        const dot_stmts = [];\n        if (config?.node_config) {\n            dot_stmts.push(`node ${config.node_config}`);\n        }\n        for (const node_spec of (config?.nodes ?? [])) {\n            if (typeof node_spec === 'string') {\n                const name = node_spec;\n                dot_stmts.push(name);\n            } else {\n                const [ name, node_options ] = node_spec;\n                dot_stmts.push(`${name} [${node_options}]`);\n            }\n        }\n        for (const [ from, to, edge_options ] of (config?.edges ?? [])) {\n            dot_stmts.push(`${from}->${to}${edge_options ? `[${edge_options}]` : ''}`);\n        }\n        const dot = `digraph { ${dot_stmts.join(';')} }`;\n\n        // create and run the renderer\n        await graphviz_render(element_selector, dot, {});\n\n        return element;\n    }\n}\n","import {\n    load_d3,\n} from './d3.js';\n\nimport {\n    load_script,\n} from '../../lib/ui/dom-tools.js';\n\nimport {\n    assets_server_url,\n} from '../assets-server-url.js';\n\n\nlet loaded = false;\nasync function load_modules() {\n    const d3 = await load_d3();\n    if (!loaded) {\n        await load_script(document.head, assets_server_url('dist/graphviz.umd.js'));\n        await load_script(document.head, assets_server_url('dist/d3-graphviz.min.js'));\n        loaded = true;\n    }\n    return d3;\n}\n\nexport async function render(element_selector, dot, options) {\n    const d3 = await load_modules();\n    const {\n        transition = \"main\",\n        ease       = d3.easeLinear,\n        delay      = 0,\n        duration   = 0,\n        logEvents  = true,\n    } = (options ?? {});\n    return new Promise((resolve, reject) => {\n        try {\n            function reject_with_string(...args) {\n                reject(new Error(args[0]));\n            }\n            const graphviz = d3.select(element_selector).graphviz({\n                useWorker:       false,\n                useSharedWorker: false,\n            });\n            graphviz\n                .transition(function () {\n                    return d3.transition(transition)\n                        .ease(ease)\n                        .delay(delay)\n                        .duration(duration);\n                })\n                .logEvents(logEvents)\n                .onerror(reject_with_string)\n                .on(\"initEnd\", function () {\n                    graphviz\n                        .renderDot(dot)\n                        .onerror(reject_with_string)\n                        .on(\"end\", resolve);\n                });\n        } catch (error) {\n            reject(error);\n        }\n    });\n}\n","import {\n    Renderer,\n} from './renderer.js';\n\n\nexport class ImageDataRenderer extends Renderer {\n    static type = 'image-data';\n\n    // Format of config object: {\n    //     x?:         number,  // default value: 0\n    //     y?:         number,  // default value: 0\n    //     image_data: ImageData,\n    // }\n    // (or an array of these objects)\n\n    // may throw an error\n    async render(ocx, config, options) {\n        const style = options?.style;\n\n        const parent = ocx.create_child({\n            attrs: {\n                'data-type': this.type,\n            },\n        });\n        const canvas = ocx.constructor.create_element_child(parent, {\n            tag: 'canvas',\n            style,\n        });\n        const ctx = canvas.getContext('2d');\n        const iter_config = Array.isArray(config) ? config : [ config ];\n        for (const { x = 0, y = 0, image_data } of iter_config) {\n            ctx.putImageData(image_data, x, y);\n        }\n\n        return parent;\n    }\n}\n","const current_script_url = import.meta.url;  // save for later\n\nimport {\n    assets_server_url,\n} from '../../assets-server-url.js';\n\nconst lib_dir_path = '../../../lib/';//!!!\nconst lib_dir_url = new URL(lib_dir_path, assets_server_url(current_script_url));\n\n// provide an implementation of dynamic import that is safe from modification by webpack\nconst dynamic_import = new Function('path', 'return import(path);');\n\n\n// ======================================================================\n//!!!\n// CODE EVALUATION\n// ---------------\n// Within the code given for evaluation, \"this\" references the eval_context\n// passed to the eval() method.  This object will be obtained from the\n// logbook, and will persist until the logbook is opened to a new file or\n// is cleared.\n//\n// vars(...objects) assigns new properties to eval_context (i.e., \"this\"\n// within the code), and those properties persist across all cells.\n// The return value is a array of the arguments which will be unmodified.\n//\n// A return statement within a cell terminates the evaluation (except\n// for asynchronous parts that have already been evaluated), and the\n// value passed to the return statement becomes the synchronous result\n// of the evaluation.\n//\n// ephemeral_eval_context\n// ----------------------\n// During evaluation, a number of other values are available \"globally\",\n// though these values do not persist after the particular evaluation\n// (except for references from async code started during the evaluation).\n// These values include ocx (an instance of OutputContext which provides\n// utilities for manipulation of the output of the cell), various graphics,\n// etc functions.  Also included are:\n//\n//     println:        prints its argument followed by newline\n//     printf:         implementation of std C printf()\n//     sprintf:        implementation of std C sprintf()\n//     import_lib:     import other libraries from the lib/ directory\n//     vars:           export new \"global\" properties\n//     is_stopped:     determine if the evaluation has been stopped\n//     delay_ms:       return a Promise that resolves after a specified delay\n//     create_worker:  create a new EvalWorker instance\n//\n// These all continue to be available even after the evaluation has\n// returned if there are any async operations still active.\n// See the method #create_ephemeral_eval_context().\n// ======================================================================\n\nconst AsyncGeneratorFunction = Object.getPrototypeOf(async function* () {}).constructor;\n\nimport {\n    LogbookManager,\n} from '../../logbook-manager.js';\n\nimport {\n    Renderer,\n} from '../renderer.js';\n\nimport {\n    TextRenderer,\n} from '../text-renderer.js';\n\nimport {\n    EvalWorker,\n} from './eval-worker/_.js';\n\nimport {\n    OutputContext,\n} from '../../output-context.js';\n\nimport {\n    Stoppable,\n} from '../../../lib/sys/stoppable.js';\n\nimport {\n    load_Plotly,\n} from '../plotly.js';\n\nimport {\n    load_d3,\n} from '../d3.js';\n\nimport * as canvas_tools from '../../../lib/ui/canvas-tools.js';\n\n\nexport class JavaScriptRenderer extends Renderer {\n    static type = 'javascript';\n\n    // options: { style?: Object, eval_context?: Object, inline?: Boolean }\n\n    // may throw an error\n    // if eval_context is not given in options, then LogbookManager.singleton.global_eval_context is used\n    async render(ocx, code, options=null) {\n        const {\n            style,\n            eval_context = LogbookManager.singleton.global_eval_context,\n            inline,\n        } = (options ?? {});\n\n        // if !style && inline, then use the given ocx,\n        // otherwise, if style || !inline, create a new ocx\n        if (style || !inline) {\n            ocx = ocx.create_child_ocx({\n                tag: inline ? 'span' : 'div',\n                attrs: {\n                    'data-type': this.type,\n                },\n                style,\n            });\n        }\n\n        ocx.new_stoppables.subscribe((new_stoppable) => {\n            this.add_stoppable(new_stoppable);\n        });  //!!! never unsubscribed\n\n        this.stop_states.subscribe(({ stopped }) => {\n            if (stopped) {\n                // this will cause abort when calling methods of ocx.\n                // because we cannot control the JavaScript interpreter,\n                // we have to make do with this \"polling\" type of approach.\n                ocx.stop();\n            }\n        });  //!!! never unsubscribed\n\n        const ephemeral_eval_context = await this.#create_ephemeral_eval_context(eval_context, ocx, code);\n        const ephemeral_eval_context_entries = Object.entries(ephemeral_eval_context);\n\n        // create an async generator with the given code as the heart of its\n        // body, and with parameters being the keys of ephemeral_eval_context.\n        // Then, the code will be evaluated by applying the function to the\n        // corresponding values from ephemeral_eval_context.  Note that\n        // evaluation will be performed in the JavaScript global environment.\n        const eval_fn_params = ephemeral_eval_context_entries.map(([k, _]) => k);\n        const eval_fn_args   = ephemeral_eval_context_entries.map(([_, v]) => v);\n\n        // evaluate the code:\n        const eval_fn_this = eval_context;\n        const eval_fn_body = code;\n        const eval_fn = new AsyncGeneratorFunction(...eval_fn_params, eval_fn_body);\n        const result_stream = eval_fn.apply(eval_fn_this, eval_fn_args);\n\n        // note that using for await ... of misses the return value and we\n        // want to process that, too.  Therefore, instead of the following,\n        // we consume the stream \"manually\".\n        //\n        // for await (const result of result_stream) {\n        //     if (typeof result !== 'undefined') {\n        //         await ephemeral_eval_context.render_value(result);\n        //     }\n        // }\n\n        for (;;) {\n            const { value, done } = await result_stream.next();\n\n            // output any non-undefined values that were received either from\n            // a return or a yield statement in the code\n            if (typeof value !== 'undefined') {\n                if (done) {\n                    // this was the return value, so precede with a special demarcation\n                    await ephemeral_eval_context.render_text('\\n>>> ');\n                }\n\n                await ephemeral_eval_context.render_value(value);\n            }\n\n            if (done) {\n                break;\n            }\n        }\n    }\n\n    async #create_ephemeral_eval_context(eval_context, ocx, source_code='') {\n        const self = this;\n\n        const Plotly = await load_Plotly();\n        const d3     = await load_d3();\n\n        function is_stopped() {\n            return self.stopped;\n        }\n\n        async function create_worker(options) {\n            const worker = new EvalWorker(options);\n            self.add_stoppable(new Stoppable(worker, worker => worker.terminate()));\n            return worker;\n        }\n\n        async function import_lib(lib_path) {\n            return dynamic_import(new URL(lib_path, lib_dir_url));\n        }\n\n        function vars(...objects) {\n            Object.assign(eval_context, ...objects);\n            return objects;\n        }\n\n        const ephemeral_eval_context = {\n            ocx,\n            source_code,  // this evaluation's source code\n\n            // Renderer, etc classes\n            Renderer,\n            Plotly,\n            d3,  // for use with Plotly\n\n            // utility functions defined above\n            is_stopped,\n            create_worker:   ocx.AIS(create_worker),\n            import_lib:      ocx.AIS(import_lib),\n            vars:            ocx.AIS(vars),\n\n            // external\n            sprintf:         ocx.sprintf.bind(ocx),\n\n            // sprintf, sleep, etc\n            sleep:           ocx.sleep.bind(ocx),\n            delay_ms:        ocx.delay_ms.bind(ocx),\n            next_tick:       ocx.next_tick.bind(ocx),\n            next_micro_tick: ocx.next_micro_tick.bind(ocx),\n\n            // output functions defined by ocx\n            render:          ocx.render.bind(ocx),\n            render_text:     ocx.render_text.bind(ocx),\n            render_error:    ocx.render_error.bind(ocx),\n            render_value:    ocx.render_value.bind(ocx),\n            println:         ocx.println.bind(ocx),\n            printf:          ocx.printf.bind(ocx),\n            print__:         ocx.print__.bind(ocx),\n\n            // code and graphics rendering defined by ocx\n            javascript:      ocx.javascript.bind(ocx),\n            markdown:        ocx.markdown.bind(ocx),\n            tex:             ocx.tex.bind(ocx),\n            image_data:      ocx.image_data.bind(ocx),\n            graphviz:        ocx.graphviz.bind(ocx),\n            plotly:          ocx.plotly.bind(ocx),\n            canvas_image:    ocx.canvas_image.bind(ocx),\n            canvas_tools,\n        };\n\n        return ephemeral_eval_context;\n    }\n}\n","const current_script_url = import.meta.url;  // save for later\n\nimport {\n    generate_object_id,\n} from '../../../../lib/sys/uuid.js';\n\nimport {\n    OpenPromise,\n} from '../../../../lib/sys/open-promise.js';\n\nimport {\n    assets_server_url,\n} from '../../../assets-server-url.js';\n\n\nexport class EvalWorker {\n    /** @param {null|undefined|Object} options: {\n     *      keepalive: Boolean,  // (default false) keep running after eval() or stream_eval() completes\n     *  }\n     */\n    constructor(options=null) {\n        const {\n            keepalive = false,\n        } = (options ?? {});\n\n        this.keepalive = !!keepalive;\n\n        Object.defineProperties(this, {\n            id: {\n                value: generate_object_id(),\n                enumerable: true,\n            },\n        });\n        this._worker = new Worker(this.constructor.#worker_code_uri);\n        this._terminated = false;\n        this._current_expression = undefined;\n    }\n\n    get terminated (){ return this._terminated; }\n\n    terminate() {\n        if (!this._terminated) {\n            this._reset_event_handlers();\n            this._current_expression?.terminate();\n            this._current_expression = undefined;\n            this._worker.terminate();\n            this._worker = undefined;\n            this._terminated = true;\n        }\n    }\n\n    async eval(expression, eval_context) {\n        if (this.terminated) {\n            throw new Error(`eval worker ${this.id}: worker has been terminated`);\n        }\n        if (this._current_expression) {\n            throw new Error(`eval worker ${this.id}: an expression evaluation is already in process`);\n        }\n\n        const result_promise = new OpenPromise();\n        let result_promise_fulfilled = false;\n\n        const handle_done = () => {\n            this._current_expression = undefined;\n            this._reset_event_handlers();\n            if (!result_promise_fulfilled) {\n                result_promise.reject(new Error(`eval worker ${this.id} / expression ${expression_id}: evaluation terminated`));\n            }\n            if (!this.keepalive) {\n                this.terminate();\n            }\n        };\n\n        const expression_id = generate_object_id();\n\n        const worker_message = {\n            request: 'eval',\n            id: expression_id,\n            worker_id: this.id,\n            expression,\n            eval_context,\n        };\n\n        this._current_expression = {\n            ...worker_message,\n            terminate() {\n                handle_done();\n            },\n        };\n\n        this._worker.onmessage = (event) => {\n            const result = event.data;\n            if ('value' in result) {\n                result_promise.resolve(result.value);\n            } else {\n                result_promise.reject(result.error);\n            }\n            result_promise_fulfilled = true;\n            handle_done();\n        };\n        this._worker.onerror = (event) => {\n            result_promise.reject(new Error(`eval worker ${this.id} / expression ${expression_id}: error in worker`));\n            result_promise_fulfilled = true;\n            handle_done();\n        };\n        this._worker.onmessageerror = (event) => {\n            result_promise.reject(new Error(`eval worker ${this.id} / expression ${expression_id}: serialization error in worker`));\n            result_promise_fulfilled = true;\n            handle_done();\n        };\n\n        this._worker.postMessage(worker_message);\n\n        return result_promise.promise;\n    }\n\n    // returns an async interator, i.e., this function is an async generator\n    stream_eval(expression, eval_context) {\n        if (this.terminated) {\n            throw new Error(`eval worker ${this.id}: worker has been terminated`);\n        }\n        if (this._current_expression) {\n            throw new Error(`eval worker ${this.id}: an expression evaluation is already in process`);\n        }\n\n        // at least one of pending_results and pending_promises should be empty at any given time\n        const pending_results  = [];  // values/errors waiting to be consumed\n        const pending_promises = [];  // consumed promises waiting for a value/error\n        let   done             = false;\n\n        const handle_done = () => {\n            done = true;\n            this._current_expression = undefined;\n            this._reset_event_handlers();\n            while (pending_promises.length > 0) {\n                pending_promises.shift().resolve({ done: true });\n            }\n            if (!this.keepalive) {\n                this.terminate();\n            }\n        };\n\n        const handle_result = (result) => {\n            if (done) {\n                console.warn(`eval worker ${this.id} / expression ${expression_id}: result received after done`, result);\n            } else {\n                if (pending_promises.length > 0) {\n                    if ('value' in result) {\n                        pending_promises.shift().resolve({ value: result.value });\n                    } else {\n                        pending_promises.shift().reject(result.error);\n                    }\n                } else {\n                    pending_results.push(result);\n                }\n\n                // errors terminate the stream\n                if (result.error) {\n                    handle_done();\n                }\n            }\n        };\n\n        const expression_id = generate_object_id();\n\n        const worker_message = {\n            request: 'stream_eval',\n            id: expression_id,\n            worker_id: this.id,\n            expression,\n            eval_context,\n        };\n\n        this._current_expression = {\n            ...worker_message,\n            terminate() {\n                handle_done();\n            },\n        };\n\n        this._worker.onmessage = (event) => {\n            const result = event.data;\n            if (result.done) {\n                handle_done();\n            } else {\n                handle_result(result);\n            }\n        };\n        this._worker.onerror = (event) => {\n            handle_result({ error: new Error(`eval worker ${this.id} / expression ${expression_id}: error in worker`) });\n            handle_done();\n        };\n        this._worker.onmessageerror = (event) => {\n            handle_result({ error: new Error(`eval worker ${this.id} / expression ${expression_id}: serialization error in worker`) });\n            handle_done();\n        };\n\n        this._worker.postMessage(worker_message);\n\n        return {\n            [Symbol.asyncIterator]() {\n                let i = 0;\n                return {\n                    next() {\n                        if (pending_results.length > 0) {\n                            const result = pending_results.shift();\n                            if ('value' in result) {\n                                return Promise.resolve({ value: result.value });\n                            } else {\n                                return Promise.reject(result.error);\n                            }\n                        } else if (done) {\n                            while (pending_promises.length > 0) {\n                                pending_promises.shift().reject(new Error(`eval worker ${this.id} / expression ${expression_id}: no further results available`));\n                            }\n                            return Promise.resolve({ done: true });\n                        } else {\n                            const new_promise = new OpenPromise();\n                            pending_promises.push(new_promise);\n                            return new_promise.promise;\n                        }\n                    },\n                    return() {\n                        // This will be reached if the consumer called 'break' or 'return' early in the loop.\n                        return { done: true };\n                    },\n                };\n            },\n        };\n    }\n\n    _reset_event_handlers() {\n        if (!this.terminated) {\n            this._worker.onmessage      = undefined;\n            this._worker.onerror        = undefined;\n            this._worker.onmessageerror = undefined;\n        }\n    }\n\n    // Safari does not support static initialization blocks in classes (at the time of writing), so do it this way:\n    static async _async_init_static() {\n        // create a data: URI for the web worker code so that we avoid cross-origin access errors\n        // see: https://stackoverflow.com/questions/23953543/cross-domain-web-workers\n        // and: https://github.com/CezaryDanielNowak/CrossOriginWorker/blob/main/index.js\n        const worker_url = assets_server_url('dist/web-worker.js');  // ./web-worker.js is copied to dist/ dir by build process\n        return fetch(worker_url)\n            .then(res => res.text())\n            .catch(error => {\n                throw new Error('unable to fetch worker code');\n            })\n            .then(code => {\n                const preamble = `\\\n{\n    const original_importScripts = globalThis.importScripts;\n    globalThis.importScripts = (...urls) => {\n        return original_importScripts( ...urls.map(url => new URL(url, \"${worker_url.href}\")) );\n    };\n}\n`;\n                this.#worker_code_uri = `data:text/javascript,${encodeURIComponent(preamble + code)}`;\n            });\n    }\n    static #worker_code_uri;\n}\n\n// Safari does not support static initialization blocks in classes (at the time of writing), so do it this way:\nawait EvalWorker._async_init_static();\n","import {\n    Renderer,\n} from './renderer.js';\n\nimport {\n    marked,\n} from './marked.js';\n\nimport {\n    TeXZilla,\n} from './texzilla.js';\n\nimport {\n    OutputContext,\n} from '../output-context.js';\n\nimport {\n    OpenPromise,\n} from '../../lib/sys/open-promise.js';\n\n\n// TeX handling adapted from: marked-katex-extension/index.js\n// https://github.com/UziTech/marked-katex-extension/blob/main/src/index.js\n// See also: https://marked.js.org/using_pro#async\n\nconst extension_name__inline    = 'inline-tex';\nconst extension_name__block     = 'block-tex';\nconst extension_name__eval_code = 'eval-code';\n\nexport class MarkdownRenderer extends Renderer {\n    static type = 'markdown';\n\n    // options: { style?: Object }\n\n    // may throw an error\n    async render(ocx, markdown, options=null) {\n\n        markdown ??= '';\n\n        const {\n            style,\n        } = (options ?? {});\n\n        const parent = ocx.create_child({\n            attrs: {\n                'data-type': this.type,\n            },\n            style,\n        });\n\n        const main_renderer = this;  // used below in extensions code\n\n        // sequencer_promise is used to evaluate the async walkTokens one\n        // token at a time, in sequence.  Normally, marked runs the\n        // async walkTokens on all tokens in concurrently.\n        // This is important because our renderers may be stateful.\n        let sequencer_promise = Promise.resolve();\n\n        const marked_options = {\n            async: true,  // needed to tell the marked parser operate asynchronously, and to return a promise\n            async walkTokens(token) {\n                const prior_sequencer_promise = sequencer_promise;\n                const new_sequencer_promise = new OpenPromise();\n                sequencer_promise = new_sequencer_promise;\n                await prior_sequencer_promise;\n\n                if (token.type === extension_name__eval_code) {\n                    const output_element = document.createElement('div');\n                    const ocx = new OutputContext(output_element);\n                    let renderer;\n                    try {\n                        renderer = ocx.renderer_for_type(token.output_type);\n                    } catch (error) {\n                        await ocx.render_error(error);\n                    }\n                    if (renderer) {\n                        ocx.new_stoppables.subscribe((new_stoppable) => {\n                            main_renderer.add_stoppable(new_stoppable);\n                        });  //!!! never unsubscribed\n\n                        const options = {\n                            //!!!\n                        };\n                        await ocx.invoke_renderer(renderer, token.text, options)\n                            .catch(error => ocx.render_error(error));\n                        renderer?.stop();  // stop background processing, if any\n                    }\n                    token.html = output_element.innerHTML;\n                }\n\n                new_sequencer_promise.resolve();  // permit next token to be processed\n            }\n        };\n\n        const markup = await marked.parse(markdown, marked_options);  // using extensions, see below\n        parent.innerHTML = markup;\n\n        return parent;\n    }\n}\n\nmarked.use({\n    extensions: [\n        {\n            name: extension_name__inline,\n            level: 'inline',\n            start(src) { return src.indexOf('$'); },\n            tokenizer(src, tokens) {\n                const match = src.match(/^\\$+([^$]+?)\\$+/);\n                if (match) {\n                    return {\n                        type: extension_name__inline,\n                        raw:  match[0],\n                        text: match[1].trim(),\n                    };\n                }\n            },\n            renderer(token) {\n                const inline = true;\n                const rtl = false;//!!!\n                const exc_on_err = false;\n                return TeXZilla.toMathMLString(token.text, !inline, rtl, exc_on_err);\n            },\n        },\n        {\n            name: extension_name__block,\n            level: 'block',\n            start(src) { return src.indexOf('$$'); },\n            tokenizer(src, tokens) {\n                const match = src.match(/^\\$\\$([^$]+?)\\$\\$/);\n                if (match) {\n                    return {\n                        type: extension_name__block,\n                        raw:  match[0],\n                        text: match[1].trim(),\n                    };\n                }\n            },\n            renderer(token) {\n                const inline = false;\n                const rtl = false;//!!!\n                const exc_on_err = false;\n                return `<p>${TeXZilla.toMathMLString(token.text, !inline, rtl, exc_on_err)}</p>`;\n            },\n        },\n        {\n            name: extension_name__eval_code,\n            level: 'block',\n            start(src) { return src.match(/^[`]{3}[ ]*[!]/)?.index; },\n            tokenizer(src, tokens) {\n                const match = src.match(/^[`]{3}[ ]*[!]([ \\t]*[^\\n]*[ \\t]*)?[\\n](.*?)[`]{3}/s);\n                if (match) {\n                    const output_type = (match[1]?.trim() ?? '') || 'javascript';\n                    return {\n                        type: extension_name__eval_code,\n                        output_type,\n                        raw:  match[0],\n                        text: match[2],\n                        html: '',  // filled in later by walkTokens\n                    };\n                }\n            },\n            renderer(token) {\n                return token.html;\n            },\n        },\n    ],\n});\n","import {\n    load_script,\n} from '../../lib/ui/dom-tools.js';\n\nimport {\n    assets_server_url,\n} from '../assets-server-url.js';\n\n\nawait load_script(document.head, assets_server_url('dist/marked.min.js'));\n\nexport const marked = globalThis.marked;\n","import {\n    Renderer,\n} from './renderer.js';\n\nimport {\n    load_Plotly,\n} from './plotly.js';\n\n\nexport class PlotlyRenderer extends Renderer {\n    static type = 'plotly';\n\n    // Format of config object: { data, layout?, config?, frames? } or simply data\n    // (the sub-objects layout, config and frames are optional)\n\n    // may throw an error\n    async render(ocx, config_, options) {\n        if (typeof config_ !== 'object') {\n            throw new Error('config_ must be an object');\n        }\n\n        let data, layout, config, frames;\n        if ('data' in config_ && Array.isArray(config_.data)) {\n            ({\n                data,\n                layout = {},\n                config = {},\n                frames = [],\n            } = config_);\n        } else {\n            data = config_;\n            config = {};\n        }\n        layout ??= {};\n        layout.plot_bgcolor  ??= 'rgba(0, 0, 0, 0)';\n        layout.paper_bgcolor ??= 'rgba(0, 0, 0, 0)';\n\n        config.displayModeBar = false;  // remove icons/links from top-right of plot\n\n        const style = options?.style;\n\n        const parent = ocx.create_child({\n            attrs: {\n                'data-type': this.type,\n            },\n        });\n        const output_element = ocx.constructor.create_element_child(parent, {\n            style,\n        });\n        const Plotly = await load_Plotly();\n        await Plotly.newPlot(output_element, { data, layout, config, frames });  // render to the output_element\n\n        return parent;\n    }\n}\n","import {\n    load_script,\n} from '../../lib/ui/dom-tools.js';\n\nimport {\n    assets_server_url,\n} from '../assets-server-url.js';\n\n\nlet Plotly;  // loaded on demand\n\n/** return the Plotly object which will be lazily loaded because Plotly is large\n */\nexport async function load_Plotly() {\n    if (!Plotly) {\n        await load_script(document.head, assets_server_url('dist/plotly.js'));  // defines globalThis.Plotly\n        Plotly = globalThis.Plotly;\n    }\n    return Plotly;\n}\n","import {\n    StoppableObjectsManager,\n} from '../../lib/sys/stoppable.js';\n\nimport {\n    renderer_class_from_type,\n    get_renderer_classes,\n    set_renderer_classes,\n    reset_to_initial_renderer_classes,\n    add_renderer_class,\n    remove_renderer_class,\n} from './_.js';\n\n\nexport class Renderer extends StoppableObjectsManager {\n    /** type which instances handle, to be overridden in subclasses\n     */\n    static type;\n\n    /** get the type specified by the class\n     */\n    get type (){ return this.constructor.type; }\n\n    /** implementation of rendering, to be implemented by subclasses\n     */\n    async render(ocx, value, options) {\n        throw new Error('NOT IMPLEMENTED');\n    }\n\n    static reset_classes()             { reset_to_initial_renderer_classes(); }\n\n    static class_from_type(type)       { return renderer_class_from_type(type); }\n    static get_classes()               { return get_renderer_classes(); }\n    static set_classes(new_classes)    { set_renderer_classes(new_classes); }\n    static add_class(rc)               { add_renderer_class(rc); }\n    static remove_class(rc)            { remove_renderer_class(rc); }\n\n    static get_class_types()           { return get_renderer_classes().map(rc => rc.type); }\n    static remove_class_for_type(type) { return this.remove_class(this.class_from_type(type)); }\n}\n","import {\n    Renderer,\n} from './renderer.js';\n\nimport {\n    TeXZilla,\n} from './texzilla.js';\n\n\nexport class TeXRenderer extends Renderer {\n    static type = 'tex';\n\n    // options: { style?: Object, inline?: Boolean, rtl?: Boolean }\n\n    // may throw an error\n    async render(ocx, tex, options=null) {\n        tex ??= '';\n\n        const {\n            style,\n            inline,\n            rtl,\n        } = (options ?? {});\n\n        const parent = ocx.create_child({\n            attrs: {\n                'data-type': this.type,\n            },\n            style,\n        });\n        const exc_on_err = false;\n        const mathml = TeXZilla.toMathMLString(tex, !inline, rtl, exc_on_err);\n        parent.innerHTML = mathml;\n\n        return parent;\n    }\n}\n","import {\n    Renderer,\n} from './renderer.js';\n\n\nexport class TextRenderer extends Renderer {\n    static type = 'text';\n\n    static plain_text_css_class = 'plain-text';\n\n    async render(ocx, text, options) {\n        const span = ocx.create_child({\n            tag: 'span',\n            attrs: {\n                'data-type': this.type,\n                class: this.constructor.plain_text_css_class,\n            },\n            style: options?.style,\n        });\n        span.innerText = text;  // innerText sanitizes text\n        return span;\n    }\n}\n","import {\n    load_script,\n} from '../../lib/ui/dom-tools.js';\n\nimport {\n    assets_server_url,\n} from '../assets-server-url.js';\n\n\nawait load_script(document.head, assets_server_url('dist/TeXZilla.js'));  // defines globalThis.TeXZilla\n\nexport const TeXZilla = globalThis.TeXZilla;\n","const current_script_url = import.meta.url;  // save for later\n\nimport {\n    create_element,\n} from '../../../lib/ui/dom-tools.js';\n\nimport {\n    Dialog,\n    AlertDialog,\n    create_control_element,\n    create_select_element,\n} from '../../../lib/ui/dialog/_.js';\n\nimport {\n    get_obj_path,\n    set_obj_path,\n} from '../../../lib/sys/obj-path.js';\n\nimport {\n    get_settings,\n    update_settings,\n    analyze_editor_options_indentUnit,\n    analyze_editor_options_tabSize,\n    analyze_editor_options_indentWithTabs,\n    valid_editor_options_keyMap_values,\n    analyze_editor_options_keyMap,\n    valid_formatting_options_align_values,\n    analyze_formatting_options_align,\n    analyze_formatting_options_indent,\n    get_valid_theme_values,\n    analyze_theme,\n} from '../settings.js';\n\nimport {\n    beep,\n} from '../../../lib/ui/beep.js';\n\nimport {\n    assets_server_url,\n} from '../../assets-server-url.js';\n\n\n// import {\n//     create_stylesheet_link,\n// } from '../../../lib/ui/dom-tools.js';\nexport async function load_stylesheet() {\n    // create_stylesheet_link(document.head, new URL('./settings-dialog.css', assets_server_url(current_script_url)));\n    await import('./settings-dialog.css');  // webpack implementation\n}\n\n\n// dialog definitiion\n\nconst sections = [\n    {\n        name: 'Appearance',\n        settings: [{\n            id: 'theme',\n            label: 'Theme',\n            type: 'select',\n            options: get_valid_theme_values().map(value =>({ value, label: value })),\n            settings_path: [ 'theme' ],\n            analyze: analyze_theme,  // (value, label) => complaint\n        }],\n    }, {\n        name: 'Editor',\n        settings: [{\n            id: 'editor_options_indentUnit',\n            label: 'Indent',\n            type: 'text',\n            settings_path: [ 'editor_options', 'indentUnit' ],\n            analyze: analyze_editor_options_indentUnit,  // (value, label) => complaint\n            convert_to_number: true,\n        }, {\n            id: 'editor_options_tabSize',\n            label: 'Tab size',\n            type: 'text',\n            settings_path: [ 'editor_options', 'tabSize' ],\n            analyze: analyze_editor_options_tabSize,  // (value, label) => complaint\n            convert_to_number: true,\n        }, {\n            id: 'editor_options_indentWithTabs',\n            label: 'Indent with tabs',\n            type: 'checkbox',\n            settings_path: [ 'editor_options', 'indentWithTabs' ],\n            analyze: analyze_editor_options_indentWithTabs,  // (value, label) => complaint\n        }, {\n            id: 'editor_options_keyMap',\n            label: 'Key map',\n            type: 'select',\n            options: valid_editor_options_keyMap_values.map(value => ({ value, label: value })),\n            settings_path: [ 'editor_options', 'keyMap' ],\n            analyze: analyze_editor_options_keyMap,  // (value, label) => complaint\n        }],\n    }, {\n        name: 'TeX Formatting',\n        settings: [{\n            id: 'formatting_options_align',\n            label: 'Horizontal alignment',\n            type: 'select',\n            options: valid_formatting_options_align_values.map(value => ({ value, label: value })),\n            settings_path: [ 'formatting_options', 'align' ],\n            analyze: analyze_formatting_options_align,  // (value, label) => complaint\n        }, {\n            id: 'formatting_options_indent',\n            label: 'Indentation',\n            type: 'text',\n            settings_path: [ 'formatting_options', 'indent' ],\n            analyze: analyze_formatting_options_indent,  // (value, label) => complaint\n        }],\n    },\n];\n\n\nexport class SettingsDialog extends Dialog {\n    static settings_dialog_css_class = 'settings-dialog';\n\n    static run(message, options) {\n        const pre_existing_element = document.querySelector(`header #ui .${this.settings_dialog_css_class}`);//!!! improve #ui\n        if (pre_existing_element) {\n            const pre_existing_instance = Dialog.instance_from_element(pre_existing_element);\n            if (!pre_existing_instance) {\n                throw new Error(`unexpected: Dialog.instance_from_element() returned null for element with class ${this.settings_dialog_css_class}`);\n            }\n            return pre_existing_instance.promise;\n        } else {\n            return new this().run();\n        }\n    }\n\n    _populate_dialog_element() {\n        const current_settings = get_settings();\n\n        // make this dialog identifiable so that the static method run()\n        // can find it if it already exists.\n        this._dialog_element.classList.add(this.constructor.settings_dialog_css_class);\n\n        this._dialog_text_container.innerText = 'Settings';\n\n        for (const section of sections) {\n            const { name, settings } = section;\n            const section_div = this._dialog_form;\n\n            const named_section_div = create_element({ parent: section_div, attrs: { 'data-section': name } });\n            const error_div = create_element({\n                parent: section_div,\n                attrs: {\n                    class: [ 'error-message' ],\n                },\n            });\n\n            for (const setting of settings) {\n                const { id, label, type, settings_path, options, analyze, convert_to_number } = setting;\n                const setting_div = named_section_div;\n                let control;\n                if (type === 'select') {\n                    control = create_select_element(setting_div, id, {\n                        label,\n                        options,\n                    });\n                } else {\n                    control = create_control_element(setting_div, id, {\n                        label,\n                        type,\n                    });\n                }\n\n                if (type === 'checkbox') {\n                    control.checked = get_obj_path(current_settings, settings_path);\n                } else {\n                    control.value = get_obj_path(current_settings, settings_path);\n                }\n\n                const update_handler = async (event) => {\n                    const current_settings = get_settings();\n\n                    const handle_error = async (error_message) => {\n                        error_div.classList.add('active');\n                        error_div.innerText = error_message;\n                        const existing_control = document.getElementById(control.id);\n                        if (!this._completed && existing_control) {\n                            existing_control.focus();\n                            if (existing_control instanceof HTMLInputElement && existing_control.type === 'text') {\n                                existing_control.select();\n                            }\n                            await beep();\n                        } else {\n                            await AlertDialog.run(`settings update failed: ${error_message}`);\n                        }\n                    };\n\n                    const value = (type === 'checkbox') ? control.checked : control.value;\n                    if (analyze) {\n                        const complaint = analyze(value, label);\n                        if (complaint) {\n                            await handle_error(complaint);\n                            return;\n                        }\n                    }\n                    set_obj_path(current_settings, settings_path, (convert_to_number ? +value : value));\n\n                    try {\n                        await update_settings(current_settings);\n                        error_div.classList.remove('active');\n                    } catch (error) {\n                        await handle_error(error.message);\n                    }\n                };\n\n                control.addEventListener('change', update_handler);\n                control.addEventListener('blur',   update_handler);\n            }\n        }\n\n        // Done button should not cause Enter to automatically submit the form\n        // unless directly clicked.\n        const accept_button = create_element({\n            parent: this._dialog_form,\n            tag:    'input',\n            attrs: {\n                type: 'button',\n                value: 'Done',\n            },\n        });\n        accept_button.onclick = (event) => this._dialog_element.close();\n\n        this._dialog_element.onclose = (event) => this._complete();\n    }\n}\n","import {\n    Subscribable,\n} from '../../lib/sys/subscribable.js';\n\nimport {\n    db_key_settings,\n    storage_db,\n} from './storage.js';\n\n\n// === INITIAL SETTINGS ===\n\n\nexport const theme_system = 'system';\nexport const theme_light  = 'light';\nexport const theme_dark   = 'dark';\n\nconst initial_settings = {\n    theme: theme_system,\n    editor_options: {\n        indentUnit:     2,\n        tabSize:        4,\n        indentWithTabs: false,\n        keyMap:         'default',\n    },\n    formatting_options: {\n        align:  'left',\n        indent: '0em',\n    },\n};\n\n\n// === EVENT INTERFACE ===\n\nfunction copy_settings(settings) {\n    return JSON.parse(JSON.stringify(settings));\n}\n\nexport const settings_updated_events = new Subscribable();\n\n\n// === GENERIC VALIDATION ===\n\nconst numeric_re = /^([+-]?[0-9]+[.][0-9]*[Ee][+-]?[0-9]+|[+-]?[.][0-9]+[Ee][+-]?[0-9]+|[+-]?[0-9]+[Ee][+-]?[0-9]+|[+-]?[0-9]+[.][0-9]*|[+-]?[.][0-9]+|[+-]?[0-9]+)$/;\n\n/** validate test_value for being numeric\n *  @param {string|number} test_value string (or number) to be tested\n *  @param {Object|undefined} options an object that may contain values for any of the following flags:\n *             require_integer\n *             reject_negative\n *             reject_zero\n *             reject_positive\n *  @return {boolean} result of validation\n */\nexport function validate_numeric(test_value, options) {\n    const {\n        require_integer,\n        reject_negative,\n        reject_zero,\n        reject_positive,\n    } = (options ?? {});\n\n    let numeric_value;\n    if (typeof test_value === 'number') {\n        numeric_value = test_value;\n    } else {\n        if (typeof test_value !== 'string') {\n            return false;\n        }\n        if (!test_value.trim().match(numeric_re)) {\n            return false;\n        }\n        numeric_value = Number.parseFloat(test_value);\n    }\n\n    if ( isNaN(numeric_value)                                  ||\n         (require_integer && !Number.isInteger(numeric_value)) ||\n         (reject_positive && numeric_value >   0)              ||\n         (reject_zero     && numeric_value === 0)              ||\n         (reject_negative && numeric_value <   0)                 ) {\n        return false;\n    }\n    return true;\n}\n\n/** check if test_value is in a collection of objects\n *  @param {any} test_value value to be tested if it is in collection\n *  @param {Array} collection objects to test membership in\n *  @param {string} name (Optional) name to use for test_value\n *  @return {string|undefined} complaint string if not in collection, or undefined if it is.\n */\nexport function analyze_contained(test_value, collection, name) {\n    if (!collection.includes(test_value)) {\n        return `${name ?? 'value'} must be one of: ${collection.join(', ')}`;\n    }\n    return undefined;\n}\n\n\n// === SETTINGS VALIDATION ===\n\nexport function analyze_editor_options_indentUnit(value, name) {\n    if (!validate_numeric(value, { require_integer: true, reject_negative: true })) {\n        return `${name ?? 'indentUnit'} must be a non-negative integer`;\n    }\n    return undefined;\n}\nexport function analyze_editor_options_tabSize(value, name) {\n    if (!validate_numeric(value, { require_integer: true, reject_negative: true })) {\n        return `${name ?? 'tabSize'} must be a non-negative integer`;\n    }\n    return undefined;\n}\nexport function analyze_editor_options_indentWithTabs(value, name) {\n    if (typeof value !== 'boolean') {\n        return `${name ?? 'indentWithTabs'} must be a boolean value`;\n    }\n    return undefined;\n}\nexport const valid_editor_options_keyMap_values = ['default', 'emacs', 'sublime', 'vim'];\nexport function analyze_editor_options_keyMap(value, name) {\n    return analyze_contained(value, valid_editor_options_keyMap_values, (name ?? 'keyMap'));\n}\n\nexport function analyze_editor_options(editor_options, name) {\n    if (typeof editor_options !== 'object') {\n        return `${name ?? 'editor_options'} must be an object`;\n    }\n    const keys = Object.keys(editor_options);\n    if (!keys.every(k => ['indentUnit', 'tabSize', 'indentWithTabs', 'keyMap'].includes(k))) {\n        return `${name ?? 'editor_options'} may only have the keys \"indentUnit\", \"tabSize\", \"indentWithTabs\" and \"keyMap\"`;\n    }\n    if ('indentUnit' in editor_options) {\n        const complaint = analyze_editor_options_indentUnit(editor_options.indentUnit);\n        if (complaint) {\n            return complaint;\n        }\n    }\n    if ('tabSize' in editor_options) {\n        const complaint = analyze_editor_options_tabSize(editor_options.tabSize);\n        if (complaint) {\n            return complaint;\n        }\n    }\n    if ('indentWithTabs' in editor_options) {\n        const complaint = analyze_editor_options_indentWithTabs(editor_options.indentWithTabs);\n        if (complaint) {\n            return complaint;\n        }\n    }\n    if ('keyMap' in editor_options) {\n        const complaint = analyze_editor_options_keyMap(editor_options.keyMap);\n        if (complaint) {\n            return complaint;\n        }\n    }\n    return undefined;\n}\n\nexport const valid_formatting_options_align_values = ['left', 'center', 'right'];\n/** analyze/validate a formatting_options align property\n *  @param {string} value\n *  @return {string|undefined} returns a complaint string if invalid, or undefined if valid\n */\nexport function analyze_formatting_options_align(value, name) {\n    return analyze_contained(value, valid_formatting_options_align_values, (name ?? 'align'));\n}\nexport const valid_formatting_options_indent_units = ['pt', 'pc', 'in', 'cm', 'mm', 'em', 'ex', 'mu'];\n/** analyze/validate a formatting_options indent property\n *  @param {string} value\n *  @return {string|undefined} returns a complaint string if invalid, or undefined if valid\n */\nexport function analyze_formatting_options_indent(value, name) {\n    if (!valid_formatting_options_indent_units.every(s => (s.length === 2))) {\n        throw new Error('unexpected: valid units contains a string whose length is not 2');\n    }\n    const complaint = `${name ?? 'indent'} must be a string containing a non-negative number followed by one of: ${valid_formatting_options_indent_units.join(', ')}`;\n    if (typeof value !== 'string') {\n        return complaint;\n    }\n    // all valid units strings are length 2\n    value = value.trim();\n    const amount_str = value.slice(0, -2);\n    const units      = value.slice(-2);\n    if ( !validate_numeric(amount_str, { reject_negative: true }) ||\n         !valid_formatting_options_indent_units.includes(units) ) {\n        return complaint;\n    }\n    return undefined;\n}\n/** analyze/validate a formatting_options object\n *  @param {Object} formatting_options: { align?: string, indent?: string }\n *  @return {string|undefined} returns a complaint string if invalid, or undefined if valid\n */\nexport function analyze_formatting_options(formatting_options, name) {\n    if (typeof formatting_options !== 'object') {\n        return `${name ?? 'formatting_options'} must be an object`;\n    }\n    const keys = Object.keys(formatting_options);\n    if (!keys.every(k => ['align', 'indent'].includes(k))) {\n        return `${name ?? 'formatting_options'} may only have the keys \"align\" and \"indent\"`;\n    }\n    if ('align' in formatting_options) {\n        const complaint = analyze_formatting_options_align(formatting_options.align);\n        if (complaint) {\n            return complaint;\n        }\n    }\n    if ('indent' in formatting_options) {\n        const complaint = analyze_formatting_options_indent(formatting_options.indent);\n        if (complaint) {\n            return complaint;\n        }\n    }\n    return undefined;\n}\n\nconst valid_theme_values = [ theme_system, theme_light, theme_dark ];\n\nexport function get_valid_theme_values() {\n    return [ ...valid_theme_values ];\n}\n\nexport function analyze_theme(value, name) {\n    return analyze_contained(value, valid_theme_values, (name ?? 'theme'));\n}\n\nexport function analyze_settings(settings, name) {\n    if (typeof settings !== 'object') {\n        return `${name ?? 'settings'} must be an object`;\n    }\n    const keys = Object.keys(settings);\n    if (!keys.every(k => ['editor_options', 'formatting_options', 'theme'].includes(k))) {\n        return `${name ?? 'settings'} may only have the keys \"editor_options\", \"formatting_options\" and \"theme\"`;\n    }\n    if (!('editor_options' in settings)) {\n        return `${name ?? 'settings'} must contain an \"editor_options\" property`;\n    } else {\n        const complaint = analyze_editor_options(settings.editor_options);\n        if (complaint) {\n            return complaint;\n        }\n    }\n    if (!('formatting_options' in settings)) {\n        return `${name ?? 'settings'} must contain a \"formmating_options\" property`;\n    } else {\n        const complaint = analyze_formatting_options(settings.formatting_options);\n        if (complaint) {\n            return complaint;\n        }\n    }\n    if (!('theme' in settings)) {\n        return `${name ?? 'settings'} must contain a \"theme\" property`;\n    } else {\n        const complaint = analyze_theme(settings.theme);\n        if (complaint) {\n            return complaint;\n        }\n    }\n    return undefined;\n}\n\n// validate initial_settings\n(() => {\n    const complaint = analyze_settings(initial_settings);\n    if (complaint) {\n        throw new Error(`initial_settings: ${complaint}`);\n    }\n})();\n\n\n// === STORAGE ===\n\n// may throw an error if the settings value is corrupt or circular\nasync function put_settings_to_storage(settings) {\n    return storage_db.put(db_key_settings, settings);\n}\n\n// may throw an error if settings value corrupt and unable to store initial settings\nasync function get_settings_from_storage() {\n    try {\n        const settings = await storage_db.get(db_key_settings);\n        if (!analyze_settings(settings)) {\n            return settings;\n        }\n        // otherwise, if !settings, fall out to reset...\n    } catch (_) {\n        // if error, fall out to reset...\n    }\n    // Either settings_string was null or an error occurred when parsing, so reset\n    await put_settings_to_storage(initial_settings);\n    return initial_settings;\n}\n\nlet current_settings = await get_settings_from_storage();\nexport async function _reset_settings() {\n    return update_settings(initial_settings);\n}\nexport function get_settings() {\n    // return a copy to insulate receivers from each other's modifications\n    return copy_settings(current_settings);\n}\n\n// may throw an error if the new_settings value is corrupt or circular\nexport async function update_settings(new_settings) {\n    const complaint = analyze_settings(new_settings);\n    if (complaint) {\n        throw new Error(complaint);\n    }\n    await put_settings_to_storage(new_settings);  // may throw an error\n    current_settings = new_settings;\n    settings_updated_events.dispatch();\n}\n","import {\n    IndexedDBInterface,\n} from '../../lib/sys/idb.js';\n\n\nexport const db_key_settings = 'settings';\nexport const db_key_themes   = 'themes';\nexport const db_key_recents  = 'recents';\n\n// database_name and database_store_name use UUIDs, but these must be constant,\n// not generated each time the system is loaded.\nexport const database_name       = 'settings-database-55e2b166-93eb-4ff8-8ef2-ddb31295efbf';\nexport const database_store_name = 'settings-database-store-55e2b166-93eb-4ff8-8ef2-ddb31295efbf';\n\nexport const storage_db = new IndexedDBInterface(database_name, database_store_name);\n","export class IndexedDBInterface {\n    constructor(database_name, database_store_name) {\n        if (typeof database_name !== 'string' || typeof database_store_name !== 'string') {\n            throw new Error('database_name and database_store_name must be strings');\n        }\n        Object.defineProperties(this, {\n            database_name: {\n                value: database_name,\n            },\n            database_store_name: {\n                value: database_store_name,\n                enumerable: true,\n            },\n            _startup_promise: {\n                value: new Promise((resolve, reject) => {\n                    const request = indexedDB.open(database_name, 1);\n                    request.onerror   = () => reject(request.error);\n                    request.onsuccess = () => resolve(request.result);\n                    request.onupgradeneeded = () => {\n                        // create empty object store (first time upgrade)\n                        request.result.createObjectStore(database_store_name);\n                    };\n                }),\n            },\n        });\n    }\n\n    async with_object_store(mode, receiver) {\n        const db = await this._startup_promise;\n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction(this.database_store_name, mode);\n            transaction.oncomplete = () => resolve();\n            transaction.onabort = transaction.onerror = () => reject(transaction.error);\n            receiver(transaction.objectStore(this.database_store_name));\n        });\n    }\n\n    async get(key) {\n        let req;\n        await this.with_object_store('readonly', store => {\n            req = store.get(key);\n        });\n        return req.result;\n    }\n\n    async put(key, value) {\n        return this.with_object_store('readwrite', store => {\n            store.put(value, key);\n        });\n    }\n\n    async delete(key) {\n        return this.with_object_store('readwrite', store => {\n            store.delete(key);\n        });\n    }\n\n    async clear() {\n        return this.with_object_store('readwrite', store => {\n            store.clear();\n        });\n    }\n\n    async keys() {\n        let req;\n        await this.with_object_store('readonly', store => {\n            req = store.getAllKeys();\n        });\n        return req.result;\n    }\n}\n","import {\n    Subscribable,\n} from '../../lib/sys/subscribable.js';\n\nimport {\n    generate_uuid,\n} from '../../lib/sys/uuid.js';\n\nimport {\n    db_key_themes,\n    storage_db,\n} from './storage.js';\n\nimport {\n    create_element,\n    clear_element,\n} from '../../lib/ui/dom-tools.js';\n\nimport {\n    get_settings,\n    theme_system,\n    theme_light,\n    theme_dark,\n    settings_updated_events,\n} from './settings.js';\n\n\nconst theme_name_validation_re      = /^[A-Za-z_-][A-Za-z0-9_-]*$/;\nconst theme_prop_name_validation_re = /^--theme-[A-Za-z_-][A-Za-z0-9_-]*$/;\n\nconst root_element = document.documentElement;\nexport const root_element_theme_attribute = 'data-theme';\n\n\n/*\n  === THEMES STRATEGY ===\n\n  Custom Themes Issues\n  - THEME NAMES MAY COME FROM USER INPUT, SO DO NOT USE THEM AS KEYS IN OBJECTS\n  - storage is segregated by different document URLs, so custom themes will not be shared\n    among different pages.\n\n  Storage\n  - themes with standard theme names should not be stored because that would\n    prevent future updates to the standard themes from being seen by the user\n  - themes with standard theme names are stored if they have been modified\n  - storage is read once at initialization.  This means that other instances'\n    subsequent modifications will not be seen until re-initialization.  //!!!\n  - the values read from storage (and subsequent updates) are stored in the\n    variable _current_themes_settings.\n  - themes read from storage are \"adjusted\" by filling in missing (standard)\n    props from default_standard_theme.  This clumsily brings old themes forward\n    when the standard theme properties extended.  Note that \"obsolete\" theme\n    properties are left alone in case the omission is temporary.\n  - this all needs to be reviewed when/if user-modified theme settings are\n    implemented.\n\n  External Interface\n  - themes returned to the user via get_themes_settings() start with the\n    themes specified by standard_theme_names first, then any remaining themes.\n    Themes from storage override standard themes.\n  - themes sent to update_themes_settings() will be filtered to remove\n    unmodified standard themes before putting them storage.\n\n  Style Element\n  - a <style> element with definitions for the theme variables for each\n    different theme setting.  When the root element's theme attribute\n    (root_element_theme_attribute) is changed, the CSS custom variables\n    are automatically adjusted.\n*/\n\n\n// === THEME STYLES ===\n\nconst theme_property_name_documentation = `\\\n/*\n  --- THEME PROPERTIES ---\n\n  ELEMENT:\n  by -- body\n  hd -- header\n  tl -- tool-bar\n  ts -- tool-bar toggle-switch\n  ty -- tool-bar type selector\n  ti -- tool-bar indicator\n  cl -- eval-cell/editor-cell\n  ou -- output element\n  mb -- menubar\n  mu -- menu\n  mi -- menuitem\n  ms -- menuitem separator\n  dg -- dialog\n  st -- settings dialog\n  gr -- general graphics element\n  rh -- resize handle\n\n  STYLE FEATURE:        STYLE FEATURE ATTRIBUTE:\n  bg -- background      c -- color\n  fg -- foreground      w -- width\n  bd -- border          s -- style (e.g., dashed)\n  sh -- shadow          r -- radius\n  fl -- fill\n  st -- stroke\n  ct -- caret\n\n  METRIC FEATURE:\n  w -- width\n  h -- height\n  m -- margin\n  p -- padding\n  g -- gap\n\n  OTHER FEATURE:\n  ff -- font-family\n  lh -- line-height\n\n  ---\n\n  PROPERTIES:\n  --theme-{ELEMENT}-{STYLE FEATURE}{STYLE FEATURE ATTRIBUTE}...\n  --theme-{ELEMENT}-{METRIC FEATURE}...\n  --theme-{ELEMENT}-{OTHER FEATURE}...\n*/\n`;\n\n// the first standard theme is the default theme and will be used if no other theme is specified\nconst standard_theme_names = [ theme_light, theme_dark ];  // array length must match array length of values in standard_themes_spec\n\nexport const default_theme_name = standard_theme_names[0];\n\nexport function get_standard_theme_names() {\n    return [ ...standard_theme_names ];\n}\n\nconst standard_themes_spec = {\n    //                                   === LIGHT ===                    === DARK ===\n\n    \"--theme-by-bgc\":                  [ '#f9f9f9',                       '#0e0e0e' ],\n    \"--theme-by-fgc-error\":            [ 'hsl(  0deg   0% 100% / 100%)',  'hsl(  0deg   0%   0% / 100%)' ],\n    \"--theme-by-bgc-error\":            [ 'hsl(  0deg  60%  50% / 100%)',  'hsl(  0deg  60%  50% / 100%)' ],\n    \"--theme-by-bdc-error\":            [ 'hsl(  0deg   0%   0% / 100%)',  'hsl(  0deg   0%   0% / 100%)' ],\n\n    \"--theme-hd-h\":                    [ '1.5rem',                        '1.5rem' ],\n    \"--theme-hd-bgc\":                  [ '#f8f8f8',                       '#2e2e2e' ],\n\n    \"--theme-rh-bgc\":                  [ 'grey',                          'grey' ],\n    \"--theme-rh-bgc-hover\":            [ 'black',                         'lightgrey' ],\n\n    \"--theme-tl-p\":                    [ '0',                             '0' ],\n    \"--theme-tl-g\":                    [ '0.5em',                         '0.5em' ],\n    \"--theme-tl-bgc\":                  [ '#f8f8f8',                       '#1e1e1e' ],\n    \"--theme-tl-bgc-mix\":              [ '10%',                           '25%' ],\n\n    \"--theme-cl-p\":                    [ '0.5em',                         '0.5em' ],\n    \"--theme-cl-lh\":                   [ '140%',                          '140%' ],\n    \"--theme-cl-ff\":                   [ 'monospace',                     'monospace' ],\n    \"--theme-cl-bdw\":                  [ '1px',                           '1px' ],\n    \"--theme-cl-bdr\":                  [ '0.5em',                         '0.5em' ],\n    \"--theme-cl-bds\":                  [ 'solid',                         'solid' ],\n    \"--theme-cl-bdc\":                  [ '#ccc',                          '#4a4a4a' ],\n    \"--theme-cl-bdc-active\":           [ '#898989',                       'hsl(  0deg   0%  55% / 100%)' ],\n    \"--theme-cl-bdc-focus\":            [ 'black',                         'hsl(  0deg   0%  65% / 100%)' ],\n    \"--theme-cl-fgc\":                  [ 'black',                         '#eee' ],\n    \"--theme-cl-bgc\":                  [ 'hsl(  0deg   0%  99% / 100%)',  '#111' ],\n    \"--theme-cl-p-inter\":              [ '0em',                           '0em' ],\n    \"--theme-cl-ctc\":                  [ 'red',                           'red' ],\n\n    \"--theme-ou-p\":                    [ '0.5em',                         '0.5em' ],\n    \"--theme-ou-fgc\":                  [ 'black',                         '#eee' ],\n    \"--theme-ou-bgc\":                  [ 'white',                         'black' ],\n\n    \"--theme-ty-fgc-markdown\":         [ 'black',                         'white' ],\n    \"--theme-ty-bgc-markdown\":         [ 'hsl(205deg  85%  90% / 100%)',  'hsl(205deg  80%  30% / 100%)' ],\n    \"--theme-ty-fgc-tex\":              [ 'black',                         'white' ],\n    \"--theme-ty-bgc-tex\":              [ 'hsl( 45deg  55%  80% / 100%)',  'hsl( 45deg  35%  30% / 100%)' ],\n    \"--theme-ty-fgc-javascript\":       [ 'black',                         'white' ],\n    \"--theme-ty-bgc-javascript\":       [ 'hsl( 85deg  55%  80% / 100%)',  'hsl(120deg  45%  25% / 100%)' ],\n\n    \"--theme-ts-w\":                    [ '1.5rem',                        '1.5rem' ],\n    \"--theme-ts-h\":                    [ '1.5rem',                        '1.5rem' ],\n    \"--theme-ts-flc-autoeval\":         [ 'transparent',                   'transparent' ],\n    \"--theme-ts-stc-autoeval\":         [ 'hsl(  0deg   9%  82% / 100%)',  'hsl(  0deg   9%  82% / 100%)' ],\n    \"--theme-ts-flc-autoeval-checked\": [ 'transparent',                   'transparent' ],\n    \"--theme-ts-stc-autoeval-checked\": [ 'hsl(  0deg  60%  70% / 100%)',  'hsl(  0deg  60%  70% / 100%)' ],\n\n    \"--theme-ti-bdc\":                  [ 'hsl(  0deg   9%  82% / 100%)',  'hsl(  0deg   0%  60% / 100%)' ],\n    \"--theme-ti-bgc\":                  [ 'transparent',                   'transparent' ],\n    \"--theme-ti-bdc-running\":          [ 'black',                         '#d5d5d5' ],\n    \"--theme-ti-bgc-running\":          [ 'hsl(120deg  94%  40% / 100%)',  'hsl(120deg  94%  40% / 100%)' ],\n    \"--theme-ti-bdc-modified\":         [ 'black',                         '#d5d5d5' ],\n    \"--theme-ti-bgc-modified\":         [ 'hsl(  0deg  60%  85% / 100%)',  'hsl(  0deg  55%  45% / 100%)' ],\n\n    \"--theme-ty-bgc\":                  [ 'hsl(  0deg   0%  97% / 100%)',  'hsl(  0deg   0%  97% / 100%)' ],\n\n    \"--theme-mu-bgc\":                  [ '#f8f8f8',                       '#2e2e2e' ],\n    \"--theme-mu-bdc\":                  [ 'grey',                          'grey' ],\n    \"--theme-mu-shc\":                  [ 'lightgrey',                     '#343434' ],\n    \"--theme-mi-fgc\":                  [ 'black',                         '#eee' ],\n    \"--theme-mi-fgc-disabled\":         [ '#bbb',                          '#666' ],\n    \"--theme-mi-bgc-selected\":         [ '#0004',                         '#fff4' ],\n    \"--theme-ms-bgc\":                  [ '#3334',                         '#ccc4' ],\n\n    \"--theme-dg-shc\":                  [ 'grey',                          'grey' ],\n\n    \"--theme-st-bgc\":                  [ 'canvas',                        'canvas' ],\n    \"--theme-st-bdc-section\":          [ 'hsl(  0deg   0%   0% / 100%)',  'hsl(  0deg   0%   0% / 100%)' ],\n    \"--theme-st-bgc-section\":          [ 'hsl(  0deg   0%  98% / 100%)',  'hsl(  0deg   0%  98% / 100%)' ],\n    \"--theme-st-fgc-section\":          [ 'hsl(  0deg   0%   0% / 100%)',  'hsl(  0deg   0%   0% / 100%)' ],\n    \"--theme-st-bdc-section-heading\":  [ '#aaa',                          '#aaa' ],\n    \"--theme-st-bgc-section-heading\":  [ 'hsl(  0deg   0% 100% / 100%)',  'hsl(  0deg   0% 100% / 100%)' ],\n    \"--theme-st-fgc-section-heading\":  [ 'hsl(  0deg   0%   0% / 100%)',  'hsl(  0deg   0%   0% / 100%)' ],\n    \"--theme-st-fgc-section-setting\":  [ 'fieldtext',                     'fieldtext' ],\n    \"--theme-st-bgc-section-setting\":  [ 'field',                         'field' ],\n    \"--theme-st-bdc-warning\":          [ 'hsl(  0deg   0%   0% / 100%)',  'hsl(  0deg   0%   0% / 100%)' ],\n    \"--theme-st-fgc-warning\":          [ 'hsl(  0deg   0%   0% / 100%)',  'hsl(  0deg   0%   0% / 100%)' ],\n    \"--theme-st-bgc-warning\":          [ 'hsl( 60deg  80%  50% / 100%)',  'hsl( 60deg  80%  50% / 100%)' ],\n    \"--theme-st-bdc-error\":            [ 'hsl(  0deg   0%   0% / 100%)',  'hsl(  0deg   0%   0% / 100%)' ],\n    \"--theme-st-fgc-error\":            [ 'hsl(  0deg   0% 100% / 100%)',  'hsl(  0deg   0% 100% / 100%)' ],\n    \"--theme-st-bgc-error\":            [ 'hsl(  0deg  60%  50% / 100%)',  'hsl(  0deg  60%  50% / 100%)' ],\n\n    \"--theme-gr-fgc\":                  [ 'black',                         'white'  ],\n    \"--theme-gr-bgc\":                  [ 'transparent',                   'transparent' ],\n};\n\nconst standard_theme_prop_names = Object.keys(standard_themes_spec);\n\nexport function get_standard_theme_prop_names() {\n    return [ ...standard_theme_prop_names ];\n}\n\nconst standard_themes = standard_theme_names\n      .map((theme_name, theme_idx) => {\n          return {\n              name: theme_name,\n              props: Object.fromEntries(\n                  Object.entries(standard_themes_spec)\n                      .map(([ prop_name, mode_values ]) => {\n                          return [ prop_name, mode_values[theme_idx] ];\n                      })\n              ),\n          };\n      });\n\nconst default_standard_theme = standard_themes[0];\n\n\n// === COPY/EQUIVALENCE ===\n\nfunction copy_theme(theme) {\n    return JSON.parse(JSON.stringify(theme));\n}\n\nfunction copy_themes_settings(themes_settings) {\n    return themes_settings.map(theme => copy_theme(theme));\n}\n\n/** compare two theme specifications\n * @param {Object} theme1\n * @param {Object} theme2\n * @return {Boolean} result\n * Equivalence requires:\n * - both themes contain all standard_theme_prop_names\n * - both themes agree on values for standard_theme_prop_names\n */\nfunction equivalent_themes(theme1, theme2) {\n    if (typeof theme1 !== 'object' || typeof theme2 !== 'object') {\n        throw new Error('specified themes must be objects');\n    }\n    if (theme1 === theme2) {\n        return true;\n    } else {\n        for (const prop of standard_theme_prop_names) {\n            if (!(prop in theme1.props) || !(prop in theme2.props) || theme1.props[prop] !== theme2.props[prop]) {\n                return false;\n            }\n        }\n        return true;  // all standard_theme_prop_names present and matched\n    }\n}\n\n\n// === TO/FROM STORAGE ===\n\n// theme_settings, if given, is validated.\n// theme_settings, if not given, defaults to [].\n// Unmodified standard themes are filtered from what is stored.\nasync function put_themes_settings_to_storage(themes_settings=null) {\n    themes_settings ??= [];\n    validate_themes_array(themes_settings);\n    // filter out unmodified standard themes\n    const filtered_themes_settings = themes_settings.filter(theme => {\n        const corresponding_standard_theme = standard_themes.find(st => (st.name === theme.name));\n        // true -> keep\n        return !corresponding_standard_theme || !equivalent_themes(corresponding_standard_theme, theme);\n    });\n    return storage_db.put(db_key_themes, filtered_themes_settings);\n}\n\n// the returned theme_settings is not validated.\n// the returned theme_settings will not contain any (unmodified) standard theme settings.\nasync function get_themes_settings_from_storage() {\n    return storage_db.get(db_key_themes)\n        .then((themes_settings) => {\n            if (!themes_settings) {\n                throw new Error('themes_settings not found');\n            }\n            return themes_settings;\n        });\n}\n\n\n// === THEME STYLE ELEMENT ===\n\nexport const themes_style_element_id = `themes-${generate_uuid()}`;\n\nfunction get_themes_style_element() {\n    return document.getElementById(themes_style_element_id);\n}\n\nfunction create_themes_style_element() {\n    if (get_themes_style_element()) {\n        throw new Error(`element with id ${themes_style_element_id} already exists`);\n    }\n    if (!document.head) {\n        throw new Error('document.head missing');\n    }\n    return create_element({\n        tag: 'style',\n        parent: document.head,\n        attrs: {\n            id: themes_style_element_id,\n        },\n    });\n}\n\n\n// === VALIDATION AND INITIALIZATION ===\n\nfunction validate_theme_props(theme_props) {\n    if ( typeof theme_props !== 'object' ||\n         !Object.entries(theme_props).every(([ k, v ]) => {\n             return ( typeof(k) === 'string' &&\n                      k.match(theme_prop_name_validation_re) &&\n                      typeof(v) === 'string' );\n         })\n       ) {\n        throw new Error('theme_props must have valid CSS property names starting with --theme- and with string values');\n    }\n}\n\nfunction validate_theme(theme) {\n    const { name, props } = theme;\n    if (name === theme_system) {\n        throw new Error(`\"${theme_system}\" is a reserved theme name`);\n    }\n    if (typeof name !== 'string' || !name.match(theme_name_validation_re)) {\n        throw new Error('invalid theme name');\n    }\n    validate_theme_props(props);\n    for (const prop_name of standard_theme_prop_names) {\n        if (!(prop_name in props)) {\n            throw new Error('theme is missing expected properties');\n        }\n    }\n}\n\nfunction validate_themes_array(themes) {\n    if (!Array.isArray(themes)) {\n        throw new Error('themes must be an array of valid themes');\n    }\n    const names = new Set();\n    for (const theme of themes) {\n        if (names.has(theme.name)) {\n            throw new Error('themes must not contain entries with duplicated names');\n        }\n        names.add(theme.name);\n        validate_theme(theme);\n    }\n}\n\nfunction adjust_theme(theme) {\n    const { name, props } = theme;\n    validate_theme_props(props);\n\n    let adjustment_made = false;\n    const adjusted_props = { ...props };\n    for (const required_prop_name of standard_theme_prop_names) {\n        if (!(required_prop_name in props)) {\n            adjustment_made = true;\n            const value = (name in standard_themes)\n                  ? standard_themes[name][required_prop_name]\n                  : (default_standard_theme[required_prop_name]);  // fall back to first theme if name not found\n            adjusted_props[required_prop_name] = value ?? 'unset';\n        }\n    }\n    // note that props that do no appear in standard_theme_prop_names are left intact\n\n    return adjustment_made ? { name, props: adjusted_props } : null;\n}\n\nfunction adjust_themes_array(themes) {\n    if (!Array.isArray(themes) || themes.length <= 0) {\n        throw new Error('themes must be an array of valid themes with at least one element');\n    }\n    let adjustment_made = false;\n    const adjusted_themes = themes.map((theme) => {\n        const adjusted_theme = adjust_theme(theme);\n        if (!adjusted_theme) {\n            return theme;\n        } else {\n            adjustment_made = true;\n            return adjusted_theme;\n        }\n    });\n    return adjustment_made ? adjusted_themes : null;\n}\n\nfunction create_theme_style_element_section(theme, default_mode=false) {\n    const { name, props } = theme;\n    return `\\\n:root${default_mode ? '' : `[${root_element_theme_attribute}=\"${name}\"]`} {\n${ Object.entries(props)\n       .map(([ prop_name, prop_value ]) => {\n           return `    ${prop_name}: ${prop_value};`;\n       })\n       .join('\\n') }\n}\n`;\n}\n\n/** write the given themes into the themes_style_element.\n *  both inputs are validated\n * @param {Array} themes\n * @param {HTMLElement} themes_style_element\n */\nasync function write_themes_to_style_element(themes, themes_style_element) {\n    validate_themes_array(themes);\n    if (!(themes_style_element instanceof HTMLElement) || themes_style_element.tagName?.toLowerCase() !== 'style') {\n        throw new Error('invalid themes_style_element');\n    }\n    const sections = [];\n    sections.push(theme_property_name_documentation);\n    sections.push(create_theme_style_element_section(themes[0], true));  // default/unspecfied theme\n    for (const theme of themes) {\n        sections.push(create_theme_style_element_section(theme));\n    }\n    themes_style_element.textContent = sections.join('\\n');\n}\n\n/** initialize themes in db if necessary, writing theme styles to the themes_style_element,\n *  and return a value for _current_themes_settings\n * @return {Array} newly-established theme_settings\n */\nasync function initialize_themes() {\n    return get_themes_settings_from_storage()\n        .catch((_) => {\n            return put_themes_settings_to_storage(null)  // initialize empty\n                .catch((error) => {\n                    console.error(error);\n                    throw new Error('unable to initialize themes storage');\n                })\n                .then(() => []);\n        })\n        .then((themes_settings_from_storage) => {\n            // themes_settings_from_storage is now an array of themes from storage.\n            // However, these themes do not include any unmodified standard themes.\n            const themes_settings = [];  // accumulated below\n            // accumulate standard themes, in order, into the beginning of themes_settings\n            for (const standard_theme of standard_themes) {\n                const theme_from_storage = themes_settings_from_storage.find(t => (t.name === standard_theme.name));\n                const theme = theme_from_storage ?? standard_theme;\n                themes_settings.push(theme);\n            }\n            // then append the remaining themes from storage\n            for (const theme_from_storage of themes_settings_from_storage) {\n                if (!standard_theme_names.includes(theme_from_storage.name)) {\n                    themes_settings.push(theme_from_storage);\n                }\n            }\n            const adjusted = adjust_themes_array(themes_settings);\n            if (!adjusted) {\n                validate_themes_array(themes_settings);\n                return themes_settings;\n            } else {\n                return put_themes_settings_to_storage(adjusted)  // also validates\n                    .catch((error) => {\n                        console.error(error);\n                        throw new Error('unable to rewrite adjusted themes');\n                    })\n                    .then(() => adjusted);\n            }\n        })\n        .then((themes_settings) => {\n            // themes_settings is now fully validated and synchronized with storage\n            const themes_style_element = get_themes_style_element() ?? create_themes_style_element();\n            return write_themes_to_style_element(themes_settings, themes_style_element)\n                .catch((error) => {\n                    console.error(error);\n                    throw new Error('unable to write to style element');\n                })\n                .then(() => themes_settings);\n        });\n}\n\n\n// === SYSTEM THEME SETTINGS INTERFACE ===\n\nconst dark_mode_media_query_list = globalThis.matchMedia(\"(prefers-color-scheme: dark)\");\n\n/** set the document attribute specified by root_element_theme_attribute\n *  according to the given state\n * @param {Boolean} dark_state\n */\nfunction set_document_dark_state(dark_state) {\n    //!!! this will reset the user's theme setting if not dark or light (the default)\n    if (dark_state) {\n        root_element.setAttribute(root_element_theme_attribute, theme_dark);\n    } else {\n        root_element.removeAttribute(root_element_theme_attribute);  // default: light\n    }\n}\n\n/** update the dark state for the document according to the current system-level\n *  \"prefers\" setting (light, dark), but with priority to the user's setting for\n *  this program (system, light, dark).\n */\nfunction update_document_dark_state() {\n    switch (get_settings().theme) {\n        default:\n        case theme_system: {\n            set_document_dark_state(dark_mode_media_query_list.matches);\n            break;\n        }\n        case theme_light: {\n            set_document_dark_state(false);\n            break;\n        }\n        case theme_dark: {\n            set_document_dark_state(true);\n            break;\n        }\n    }\n}\n\n\n// === EVENT INTERFACE ===\n\nexport const themes_settings_updated_events = new Subscribable();\n\n\n// === THEME SETTINGS GET/UPDATE INTERFACE ===\n\nlet _current_themes_settings;  // initialized below\n\nexport function get_themes_settings() {\n    return copy_themes_settings(_current_themes_settings);\n}\n\nexport async function update_themes_settings(new_themes_settings) {\n    new_themes_settings = copy_themes_settings(new_themes_settings);\n    await put_themes_settings_to_storage(new_themes_settings);  // also validates\n    write_themes_to_style_element(new_themes_settings, get_themes_style_element());\n    _current_themes_settings = new_themes_settings;\n    themes_settings_updated_events.dispatch();\n}\n\nexport async function reset_to_standard_themes_settings() {\n    return update_themes_settings(standard_themes);\n}\n\n\n// === INITIALIZATION ===\n\n_current_themes_settings = await initialize_themes();\n\ndark_mode_media_query_list.addEventListener('change', update_document_dark_state);\nsettings_updated_events.subscribe(update_document_dark_state);\nupdate_document_dark_state();  // initialize now from current settings/themes_settings\n\nglobalThis.reset_to_standard_themes_settings = reset_to_standard_themes_settings;//!!!\n","const current_script_url = import.meta.url;  // save for later\n\nimport {\n    EventListenerManager,\n} from '../../lib/sys/event-listener-manager.js';\n\nimport {\n    create_element,\n} from '../../lib/ui/dom-tools.js';\n\nimport {\n    beep,\n} from '../../lib/ui/beep.js';\n\nimport {\n    assets_server_url,\n} from '../assets-server-url.js';\n\n// import {\n//     create_stylesheet_link,\n// } from '../../lib/ui/dom-tools.js';\nexport async function load_stylesheet() {\n    // create_stylesheet_link(document.head, new URL('./style.css', assets_server_url(current_script_url)));\n    await import('./style.css');  // webpack implementation\n}\n\n\nexport class ToggleSwitchElement extends HTMLElement {\n    static custom_element_name = 'toggle-switch';\n\n    static create(options=null) {\n        const {\n            parent,\n            class: cls,\n            title_for_on,\n            title_for_off,\n            svg,\n        } = (options ?? {});\n        const control = create_element({\n            parent,\n            tag: this.custom_element_name,\n            attrs: {\n                role: 'switch',\n                \"aria-checked\": false,\n                \"tabindex\": \"0\",\n                title: title_for_off,\n                class: (cls ?? ''),\n            },\n        });\n        control.#event_listener_manager.add(control, 'change', (event) => {\n            control.title = control.get_state() ? title_for_on : title_for_off;\n        });\n        return control;\n    }\n\n    constructor() {\n        super();\n        this.#event_listener_manager = new EventListenerManager();\n        this.#event_listener_manager.add(this, 'click', (event) => {\n            if (!this.is_enabled()) {\n                beep();\n            } else {\n                this.set_state();\n                event.preventDefault();\n                event.stopPropagation();\n            }\n        });\n        this.#event_listener_manager.add(this, 'keydown', (event) => {\n            if ([' ', 'Enter'].includes(event.key)) {\n                if (!this.is_enabled()) {\n                    beep();\n                } else {\n                    this.set_state();\n                    event.preventDefault();\n                    event.stopPropagation();\n                }\n            }\n        });\n    }\n    #event_listener_manager;\n\n    is_enabled() {\n        if (!this.hasAttribute('disabled')) {\n            return true;\n        } else {\n            const disabled_value = this.getAttribute('disabled');\n            return (disabled_value === false.toString());\n        }\n    }\n\n    enable(state) {\n        if (state) {\n            this.removeAttribute('disabled');\n            this.removeAttribute('aria-disabled');\n            this.setAttribute('tabindex', '0');\n            this.style.removeProperty('filter');//!!! hacky way of setting \"disabled\" display state\n        } else {\n            this.setAttribute('disabled', true);\n            this.setAttribute('aria-disabled', true);\n            this.removeAttribute('tabindex');\n            this.style.setProperty('filter', 'opacity(0.45)');//!!! hacky way of setting \"disabled\" display state\n        }\n    }\n\n    get_state() {\n        return (this.getAttribute('aria-checked') === 'true');\n    }\n\n    set_state(new_state=null) {\n        const old_state = this.get_state();\n        new_state ??= !old_state;  // if no argument, then toggle state\n        new_state = !!new_state;\n        this.setAttribute('aria-checked', new_state);\n        if (old_state !== new_state) {\n            this.dispatchEvent(new Event('change'));\n        }\n    }\n\n\n    // === WEB COMPONENT LIFECYCLE ===\n\n    // connectedCallback:\n    //     Invoked each time the custom element is appended into a document-connected element.\n    //     This will happen each time the node is moved, and may happen before the element's contents have been fully parsed.\n    //     Note: connectedCallback may be called once your element is no longer connected, use Node.isConnected to make sure.\n    connectedCallback() {\n        // attributes are not allowed to be set in the constructor so set these here instead\n        this.setAttribute('role', 'switch');\n        this.setAttribute('aria-checked', this.get_state());  // ensure 'aria-checked' is set\n\n        this.#event_listener_manager.attach();\n    }\n\n    // disconnectedCallback:\n    //     Invoked each time the custom element is disconnected from the document's DOM.\n    disconnectedCallback() {\n        this.#event_listener_manager.detach();\n    }\n\n    // adoptedCallback:\n    //     Invoked each time the custom element is moved to a new document.\n    adoptedCallback() {\n        this.#event_listener_manager.attach();\n    }\n\n    // attributeChangedCallback:\n    //     Invoked each time one of the custom element's attributes is added, removed, or changed.\n    //     Which attributes to notice change for is specified in a static get observedAttributes method\n    attributeChangedCallback(name, old_value, new_value) {\n        switch (name) {\n        case 'xyzzy': {\n            //!!!\n            break;\n        }\n        }\n        //!!!\n    }\n\n    static get observedAttributes() {\n        return [\n            'xyzzy',//!!!\n        ];\n    }\n\n\n    // === INTERNAL ===\n\n    // Safari does not support static initialization blocks in classes (at the time of writing), so do it this way:\n    static _init_static() {\n        globalThis.customElements.define(this.custom_element_name, this);\n    }\n}\n\n// Safari does not support static initialization blocks in classes (at the time of writing), so do it this way:\nToggleSwitchElement._init_static();\n","const current_script_url = import.meta.url;  // save for later\n\nimport {\n    ToggleSwitchElement,\n} from '../toggle-switch-element/_.js';\n\nimport {\n    EventListenerManager,\n} from '../../lib/sys/event-listener-manager.js';\n\nimport {\n    get_evaluator_classes,\n} from '../evaluator/_.js';\n\nimport {\n    create_element,\n    clear_element,\n} from '../../lib/ui/dom-tools.js';\n\nimport {\n    assets_server_url,\n} from '../assets-server-url.js';\n\n\n// import {\n//     create_stylesheet_link,\n// } from '../../lib/ui/dom-tools.js';\nexport async function load_stylesheet() {\n    // create_stylesheet_link(document.head, new URL('./style.css', assets_server_url(current_script_url)));\n    await import('./style.css');  // webpack implementation\n}\n\nexport class ToolBarElement extends HTMLElement {\n    static custom_element_name = 'tool-bar';\n\n    static indicator_control__class            = 'tool-bar-indicator';\n    static indicator_control__attribute__value = 'data-indicator-value';\n\n    static toggle_switch__autoeval__class = 'tool-bar-toggle-autoeval';\n\n    /** create a new ToolBarElement in the document, then set target with options\n     *  @param {any} target\n     *  @param {Object|null|undefined} options to be passed to set_target()\n     *  @return {ToolBarElement} tool bar element\n     */\n    static create_for(target, options) {\n        const tool_bar = document.createElement(this.custom_element_name);\n        if (!tool_bar) {\n            throw new Error('error creating tool bar');\n        }\n        try {\n            tool_bar.set_target(target, options);\n            return tool_bar;\n        } catch (error) {\n            tool_bar.remove();\n            throw error;\n        }\n    }\n\n    constructor() {\n        super();\n        this.#target = null;\n        this.#event_listener_manager = new EventListenerManager();\n        this.#reset_configuration();\n    }\n    #event_listener_manager;\n    #controls;  // name -> { name?, control?, get?, set?}\n\n    set_type(type) {\n        this.set_for('type', type);\n    }\n\n\n    // === TARGET ===\n\n    #target;\n\n    /** @return {any} current target\n     */\n    get target (){ return this.#target; }\n\n    /** set the target for this tool bar\n     *  @param {any} target\n     *  @param {Object|null|undefined} options: {\n     *      autoeval?, { initial?, on? },\n     *      type?,     { initial?, on? },\n     *      running?,  { initial?, on? },\n     *      modified?, { initial?, on? },\n     *      run?,      { initial?, on? },\n     *  }\n     * A prior target, if any, is silently replaced.\n     */\n    set_target(target, options=null) {\n        if (target !== null && typeof target !== 'undefined' && !(target instanceof EventTarget)) {\n            throw new Error('target must be null, undefined, or and instance of EventTarget');\n        }\n        if (!target) {\n            this.#target = null;\n            this.#reset_configuration();\n        } else {\n            if (this.#target !== target) {\n                this.#target = target;\n                this.#configure(options);\n            }\n        }\n    }\n\n    get_for(name, value) {\n        if (!(name in this.#controls)) {\n            throw new Error('unknown name');\n        }\n        return this.#controls[name].get();\n    }\n    set_for(name, value) {\n        if (!(name in this.#controls)) {\n            throw new Error('unknown name');\n        }\n        this.#controls[name].set(value);\n    }\n    enable_for(name, value) {\n        if (!(name in this.#controls)) {\n            throw new Error('unknown name');\n        }\n        this.#controls[name].enable(value);\n    }\n\n\n    // === CONFIGURATION ===\n\n    /** set up controls, etc according to options\n     *  @param {Object|null|undefined} options from set_target()\n     */\n    #configure(options=null) {\n        options ??= {};\n        this.#reset_configuration();\n        try {\n            for (const [ name, create, getter, setter, enable ] of this.#get_control_setup()) {\n                let control_options = options[name];\n                if (control_options) {\n                    if (typeof control_options !== 'object') {\n                        control_options = {};\n                    }\n\n                    const control = create(control_options.on);\n                    if ('initial' in control_options) {\n                        setter(control, control_options.initial);\n                    }\n\n                    this.#controls[name] = {\n                        name,\n                        control,\n                        get:    getter.bind(ToolBarElement, control),\n                        set:    setter.bind(ToolBarElement, control),\n                        enable: enable.bind(ToolBarElement, control),\n                    };\n                }\n            }\n            this.#event_listener_manager.add(this, 'pointerdown', (event) => {\n                this.#target.focus();\n                if (event.target instanceof ToolBarElement) {\n                    // stop event only if target is directly a ToolBarElement, not one of its children\n                    event.preventDefault();\n                    event.stopPropagation();\n                }\n            });\n\n        } catch (error) {\n            this.#reset_configuration();\n            throw error;\n        }\n    }\n\n    #reset_configuration() {\n        this.#event_listener_manager.remove_all();\n        clear_element(this);\n        this.#controls = {};\n    }\n\n    /** @return array of arrays of [ name, create, getter, setter, enable ]\n     */\n    #get_control_setup() {\n        const cons = this.constructor;\n        return [\n            // the order of this array determines order of control creation\n\n            // NAME       CREATE_FN,                         GETTER_FN               SETTER_FN               ENABLE_FN\n            [ 'type',     this.#create__type.bind(this),     cons.#getter__type,     cons.#setter__type,     cons.#enable__type     ],\n            [ 'run',      this.#create__run.bind(this),      cons.#getter__run,      cons.#setter__run,      cons.#enable__run      ],\n            [ 'autoeval', this.#create__autoeval.bind(this), cons.#getter__autoeval, cons.#setter__autoeval, cons.#enable__autoeval ],\n            [ 'modified', this.#create__modified.bind(this), cons.#getter__modified, cons.#setter__modified, cons.#enable__modified ],\n            [ 'running',  this.#create__running.bind(this),  cons.#getter__running,  cons.#setter__running,  cons.#enable__running  ],\n        ];\n    }\n\n\n    // === CONTROL HANDLING ===\n\n    #create__autoeval(on_change_handler=null) {\n        const control = create_element({\n            parent: this,\n            tag: 'input',\n            attrs: {\n                type: 'checkbox',\n                title: 'autoeval...',\n            },\n        });\n        control.innerHTML = `\\\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!--\n    Adapted from: https://commons.wikimedia.org/wiki/File:Ei-pencil.svg\n    Alexander Madyankin, Roman Shamin, MIT <http://opensource.org/licenses/mit-license.php>, via Wikimedia Commons\n-->\n<svg\n  xmlns=\"http://www.w3.org/2000/svg\"\n  version=\"1.1\"\n  viewBox=\"0 0 50 50\"\n>\n  <path class=\"accent-stroke accent-fill\" fill=\"#0000\" d=\"M9.6 40.4 l2.5 -9.9 L27 15.6 l7.4 7.4 -14.9 14.9 -9.9 2.5z m4.3 -8.9 l-1.5 6.1 6.1 -1.5 L31.6 23 27 18.4 13.9 31.5z\"/>\n  <path class=\"accent-stroke accent-fill\" fill=\"#0000\" d=\"M17.8 37.3 c-.6 -2.5 -2.6 -4.5 -5.1 -5.1 l.5 -1.9 c3.2 .8 5.7 3.3 6.5 6.5 l-1.9 .5z\"/>\n  <path class=\"accent-stroke accent-fill\" fill=\"#0000\" d=\"M29.298 19.287 l1.414 1.414 -13.01 13.02 -1.414 -1.412z\"/>\n  <path class=\"accent-stroke accent-fill\" fill=\"#0000\" d=\"M11 39 l2.9 -.7 c-.3 -1.1 -1.1 -1.9 -2.2 -2.2 L11 39z\"/>\n  <path class=\"accent-stroke accent-fill\" fill=\"#0000\" d=\"M35 22.4 L27.6 15 l3-3 .5.1 c3.6 .5 6.4 3.3 6.9 6.9 l.1 .5 -3.1 2.9z M30.4 15 l4.6 4.6 .9 -.9 c-.5 -2.3 -2.3 -4.1 -4.6 -4.6 l-.9 .9z\"/>\n</svg>\n`;\n        if (on_change_handler) {\n            this.#event_listener_manager.add(control, 'change', (event) => {\n                if (!on_change_handler(event)) {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    event.stopImmediatePropagation();\n                }\n            });\n        }\n        this.#event_listener_manager.add(control, 'change', (event) => {\n            control.title = control.checked ? 'autoeval off...' : 'autoeval on...';\n        });\n        return control;\n    }\n    static #getter__autoeval(control)        { return control.checked; }\n    static #setter__autoeval(control, value) { control.checked = !!value; }\n    static #enable__autoeval(control, value) { control.enable(value); }\n\n    #create__type(on_change_handler=null) {\n        const control = create_element({\n            parent: this,\n            tag: 'select',\n            attrs: {\n                title: 'type...',\n            },\n            set_id: true,  // prevent warning: \"A form field element should have an id or name attribute\"\n        });\n\n        const types = new Set(get_evaluator_classes().map(e => e.handled_input_types).flat()).values();\n        let subsequent = false;\n        for (const type of types) {\n            create_element({\n                parent: control,\n                tag: 'option',\n                attrs: {\n                    title: 'type...',\n                    label: type,\n                    ...(subsequent ? {} : { selected: !subsequent }),  // first entry is default\n                    value: type,\n                },\n            });\n            subsequent = true;\n        }\n\n        if (on_change_handler) {\n            this.#event_listener_manager.add(control, 'change', (event) => {\n                if (!on_change_handler(event)) {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    event.stopImmediatePropagation();\n                }\n            });\n        }\n        this.#event_listener_manager.add(control, 'change', (event) => {\n            control.title = `type ${control.value}`;\n        });\n        return control;\n    }\n    static #getter__type(control)        { return control.value; }\n    static #setter__type(control, value) {\n        if (![ ...control.options ].map(option => option.value).includes(value)) {  //!!! what a kludge...\n            throw new Error('setting unknown/illegal value');\n        }\n        control.value = value;\n    }\n    static #enable__type(control, value) {\n        if (value) {\n            control.removeAttribute('disabled');\n            control.removeAttribute('aria-disabled');\n        } else {\n            control.setAttribute('disabled', true);\n            control.setAttribute('aria-disabled', true);\n        }\n    }\n\n    #create__running(on_change_handler=null) {\n        return this.#indicator_control__create_with_class_and_title('running', 'running...', 'done...', on_change_handler);\n    }\n    static #getter__running(control)        { return this.#indicator_control__getter(control); }\n    static #setter__running(control, value) { this.#indicator_control__setter(control, value); }\n    static #enable__running(control, value) { /* nothing */ }\n\n    #create__modified(on_change_handler=null) {\n        return this.#indicator_control__create_with_class_and_title('modified', 'modified...', 'not modified...', on_change_handler);\n    }\n    static #getter__modified(control)        { return this.#indicator_control__getter(control); }\n    static #setter__modified(control, value) { this.#indicator_control__setter(control, value); }\n    static #enable__modified(control, value)  { /* nothing */ }\n\n    #create__run(on_change_handler=null) {\n        //!!!\n    }\n    static #getter__run(control) {\n        //!!!\n    }\n    static #setter__run(control, value) {\n        //!!!\n    }\n    static #enable__run(control, value) {\n        //!!!\n    }\n\n    // indicator control getter/setter\n    #indicator_control__create_with_class_and_title(css_class, title_for_on, title_for_off, on_change_handler=null) {\n        const control = create_element({\n            parent: this,\n            attrs: {\n                title: title_for_off,\n                class: [ this.constructor.indicator_control__class, css_class ],\n            },\n        });\n        if (on_change_handler) {\n            this.#event_listener_manager.add(control, 'change', on_change_handler);\n        }\n        this.#event_listener_manager.add(control, 'change', (event) => {\n            control.title = this.constructor.#indicator_control__getter(control) ? title_for_on : title_for_off;\n        });\n        return control;\n    }\n    static #indicator_control__getter(control) {\n        return !!control.getAttribute(this.indicator_control__attribute__value);\n    }\n    static #indicator_control__setter(control, value) {\n        const current_value = this.#indicator_control__getter(control);\n        if (value !== current_value) {\n            control.setAttribute(this.indicator_control__attribute__value, (value ? 'on' : ''));\n            // dispatch \"change\" event\n            const event = new Event('change', {});\n            control.dispatchEvent(event);\n        }\n    }\n\n\n    // === WEB COMPONENT LIFECYCLE ===\n\n    // connectedCallback:\n    //     Invoked each time the custom element is appended into a document-connected element.\n    //     This will happen each time the node is moved, and may happen before the element's contents have been fully parsed.\n    //     Note: connectedCallback may be called once your element is no longer connected, use Node.isConnected to make sure.\n    connectedCallback() {\n        this.#event_listener_manager.attach();\n    }\n\n    // disconnectedCallback:\n    //     Invoked each time the custom element is disconnected from the document's DOM.\n    disconnectedCallback() {\n        this.#event_listener_manager.detach();\n    }\n\n    // adoptedCallback:\n    //     Invoked each time the custom element is moved to a new document.\n    adoptedCallback() {\n        this.#event_listener_manager.attach();\n    }\n\n    // attributeChangedCallback:\n    //     Invoked each time one of the custom element's attributes is added, removed, or changed.\n    //     Which attributes to notice change for is specified in a static get observedAttributes method\n    attributeChangedCallback(name, old_value, new_value) {\n        switch (name) {\n        case 'xyzzy': {\n            //!!!\n            break;\n        }\n        }\n        //!!!\n    }\n\n    static get observedAttributes() {\n        return [\n            'xyzzy',//!!!\n        ];\n    }\n\n\n    // === INTERNAL ===\n\n    // Safari does not support static initialization blocks in classes (at the time of writing), so do it this way:\n    static _init_static() {\n        globalThis.customElements.define(this.custom_element_name, this);\n    }\n}\n\n// Safari does not support static initialization blocks in classes (at the time of writing), so do it this way:\nToolBarElement._init_static();\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".main.js\";\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && !scriptUrl) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t179: 0\n};\n\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => (installedChunkData = installedChunks[chunkId] = [resolve, reject]));\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = (event) => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunklogbook\"] = self[\"webpackChunklogbook\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","__webpack_require__.nc = undefined;","// startup\n// Load entry module and return exports\n// This entry module used 'module' so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(7027);\n"],"names":["webpackQueues","webpackExports","webpackError","resolveQueue","inProgress","dataWebpackPrefix","___CSS_LOADER_EXPORT___","push","module","id","exports","cssWithMappingToString","list","toString","this","map","item","content","needLayer","concat","length","join","i","modules","media","dedupe","supports","layer","undefined","alreadyImportedModules","k","_k","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","data","sourceMapping","options","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","locals","stylesInDOM","getIndexByIdentifier","identifier","result","modulesToDom","idCountMap","identifiers","base","count","indexByIdentifier","obj","css","sourceMap","references","updater","addElementStyle","byIndex","splice","api","update","newObj","remove","lastIdentifiers","newList","index","newLastIdentifiers","_i","_index","memo","style","target","styleTarget","document","querySelector","window","HTMLIFrameElement","contentDocument","head","e","getTarget","Error","appendChild","element","createElement","attributes","styleElement","nonce","setAttribute","apply","parentNode","removeChild","removeStyleElement","styleSheet","cssText","firstChild","createTextNode","EventListenerManager","constructor","attached","empty","add","type","listener","spec","addEventListener","removeEventListener","remove_all","attach","detach","search_spec","static","uses_capture","EventTarget","capture","spec1","spec2","FsInterface","globalThis","FileSystemHandle","FileSystemFileHandle","FileSystemDirectoryHandle","showOpenFilePicker","showSaveFilePicker","showDirectoryPicker","fsaapi_available","async","file_handle","for_writing","ensure_fsaapi_available","writable","mode","queryPermission","requestPermission","get_text","legacy_save","prompt_result","prompt_for_save","prompt_options","canceled","verify_permission","text","createWritable","write","close","stats","get_fs_stats_for_file_handle","legacy_open","prompt_for_open","file","getFile","get_fs_stats_for_file","lastModified","last_modified","name","size","_prompt","multiple","picker","err","Promise","resolve","reject","a_el","download","href","URL","createObjectURL","Blob","body","onfocus","event","revokeObjectURL","click","accept","_convert_options_for_legacy","i_el","getElementById","legacy_file_input_element_id","classList","insertBefore","op","onchange","files","promise","options_accept","types","Object","keys","fs_interface","get_obj_path","path","segment","set_obj_path","value","slice","OpenPromise","o","x","defineProperties","then","bind","catch","finally","rxjs","sprintf","Stoppable","stopper","multiple_stops","stop","enumerable","stop_count","stopped","StoppableObjectsManager","stop_states","add_stoppable","stoppable","remove_stoppable","indexOf","changed","pop","error","console","warn","dispatch","manager","Subscribable","Subject","event_data","next","randomUUID","crypto","getRandomValues","rnds8","Uint8Array","rng","byteToHex","uuidv4","buf","offset","rnds","random","arr","toLowerCase","unsafeStringify","generate_object_id","generate_uuid","beep_data_uri","beep","Audio","play","draw_arc","ctx","y","r","CanvasRenderingContext2D","a0","a1","Math","PI","counterclockwise","no_close_path","no_fill","no_stroke","beginPath","arc","closePath","fill","stroke","default_dot_size_to_line_width_ratio","draw_dot","lineWidth","old_fill_style","fillStyle","strokeStyle","angle_from_heading","dx","dy","t","a","atan","draw_line","x0","y0","x1","y1","label","label_options","moveTo","lineTo","draw_flipped_text","angle","default_tick_length_to_line_width_ratio","draw_tick","hx","hy","len","hmag","sqrt","px","py","draw_ticks","inc","draw_initial","mag","x_inc","y_inc","first","stroke_only","clear","padding","dxr","dyr","includes","initial_transform","getTransform","metrics","measureText","width","height","actualBoundingBoxAscent","actualBoundingBoxDescent","translate","scale","rotate","clearRect","fillRect","setTransform","default_arrowhead_length_to_line_width_ratio","draw_arrowhead","TWOPI","reversed","tick","tip_angle","floor","heading_angle","heading_deflection","tip_heading1","tip_heading2","cos","sin","tick_options","draw_arrow","double","_dialog_element_to_instance_map","WeakMap","Dialog","message","run","querySelectorAll","_modal_dialog_css_class","some","d","open","get","closest","_completed","_promise","_destroy_dialog_element","_dialog_element_id","_create_dialog_element","set","_dialog_element","_cancel","args","_populate_dialog_element","showModal","_complete","header_element","parent","tag","parentElement","ui_element","before","attrs","tagName","dialog_element","class","_dialog_text_container","_dialog_form","method","delete","oncancel","onclose","AlertDialog","accept_button_label","innerText","ConfirmDialog","decline_button_label","decline_button","onclick","returnValue","create_control_element","label_after","control_opts","control","control_label","for","create_select_element","opts","option_elements","option_attrs","option_element","select_element","current_script_url","escape_for_html","s","replaceAll","delay_ms","ms","resolve_result","setTimeout","next_tick","next_micro_tick","queueMicrotask","setup_textarea_auto_resize","textarea","max_height_px","HTMLTextAreaElement","initial_height","scrollHeight","oninput","cs","getComputedStyle","paddingY","parseFloat","paddingTop","paddingBottom","calculated_height","new_height","trigger_textarea_auto_resize","dispatchEvent","Event","clear_element","HTMLElement","Node","scroll_element_into_view","element_rect","getBoundingClientRect","bottom","innerHeight","scrollBy","set_element_attrs","_attr_value","v","removeAttribute","update_element_style","removeProperty","setProperty","validate_parent_and_before_from_options","required_parent_class","parent_from_options","mapping_default_key","create_element","return_mapping","_key","namespace","set_id","children","Array","isArray","every","child","createElementNS","element_id_specified","c","match","mapping","child_desc","child_result","assign","move_node","node","create_element_child_text_node","prevent_coalesce_next","previous","previousSibling","lastChild","nodeType","TEXT_NODE","nodeValue","normalize_element_text","normalize","_script_promise_data","load_script","script_url","permit_duplication","full_script_url","promise_data","initial","data_key","_establish_script_promise_data","script_el","script_load_handler","reset","script_load_error_handler","Element","script_element","src","create_script","once","KeyEventManager","event_target","command_observer","commands","subscribe","reset_key_map_stack","push_key_map","key_map","unshift","pop_key_map","popped_key_map","shift","remove_key_map","remove_subsequent_too","is_attached","multi_mapper","initial_state","state","key_sequence","blur_handler","key_handler","key","key_spec","from_keyboard_event","mapping_result","consume","preventDefault","command_context","command","listener_specs","inject_key_event","key_event","was_attached","KeyMap","bindings","recognizer","create_mapper","fallback_mapper","Mapper","key_maps","m","reduce","mapper","seq_mapping","seq_key_strings","split","canonical_key_string_separator","key_string","is_last","canonical_key_string","canonical","existing","seq_so_far","key_string_or_key_spec","recognizer_result","fallback_mapper_result","KeySpec","context","meta","code","event_prop","glyph","display_order","alternates","ctrl","alt","arrowleft","arrowup","arrowright","arrowdown","enter","backspace","keyboard_event","modifier_descs","modifier","desc","canonical_key_modifier_separator","glyphs","klc","result_segments","toUpperCase","modifiers","at","sort","b","modifier_flags","values","flags","canonical_modifiers","is_printable","shift_flag","freeze","defineProperty","navigator","userAgentData","platform","startsWith","fromEntries","entries","modifier_key","current_bit","disallowed_modifier_codes","all_alternates","acc","Set","codes","props","mdm","create_extended_desc","basic_modifier_key","ext_desc","basic_modifier","bmdm_key","alt_key","_init_static","MenuBar","menuitem","mi","previousElementSibling","contains","nextElementSibling","menubar_spec","get_command_bindings","selects","menu_id","set_focus","menubar_first_menuitem","focus","deactivate","set_menu_state","state_specs","menu_element","select","menuitem_element","container","collection","menuitem_element_br","top","left","menuitem_element_tag_name","menu_spec","toplevel","collection_element","menu_element_tag_name","textContent","forEach","stopPropagation","kbd_bindings","kbd_container","binding","binding_glyphs","menubar_container","role","tabindex","selected_elements","is_in_menubar","key_menu_prev","key_menu_next","key_cross_prev","key_cross_next","find_previous_menuitem","find_next_menuitem","menubar_menuitem","mbi","navigated_into_collection","assets_server_script","assets_server_root","local_server_root","assets_server_url","local_url","protocol","relative","EditorCellElement","super","_tool_bar","ResizeObserver","observe","set_text","get_outer_html","attr_segments","getAttributeNames","attribute__active","getAttribute","encoded_value","text_content","first_child","nextSibling","editable_element","spellcheck","setSelectionRange","text_container","ss","selectionStart","se","selectionEnd","editable","set_editable","enable_for","active","hasAttribute","set_active","attribute_element","set_active_element_mapper","current_active_state","establish_tool_bar","create_for","autoeval","modified","remove_tool_bar","get_dom_extent","last","compareDocumentPosition","DOCUMENT_POSITION_PRECEDING","DOCUMENT_POSITION_FOLLOWING","LogbookManager","singleton","active_element_mapper","cell","custom_element_name","adjacent_cell","forward","cells","move_cell","had_tool_bar","remove_cell","set_active_cell","connectedCallback","disconnectedCallback","adoptedCallback","attributeChangedCallback","old_value","new_value","observedAttributes","customElements","define","EvalCellElement","input_type","set_type","output_element_class","output_element_id","output_element","oid","establish_output_element","dom_extent","create_output_element","remove_output_element","output_element_precedes","element_after_output","evaluator_class","evaluator_class_from_options","eval_context","class_for_content","prototype","evaluator","set_for","emit_eval_state","_perform_eval","ocx","render_error","evaluator_foreground","can_stop","initial_type","on","running","create_cell","get_evaluator_classes","J","Evaluator","input_element","instance","evaluator_classes","default_evaluator_class","handled_input_types","JavaScriptEvaluator","renderer","renderer_for_type","invoke_renderer","MarkdownEvaluator","TeXEvaluator","inline","rtl","get_menubar_spec","get_global_initial_key_map_bindings","get_global_command_bindings","implementor","command_bindings","command_handler__create_cell","command_handler__reset_cell","command_handler__reset","command_handler__clear","command_handler__save","command_handler__save_as","command_handler__eval","command_handler__eval_and_refocus","command_handler__eval_before","command_handler__eval_all","command_handler__stop","command_handler__stop_all","command_handler__focus_up","command_handler__focus_down","command_handler__move_up","command_handler__move_down","command_handler__add_before","command_handler__add_after","command_handler__delete","command_handler__set_mode_markdown","command_handler__set_mode_tex","command_handler__set_mode_javascript","command_handler__shrink_inputs","command_handler__enlarge_inputs","command_handler__collapse_inputs","command_handler__expand_inputs","command_handler__show_settings_dialog","command_handler__show_help","open_help_window","trigger_document_initialization","view_var_name","view_var_value_edit","view_var_value_output","autoeval_var_name","view_value","URLSearchParams","location","search","documentElement","autoeval_value","expand_input_output_split","collapse_input_output_split","inject_command","logbook_manager","readyState","load_event","initialize","reset_global_eval_context","main_element","get_cells","active_cell","getElementsByTagName","global_eval_context","reset_classes","first_cell","find","show_initialization_failed","cell_parent","cell_before","output_element_parent","output_element_before","header_element_tag","main_element_tag","rel","resize_handle_class","trim","current_output_element","enabled","csp_header_content","create","queried_main_element","outerHTML","get_suggested_file_name","pathname","mousedown_event","resize_handle_dragging_state_class","resize_metrics","get_resize_metrics","mouse_x_min","mouse_x_max","split_collapse_px","current_x","resize_handler","new_split_px","get_current_split_px","is_collapsed","collapse_cells_state_class","is_stacked","getPropertyValue","is_stacked_css_variable","active_cell_input_container","step_input_output_split_size","enlarge","split_step_size_px","current_split_px","split_min_px","max","split_max_px","set_input_output_split","new_split","input_output_split_css_variable","main_element_computed_style","main_element_margin_left_px","marginLeft","main_element_width_px","max_split_ratio","collapse_split_ratio","split_step_size_ratio","split_neutral_px","split_neutral_ratio","cell_container","cell_container_class","cell_input_container","cell_input_container_class","editor_element","metaKey","ctrlKey","shiftKey","altKey","currentTarget","success","updated_command_context","bindings_fn","active_index","eval_state","something_foreground","next_cell","save_result","save","suggestedName","eval","em","iter_cell","focus_cell","new_cell_created","stack","error_h1","error_pre","OutputContext","new_stoppables","format","svg_node","svg_string","XMLSerializer","serializeToString","replace","create_element_mapping","create_element_child","abort_if_stopped","operation","AIS","f","scroll_into_view","set_attrs","update_style","create_child","create_child_mapping","create_child_ocx","parent_style_attr","create_child_text_node","normalize_text","constuctor","render","render_text","canvas_renderer","renderer_class","class_from_type","Renderer","initial_renderer_classes","I","is_renderer_subclass","thing","renderer_classes","type_to_renderer_class_map","renderer_class_from_type","get_renderer_classes","set_renderer_classes","new_renderer_classes","types_seen","error_renderer_seen","rc","has","Map","reset_to_initial_renderer_classes","add_renderer_class","filter","remove_renderer_class","CanvasImageRenderer","image_options","canvas","toDataURL","d3","load_d3","ErrorRenderer","error_object","text_segments","color","error_element_text_color","GraphvizRenderer","config","element_selector","dot_stmts","node_config","node_spec","nodes","node_options","from","to","edge_options","edges","dot","loaded","load_modules","transition","ease","easeLinear","delay","duration","logEvents","reject_with_string","graphviz","useWorker","useSharedWorker","onerror","renderDot","ImageDataRenderer","getContext","iter_config","image_data","putImageData","lib_dir_url","dynamic_import","Function","AsyncGeneratorFunction","getPrototypeOf","JavaScriptRenderer","new_stoppable","ephemeral_eval_context","ephemeral_eval_context_entries","eval_fn_params","_","eval_fn_args","eval_fn_this","result_stream","done","render_value","source_code","self","Plotly","is_stopped","create_worker","worker","terminate","import_lib","lib_path","vars","objects","sleep","println","printf","print__","javascript","markdown","tex","plotly","canvas_image","canvas_tools","EvalWorker","keepalive","_worker","Worker","_terminated","_current_expression","terminated","_reset_event_handlers","expression","result_promise","result_promise_fulfilled","handle_done","expression_id","worker_message","request","worker_id","onmessage","onmessageerror","postMessage","stream_eval","pending_results","pending_promises","handle_result","Symbol","asyncIterator","new_promise","return","worker_url","fetch","res","preamble","_async_init_static","extension_name__inline","extension_name__block","extension_name__eval_code","MarkdownRenderer","main_renderer","sequencer_promise","marked_options","token","prior_sequencer_promise","new_sequencer_promise","output_type","html","innerHTML","markup","parse","use","extensions","level","start","tokenizer","tokens","raw","toMathMLString","marked","PlotlyRenderer","config_","layout","frames","plot_bgcolor","paper_bgcolor","displayModeBar","newPlot","load_Plotly","new_classes","remove_class","TeXRenderer","mathml","TextRenderer","span","plain_text_css_class","TeXZilla","sections","settings","settings_path","analyze","convert_to_number","SettingsDialog","pre_existing_element","settings_dialog_css_class","pre_existing_instance","instance_from_element","current_settings","section","section_div","named_section_div","error_div","setting","setting_div","checked","update_handler","handle_error","error_message","existing_control","HTMLInputElement","complaint","theme_system","theme_light","theme_dark","initial_settings","theme","editor_options","indentUnit","tabSize","indentWithTabs","keyMap","formatting_options","align","indent","settings_updated_events","numeric_re","validate_numeric","test_value","require_integer","reject_negative","reject_zero","reject_positive","numeric_value","Number","isNaN","isInteger","analyze_contained","analyze_editor_options_indentUnit","analyze_editor_options_tabSize","analyze_editor_options_indentWithTabs","valid_editor_options_keyMap_values","analyze_editor_options_keyMap","analyze_editor_options","valid_formatting_options_align_values","analyze_formatting_options_align","valid_formatting_options_indent_units","analyze_formatting_options_indent","amount_str","units","analyze_formatting_options","valid_theme_values","get_valid_theme_values","analyze_theme","analyze_settings","put_settings_to_storage","put","get_settings_from_storage","get_settings","update_settings","new_settings","db_key_settings","db_key_themes","storage_db","database_name","database_store_name","_startup_promise","indexedDB","onsuccess","onupgradeneeded","createObjectStore","receiver","db","transaction","oncomplete","onabort","objectStore","req","with_object_store","store","getAllKeys","theme_name_validation_re","theme_prop_name_validation_re","root_element","root_element_theme_attribute","theme_property_name_documentation","standard_theme_names","standard_themes_spec","standard_theme_prop_names","standard_themes","theme_name","theme_idx","prop_name","mode_values","default_standard_theme","copy_theme","equivalent_themes","theme1","theme2","prop","put_themes_settings_to_storage","themes_settings","validate_themes_array","filtered_themes_settings","corresponding_standard_theme","st","get_themes_settings_from_storage","themes_style_element_id","get_themes_style_element","create_themes_style_element","validate_theme_props","theme_props","validate_theme","themes","names","adjust_theme","adjustment_made","adjusted_props","required_prop_name","adjust_themes_array","adjusted_themes","adjusted_theme","create_theme_style_element_section","default_mode","prop_value","write_themes_to_style_element","themes_style_element","initialize_themes","themes_settings_from_storage","standard_theme","theme_from_storage","adjusted","dark_mode_media_query_list","matchMedia","set_document_dark_state","dark_state","update_document_dark_state","matches","themes_settings_updated_events","_current_themes_settings","update_themes_settings","new_themes_settings","reset_to_standard_themes_settings","ToggleSwitchElement","cls","title_for_on","title_for_off","svg","title","get_state","is_enabled","set_state","enable","new_state","old_state","ToolBarElement","tool_bar","set_target","get_for","getter","setter","control_options","cons","on_change_handler","stopImmediatePropagation","flat","subsequent","selected","option","css_class","indicator_control__class","indicator_control__attribute__value","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","queue","fn","hasAwait","currentDeps","outerResolve","depQueues","rej","deps","dep","ret","wrapDeps","getResult","fnQueue","q","n","__esModule","definition","chunkId","all","promises","u","g","hasOwnProperty","call","l","url","script","needAttach","scripts","charset","timeout","nc","onScriptComplete","prev","onload","clearTimeout","doneFns","toStringTag","scriptUrl","importScripts","currentScript","p","installedChunks","j","installedChunkData","errorType","realSrc","webpackJsonpCallback","parentChunkLoadingFunction","chunkIds","moreModules","runtime","chunkLoadingGlobal"],"sourceRoot":""}